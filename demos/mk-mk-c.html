<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=utf-8">
<LINK href="diff-s.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="nav-div.js"></script>
</head>
<body>
<div id="left" class="src">
<pre>
<a id='leftstart' tid='rightstart'></a>
<a id='295' tid='296', class="unchanged" title="(similarity 100%)">;;; This file was generated by writeminikanren.pl
</a><a id='297' tid='298', class="unchanged" title="(similarity 100%)">;;; Generated at 2007-10-25 15:24:42
</a>
(<a id='299' tid='300', class="unchanged" title="(similarity 100%)">define-syntax</a> <a id='301' tid='302', class="unchanged" title="(similarity 100%)">lambdag@</a>
  <span class="deletion" title="deleted">(syntax-rules ()
    ((_ (p) e) (lambda (p) e)))</span>)

(<a id='303' tid='304', class="unchanged" title="(similarity 100%)">define-syntax</a> <a id='305' tid='306', class="unchanged" title="(similarity 100%)">lambdaf@</a>
  <span class="deletion" title="deleted">(syntax-rules ()
    ((_ () e) (lambda () e)))</span>)

(<a id='1' tid='2', class="move" title="(similarity 100%)">define-syntax</a> <a id='3' tid='4', class="move" title="(similarity 100%)">run*</a>
  (<a id='5' tid='6', class="move" title="(similarity 100%)">syntax-rules</a> ()
    ((<a id='7' tid='8', class="move" title="(similarity 100%)">_</a> (<a id='9' tid='10', class="move" title="(similarity 100%)">x</a>) <a id='11' tid='12', class="move" title="(similarity 100%)">g</a> <a id='13' tid='14', class="move" title="(similarity 100%)">...</a>) (<a id='15' tid='16', class="move" title="(similarity 100%)">run</a> <a id='17' tid='18', class="move" title="(similarity 100%)">#f</a> (<a id='19' tid='20', class="move" title="(similarity 100%)">x</a>) <a id='21' tid='22', class="move" title="(similarity 100%)">g</a> <a id='23' tid='24', class="move" title="(similarity 100%)">...</a>))))

(<a id='307' tid='308', class="unchanged" title="(similarity 100%)">define-syntax</a> <a id='309' tid='310', class="unchanged" title="(similarity 100%)">rhs</a>
  (<a id='311' tid='312', class="unchanged" title="(similarity 100%)">syntax-rules</a> ()
    ((<a id='313' tid='314', class="unchanged" title="(similarity 100%)">_</a> <a id='315' tid='316', class="unchanged" title="(similarity 100%)">x</a>) (<a id='317' tid='318', class="unchanged" title="(similarity 100%)">cdr</a> <a id='319' tid='320', class="unchanged" title="(similarity 100%)">x</a>))))

(<a id='321' tid='322', class="unchanged" title="(similarity 100%)">define-syntax</a> <a id='323' tid='324', class="unchanged" title="(similarity 100%)">lhs</a>
  (<a id='325' tid='326', class="unchanged" title="(similarity 100%)">syntax-rules</a> ()
    ((<a id='327' tid='328', class="unchanged" title="(similarity 100%)">_</a> <a id='329' tid='330', class="unchanged" title="(similarity 100%)">x</a>) (<a id='331' tid='332', class="unchanged" title="(similarity 100%)">car</a> <a id='333' tid='334', class="unchanged" title="(similarity 100%)">x</a>))))

(<a id='335' tid='336', class="unchanged" title="(similarity 100%)">define-syntax</a> <a id='337' tid='338', class="unchanged" title="(similarity 100%)">size-s</a>
  (<a id='339' tid='340', class="unchanged" title="(similarity 100%)">syntax-rules</a> ()
    ((<a id='341' tid='342', class="unchanged" title="(similarity 100%)">_</a> <a id='343' tid='344', class="unchanged" title="(similarity 100%)">x</a>) (<a id='345' tid='346', class="unchanged" title="(similarity 100%)">length</a> <a id='347' tid='348', class="unchanged" title="(similarity 100%)">x</a>))))

(<a id='349' tid='350', class="unchanged" title="(similarity 100%)">define-syntax</a> <a id='351' tid='352', class="unchanged" title="(similarity 100%)">var</a>
  (<a id='353' tid='354', class="unchanged" title="(similarity 100%)">syntax-rules</a> ()
    ((<a id='355' tid='356', class="unchanged" title="(similarity 100%)">_</a> <a id='357' tid='358', class="unchanged" title="(similarity 100%)">x</a>) (<a id='359' tid='360', class="unchanged" title="(similarity 100%)">vector</a> <a id='361' tid='362', class="unchanged" title="(similarity 100%)">x</a>))))

(<a id='363' tid='364', class="unchanged" title="(similarity 100%)">define-syntax</a> <a id='365' tid='366', class="unchanged" title="(similarity 100%)">var?</a>
  (<a id='367' tid='368', class="unchanged" title="(similarity 100%)">syntax-rules</a> ()
    ((<a id='369' tid='370', class="unchanged" title="(similarity 100%)">_</a> <a id='371' tid='372', class="unchanged" title="(similarity 100%)">x</a>) (<a id='373' tid='374', class="unchanged" title="(similarity 100%)">vector?</a> <a id='375' tid='376', class="unchanged" title="(similarity 100%)">x</a>))))


(<a id='377' tid='378', class="unchanged" title="(similarity 100%)">define</a> <a id='379' tid='380', class="unchanged" title="(similarity 100%)">empty-s</a> <a id='381' tid='382', class="unchanged" title="(similarity 100%)">&#39;</a>())

(<a id='383' tid='384', class="unchanged" title="(similarity 100%)">define</a> <a id='385' tid='386', class="unchanged" title="(similarity 100%)">walk</a>
  (<a id='387' tid='388', class="unchanged" title="(similarity 100%)">lambda</a> (<a id='389' tid='390', class="unchanged" title="(similarity 100%)">v</a> <a id='391' tid='392', class="unchanged" title="(similarity 100%)">s</a>)
    (<a id='393' tid='394', class="unchanged" title="(similarity 100%)">cond</a>
      ((<a id='395' tid='396', class="unchanged" title="(similarity 100%)">var?</a> <a id='397' tid='398', class="unchanged" title="(similarity 100%)">v</a>)
       (<a id='399' tid='400', class="unchanged" title="(similarity 100%)">let</a> ((<a id='401' tid='402', class="unchanged" title="(similarity 100%)">a</a> (<a id='403' tid='404', class="unchanged" title="(similarity 100%)">assq</a> <a id='405' tid='406', class="unchanged" title="(similarity 100%)">v</a> <a id='407' tid='408', class="unchanged" title="(similarity 100%)">s</a>)))
         (<a id='409' tid='410', class="unchanged" title="(similarity 100%)">cond</a>
           (<a id='411' tid='412', class="unchanged" title="(similarity 100%)">a</a> (<a id='413' tid='414', class="unchanged" title="(similarity 100%)">walk</a> (<a id='415' tid='416', class="unchanged" title="(similarity 100%)">rhs</a> <a id='417' tid='418', class="unchanged" title="(similarity 100%)">a</a>) <a id='419' tid='420', class="unchanged" title="(similarity 100%)">s</a>))
           (<a id='421' tid='422', class="unchanged" title="(similarity 100%)">else</a> <a id='423' tid='424', class="unchanged" title="(similarity 100%)">v</a>))))
      (<a id='425' tid='426', class="unchanged" title="(similarity 100%)">else</a> <a id='427' tid='428', class="unchanged" title="(similarity 100%)">v</a>))))

(<a id='429' tid='430', class="unchanged" title="(similarity 100%)">define</a> <a id='431' tid='432', class="unchanged" title="(similarity 100%)">ext-s</a>
  (<a id='433' tid='434', class="unchanged" title="(similarity 100%)">lambda</a> (<a id='435' tid='436', class="unchanged" title="(similarity 100%)">x</a> <a id='437' tid='438', class="unchanged" title="(similarity 100%)">v</a> <a id='439' tid='440', class="unchanged" title="(similarity 100%)">s</a>)
    (<a id='441' tid='442', class="unchanged" title="(similarity 100%)">cons</a> <a id='443' tid='444', class="unchanged" title="(similarity 100%)">`</a>(<a id='445' tid='446', class="unchanged" title="(similarity 100%)">,</a><a id='447' tid='448', class="unchanged" title="(similarity 100%)">x</a> <a id='449' tid='450', class="unchanged" title="(similarity 100%)">.</a> <a id='451' tid='452', class="unchanged" title="(similarity 100%)">,</a><a id='453' tid='454', class="unchanged" title="(similarity 100%)">v</a>) <a id='455' tid='456', class="unchanged" title="(similarity 100%)">s</a>)))

(<a id='457' tid='458', class="unchanged" title="(similarity 100%)">define</a> <a id='459' tid='460', class="unchanged" title="(similarity 100%)">unify</a>
  (<span class="deletion" title="deleted">lambda</span> <span class="deletion" title="deleted">(v w s)</span>
    (<a id='113' tid='114', class="move" title="(similarity 100%)">let</a> ((<a id='115' tid='116', class="move" title="(similarity 100%)">v</a> (<a id='117' tid='118', class="move" title="(similarity 100%)">walk</a> <a id='119' tid='120', class="move" title="(similarity 100%)">v</a> <a id='121' tid='122', class="move" title="(similarity 100%)">s</a>))
          (<a id='123' tid='124', class="move" title="(similarity 100%)">w</a> (<a id='125' tid='126', class="move" title="(similarity 100%)">walk</a> <a id='127' tid='128', class="move" title="(similarity 100%)">w</a> <a id='129' tid='130', class="move" title="(similarity 100%)">s</a>)))
      (<a id='131' tid='132', class="move" title="(similarity 100%)">cond</a>
        ((<a id='133' tid='134', class="move" title="(similarity 100%)">eq?</a> <a id='135' tid='136', class="move" title="(similarity 100%)">v</a> <a id='137' tid='138', class="move" title="(similarity 100%)">w</a>) <a id='139' tid='140', class="move" title="(similarity 100%)">s</a>)
        ((<a id='141' tid='142', class="move" title="(similarity 100%)">var?</a> <a id='143' tid='144', class="move" title="(similarity 100%)">v</a>) (<a id='145' tid='146', class="move" title="(similarity 100%)">ext-s</a> <a id='147' tid='148', class="move" title="(similarity 100%)">v</a> <a id='149' tid='150', class="move" title="(similarity 100%)">w</a> <a id='151' tid='152', class="move" title="(similarity 100%)">s</a>))
        ((<a id='153' tid='154', class="move" title="(similarity 100%)">var?</a> <a id='155' tid='156', class="move" title="(similarity 100%)">w</a>) (<a id='157' tid='158', class="move" title="(similarity 100%)">ext-s</a> <a id='159' tid='160', class="move" title="(similarity 100%)">w</a> <a id='161' tid='162', class="move" title="(similarity 100%)">v</a> <a id='163' tid='164', class="move" title="(similarity 100%)">s</a>))
        ((<a id='165' tid='166', class="move" title="(similarity 100%)">and</a> (<a id='167' tid='168', class="move" title="(similarity 100%)">pair?</a> <a id='169' tid='170', class="move" title="(similarity 100%)">v</a>) (<a id='171' tid='172', class="move" title="(similarity 100%)">pair?</a> <a id='173' tid='174', class="move" title="(similarity 100%)">w</a>))
         <span class="deletion" title="deleted">(let ((s (unify (car v) (car w) s)))
           (and s (unify (cdr v) (cdr w) s)))</span>)
        ((<a id='175' tid='176', class="move" title="(similarity 100%)">equal?</a> <a id='177' tid='178', class="move" title="(similarity 100%)">v</a> <a id='179' tid='180', class="move" title="(similarity 100%)">w</a>) <a id='181' tid='182', class="move" title="(similarity 100%)">s</a>)
        (<a id='183' tid='184', class="move" title="(similarity 100%)">else</a> <a id='185' tid='186', class="move" title="(similarity 100%)">#f</a>)))))

(<a id='461' tid='462', class="unchanged" title="(similarity 100%)">define</a> <a id='463' tid='464', class="unchanged" title="(similarity 100%)">unify-check</a>
  (<a id='465' tid='466', class="unchanged" title="(similarity 100%)">lambda</a> (<a id='467' tid='468', class="unchanged" title="(similarity 100%)">u</a> <a id='469' tid='470', class="unchanged" title="(similarity 100%)">v</a> <a id='471' tid='472', class="unchanged" title="(similarity 100%)">s</a>)
    (<a id='473' tid='474', class="unchanged" title="(similarity 100%)">let</a> ((<a id='475' tid='476', class="unchanged" title="(similarity 100%)">u</a> (<a id='477' tid='478', class="unchanged" title="(similarity 100%)">walk</a> <a id='479' tid='480', class="unchanged" title="(similarity 100%)">u</a> <a id='481' tid='482', class="unchanged" title="(similarity 100%)">s</a>))
          (<a id='483' tid='484', class="unchanged" title="(similarity 100%)">v</a> (<a id='485' tid='486', class="unchanged" title="(similarity 100%)">walk</a> <a id='487' tid='488', class="unchanged" title="(similarity 100%)">v</a> <a id='489' tid='490', class="unchanged" title="(similarity 100%)">s</a>)))
      (<a id='491' tid='492', class="unchanged" title="(similarity 100%)">cond</a>
        ((<a id='493' tid='494', class="unchanged" title="(similarity 100%)">eq?</a> <a id='495' tid='496', class="unchanged" title="(similarity 100%)">u</a> <a id='497' tid='498', class="unchanged" title="(similarity 100%)">v</a>) <a id='499' tid='500', class="unchanged" title="(similarity 100%)">s</a>)
        ((<a id='501' tid='502', class="unchanged" title="(similarity 100%)">var?</a> <a id='503' tid='504', class="unchanged" title="(similarity 100%)">u</a>) (<a id='505' tid='506', class="unchanged" title="(similarity 100%)">ext-s-check</a> <a id='507' tid='508', class="unchanged" title="(similarity 100%)">u</a> <a id='509' tid='510', class="unchanged" title="(similarity 100%)">v</a> <a id='511' tid='512', class="unchanged" title="(similarity 100%)">s</a>))
        ((<a id='513' tid='514', class="unchanged" title="(similarity 100%)">var?</a> <a id='515' tid='516', class="unchanged" title="(similarity 100%)">v</a>) (<a id='517' tid='518', class="unchanged" title="(similarity 100%)">ext-s-check</a> <a id='519' tid='520', class="unchanged" title="(similarity 100%)">v</a> <a id='521' tid='522', class="unchanged" title="(similarity 100%)">u</a> <a id='523' tid='524', class="unchanged" title="(similarity 100%)">s</a>))
        ((<a id='525' tid='526', class="unchanged" title="(similarity 100%)">and</a> (<a id='527' tid='528', class="unchanged" title="(similarity 100%)">pair?</a> <a id='529' tid='530', class="unchanged" title="(similarity 100%)">u</a>) (<a id='531' tid='532', class="unchanged" title="(similarity 100%)">pair?</a> <a id='533' tid='534', class="unchanged" title="(similarity 100%)">v</a>))
         (<a id='535' tid='536', class="unchanged" title="(similarity 100%)">let</a> ((<a id='537' tid='538', class="unchanged" title="(similarity 100%)">s</a> (<a id='539' tid='540', class="unchanged" title="(similarity 100%)">unify-check</a> 
                    (<a id='541' tid='542', class="unchanged" title="(similarity 100%)">car</a> <a id='543' tid='544', class="unchanged" title="(similarity 100%)">u</a>) (<a id='545' tid='546', class="unchanged" title="(similarity 100%)">car</a> <a id='547' tid='548', class="unchanged" title="(similarity 100%)">v</a>) <a id='549' tid='550', class="unchanged" title="(similarity 100%)">s</a>)))
           (<a id='551' tid='552', class="unchanged" title="(similarity 100%)">and</a> <a id='553' tid='554', class="unchanged" title="(similarity 100%)">s</a> (<a id='555' tid='556', class="unchanged" title="(similarity 100%)">unify-check</a> 
                    (<a id='557' tid='558', class="unchanged" title="(similarity 100%)">cdr</a> <a id='559' tid='560', class="unchanged" title="(similarity 100%)">u</a>) (<a id='561' tid='562', class="unchanged" title="(similarity 100%)">cdr</a> <a id='563' tid='564', class="unchanged" title="(similarity 100%)">v</a>) <a id='565' tid='566', class="unchanged" title="(similarity 100%)">s</a>))))
        ((<a id='567' tid='568', class="unchanged" title="(similarity 100%)">equal?</a> <a id='569' tid='570', class="unchanged" title="(similarity 100%)">u</a> <a id='571' tid='572', class="unchanged" title="(similarity 100%)">v</a>) <a id='573' tid='574', class="unchanged" title="(similarity 100%)">s</a>)
        (<a id='575' tid='576', class="unchanged" title="(similarity 100%)">else</a> <a id='577' tid='578', class="unchanged" title="(similarity 100%)">#f</a>)))))

 
(<a id='579' tid='580', class="unchanged" title="(similarity 100%)">define</a> <a id='581' tid='582', class="unchanged" title="(similarity 100%)">ext-s-check</a>
  (<a id='583' tid='584', class="unchanged" title="(similarity 100%)">lambda</a> (<a id='585' tid='586', class="unchanged" title="(similarity 100%)">x</a> <a id='587' tid='588', class="unchanged" title="(similarity 100%)">v</a> <a id='589' tid='590', class="unchanged" title="(similarity 100%)">s</a>)
    (<a id='591' tid='592', class="unchanged" title="(similarity 100%)">cond</a>
      ((<a id='593' tid='594', class="unchanged" title="(similarity 100%)">occurs-check</a> <a id='595' tid='596', class="unchanged" title="(similarity 100%)">x</a> <a id='597' tid='598', class="unchanged" title="(similarity 100%)">v</a> <a id='599' tid='600', class="unchanged" title="(similarity 100%)">s</a>) <a id='601' tid='602', class="unchanged" title="(similarity 100%)">#f</a>)
      (<a id='603' tid='604', class="unchanged" title="(similarity 100%)">else</a> (<a id='605' tid='606', class="unchanged" title="(similarity 100%)">ext-s</a> <a id='607' tid='608', class="unchanged" title="(similarity 100%)">x</a> <a id='609' tid='610', class="unchanged" title="(similarity 100%)">v</a> <a id='611' tid='612', class="unchanged" title="(similarity 100%)">s</a>)))))

(<a id='613' tid='614', class="unchanged" title="(similarity 100%)">define</a> <a id='615' tid='616', class="unchanged" title="(similarity 100%)">occurs-check</a>
  (<a id='617' tid='618', class="unchanged" title="(similarity 100%)">lambda</a> (<a id='619' tid='620', class="unchanged" title="(similarity 100%)">x</a> <a id='621' tid='622', class="unchanged" title="(similarity 100%)">v</a> <a id='623' tid='624', class="unchanged" title="(similarity 100%)">s</a>)
    (<a id='625' tid='626', class="unchanged" title="(similarity 100%)">let</a> ((<a id='627' tid='628', class="unchanged" title="(similarity 100%)">v</a> (<a id='629' tid='630', class="unchanged" title="(similarity 100%)">walk</a> <a id='631' tid='632', class="unchanged" title="(similarity 100%)">v</a> <a id='633' tid='634', class="unchanged" title="(similarity 100%)">s</a>)))
      (<a id='635' tid='636', class="unchanged" title="(similarity 100%)">cond</a>
        ((<a id='637' tid='638', class="unchanged" title="(similarity 100%)">var?</a> <a id='639' tid='640', class="unchanged" title="(similarity 100%)">v</a>) (<a id='641' tid='642', class="unchanged" title="(similarity 100%)">eq?</a> <a id='643' tid='644', class="unchanged" title="(similarity 100%)">v</a> <a id='645' tid='646', class="unchanged" title="(similarity 100%)">x</a>))
        ((<a id='647' tid='648', class="unchanged" title="(similarity 100%)">pair?</a> <a id='649' tid='650', class="unchanged" title="(similarity 100%)">v</a>) 
         (<a id='651' tid='652', class="unchanged" title="(similarity 100%)">or</a> 
           (<a id='653' tid='654', class="unchanged" title="(similarity 100%)">occurs-check</a> <a id='655' tid='656', class="unchanged" title="(similarity 100%)">x</a> (<a id='657' tid='658', class="unchanged" title="(similarity 100%)">car</a> <a id='659' tid='660', class="unchanged" title="(similarity 100%)">v</a>) <a id='661' tid='662', class="unchanged" title="(similarity 100%)">s</a>)
           (<a id='663' tid='664', class="unchanged" title="(similarity 100%)">occurs-check</a> <a id='665' tid='666', class="unchanged" title="(similarity 100%)">x</a> (<a id='667' tid='668', class="unchanged" title="(similarity 100%)">cdr</a> <a id='669' tid='670', class="unchanged" title="(similarity 100%)">v</a>) <a id='671' tid='672', class="unchanged" title="(similarity 100%)">s</a>)))
        (<a id='673' tid='674', class="unchanged" title="(similarity 100%)">else</a> <a id='675' tid='676', class="unchanged" title="(similarity 100%)">#f</a>)))))

(<a id='677' tid='678', class="unchanged" title="(similarity 100%)">define</a> <a id='679' tid='680', class="unchanged" title="(similarity 100%)">walk*</a>
  (<a id='681' tid='682', class="unchanged" title="(similarity 100%)">lambda</a> (<a id='683' tid='684', class="unchanged" title="(similarity 100%)">w</a> <a id='685' tid='686', class="unchanged" title="(similarity 100%)">s</a>)
    (<a id='687' tid='688', class="unchanged" title="(similarity 100%)">let</a> ((<a id='689' tid='690', class="unchanged" title="(similarity 100%)">v</a> (<a id='691' tid='692', class="unchanged" title="(similarity 100%)">walk</a> <a id='693' tid='694', class="unchanged" title="(similarity 100%)">w</a> <a id='695' tid='696', class="unchanged" title="(similarity 100%)">s</a>)))
      (<a id='697' tid='698', class="unchanged" title="(similarity 100%)">cond</a>
        ((<a id='699' tid='700', class="unchanged" title="(similarity 100%)">var?</a> <a id='701' tid='702', class="unchanged" title="(similarity 100%)">v</a>) <a id='703' tid='704', class="unchanged" title="(similarity 100%)">v</a>)
        ((<a id='705' tid='706', class="unchanged" title="(similarity 100%)">pair?</a> <a id='707' tid='708', class="unchanged" title="(similarity 100%)">v</a>)
         (<a id='709' tid='710', class="unchanged" title="(similarity 100%)">cons</a>
           (<a id='711' tid='712', class="unchanged" title="(similarity 100%)">walk*</a> (<a id='713' tid='714', class="unchanged" title="(similarity 100%)">car</a> <a id='715' tid='716', class="unchanged" title="(similarity 100%)">v</a>) <a id='717' tid='718', class="unchanged" title="(similarity 100%)">s</a>)
           (<a id='719' tid='720', class="unchanged" title="(similarity 100%)">walk*</a> (<a id='721' tid='722', class="unchanged" title="(similarity 100%)">cdr</a> <a id='723' tid='724', class="unchanged" title="(similarity 100%)">v</a>) <a id='725' tid='726', class="unchanged" title="(similarity 100%)">s</a>)))
        (<a id='727' tid='728', class="unchanged" title="(similarity 100%)">else</a> <a id='729' tid='730', class="unchanged" title="(similarity 100%)">v</a>)))))

(<a id='731' tid='732', class="unchanged" title="(similarity 100%)">define</a> <a id='733' tid='734', class="unchanged" title="(similarity 100%)">reify-s</a>
  (<span class="deletion" title="deleted">lambda</span> <span class="deletion" title="deleted">(v s)</span>
    (<span class="deletion" title="deleted">let</span> ((<a id='187' tid='188', class="move" title="(similarity 100%)">v</a> (<a id='189' tid='190', class="move" title="(similarity 100%)">walk</a> <a id='191' tid='192', class="move" title="(similarity 100%)">v</a> <a id='193' tid='194', class="move" title="(similarity 100%)">s</a>)))
      (<a id='55' tid='56', class="move" title="(similarity 100%)">cond</a>
        ((<a id='57' tid='58', class="move" title="(similarity 100%)">var?</a> <a id='59' tid='60', class="move" title="(similarity 100%)">v</a>)
         (<a id='61' tid='62', class="move" title="(similarity 100%)">ext-s</a> <a id='63' tid='64', class="move" title="(similarity 100%)">v</a> (<a id='65' tid='66', class="move" title="(similarity 100%)">reify-name</a> (<a id='67' tid='68', class="move" title="(similarity 100%)">size-s</a> <a id='69' tid='70', class="move" title="(similarity 100%)">s</a>)) <a id='71' tid='72', class="move" title="(similarity 100%)">s</a>))
        ((<a id='73' tid='74', class="move" title="(similarity 100%)">pair?</a> <a id='75' tid='76', class="move" title="(similarity 100%)">v</a>) (<a id='77' tid='78', class="move" title="(similarity 100%)">reify-s</a> (<a id='79' tid='80', class="move" title="(similarity 100%)">cdr</a> <a id='81' tid='82', class="move" title="(similarity 100%)">v</a>)
                     (<a id='83' tid='84', class="move" title="(similarity 100%)">reify-s</a> (<a id='85' tid='86', class="move" title="(similarity 100%)">car</a> <a id='87' tid='88', class="move" title="(similarity 100%)">v</a>) <a id='89' tid='90', class="move" title="(similarity 100%)">s</a>)))
        (<a id='91' tid='92', class="move" title="(similarity 100%)">else</a> <a id='93' tid='94', class="move" title="(similarity 100%)">s</a>)))))

(<a id='735' tid='736', class="unchanged" title="(similarity 100%)">define</a> <a id='737' tid='738', class="unchanged" title="(similarity 100%)">reify-name</a>
  (<a id='739' tid='740', class="unchanged" title="(similarity 100%)">lambda</a> (<a id='741' tid='742', class="unchanged" title="(similarity 100%)">n</a>)
    (<a id='743' tid='744', class="unchanged" title="(similarity 100%)">string-&gt;symbol</a>
      (<a id='745' tid='746', class="unchanged" title="(similarity 100%)">string-append</a> <a id='747' tid='748', class="unchanged" title="(similarity 100%)">&quot;_&quot;</a> <a id='749' tid='750', class="unchanged" title="(similarity 100%)">&quot;.&quot;</a> (<a id='751' tid='752', class="unchanged" title="(similarity 100%)">number-&gt;string</a> <a id='753' tid='754', class="unchanged" title="(similarity 100%)">n</a>)))))

(<a id='755' tid='756', class="unchanged" title="(similarity 100%)">define</a> <a id='757' tid='758', class="unchanged" title="(similarity 100%)">reify</a>
  (<a id='759' tid='760', class="unchanged" title="(similarity 100%)">lambda</a> (<a id='761' tid='762', class="unchanged" title="(similarity 100%)">v</a> <a id='763' tid='764', class="unchanged" title="(similarity 100%)">s</a>)
    (<a id='765' tid='766', class="unchanged" title="(similarity 100%)">let</a> ((<a id='767' tid='768', class="unchanged" title="(similarity 100%)">v</a> (<a id='769' tid='770', class="unchanged" title="(similarity 100%)">walk*</a> <a id='771' tid='772', class="unchanged" title="(similarity 100%)">v</a> <a id='773' tid='774', class="unchanged" title="(similarity 100%)">s</a>)))
      (<a id='775' tid='776', class="unchanged" title="(similarity 100%)">walk*</a> <a id='777' tid='778', class="unchanged" title="(similarity 100%)">v</a> (<a id='779' tid='780', class="unchanged" title="(similarity 100%)">reify-s</a> <a id='781' tid='782', class="unchanged" title="(similarity 100%)">v</a> <a id='783' tid='784', class="unchanged" title="(similarity 100%)">empty-s</a>)))))

(<a id='785' tid='786', class="unchanged" title="(similarity 100%)">define</a> <a id='787' tid='788', class="unchanged" title="(similarity 100%)">==</a> 
  <span class="deletion" title="deleted">(lambda (u v)
    (lambdag@ (s) (unify u v s)))</span>)

<span class="deletion" title="deleted">(define ==-check
  (lambda (v w)
    (lambdag@ (s)
      (unify-check v w s))))</span>

<span class="deletion" title="deleted">(define-syntax mzero 
  (syntax-rules () ((_) #f)))</span>

(<a id='25' tid='26', class="move" title="(similarity 100%)">define-syntax</a> <a id='27' tid='28', class="move" title="(similarity 100%)">inc</a> 
  (<a id='29' tid='30', class="move" title="(similarity 100%)">syntax-rules</a> () ((<a id='31' tid='32', class="move" title="(similarity 100%)">_</a> <a id='33' tid='34', class="move" title="(similarity 100%)">e</a>) (<a id='35' tid='36', class="move" title="(similarity 100%)">lambdaf@</a> () <a id='37' tid='38', class="move" title="(similarity 100%)">e</a>))))

<span class="deletion" title="deleted">(define-syntax unit 
  (syntax-rules () ((_ a) a)))</span>

<span class="deletion" title="deleted">(define-syntax choice 
  (syntax-rules () ((_ a f) (cons a f))))</span>
 
<span class="deletion" title="deleted">(define-syntax case-inf
  (syntax-rules ()
    ((_ e (() e0) ((f^) e1) ((a^) e2) ((a f) e3))
     (let ((a-inf e))
       (cond
         ((not a-inf) e0)
         ((procedure? a-inf) (let ((f^ a-inf)) e1))
         ((not (and (pair? a-inf)
                    (procedure? (cdr a-inf))))
          (let ((a^ a-inf)) e2))
         (else (let ((a (car a-inf)) (f (cdr a-inf))) 
                 e3)))))))</span>

(<a id='95' tid='96', class="move" title="(similarity 100%)">define-syntax</a> <a id='97' tid='98', class="move" title="(similarity 100%)">run</a>
  (<a id='99' tid='100', class="move" title="(similarity 100%)">syntax-rules</a> ()
    ((<a id='101' tid='102', class="move" title="(similarity 100%)">_</a> <a id='103' tid='104', class="move" title="(similarity 100%)">n</a> (<a id='105' tid='106', class="move" title="(similarity 100%)">x</a>) <a id='107' tid='108', class="move" title="(similarity 100%)">g0</a> <a id='109' tid='110', class="move" title="(similarity 100%)">g</a> <a id='111' tid='112', class="move" title="(similarity 100%)">...</a>)
     <span class="deletion" title="deleted">(take n
       (lambdaf@ ()
         ((exist (x) g0 g ... 
            (lambdag@ (s)
              (cons (reify x s) &#39;())))
          empty-s)))</span>)))
 
(<a id='39' tid='40', class="move" title="(similarity 100%)">define</a> <a id='41' tid='42', class="move" title="(similarity 100%)">take</a>
  (<span class="deletion" title="deleted">lambda</span> <span class="deletion" title="deleted">(n f)</span>
    (<span class="deletion" title="deleted">if</span> (<a id='43' tid='44', class="move" title="(similarity 100%)">and</a> <a id='45' tid='46', class="move" title="(similarity 100%)">n</a> (<a id='47' tid='48', class="move" title="(similarity 100%)">zero?</a> <a id='49' tid='50', class="move" title="(similarity 100%)">n</a>)) 
      <span class="deletion" title="deleted">&#39;</span><span class="deletion" title="deleted">()</span>
      <span class="deletion" title="deleted">(case-inf (f)
        (() &#39;())
        ((f) (take n f))
        ((a) a)
        ((a f)
         (cons (car a)
           (take (and n (- n 1)) f))))</span>)))

 
(<a id='789' tid='790', class="unchanged" title="(similarity 100%)">define-syntax</a> <a id='791' tid='792', class="unchanged" title="(similarity 100%)">exist</a>
  (<a id='195' tid='196', class="move" title="(similarity 100%)">syntax-rules</a> ()
    ((<a id='197' tid='198', class="move" title="(similarity 100%)">_</a> (<a id='199' tid='200', class="move" title="(similarity 100%)">x</a> <a id='201' tid='202', class="move" title="(similarity 100%)">...</a>) <a id='203' tid='204', class="move" title="(similarity 100%)">g0</a> <a id='205' tid='206', class="move" title="(similarity 100%)">g</a> <a id='207' tid='208', class="move" title="(similarity 100%)">...</a>)
     (<span class="deletion" title="deleted">lambdag@</span> <span class="deletion" title="deleted">(s)</span>
       (<span class="deletion" title="deleted">inc</span>
         (<span class="deletion" title="deleted">let</span> ((<a id='209' tid='210', class="move" title="(similarity 100%)">x</a> (<a id='211' tid='212', class="move" title="(similarity 100%)">var</a> <a id='213' tid='214', class="move" title="(similarity 100%)">&#39;</a><a id='215' tid='216', class="move" title="(similarity 100%)">x</a>)) <a id='217' tid='218', class="move" title="(similarity 100%)">...</a>)
           <span class="deletion" title="deleted">(bind* (g0 s) g ...)</span>))))))
 
<span class="deletion" title="deleted">(define-syntax bind*
  (syntax-rules ()
    ((_ e) e)
    ((_ e g0 g ...) (bind* (bind e g0) g ...))))</span>
 
(<a id='51' tid='52', class="move" title="(similarity 100%)">define</a> <a id='53' tid='54', class="move" title="(similarity 100%)">bind</a>
  <span class="deletion" title="deleted">(lambda (a-inf g)
    (case-inf a-inf
      (() (mzero))
      ((f) (inc (bind (f) g)))
      ((a) (g a))
      ((a f) (mplus (g a) (lambdaf@ () (bind (f) g))))))</span>)

(<a id='793' tid='794', class="unchanged" title="(similarity 100%)">define-syntax</a> <a id='795' tid='796', class="unchanged" title="(similarity 100%)">conde</a>
  (<a id='219' tid='220', class="move" title="(similarity 100%)">syntax-rules</a> ()
    ((<a id='221' tid='222', class="move" title="(similarity 100%)">_</a> (<a id='223' tid='224', class="move" title="(similarity 100%)">g0</a> <a id='225' tid='226', class="move" title="(similarity 100%)">g</a> <a id='227' tid='228', class="move" title="(similarity 100%)">...</a>) (<a id='229' tid='230', class="move" title="(similarity 100%)">g1</a> <a id='231' tid='232', class="move" title="(similarity 100%)">g^</a> <a id='233' tid='234', class="move" title="(similarity 100%)">...</a>) <a id='235' tid='236', class="move" title="(similarity 100%)">...</a>)
     <span class="deletion" title="deleted">(lambdag@ (s) 
       (inc 
         (mplus* 
           (bind* (g0 s) g ...)
           (bind* (g1 s) g^ ...) ...)))</span>)))
 
<span class="deletion" title="deleted">(define-syntax mplus*
  (syntax-rules ()
    ((_ e) e)
    ((_ e0 e ...) (mplus e0 
                    (lambdaf@ () (mplus* e ...))))))</span>
 
<span class="deletion" title="deleted">(define mplus
  (lambda (a-inf f)
    (case-inf a-inf
      (() (f))
      ((f^) (inc (mplus (f) f^)))
      ((a) (choice a f))
      ((a f^) (choice a (lambdaf@ () (mplus (f) f^)))))))</span>

(<a id='797' tid='798', class="unchanged" title="(similarity 100%)">define-syntax</a> <a id='799' tid='800', class="unchanged" title="(similarity 100%)">conda</a>
  (<a id='801' tid='802', class="unchanged" title="(similarity 100%)">syntax-rules</a> ()
    ((<a id='803' tid='804', class="unchanged" title="(similarity 100%)">_</a> (<a id='805' tid='806', class="unchanged" title="(similarity 100%)">g0</a> <a id='807' tid='808', class="unchanged" title="(similarity 100%)">g</a> <a id='809' tid='810', class="unchanged" title="(similarity 100%)">...</a>) (<a id='811' tid='812', class="unchanged" title="(similarity 100%)">g1</a> <a id='813' tid='814', class="unchanged" title="(similarity 100%)">g^</a> <a id='815' tid='816', class="unchanged" title="(similarity 100%)">...</a>) <a id='817' tid='818', class="unchanged" title="(similarity 100%)">...</a>)
     (<a id='819' tid='820', class="unchanged" title="(similarity 100%)">lambdag@</a> (<a id='821' tid='822', class="unchanged" title="(similarity 100%)">s</a>)
       (<a id='823' tid='824', class="unchanged" title="(similarity 100%)">inc</a>
         (<a id='825' tid='826', class="unchanged" title="(similarity 100%)">ifa</a> ((<a id='827' tid='828', class="unchanged" title="(similarity 100%)">g0</a> <a id='829' tid='830', class="unchanged" title="(similarity 100%)">s</a>) <a id='831' tid='832', class="unchanged" title="(similarity 100%)">g</a> <a id='833' tid='834', class="unchanged" title="(similarity 100%)">...</a>)
              ((<a id='835' tid='836', class="unchanged" title="(similarity 100%)">g1</a> <a id='837' tid='838', class="unchanged" title="(similarity 100%)">s</a>) <a id='839' tid='840', class="unchanged" title="(similarity 100%)">g^</a> <a id='841' tid='842', class="unchanged" title="(similarity 100%)">...</a>) <a id='843' tid='844', class="unchanged" title="(similarity 100%)">...</a>))))))
 
(<a id='845' tid='846', class="unchanged" title="(similarity 100%)">define-syntax</a> <a id='847' tid='848', class="unchanged" title="(similarity 100%)">ifa</a>
  (<span class="deletion" title="deleted">syntax-rules</span> <span class="deletion" title="deleted">()</span>
    <span class="deletion" title="deleted">((_) (mzero))</span>
    ((<a id='237' tid='238', class="move" title="(similarity 100%)">_</a> (<a id='239' tid='240', class="move" title="(similarity 100%)">e</a> <a id='241' tid='242', class="move" title="(similarity 100%)">g</a> <a id='243' tid='244', class="move" title="(similarity 100%)">...</a>) <a id='245' tid='246', class="move" title="(similarity 100%)">b</a> <a id='247' tid='248', class="move" title="(similarity 100%)">...</a>)
     <span class="deletion" title="deleted">(let loop ((a-inf e))
       (case-inf a-inf
         (() (ifa b ...))
         ((f) (inc (loop (f))))
         ((a) (bind* a-inf g ...))
         ((a f) (bind* a-inf g ...))))</span>)))

(<a id='849' tid='850', class="unchanged" title="(similarity 100%)">define-syntax</a> <a id='851' tid='852', class="unchanged" title="(similarity 100%)">condu</a>
  (<a id='853' tid='854', class="unchanged" title="(similarity 100%)">syntax-rules</a> ()
    ((<a id='855' tid='856', class="unchanged" title="(similarity 100%)">_</a> (<a id='857' tid='858', class="unchanged" title="(similarity 100%)">g0</a> <a id='859' tid='860', class="unchanged" title="(similarity 100%)">g</a> <a id='861' tid='862', class="unchanged" title="(similarity 100%)">...</a>) (<a id='863' tid='864', class="unchanged" title="(similarity 100%)">g1</a> <a id='865' tid='866', class="unchanged" title="(similarity 100%)">g^</a> <a id='867' tid='868', class="unchanged" title="(similarity 100%)">...</a>) <a id='869' tid='870', class="unchanged" title="(similarity 100%)">...</a>)
     (<a id='871' tid='872', class="unchanged" title="(similarity 100%)">lambdag@</a> (<a id='873' tid='874', class="unchanged" title="(similarity 100%)">s</a>)
       (<a id='875' tid='876', class="unchanged" title="(similarity 100%)">inc</a>
         (<a id='877' tid='878', class="unchanged" title="(similarity 100%)">ifu</a> ((<a id='879' tid='880', class="unchanged" title="(similarity 100%)">g0</a> <a id='881' tid='882', class="unchanged" title="(similarity 100%)">s</a>) <a id='883' tid='884', class="unchanged" title="(similarity 100%)">g</a> <a id='885' tid='886', class="unchanged" title="(similarity 100%)">...</a>)
              ((<a id='887' tid='888', class="unchanged" title="(similarity 100%)">g1</a> <a id='889' tid='890', class="unchanged" title="(similarity 100%)">s</a>) <a id='891' tid='892', class="unchanged" title="(similarity 100%)">g^</a> <a id='893' tid='894', class="unchanged" title="(similarity 100%)">...</a>) <a id='895' tid='896', class="unchanged" title="(similarity 100%)">...</a>))))))
 
(<a id='897' tid='898', class="unchanged" title="(similarity 100%)">define-syntax</a> <a id='899' tid='900', class="unchanged" title="(similarity 100%)">ifu</a>
  (<span class="deletion" title="deleted">syntax-rules</span> <span class="deletion" title="deleted">()</span>
    <span class="deletion" title="deleted">((_) (mzero))</span>
    ((<a id='249' tid='250', class="move" title="(similarity 100%)">_</a> (<a id='251' tid='252', class="move" title="(similarity 100%)">e</a> <a id='253' tid='254', class="move" title="(similarity 100%)">g</a> <a id='255' tid='256', class="move" title="(similarity 100%)">...</a>) <a id='257' tid='258', class="move" title="(similarity 100%)">b</a> <a id='259' tid='260', class="move" title="(similarity 100%)">...</a>)
     <span class="deletion" title="deleted">(let loop ((a-inf e))
       (case-inf a-inf
         (() (ifu b ...))
         ((f) (inc (loop (f))))
         ((a) (bind* a-inf g ...))
         ((a f) (bind* (unit a) g ...))))</span>)))

(<a id='901' tid='902', class="unchanged" title="(similarity 100%)">define-syntax</a> <a id='903' tid='904', class="unchanged" title="(similarity 100%)">project</a>
  (<a id='261' tid='262', class="move" title="(similarity 100%)">syntax-rules</a> ()
    ((<a id='263' tid='264', class="move" title="(similarity 100%)">_</a> (<a id='265' tid='266', class="move" title="(similarity 100%)">x</a> <a id='267' tid='268', class="move" title="(similarity 100%)">...</a>) <a id='269' tid='270', class="move" title="(similarity 100%)">g</a> <a id='271' tid='272', class="move" title="(similarity 100%)">g*</a> <a id='273' tid='274', class="move" title="(similarity 100%)">...</a>)
     (<span class="deletion" title="deleted">lambdag@</span> <span class="deletion" title="deleted">(s)</span>
       (<a id='275' tid='276', class="move" title="(similarity 100%)">let</a> ((<a id='277' tid='278', class="move" title="(similarity 100%)">x</a> (<a id='279' tid='280', class="move" title="(similarity 100%)">walk*</a> <a id='281' tid='282', class="move" title="(similarity 100%)">x</a> <a id='283' tid='284', class="move" title="(similarity 100%)">s</a>)) <a id='285' tid='286', class="move" title="(similarity 100%)">...</a>)
         ((<a id='287' tid='288', class="move" title="(similarity 100%)">exist</a> () <a id='289' tid='290', class="move" title="(similarity 100%)">g</a> <a id='291' tid='292', class="move" title="(similarity 100%)">g*</a> <a id='293' tid='294', class="move" title="(similarity 100%)">...</a>) <span class="deletion" title="deleted">s</span>))))))

(<a id='905' tid='906', class="unchanged" title="(similarity 100%)">define</a> <a id='907' tid='908', class="unchanged" title="(similarity 100%)">succeed</a> <span class="deletion" title="deleted">(== #f #f)</span>)

(<a id='909' tid='910', class="unchanged" title="(similarity 100%)">define</a> <a id='911' tid='912', class="unchanged" title="(similarity 100%)">fail</a> <span class="deletion" title="deleted">(== #f #t)</span>)

<span class="deletion" title="deleted">(define onceo
  (lambda (g)
    (condu
      (g succeed)
      (else fail))))</span>


</pre>
</div>
<div id="right" class="src">
<pre>
<a id='rightstart' tid='leftstart'></a>
<a id='296' tid='295', class="unchanged" title="(similarity 100%)">;;; This file was generated by writeminikanren.pl
</a><a id='298' tid='297', class="unchanged" title="(similarity 100%)">;;; Generated at 2007-10-25 15:24:42
</a>
<span class="insertion" title="inserted">(define *debug-tags* &#39;())</span>
<span class="insertion" title="inserted">(define debug
  (lambda (tags format . args)
    (let* ((tags (if (not (pair? tags)) (list tags) tags))
           (fs (string-append &quot;[&quot; (symbol-&gt;string (car tags)) &quot;] &quot; format &quot;\n&quot;)))
      (cond
       [(null? tags)]
       [(pair? tags)
        (if (member (car tags) *debug-tags*)
            (apply printf fs args)
            (void))]
       ))))</span>


<span class="insertion" title="inserted">;; Stream primitives
</span>(<a id='300' tid='299', class="unchanged" title="(similarity 100%)">define-syntax</a> <a id='302' tid='301', class="unchanged" title="(similarity 100%)">lambdag@</a>
  <span class="insertion" title="inserted">(syntax-rules ()
    ((_ (p ...) e ...) (lambda (p ...) e ...)))</span>)

(<a id='304' tid='303', class="unchanged" title="(similarity 100%)">define-syntax</a> <a id='306' tid='305', class="unchanged" title="(similarity 100%)">lambdaf@</a>
  <span class="insertion" title="inserted">(syntax-rules ()
    ((_ () e ...) (lambda () e ...)))</span>)

(<a id='26' tid='25', class="move" title="(similarity 100%)">define-syntax</a> <a id='28' tid='27', class="move" title="(similarity 100%)">inc</a>
  (<a id='30' tid='29', class="move" title="(similarity 100%)">syntax-rules</a> () ((<a id='32' tid='31', class="move" title="(similarity 100%)">_</a> <a id='34' tid='33', class="move" title="(similarity 100%)">e</a>) (<a id='36' tid='35', class="move" title="(similarity 100%)">lambdaf@</a> () <a id='38' tid='37', class="move" title="(similarity 100%)">e</a>))))

<span class="insertion" title="inserted">(define defunc
  (lambda (f)
    (if (procedure? f) (defunc (f)) f)))</span>

<span class="insertion" title="inserted">(define snull &#39;snull)</span>

<span class="insertion" title="inserted">(define snull? 
  (lambda (s)
    (eq? s snull)))</span>

<span class="insertion" title="inserted">(define-syntax scons
  (syntax-rules ()
    ((_ a d) (cons a (lambda () d)))))</span>

<span class="insertion" title="inserted">(define scar
  (lambda (s)
    (cond
     [(procedure? s) (scar (s))]
     [else (car s)])))</span>

<span class="insertion" title="inserted">(define scdr
  (lambda (s)
    (cond
     [(procedure? s) (scdr (s))]
     [else ((cdr s))])))</span>

<span class="insertion" title="inserted">(define-syntax sunit
  (syntax-rules ()
    ((_ a) (scons a snull))))</span>

<span class="insertion" title="inserted">(define slift
  (lambda (f)
    (lambda args
      (sunit (apply f args)))))</span>

<span class="insertion" title="inserted">(define-syntax make-stream
  (syntax-rules ()
    ((_) snull)
    ((_ e1 e2 ...) (scons e1 (make-stream e2 ...)))))</span>

(<a id='40' tid='39', class="move" title="(similarity 100%)">define</a> <a id='42' tid='41', class="move" title="(similarity 100%)">take</a>
  (<span class="insertion" title="inserted">lambda</span> <span class="insertion" title="inserted">(n s)</span>
    (<span class="insertion" title="inserted">if</span> (<a id='44' tid='43', class="move" title="(similarity 100%)">and</a> <a id='46' tid='45', class="move" title="(similarity 100%)">n</a> (<a id='48' tid='47', class="move" title="(similarity 100%)">zero?</a> <a id='50' tid='49', class="move" title="(similarity 100%)">n</a>))
        <span class="insertion" title="inserted">&#39;</span><span class="insertion" title="inserted">()</span>
        <span class="insertion" title="inserted">(let ([s (defunc s)])
          (cond
           [(snull? s) &#39;()]
           [else (cons (scar s) (take (and n (- n 1)) (scdr s)))]))</span>)))

<span class="insertion" title="inserted">(define smerge
  (lambda (s1 s2)
    (cond
     [(snull? s1) s2]
     [(procedure? s1)
      (lambda () (smerge s2 (s1)))]
     [else (scons (scar s1) (smerge s2 (scdr s1)))])))</span>

<span class="insertion" title="inserted">(define stream-merge
  (lambda (ss)
    (cond
     [(snull? ss) snull]
     [(procedure? ss) (lambda () (stream-merge (ss)))]
     [(snull? (scar ss)) (stream-merge (scdr ss))]
     [(procedure? (scar ss)) (lambda () 
                               (smerge (stream-merge (scdr ss))
                                       (scar ss)))]
     [else (scons (scar (scar ss)) (smerge (scdr (scar ss))
                                           (stream-merge (scdr ss))))])))</span>

<span class="insertion" title="inserted">(define smap
  (lambda (f s)
    (cond
     [(snull? s) snull]
     [(procedure? s) (lambda () (smap f (s)))]
     [else (scons (f (scar s)) (smap f (scdr s)))])))</span>



<span class="insertion" title="inserted">;; Substitution
</span>(<a id='308' tid='307', class="unchanged" title="(similarity 100%)">define-syntax</a> <a id='310' tid='309', class="unchanged" title="(similarity 100%)">rhs</a>
  (<a id='312' tid='311', class="unchanged" title="(similarity 100%)">syntax-rules</a> ()
    ((<a id='314' tid='313', class="unchanged" title="(similarity 100%)">_</a> <a id='316' tid='315', class="unchanged" title="(similarity 100%)">x</a>) (<a id='318' tid='317', class="unchanged" title="(similarity 100%)">cdr</a> <a id='320' tid='319', class="unchanged" title="(similarity 100%)">x</a>))))

(<a id='322' tid='321', class="unchanged" title="(similarity 100%)">define-syntax</a> <a id='324' tid='323', class="unchanged" title="(similarity 100%)">lhs</a>
  (<a id='326' tid='325', class="unchanged" title="(similarity 100%)">syntax-rules</a> ()
    ((<a id='328' tid='327', class="unchanged" title="(similarity 100%)">_</a> <a id='330' tid='329', class="unchanged" title="(similarity 100%)">x</a>) (<a id='332' tid='331', class="unchanged" title="(similarity 100%)">car</a> <a id='334' tid='333', class="unchanged" title="(similarity 100%)">x</a>))))

(<a id='336' tid='335', class="unchanged" title="(similarity 100%)">define-syntax</a> <a id='338' tid='337', class="unchanged" title="(similarity 100%)">size-s</a>
  (<a id='340' tid='339', class="unchanged" title="(similarity 100%)">syntax-rules</a> ()
    ((<a id='342' tid='341', class="unchanged" title="(similarity 100%)">_</a> <a id='344' tid='343', class="unchanged" title="(similarity 100%)">x</a>) (<a id='346' tid='345', class="unchanged" title="(similarity 100%)">length</a> <a id='348' tid='347', class="unchanged" title="(similarity 100%)">x</a>))))

(<a id='350' tid='349', class="unchanged" title="(similarity 100%)">define-syntax</a> <a id='352' tid='351', class="unchanged" title="(similarity 100%)">var</a>
  (<a id='354' tid='353', class="unchanged" title="(similarity 100%)">syntax-rules</a> ()
    ((<a id='356' tid='355', class="unchanged" title="(similarity 100%)">_</a> <a id='358' tid='357', class="unchanged" title="(similarity 100%)">x</a>) (<a id='360' tid='359', class="unchanged" title="(similarity 100%)">vector</a> <a id='362' tid='361', class="unchanged" title="(similarity 100%)">x</a>))))

(<a id='364' tid='363', class="unchanged" title="(similarity 100%)">define-syntax</a> <a id='366' tid='365', class="unchanged" title="(similarity 100%)">var?</a>
  (<a id='368' tid='367', class="unchanged" title="(similarity 100%)">syntax-rules</a> ()
    ((<a id='370' tid='369', class="unchanged" title="(similarity 100%)">_</a> <a id='372' tid='371', class="unchanged" title="(similarity 100%)">x</a>) (<a id='374' tid='373', class="unchanged" title="(similarity 100%)">vector?</a> <a id='376' tid='375', class="unchanged" title="(similarity 100%)">x</a>))))

(<a id='378' tid='377', class="unchanged" title="(similarity 100%)">define</a> <a id='380' tid='379', class="unchanged" title="(similarity 100%)">empty-s</a> <a id='382' tid='381', class="unchanged" title="(similarity 100%)">&#39;</a>())

(<a id='384' tid='383', class="unchanged" title="(similarity 100%)">define</a> <a id='386' tid='385', class="unchanged" title="(similarity 100%)">walk</a>
  (<a id='388' tid='387', class="unchanged" title="(similarity 100%)">lambda</a> (<a id='390' tid='389', class="unchanged" title="(similarity 100%)">v</a> <a id='392' tid='391', class="unchanged" title="(similarity 100%)">s</a>)
    (<a id='394' tid='393', class="unchanged" title="(similarity 100%)">cond</a>
      ((<a id='396' tid='395', class="unchanged" title="(similarity 100%)">var?</a> <a id='398' tid='397', class="unchanged" title="(similarity 100%)">v</a>)
       (<a id='400' tid='399', class="unchanged" title="(similarity 100%)">let</a> ((<a id='402' tid='401', class="unchanged" title="(similarity 100%)">a</a> (<a id='404' tid='403', class="unchanged" title="(similarity 100%)">assq</a> <a id='406' tid='405', class="unchanged" title="(similarity 100%)">v</a> <a id='408' tid='407', class="unchanged" title="(similarity 100%)">s</a>)))
         (<a id='410' tid='409', class="unchanged" title="(similarity 100%)">cond</a>
           (<a id='412' tid='411', class="unchanged" title="(similarity 100%)">a</a> (<a id='414' tid='413', class="unchanged" title="(similarity 100%)">walk</a> (<a id='416' tid='415', class="unchanged" title="(similarity 100%)">rhs</a> <a id='418' tid='417', class="unchanged" title="(similarity 100%)">a</a>) <a id='420' tid='419', class="unchanged" title="(similarity 100%)">s</a>))
           (<a id='422' tid='421', class="unchanged" title="(similarity 100%)">else</a> <a id='424' tid='423', class="unchanged" title="(similarity 100%)">v</a>))))
      (<a id='426' tid='425', class="unchanged" title="(similarity 100%)">else</a> <a id='428' tid='427', class="unchanged" title="(similarity 100%)">v</a>))))

(<a id='430' tid='429', class="unchanged" title="(similarity 100%)">define</a> <a id='432' tid='431', class="unchanged" title="(similarity 100%)">ext-s</a>
  (<a id='434' tid='433', class="unchanged" title="(similarity 100%)">lambda</a> (<a id='436' tid='435', class="unchanged" title="(similarity 100%)">x</a> <a id='438' tid='437', class="unchanged" title="(similarity 100%)">v</a> <a id='440' tid='439', class="unchanged" title="(similarity 100%)">s</a>)
    (<a id='442' tid='441', class="unchanged" title="(similarity 100%)">cons</a> <a id='444' tid='443', class="unchanged" title="(similarity 100%)">`</a>(<a id='446' tid='445', class="unchanged" title="(similarity 100%)">,</a><a id='448' tid='447', class="unchanged" title="(similarity 100%)">x</a> <a id='450' tid='449', class="unchanged" title="(similarity 100%)">.</a> <a id='452' tid='451', class="unchanged" title="(similarity 100%)">,</a><a id='454' tid='453', class="unchanged" title="(similarity 100%)">v</a>) <a id='456' tid='455', class="unchanged" title="(similarity 100%)">s</a>)))

(<a id='458' tid='457', class="unchanged" title="(similarity 100%)">define</a> <a id='460' tid='459', class="unchanged" title="(similarity 100%)">unify</a>
  <span class="insertion" title="inserted">(lambda (v w s env)
    ((env-unify env) v w s env))</span>)

(<span class="insertion" title="inserted">define</span> <span class="insertion" title="inserted">unify-good</span>
  (<span class="insertion" title="inserted">lambda</span> <span class="insertion" title="inserted">(v w s env)</span>
<span class="insertion" title="inserted">;    (printf &quot;[unify-good]: ~a &lt;--&gt; ~a :: ~a\n&quot; v w s)
</span>    (<a id='114' tid='113', class="move" title="(similarity 100%)">let</a> ((<a id='116' tid='115', class="move" title="(similarity 100%)">v</a> (<a id='118' tid='117', class="move" title="(similarity 100%)">walk</a> <a id='120' tid='119', class="move" title="(similarity 100%)">v</a> <a id='122' tid='121', class="move" title="(similarity 100%)">s</a>))
          (<a id='124' tid='123', class="move" title="(similarity 100%)">w</a> (<a id='126' tid='125', class="move" title="(similarity 100%)">walk</a> <a id='128' tid='127', class="move" title="(similarity 100%)">w</a> <a id='130' tid='129', class="move" title="(similarity 100%)">s</a>)))
      (<a id='132' tid='131', class="move" title="(similarity 100%)">cond</a>
        ((<a id='134' tid='133', class="move" title="(similarity 100%)">eq?</a> <a id='136' tid='135', class="move" title="(similarity 100%)">v</a> <a id='138' tid='137', class="move" title="(similarity 100%)">w</a>) <a id='140' tid='139', class="move" title="(similarity 100%)">s</a>)
        ((<a id='142' tid='141', class="move" title="(similarity 100%)">var?</a> <a id='144' tid='143', class="move" title="(similarity 100%)">v</a>) (<a id='146' tid='145', class="move" title="(similarity 100%)">ext-s</a> <a id='148' tid='147', class="move" title="(similarity 100%)">v</a> <a id='150' tid='149', class="move" title="(similarity 100%)">w</a> <a id='152' tid='151', class="move" title="(similarity 100%)">s</a>))
        ((<a id='154' tid='153', class="move" title="(similarity 100%)">var?</a> <a id='156' tid='155', class="move" title="(similarity 100%)">w</a>) (<a id='158' tid='157', class="move" title="(similarity 100%)">ext-s</a> <a id='160' tid='159', class="move" title="(similarity 100%)">w</a> <a id='162' tid='161', class="move" title="(similarity 100%)">v</a> <a id='164' tid='163', class="move" title="(similarity 100%)">s</a>))
        ((<a id='166' tid='165', class="move" title="(similarity 100%)">and</a> (<a id='168' tid='167', class="move" title="(similarity 100%)">pair?</a> <a id='170' tid='169', class="move" title="(similarity 100%)">v</a>) (<a id='172' tid='171', class="move" title="(similarity 100%)">pair?</a> <a id='174' tid='173', class="move" title="(similarity 100%)">w</a>))
         <span class="insertion" title="inserted">(let ((s (unify-good (car v) (car w) s env)))
           (and s (unify-good (cdr v) (cdr w) s env)))</span>)
        ((<a id='176' tid='175', class="move" title="(similarity 100%)">equal?</a> <a id='178' tid='177', class="move" title="(similarity 100%)">v</a> <a id='180' tid='179', class="move" title="(similarity 100%)">w</a>) <a id='182' tid='181', class="move" title="(similarity 100%)">s</a>)
        (<a id='184' tid='183', class="move" title="(similarity 100%)">else</a> <a id='186' tid='185', class="move" title="(similarity 100%)">#f</a>)))))


<span class="insertion" title="inserted">(define unify-evil
  (lambda (v w s env)
    (debug &#39;(unify-evil unify) 
           &quot;v=~a, w=~a, cvars: ~a\n  subst:~a&quot; v w (env-cvars env) s)
    (let ((vv (walk v s))
          (ww (walk w s)))
      (cond
       ((eq? vv ww) s)
       ((and (var? vv) (memq v (env-cvars env))) #f)
       ((and (var? ww) (memq w (env-cvars env))) #f)
       ((var? vv) (ext-s vv ww s))
       ((var? ww) (ext-s ww vv s))
       ((and (pair? vv) (pair? ww))
        (let ((s (unify-evil (car vv) (car ww) s env)))
          (and s (unify-evil (cdr vv) (cdr ww) s env))))
       ((equal? vv ww) s)
       (else #f)))))</span>


<span class="insertion" title="inserted">(define switch-unify
  (lambda (env)
    (if (eq? (env-unify env) unify-good)
        (change-unify env unify-evil)
        (change-unify env unify-good))))</span>

(<span class="insertion" title="inserted">define</span> <span class="insertion" title="inserted">unify-pred</span>
  (<span class="insertion" title="inserted">lambda</span> <span class="insertion" title="inserted">(v pred s env)</span>
    (<span class="insertion" title="inserted">let</span> ((<a id='188' tid='187', class="move" title="(similarity 100%)">v</a> (<a id='190' tid='189', class="move" title="(similarity 100%)">walk</a> <a id='192' tid='191', class="move" title="(similarity 100%)">v</a> <a id='194' tid='193', class="move" title="(similarity 100%)">s</a>)))
      <span class="insertion" title="inserted">(if (var? v)
          (cond 
           [(eq? pred number?) (ext-s v (random 9999999999) s)]
           [(eq? pred string?) (ext-s v &quot;random string...&quot; s)]
           [(eq? pred symbol?) (ext-s v &#39;randomstring... s)]
           )
          (cond
           [(pred v) s]
           [else #f]))</span>)))

<span class="insertion" title="inserted">(define predo
  (lambda (q pred)
    (lambdag@ (s env)
      (let ((s1 (unify-pred q pred s env)))
        (cond
         [(not s1) snull]
         [else (sunit s1)])))))</span>

(<a id='462' tid='461', class="unchanged" title="(similarity 100%)">define</a> <a id='464' tid='463', class="unchanged" title="(similarity 100%)">unify-check</a>
  (<a id='466' tid='465', class="unchanged" title="(similarity 100%)">lambda</a> (<a id='468' tid='467', class="unchanged" title="(similarity 100%)">u</a> <a id='470' tid='469', class="unchanged" title="(similarity 100%)">v</a> <a id='472' tid='471', class="unchanged" title="(similarity 100%)">s</a>)
    (<a id='474' tid='473', class="unchanged" title="(similarity 100%)">let</a> ((<a id='476' tid='475', class="unchanged" title="(similarity 100%)">u</a> (<a id='478' tid='477', class="unchanged" title="(similarity 100%)">walk</a> <a id='480' tid='479', class="unchanged" title="(similarity 100%)">u</a> <a id='482' tid='481', class="unchanged" title="(similarity 100%)">s</a>))
          (<a id='484' tid='483', class="unchanged" title="(similarity 100%)">v</a> (<a id='486' tid='485', class="unchanged" title="(similarity 100%)">walk</a> <a id='488' tid='487', class="unchanged" title="(similarity 100%)">v</a> <a id='490' tid='489', class="unchanged" title="(similarity 100%)">s</a>)))
      (<a id='492' tid='491', class="unchanged" title="(similarity 100%)">cond</a>
        ((<a id='494' tid='493', class="unchanged" title="(similarity 100%)">eq?</a> <a id='496' tid='495', class="unchanged" title="(similarity 100%)">u</a> <a id='498' tid='497', class="unchanged" title="(similarity 100%)">v</a>) <a id='500' tid='499', class="unchanged" title="(similarity 100%)">s</a>)
        ((<a id='502' tid='501', class="unchanged" title="(similarity 100%)">var?</a> <a id='504' tid='503', class="unchanged" title="(similarity 100%)">u</a>) (<a id='506' tid='505', class="unchanged" title="(similarity 100%)">ext-s-check</a> <a id='508' tid='507', class="unchanged" title="(similarity 100%)">u</a> <a id='510' tid='509', class="unchanged" title="(similarity 100%)">v</a> <a id='512' tid='511', class="unchanged" title="(similarity 100%)">s</a>))
        ((<a id='514' tid='513', class="unchanged" title="(similarity 100%)">var?</a> <a id='516' tid='515', class="unchanged" title="(similarity 100%)">v</a>) (<a id='518' tid='517', class="unchanged" title="(similarity 100%)">ext-s-check</a> <a id='520' tid='519', class="unchanged" title="(similarity 100%)">v</a> <a id='522' tid='521', class="unchanged" title="(similarity 100%)">u</a> <a id='524' tid='523', class="unchanged" title="(similarity 100%)">s</a>))
        ((<a id='526' tid='525', class="unchanged" title="(similarity 100%)">and</a> (<a id='528' tid='527', class="unchanged" title="(similarity 100%)">pair?</a> <a id='530' tid='529', class="unchanged" title="(similarity 100%)">u</a>) (<a id='532' tid='531', class="unchanged" title="(similarity 100%)">pair?</a> <a id='534' tid='533', class="unchanged" title="(similarity 100%)">v</a>))
         (<a id='536' tid='535', class="unchanged" title="(similarity 100%)">let</a> ((<a id='538' tid='537', class="unchanged" title="(similarity 100%)">s</a> (<a id='540' tid='539', class="unchanged" title="(similarity 100%)">unify-check</a> (<a id='542' tid='541', class="unchanged" title="(similarity 100%)">car</a> <a id='544' tid='543', class="unchanged" title="(similarity 100%)">u</a>) (<a id='546' tid='545', class="unchanged" title="(similarity 100%)">car</a> <a id='548' tid='547', class="unchanged" title="(similarity 100%)">v</a>) <a id='550' tid='549', class="unchanged" title="(similarity 100%)">s</a>)))
           (<a id='552' tid='551', class="unchanged" title="(similarity 100%)">and</a> <a id='554' tid='553', class="unchanged" title="(similarity 100%)">s</a> (<a id='556' tid='555', class="unchanged" title="(similarity 100%)">unify-check</a> (<a id='558' tid='557', class="unchanged" title="(similarity 100%)">cdr</a> <a id='560' tid='559', class="unchanged" title="(similarity 100%)">u</a>) (<a id='562' tid='561', class="unchanged" title="(similarity 100%)">cdr</a> <a id='564' tid='563', class="unchanged" title="(similarity 100%)">v</a>) <a id='566' tid='565', class="unchanged" title="(similarity 100%)">s</a>))))
        ((<a id='568' tid='567', class="unchanged" title="(similarity 100%)">equal?</a> <a id='570' tid='569', class="unchanged" title="(similarity 100%)">u</a> <a id='572' tid='571', class="unchanged" title="(similarity 100%)">v</a>) <a id='574' tid='573', class="unchanged" title="(similarity 100%)">s</a>)
        (<a id='576' tid='575', class="unchanged" title="(similarity 100%)">else</a> <a id='578' tid='577', class="unchanged" title="(similarity 100%)">#f</a>)))))

 
(<a id='580' tid='579', class="unchanged" title="(similarity 100%)">define</a> <a id='582' tid='581', class="unchanged" title="(similarity 100%)">ext-s-check</a>
  (<a id='584' tid='583', class="unchanged" title="(similarity 100%)">lambda</a> (<a id='586' tid='585', class="unchanged" title="(similarity 100%)">x</a> <a id='588' tid='587', class="unchanged" title="(similarity 100%)">v</a> <a id='590' tid='589', class="unchanged" title="(similarity 100%)">s</a>)
    (<a id='592' tid='591', class="unchanged" title="(similarity 100%)">cond</a>
      ((<a id='594' tid='593', class="unchanged" title="(similarity 100%)">occurs-check</a> <a id='596' tid='595', class="unchanged" title="(similarity 100%)">x</a> <a id='598' tid='597', class="unchanged" title="(similarity 100%)">v</a> <a id='600' tid='599', class="unchanged" title="(similarity 100%)">s</a>) <a id='602' tid='601', class="unchanged" title="(similarity 100%)">#f</a>)
      (<a id='604' tid='603', class="unchanged" title="(similarity 100%)">else</a> (<a id='606' tid='605', class="unchanged" title="(similarity 100%)">ext-s</a> <a id='608' tid='607', class="unchanged" title="(similarity 100%)">x</a> <a id='610' tid='609', class="unchanged" title="(similarity 100%)">v</a> <a id='612' tid='611', class="unchanged" title="(similarity 100%)">s</a>)))))

(<a id='614' tid='613', class="unchanged" title="(similarity 100%)">define</a> <a id='616' tid='615', class="unchanged" title="(similarity 100%)">occurs-check</a>
  (<a id='618' tid='617', class="unchanged" title="(similarity 100%)">lambda</a> (<a id='620' tid='619', class="unchanged" title="(similarity 100%)">x</a> <a id='622' tid='621', class="unchanged" title="(similarity 100%)">v</a> <a id='624' tid='623', class="unchanged" title="(similarity 100%)">s</a>)
    (<a id='626' tid='625', class="unchanged" title="(similarity 100%)">let</a> ((<a id='628' tid='627', class="unchanged" title="(similarity 100%)">v</a> (<a id='630' tid='629', class="unchanged" title="(similarity 100%)">walk</a> <a id='632' tid='631', class="unchanged" title="(similarity 100%)">v</a> <a id='634' tid='633', class="unchanged" title="(similarity 100%)">s</a>)))
      (<a id='636' tid='635', class="unchanged" title="(similarity 100%)">cond</a>
        ((<a id='638' tid='637', class="unchanged" title="(similarity 100%)">var?</a> <a id='640' tid='639', class="unchanged" title="(similarity 100%)">v</a>) (<a id='642' tid='641', class="unchanged" title="(similarity 100%)">eq?</a> <a id='644' tid='643', class="unchanged" title="(similarity 100%)">v</a> <a id='646' tid='645', class="unchanged" title="(similarity 100%)">x</a>))
        ((<a id='648' tid='647', class="unchanged" title="(similarity 100%)">pair?</a> <a id='650' tid='649', class="unchanged" title="(similarity 100%)">v</a>) 
         (<a id='652' tid='651', class="unchanged" title="(similarity 100%)">or</a> 
           (<a id='654' tid='653', class="unchanged" title="(similarity 100%)">occurs-check</a> <a id='656' tid='655', class="unchanged" title="(similarity 100%)">x</a> (<a id='658' tid='657', class="unchanged" title="(similarity 100%)">car</a> <a id='660' tid='659', class="unchanged" title="(similarity 100%)">v</a>) <a id='662' tid='661', class="unchanged" title="(similarity 100%)">s</a>)
           (<a id='664' tid='663', class="unchanged" title="(similarity 100%)">occurs-check</a> <a id='666' tid='665', class="unchanged" title="(similarity 100%)">x</a> (<a id='668' tid='667', class="unchanged" title="(similarity 100%)">cdr</a> <a id='670' tid='669', class="unchanged" title="(similarity 100%)">v</a>) <a id='672' tid='671', class="unchanged" title="(similarity 100%)">s</a>)))
        (<a id='674' tid='673', class="unchanged" title="(similarity 100%)">else</a> <a id='676' tid='675', class="unchanged" title="(similarity 100%)">#f</a>)))))

(<a id='678' tid='677', class="unchanged" title="(similarity 100%)">define</a> <a id='680' tid='679', class="unchanged" title="(similarity 100%)">walk*</a>
  (<a id='682' tid='681', class="unchanged" title="(similarity 100%)">lambda</a> (<a id='684' tid='683', class="unchanged" title="(similarity 100%)">w</a> <a id='686' tid='685', class="unchanged" title="(similarity 100%)">s</a>)
    (<a id='688' tid='687', class="unchanged" title="(similarity 100%)">let</a> ((<a id='690' tid='689', class="unchanged" title="(similarity 100%)">v</a> (<a id='692' tid='691', class="unchanged" title="(similarity 100%)">walk</a> <a id='694' tid='693', class="unchanged" title="(similarity 100%)">w</a> <a id='696' tid='695', class="unchanged" title="(similarity 100%)">s</a>)))
      (<a id='698' tid='697', class="unchanged" title="(similarity 100%)">cond</a>
        ((<a id='700' tid='699', class="unchanged" title="(similarity 100%)">var?</a> <a id='702' tid='701', class="unchanged" title="(similarity 100%)">v</a>) <a id='704' tid='703', class="unchanged" title="(similarity 100%)">v</a>)
        ((<a id='706' tid='705', class="unchanged" title="(similarity 100%)">pair?</a> <a id='708' tid='707', class="unchanged" title="(similarity 100%)">v</a>)
         (<a id='710' tid='709', class="unchanged" title="(similarity 100%)">cons</a>
           (<a id='712' tid='711', class="unchanged" title="(similarity 100%)">walk*</a> (<a id='714' tid='713', class="unchanged" title="(similarity 100%)">car</a> <a id='716' tid='715', class="unchanged" title="(similarity 100%)">v</a>) <a id='718' tid='717', class="unchanged" title="(similarity 100%)">s</a>)
           (<a id='720' tid='719', class="unchanged" title="(similarity 100%)">walk*</a> (<a id='722' tid='721', class="unchanged" title="(similarity 100%)">cdr</a> <a id='724' tid='723', class="unchanged" title="(similarity 100%)">v</a>) <a id='726' tid='725', class="unchanged" title="(similarity 100%)">s</a>)))
        (<a id='728' tid='727', class="unchanged" title="(similarity 100%)">else</a> <a id='730' tid='729', class="unchanged" title="(similarity 100%)">v</a>)))))

(<a id='732' tid='731', class="unchanged" title="(similarity 100%)">define</a> <a id='734' tid='733', class="unchanged" title="(similarity 100%)">reify-s</a>
  (<span class="insertion" title="inserted">lambda</span> <span class="insertion" title="inserted">(v s)</span>
    <span class="insertion" title="inserted">(debug &#39;reify-s &quot;v: ~a\ns:~a&quot; v s)</span>
    (<span class="insertion" title="inserted">let</span> <span class="insertion" title="inserted">((v (walk v s)))</span>
      (<a id='56' tid='55', class="move" title="(similarity 100%)">cond</a>
        ((<a id='58' tid='57', class="move" title="(similarity 100%)">var?</a> <a id='60' tid='59', class="move" title="(similarity 100%)">v</a>)
         (<a id='62' tid='61', class="move" title="(similarity 100%)">ext-s</a> <a id='64' tid='63', class="move" title="(similarity 100%)">v</a> (<a id='66' tid='65', class="move" title="(similarity 100%)">reify-name</a> (<a id='68' tid='67', class="move" title="(similarity 100%)">size-s</a> <a id='70' tid='69', class="move" title="(similarity 100%)">s</a>)) <a id='72' tid='71', class="move" title="(similarity 100%)">s</a>))
        ((<a id='74' tid='73', class="move" title="(similarity 100%)">pair?</a> <a id='76' tid='75', class="move" title="(similarity 100%)">v</a>) (<a id='78' tid='77', class="move" title="(similarity 100%)">reify-s</a> (<a id='80' tid='79', class="move" title="(similarity 100%)">cdr</a> <a id='82' tid='81', class="move" title="(similarity 100%)">v</a>)
                     (<a id='84' tid='83', class="move" title="(similarity 100%)">reify-s</a> (<a id='86' tid='85', class="move" title="(similarity 100%)">car</a> <a id='88' tid='87', class="move" title="(similarity 100%)">v</a>) <a id='90' tid='89', class="move" title="(similarity 100%)">s</a>)))
        (<a id='92' tid='91', class="move" title="(similarity 100%)">else</a> <a id='94' tid='93', class="move" title="(similarity 100%)">s</a>)))))

(<a id='736' tid='735', class="unchanged" title="(similarity 100%)">define</a> <a id='738' tid='737', class="unchanged" title="(similarity 100%)">reify-name</a>
  (<a id='740' tid='739', class="unchanged" title="(similarity 100%)">lambda</a> (<a id='742' tid='741', class="unchanged" title="(similarity 100%)">n</a>)
    (<a id='744' tid='743', class="unchanged" title="(similarity 100%)">string-&gt;symbol</a>
      (<a id='746' tid='745', class="unchanged" title="(similarity 100%)">string-append</a> <a id='748' tid='747', class="unchanged" title="(similarity 100%)">&quot;_&quot;</a> <a id='750' tid='749', class="unchanged" title="(similarity 100%)">&quot;.&quot;</a> (<a id='752' tid='751', class="unchanged" title="(similarity 100%)">number-&gt;string</a> <a id='754' tid='753', class="unchanged" title="(similarity 100%)">n</a>)))))

(<a id='756' tid='755', class="unchanged" title="(similarity 100%)">define</a> <a id='758' tid='757', class="unchanged" title="(similarity 100%)">reify</a>
  (<a id='760' tid='759', class="unchanged" title="(similarity 100%)">lambda</a> (<a id='762' tid='761', class="unchanged" title="(similarity 100%)">v</a> <a id='764' tid='763', class="unchanged" title="(similarity 100%)">s</a>)
    (<a id='766' tid='765', class="unchanged" title="(similarity 100%)">let</a> ((<a id='768' tid='767', class="unchanged" title="(similarity 100%)">v</a> (<a id='770' tid='769', class="unchanged" title="(similarity 100%)">walk*</a> <a id='772' tid='771', class="unchanged" title="(similarity 100%)">v</a> <a id='774' tid='773', class="unchanged" title="(similarity 100%)">s</a>)))
      (<a id='776' tid='775', class="unchanged" title="(similarity 100%)">walk*</a> <a id='778' tid='777', class="unchanged" title="(similarity 100%)">v</a> (<a id='780' tid='779', class="unchanged" title="(similarity 100%)">reify-s</a> <a id='782' tid='781', class="unchanged" title="(similarity 100%)">v</a> <a id='784' tid='783', class="unchanged" title="(similarity 100%)">empty-s</a>)))))


<span class="insertion" title="inserted">(define pkg
  (lambda (s c)
    (list s c)))</span>
<span class="insertion" title="inserted">(define pkg-subst car)</span>                  <span class="insertion" title="inserted">; current substitution
</span><span class="insertion" title="inserted">(define pkg-constraints cadr)</span>
<span class="insertion" title="inserted">(define ext-pkg-constraints
  (lambda (p cs ctexts env)
    (let ([newc (map (lambda (g t) 
                       (make-constraint g (env-vars env) t))
                     cs ctexts)])
      (pkg (pkg-subst p) (append newc (pkg-constraints p))))))</span>

<span class="insertion" title="inserted">;; constraints save the current environment vars
</span><span class="insertion" title="inserted">(define make-constraint
  (lambda (g vars text)
    (list g vars text)))</span>
<span class="insertion" title="inserted">(define constraint-goal car)</span>            <span class="insertion" title="inserted">; constraint goal
</span><span class="insertion" title="inserted">(define constraint-vars cadr)</span>            <span class="insertion" title="inserted">; variables which the constraint care about
</span><span class="insertion" title="inserted">(define constraint-text caddr)</span>

<span class="insertion" title="inserted">;; environment
</span><span class="insertion" title="inserted">(define make-env
  (lambda (unify constraints vars cvars)
    (list unify constraints vars cvars)))</span>
<span class="insertion" title="inserted">(define empty-env (list unify-good &#39;() &#39;() &#39;()))</span>
<span class="insertion" title="inserted">(define env-unify car)</span>                 <span class="insertion" title="inserted">; which unification to use (env)
</span><span class="insertion" title="inserted">(define env-constraints cadr)</span>          <span class="insertion" title="inserted">; current constraints (env)
</span><span class="insertion" title="inserted">(define env-vars caddr)</span>                <span class="insertion" title="inserted">; variables at this point (env)
</span><span class="insertion" title="inserted">(define env-cvars cadddr)</span>              <span class="insertion" title="inserted">; checked variables at this point (env)
</span><span class="insertion" title="inserted">(define env-constraint-goals
  (lambda (p)
    (map constraint-goal (env-constraint p))))</span>



<span class="insertion" title="inserted">(define change-unify
  (lambda (p u)
    (make-env u (env-constraints p) (env-vars p) (env-cvars p))))</span>

<span class="insertion" title="inserted">(define change-constraints
  (lambda (p c)
    (make-env (env-unify p) c (env-vars p) (env-cvars p))))</span>

<span class="insertion" title="inserted">(define change-vars
  (lambda (p v)
    (make-env (env-unify p) (env-constraints p) v (env-cvars p))))</span>

<span class="insertion" title="inserted">(define change-cvars
  (lambda (p cv)
    (env (env-unify p) (env-constraints p) (env-vars p) cv)))</span>

<span class="insertion" title="inserted">(define ext-constraint
  (lambda (env new-cg)
    (let ([newc (map (lambda (g) (make-constraint g (env-vars env) &#39;a))
                     new-cg)])
      (change-constraints env newc))))</span>

<span class="insertion" title="inserted">(define ext-vars
  (lambda (env new-vars)
    (change-vars env (append new-vars (env-vars env)))))</span>

<span class="insertion" title="inserted">(define ext-cvars
  (lambda (env new-cvars)
    (change-cvars env (append new-cvars (env-cvars env)))))</span>



<span class="insertion" title="inserted">;;; miniKanren
</span>
(<a id='52' tid='51', class="move" title="(similarity 100%)">define</a> <a id='54' tid='53', class="move" title="(similarity 100%)">bind</a>
  <span class="insertion" title="inserted">(lambda (s f env)
    (cond
     [(procedure? s) (lambda () (bind (s) f env))]
     [else
      (stream-merge (smap (lambda (s) (f s env)) s))]))</span>)

<span class="insertion" title="inserted">(define bind*
  (lambda (s goals env)
    (cond
     [(null? goals)
      (stream-merge
       (smap (lambda (s) 
               (bind-constraints (sunit s) (pkg-constraints s) env))
             s))]
     [(snull? s) snull]
     [else (bind* (bind s (car goals) env) (cdr goals) env)])))</span>

<span class="insertion" title="inserted">(define bind*
  (lambda (s goals env)
    (cond
     [(null? goals) s]
     [(snull? s) snull]
     [else (bind* (bind s (car goals) env) (cdr goals) env)])))</span>

<span class="insertion" title="inserted">(define bind-constraints
  (lambda (s cs env)
    (cond
     [(null? cs) s]
     [(snull? s) snull]
     [else 
      (debug &#39;bind-constraints
             &quot;checking constraint: ~a&quot; (constraint-text (car cs)))
      (bind-constraints
            (bind s
                  (constraint-goal (car cs))
                  (make-env (env-unify env)
                            &#39;()                     ; no constraints
                            (env-vars env)
                            (constraint-vars (car cs)))) 
            (cdr cs)
            env)])))</span>

(<a id='786' tid='785', class="unchanged" title="(similarity 100%)">define</a> <a id='788' tid='787', class="unchanged" title="(similarity 100%)">==</a>
  <span class="insertion" title="inserted">(lambda (u v)
    (lambdag@ (s env)
      (let ((s1 ((env-unify env) u v (pkg-subst s) env)))
        (cond
         [(not s1) snull]
         [else (sunit (pkg s1 (pkg-constraints s)))]))))</span>)

<span class="insertion" title="inserted">(define ==
  (lambda (u v)
    (lambdag@ (s env)
      (let ((s1 ((env-unify env) u v (pkg-subst s) env)))
        (cond
         [(not s1) snull]
         [else
          (let ([cc (bind-constraints (sunit (pkg s1 &#39;()))
                                      (pkg-constraints s) env)])
            (if (snull? cc)
                snull
                (sunit (pkg s1 (filter (lambda (c) 
                                         (not (tautology? c (pkg-subst s))))
                                       (pkg-constraints s))))))])))))</span>

<span class="insertion" title="inserted">(define ando
  (lambda goals
    (lambdag@ (s env)
      (bind* (sunit s) goals env))))</span>

<span class="insertion" title="inserted">(define org2
  (lambda (goals)
    (lambdag@ (s env)
      (cond
       [(null? goals) snull]
       [else
        (scons (bind (sunit s) (car goals) env)
               ((org2 (cdr goals)) s env))]))))</span>

<span class="insertion" title="inserted">(define oro
  (lambda goals
    (lambdag@ (s env)
      (stream-merge ((org2 goals) s env)))))</span>

<span class="insertion" title="inserted">(define noto
  (lambda (g)
    (lambdag@ (s env)
      (inc
        (let ([ans (g s (switch-unify env))])
          (letrec ((negate (lambda (s)
                             (cond
                              [(procedure? s) (lambda () (negate (s)))]
                              [(snull? ans) (succeed s env)]
                              [else (fail s env)]))))
                  (negate ans)))))))</span>

<span class="insertion" title="inserted">(define noto
  (lambda (g)
    (lambdag@ (s env)
      (let ([ans (defunc (g s (switch-unify env)))])
        ((if (snull? ans)
             ;;             (begin (printf &quot;###fail###\n&quot;) succeed)
             ;;             (begin (printf &quot;###succeed###\n&quot;) fail)
             succeed
             fail
             ) s env)))))</span>


(<a id='790' tid='789', class="unchanged" title="(similarity 100%)">define-syntax</a> <a id='792' tid='791', class="unchanged" title="(similarity 100%)">exist</a>
  <span class="insertion" title="inserted">(syntax-rules ()
    ((_ (x ...) g0 g ...)
     (lambdag@ (s env)
       (inc
         (let ((x (var &#39;x)) ...)
           ((ando g0 g ...) s (ext-vars env (list x ...))))))))</span>)

(<span class="insertion" title="inserted">define-syntax</span> <span class="insertion" title="inserted">forall</span>
  (<a id='196' tid='195', class="move" title="(similarity 100%)">syntax-rules</a> ()
    ((<a id='198' tid='197', class="move" title="(similarity 100%)">_</a> (<a id='200' tid='199', class="move" title="(similarity 100%)">x</a> <a id='202' tid='201', class="move" title="(similarity 100%)">...</a>) <a id='204' tid='203', class="move" title="(similarity 100%)">g0</a> <a id='206' tid='205', class="move" title="(similarity 100%)">g</a> <a id='208' tid='207', class="move" title="(similarity 100%)">...</a>)
     (<span class="insertion" title="inserted">lambdag@</span> <span class="insertion" title="inserted">(s env)</span>
       (<span class="insertion" title="inserted">inc</span>
         (<span class="insertion" title="inserted">let</span> ((<a id='210' tid='209', class="move" title="(similarity 100%)">x</a> (<a id='212' tid='211', class="move" title="(similarity 100%)">var</a> <a id='214' tid='213', class="move" title="(similarity 100%)">&#39;</a><a id='216' tid='215', class="move" title="(similarity 100%)">x</a>)) <a id='218' tid='217', class="move" title="(similarity 100%)">...</a>)
           <span class="insertion" title="inserted">((ando g0 g ...)
            (let loop ([ss (pkg-subst s)] [vars (list x ...)])
             (cond
              [(null? vars) ss]
              [else (loop (ext-s (car vars) (gensym) ss) (cdr vars))]))
            (ext-vars env (list x ...)))</span>))))))

(<a id='794' tid='793', class="unchanged" title="(similarity 100%)">define-syntax</a> <a id='796' tid='795', class="unchanged" title="(similarity 100%)">conde</a>
  (<a id='220' tid='219', class="move" title="(similarity 100%)">syntax-rules</a> ()
    ((<a id='222' tid='221', class="move" title="(similarity 100%)">_</a> (<a id='224' tid='223', class="move" title="(similarity 100%)">g0</a> <a id='226' tid='225', class="move" title="(similarity 100%)">g</a> <a id='228' tid='227', class="move" title="(similarity 100%)">...</a>) (<a id='230' tid='229', class="move" title="(similarity 100%)">g1</a> <a id='232' tid='231', class="move" title="(similarity 100%)">g^</a> <a id='234' tid='233', class="move" title="(similarity 100%)">...</a>) <a id='236' tid='235', class="move" title="(similarity 100%)">...</a>)
     <span class="insertion" title="inserted">(lambdag@ (s env)
       (inc
         ((oro (ando g0 g ...)
               (ando g1 g^ ...) ...) s env)))</span>)))

<span class="insertion" title="inserted">(define-syntax condc
  (syntax-rules ()
    ((_ (g0 g ...)) (ando g0 g ...))
    ((_ (g0 g ...) g^ ...)
     (lambdag@ (s env)
       (inc
         ((oro (ando g0 g ...)
               (assert ((noto g0))
                       (condc g^ ...))) s env))))))</span>

<span class="insertion" title="inserted">(define reify-constraint
  (lambda (s)
    (lambda (c)
      (let ((ct (constraint-text c)))
        (cond
         [(pair? ct)
          (cons (car ct) 
                (map (lambda (v) (walk* v (pkg-subst s))) (cdr ct)))]
         [else ct])))))</span>

<span class="insertion" title="inserted">(define format-constraints
  (lambda (s)
    (debug &#39;format-constraints &quot;subst: ~a\nconstraints: ~a\n&quot; 
           (pkg-subst s)
           (pkg-constraints s))
    (map (reify-constraint s)
         (filter (lambda (c) 
                   (not (tautology? c (pkg-subst s))))
                 (pkg-constraints s)))))</span>


(<a id='96' tid='95', class="move" title="(similarity 100%)">define-syntax</a> <a id='98' tid='97', class="move" title="(similarity 100%)">run</a>
  (<a id='100' tid='99', class="move" title="(similarity 100%)">syntax-rules</a> ()
    ((<a id='102' tid='101', class="move" title="(similarity 100%)">_</a> <a id='104' tid='103', class="move" title="(similarity 100%)">n</a> (<a id='106' tid='105', class="move" title="(similarity 100%)">x</a>) <a id='108' tid='107', class="move" title="(similarity 100%)">g0</a> <a id='110' tid='109', class="move" title="(similarity 100%)">g</a> <a id='112' tid='111', class="move" title="(similarity 100%)">...</a>)
     <span class="insertion" title="inserted">(let ((x (var &#39;x)))
       (let ([ss ((ando g0 g ...) (pkg empty-s &#39;())
                   (make-env unify-good &#39;() (list x) &#39;()))])
         (take n (smap (lambda (s)
                         (let* ((x (walk* x (pkg-subst s)))
                                (rs (reify-s x empty-s)))
                           (list
                            (walk* x rs)
                            (let ((ctext (walk* (format-constraints s) rs)))
                              (if (null? ctext)
                                  &#39;()
                                  (list &#39;constraints: ctext))))))
                       ss))))</span>)))

<span class="insertion" title="inserted">(define tautology?
  (lambda (c s)
    (debug &#39;tautology?
           &quot;constraint: ~a\nvars: ~a\nsubst:~a\n&quot;
           (constraint-text c)
           (constraint-vars c)
           s)
    (not (snull?
          (defunc ((constraint-goal c)
                   (pkg s &#39;())
                   (make-env unify-evil &#39;() &#39;() (constraint-vars c))))))))</span>


(<a id='2' tid='1', class="move" title="(similarity 100%)">define-syntax</a> <a id='4' tid='3', class="move" title="(similarity 100%)">run*</a>
  (<a id='6' tid='5', class="move" title="(similarity 100%)">syntax-rules</a> ()
    ((<a id='8' tid='7', class="move" title="(similarity 100%)">_</a> (<a id='10' tid='9', class="move" title="(similarity 100%)">x</a>) <a id='12' tid='11', class="move" title="(similarity 100%)">g</a> <a id='14' tid='13', class="move" title="(similarity 100%)">...</a>) (<a id='16' tid='15', class="move" title="(similarity 100%)">run</a> <a id='18' tid='17', class="move" title="(similarity 100%)">#f</a> (<a id='20' tid='19', class="move" title="(similarity 100%)">x</a>) <a id='22' tid='21', class="move" title="(similarity 100%)">g</a> <a id='24' tid='23', class="move" title="(similarity 100%)">...</a>))))

<span class="insertion" title="inserted">(define-syntax make-text
  (syntax-rules (quote quasiquote)
    ((_ (quote a)) (quote a))
    ((_ (quasiquote a)) (quasiquote a))
    ((_ (g a0 ...)) (list &#39;g (make-text a0) ...))
    ((_ a) a)))</span>

<span class="insertion" title="inserted">(define-syntax make-text*
  (syntax-rules (quote quasiquote)
    ((_) &#39;())
    ((_ (quote a)) (quote a))
    ((_ (quasiquote a)) (quasiquote a))
    ((_ (g0 a ...) g ...)
     (list (make-text (g0 a ...)) (make-text g) ...))
    ((_ a) &#39;a)))</span>


<span class="insertion" title="inserted">;; (make-text* `b)
</span><span class="insertion" title="inserted">;; (make-text* (noto (== `(,a ,d) (cons u v))) (noto (appendo a b c)))
</span><span class="insertion" title="inserted">;; (define a 1)
</span><span class="insertion" title="inserted">;; (define b 2)
</span><span class="insertion" title="inserted">;; (define c 3)
</span><span class="insertion" title="inserted">;; (define d 4)
</span><span class="insertion" title="inserted">;; (define u 5)
</span><span class="insertion" title="inserted">;; (define v 6)
</span><span class="insertion" title="inserted">;; (make-text* (a b c) `(,c a))
</span><span class="insertion" title="inserted">;; (define q 10)
</span><span class="insertion" title="inserted">; (make-text* (noto (== q 3)))
</span>
<span class="insertion" title="inserted">(define-syntax assert
  (syntax-rules ()
    ((_ (c0 c ...) g ...)
     (lambdag@ (s env)
       (inc 
        ((ando g ...)
         (ext-pkg-constraints s (list c0 c ...) (make-text* c0 c ...) env)
         (ext-constraint env (list c0 c ...))))))))</span>

(<a id='798' tid='797', class="unchanged" title="(similarity 100%)">define-syntax</a> <a id='800' tid='799', class="unchanged" title="(similarity 100%)">conda</a>
  (<a id='802' tid='801', class="unchanged" title="(similarity 100%)">syntax-rules</a> ()
    ((<a id='804' tid='803', class="unchanged" title="(similarity 100%)">_</a> (<a id='806' tid='805', class="unchanged" title="(similarity 100%)">g0</a> <a id='808' tid='807', class="unchanged" title="(similarity 100%)">g</a> <a id='810' tid='809', class="unchanged" title="(similarity 100%)">...</a>) (<a id='812' tid='811', class="unchanged" title="(similarity 100%)">g1</a> <a id='814' tid='813', class="unchanged" title="(similarity 100%)">g^</a> <a id='816' tid='815', class="unchanged" title="(similarity 100%)">...</a>) <a id='818' tid='817', class="unchanged" title="(similarity 100%)">...</a>)
     (<a id='820' tid='819', class="unchanged" title="(similarity 100%)">lambdag@</a> (<a id='822' tid='821', class="unchanged" title="(similarity 100%)">s</a>)
       (<a id='824' tid='823', class="unchanged" title="(similarity 100%)">inc</a>
         (<a id='826' tid='825', class="unchanged" title="(similarity 100%)">ifa</a> ((<a id='828' tid='827', class="unchanged" title="(similarity 100%)">g0</a> <a id='830' tid='829', class="unchanged" title="(similarity 100%)">s</a>) <a id='832' tid='831', class="unchanged" title="(similarity 100%)">g</a> <a id='834' tid='833', class="unchanged" title="(similarity 100%)">...</a>)
              ((<a id='836' tid='835', class="unchanged" title="(similarity 100%)">g1</a> <a id='838' tid='837', class="unchanged" title="(similarity 100%)">s</a>) <a id='840' tid='839', class="unchanged" title="(similarity 100%)">g^</a> <a id='842' tid='841', class="unchanged" title="(similarity 100%)">...</a>) <a id='844' tid='843', class="unchanged" title="(similarity 100%)">...</a>))))))

(<a id='846' tid='845', class="unchanged" title="(similarity 100%)">define-syntax</a> <a id='848' tid='847', class="unchanged" title="(similarity 100%)">ifa</a>
  (<span class="insertion" title="inserted">syntax-rules</span> <span class="insertion" title="inserted">()</span>
    <span class="insertion" title="inserted">((_) snull)</span>
    ((<a id='238' tid='237', class="move" title="(similarity 100%)">_</a> (<a id='240' tid='239', class="move" title="(similarity 100%)">e</a> <a id='242' tid='241', class="move" title="(similarity 100%)">g</a> <a id='244' tid='243', class="move" title="(similarity 100%)">...</a>) <a id='246' tid='245', class="move" title="(similarity 100%)">b</a> <a id='248' tid='247', class="move" title="(similarity 100%)">...</a>)
     <span class="insertion" title="inserted">(cond
      [(snull? (defunc e)) (ifa b ...)]
      [else (bind* e (list g ...))])</span>)))

(<a id='850' tid='849', class="unchanged" title="(similarity 100%)">define-syntax</a> <a id='852' tid='851', class="unchanged" title="(similarity 100%)">condu</a>
  (<a id='854' tid='853', class="unchanged" title="(similarity 100%)">syntax-rules</a> ()
    ((<a id='856' tid='855', class="unchanged" title="(similarity 100%)">_</a> (<a id='858' tid='857', class="unchanged" title="(similarity 100%)">g0</a> <a id='860' tid='859', class="unchanged" title="(similarity 100%)">g</a> <a id='862' tid='861', class="unchanged" title="(similarity 100%)">...</a>) (<a id='864' tid='863', class="unchanged" title="(similarity 100%)">g1</a> <a id='866' tid='865', class="unchanged" title="(similarity 100%)">g^</a> <a id='868' tid='867', class="unchanged" title="(similarity 100%)">...</a>) <a id='870' tid='869', class="unchanged" title="(similarity 100%)">...</a>)
     (<a id='872' tid='871', class="unchanged" title="(similarity 100%)">lambdag@</a> (<a id='874' tid='873', class="unchanged" title="(similarity 100%)">s</a>)
       (<a id='876' tid='875', class="unchanged" title="(similarity 100%)">inc</a>
         (<a id='878' tid='877', class="unchanged" title="(similarity 100%)">ifu</a> ((<a id='880' tid='879', class="unchanged" title="(similarity 100%)">g0</a> <a id='882' tid='881', class="unchanged" title="(similarity 100%)">s</a>) <a id='884' tid='883', class="unchanged" title="(similarity 100%)">g</a> <a id='886' tid='885', class="unchanged" title="(similarity 100%)">...</a>)
              ((<a id='888' tid='887', class="unchanged" title="(similarity 100%)">g1</a> <a id='890' tid='889', class="unchanged" title="(similarity 100%)">s</a>) <a id='892' tid='891', class="unchanged" title="(similarity 100%)">g^</a> <a id='894' tid='893', class="unchanged" title="(similarity 100%)">...</a>) <a id='896' tid='895', class="unchanged" title="(similarity 100%)">...</a>))))))
 
(<a id='898' tid='897', class="unchanged" title="(similarity 100%)">define-syntax</a> <a id='900' tid='899', class="unchanged" title="(similarity 100%)">ifu</a>
  (<span class="insertion" title="inserted">syntax-rules</span> <span class="insertion" title="inserted">()</span>
    <span class="insertion" title="inserted">((_) snull)</span>
    ((<a id='250' tid='249', class="move" title="(similarity 100%)">_</a> (<a id='252' tid='251', class="move" title="(similarity 100%)">e</a> <a id='254' tid='253', class="move" title="(similarity 100%)">g</a> <a id='256' tid='255', class="move" title="(similarity 100%)">...</a>) <a id='258' tid='257', class="move" title="(similarity 100%)">b</a> <a id='260' tid='259', class="move" title="(similarity 100%)">...</a>)
     <span class="insertion" title="inserted">(cond
      [(snull? (defunc e)) (ifa b ...)]
      [else (bind* (sunit (scar e)) (list g ...))])</span>)))

(<a id='902' tid='901', class="unchanged" title="(similarity 100%)">define-syntax</a> <a id='904' tid='903', class="unchanged" title="(similarity 100%)">project</a>
  (<a id='262' tid='261', class="move" title="(similarity 100%)">syntax-rules</a> ()
    ((<a id='264' tid='263', class="move" title="(similarity 100%)">_</a> (<a id='266' tid='265', class="move" title="(similarity 100%)">x</a> <a id='268' tid='267', class="move" title="(similarity 100%)">...</a>) <a id='270' tid='269', class="move" title="(similarity 100%)">g</a> <a id='272' tid='271', class="move" title="(similarity 100%)">g*</a> <a id='274' tid='273', class="move" title="(similarity 100%)">...</a>)
     (<span class="insertion" title="inserted">lambdag@</span> <span class="insertion" title="inserted">(s env)</span>
       (<a id='276' tid='275', class="move" title="(similarity 100%)">let</a> ((<a id='278' tid='277', class="move" title="(similarity 100%)">x</a> (<a id='280' tid='279', class="move" title="(similarity 100%)">walk*</a> <a id='282' tid='281', class="move" title="(similarity 100%)">x</a> <a id='284' tid='283', class="move" title="(similarity 100%)">s</a>)) <a id='286' tid='285', class="move" title="(similarity 100%)">...</a>)
         ((<a id='288' tid='287', class="move" title="(similarity 100%)">exist</a> () <a id='290' tid='289', class="move" title="(similarity 100%)">g</a> <a id='292' tid='291', class="move" title="(similarity 100%)">g*</a> <a id='294' tid='293', class="move" title="(similarity 100%)">...</a>) <span class="insertion" title="inserted">s</span> <span class="insertion" title="inserted">env</span>))))))

(<a id='906' tid='905', class="unchanged" title="(similarity 100%)">define</a> <a id='908' tid='907', class="unchanged" title="(similarity 100%)">succeed</a> <span class="insertion" title="inserted">(lambda (s env) (sunit s))</span>)
(<a id='910' tid='909', class="unchanged" title="(similarity 100%)">define</a> <a id='912' tid='911', class="unchanged" title="(similarity 100%)">fail</a> <span class="insertion" title="inserted">(lambda (s env) snull)</span>)

<span class="insertion" title="inserted">(define prints
  (lambda (s env)
    (begin 
      (printf &quot;#[prints]:: ~s\n&quot; s)
      (succeed s env))))</span>

<span class="insertion" title="inserted">(define print-env
  (lambdag@ (s env)
    (begin 
      (printf &quot;env: ~s\n&quot; env)
      (succeed s env))))</span>

<span class="insertion" title="inserted">(define print-var
  (lambda (name v)
    (lambda (s env)
      (begin 
        (printf &quot;#[print-var] ~a = ~s\n&quot; name (walk v s))
        (succeed s env)))))</span>

<span class="insertion" title="inserted">(define-syntax print-var
  (syntax-rules ()
    ((_ v) (lambda (s env)
             (begin 
               (printf &quot;#[print-var] ~a = ~s\n&quot; &#39;v (walk* v (pkg-subst s)))
               (succeed s env))))))</span>


<span class="insertion" title="inserted">(define print-constraintso
  (lambda (s env)
    (printf &quot;#[constraints] \n~a\n&quot; 
            (map (lambda (s) (format &quot;~a\n&quot; s))
                 (map (reify-constraint s) (pkg-constraints s))))
    (succeed s env)))</span>


</pre>
</div>
</body>
</html>
