<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=utf-8">
<LINK href="diff-s.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="nav-div.js"></script>
</head>
<body>
<div id="left" class="src">
<pre>
<a id='leftstart' tid='rightstart'></a>
// Copyright 2011 the V8 project authors. All rights reserved.
// Redistribution and use in source and binary forms, with or without
// modification, are permitted provided that the following conditions are
// met:
//
//     * Redistributions of source code must retain the above copyright
//       notice, this list of conditions and the following disclaimer.
//     * Redistributions in binary form must reproduce the above
//       copyright notice, this list of conditions and the following
//       disclaimer in the documentation and/or other materials provided
//       with the distribution.
//     * Neither the name of Google Inc. nor the names of its
//       contributors may be used to endorse or promote products derived
//       from this software without specific prior written permission.
//
// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
// &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
// LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
// A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
// OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
// SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
// LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
// DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
// THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

<span class="deletion" title="deleted">#include &lt;stdlib.h&gt;</span>
<span class="deletion" title="deleted">#include &lt;math.h&gt;</span>
<span class="deletion" title="deleted">#include &lt;limits.h&gt;</span>
<span class="deletion" title="deleted">#include &lt;cstdarg&gt;</span>
<span class="deletion" title="deleted">#include &quot;v8.h&quot;</span>

<span class="deletion" title="deleted">#if defined(V8_TARGET_ARCH_MIPS)</span>

<span class="deletion" title="deleted">#include &quot;disasm.h&quot;</span>
<span class="deletion" title="deleted">#include &quot;assembler.h&quot;</span>
<span class="deletion" title="deleted">#include &quot;globals.h&quot;</span>    // Need the BitCast.
<span class="deletion" title="deleted">#include &quot;mips/constants-mips.h&quot;</span>
<span class="deletion" title="deleted">#include &quot;mips/simulator-mips.h&quot;</span>


// Only build the simulator if not compiling for real MIPS hardware.
<span class="deletion" title="deleted">#if defined(USE_SIMULATOR)</span>

namespace <span class="deletion" title="deleted">v8</span> {
namespace <span class="deletion" title="deleted">internal</span> {

// Utils functions.
<span class="deletion" title="deleted">bool HaveSameSign(int32_t a, int32_t b) {
  return ((a ^ b) &gt;= 0);
}</span>


<span class="deletion" title="deleted">uint32_t get_fcsr_condition_bit(uint32_t cc) {
  if (cc == 0) {
    return 23;
  } else {
    return 24 + cc;
  }
}</span>


// This macro provides a platform independent use of sscanf. The reason for
// SScanF not being implemented in a platform independent was through
// ::v8::internal::OS in the same way as SNPrintF is that the Windows C Run-Time
// Library does not provide vsscanf.
<span class="deletion" title="deleted">#define SScanF sscanf</span>  // NOLINT

// The MipsDebugger class is used by the simulator while debugging simulated
// code.
<span class="deletion" title="deleted">class</span> <span class="deletion" title="deleted">MipsDebugger</span> {
 <span class="deletion" title="deleted">public:</span>
  <span class="deletion" title="deleted">explicit MipsDebugger(Simulator* sim)</span>;
  <span class="deletion" title="deleted">~MipsDebugger();</span>

  <span class="deletion" title="deleted">void Stop(Instruction* instr)</span>;
  <span class="deletion" title="deleted">void Debug()</span>;
  // Print all registers with a nice formatting.
  <span class="deletion" title="deleted">void PrintAllRegs()</span>;
  <span class="deletion" title="deleted">void PrintAllRegsIncludingFPU()</span>;

 <span class="deletion" title="deleted">private:</span>
  // We set the breakpoint code to 0xfffff to easily recognize it.
  <span class="deletion" title="deleted">static const Instr kBreakpointInstr = SPECIAL | BREAK | 0xfffff &lt;&lt; 6;</span>
  <span class="deletion" title="deleted">static const Instr kNopInstr =  0x0;</span>

  <span class="deletion" title="deleted">Simulator* sim_;</span>

  <span class="deletion" title="deleted">int32_t GetRegisterValue(int regnum)</span>;
  <span class="deletion" title="deleted">int32_t GetFPURegisterValueInt(int regnum)</span>;
  <span class="deletion" title="deleted">int64_t GetFPURegisterValueLong(int regnum)</span>;
  <span class="deletion" title="deleted">float GetFPURegisterValueFloat(int regnum)</span>;
  <span class="deletion" title="deleted">double GetFPURegisterValueDouble(int regnum)</span>;
  <a id='8167' tid='8168', class="move" title="(similarity 100%)">bool</a> <a id='8169' tid='8170', class="move" title="(similarity 100%)">GetValue</a>(<a id='8171' tid='8172', class="move" title="(similarity 100%)">const</a> <a id='8173' tid='8174', class="move" title="(similarity 100%)">char</a><a id='8175' tid='8176', class="move" title="(similarity 100%)">*</a> <a id='8177' tid='8178', class="move" title="(similarity 100%)">desc</a>, <a id='8179' tid='8180', class="move" title="(similarity 100%)">int32_t</a><a id='8181' tid='8182', class="move" title="(similarity 100%)">*</a> <a id='8183' tid='8184', class="move" title="(similarity 100%)">value</a>);

  // Set or delete a breakpoint. Returns true if successful.
  <span class="deletion" title="deleted">bool SetBreakpoint(Instruction* breakpc)</span>;
  <span class="deletion" title="deleted">bool DeleteBreakpoint(Instruction* breakpc)</span>;

  // Undo and redo all breakpoints. This is needed to bracket disassembly and
  // execution to skip past breakpoints when run from the debugger.
  <span class="deletion" title="deleted">void UndoBreakpoints()</span>;
  <span class="deletion" title="deleted">void RedoBreakpoints()</span>;
};

<span class="deletion" title="deleted">MipsDebugger::MipsDebugger(Simulator* sim) {
  sim_ = sim;
}</span>


<span class="deletion" title="deleted">MipsDebugger::~MipsDebugger() {
}</span>


<span class="deletion" title="deleted">#ifdef GENERATED_CODE_COVERAGE</span>
<span class="deletion" title="deleted">static FILE* coverage_log = NULL;</span>


<a id='8133' tid='8134', class="move" title="(similarity 100%)">static</a> <a id='8135' tid='8136', class="move" title="(similarity 100%)">void</a> <a id='8137' tid='8138', class="move" title="(similarity 100%)">InitializeCoverage</a>() {
  <a id='8139' tid='8140', class="move" title="(similarity 100%)">char</a><a id='8141' tid='8142', class="move" title="(similarity 100%)">*</a> <a id='8143' tid='8144', class="move" title="(similarity 100%)">file_name</a> = <a id='8145' tid='8146', class="move" title="(similarity 100%)">getenv</a>(<a id='8147' tid='8148', class="move" title="(similarity 100%)">&quot;V8_GENERATED_CODE_COVERAGE_LOG&quot;</a>);
  <a id='8149' tid='8150', class="move" title="(similarity 100%)">if</a> (<a id='8151' tid='8152', class="move" title="(similarity 100%)">file_name</a> <a id='8153' tid='8154', class="move" title="(similarity 100%)">!=</a> <a id='8155' tid='8156', class="move" title="(similarity 100%)">NULL</a>) {
    <a id='8157' tid='8158', class="move" title="(similarity 100%)">coverage_log</a> <a id='8159' tid='8160', class="move" title="(similarity 100%)">=</a> <a id='8161' tid='8162', class="move" title="(similarity 100%)">fopen</a>(<a id='8163' tid='8164', class="move" title="(similarity 100%)">file_name</a>, <a id='8165' tid='8166', class="move" title="(similarity 100%)">&quot;aw+&quot;</a>);
  }
}


<span class="deletion" title="deleted">void MipsDebugger::Stop(Instruction* instr) {
  // Get the stop code.
  uint32_t code = instr-&gt;Bits(25, 6);
  // Retrieve the encoded address, which comes just after this stop.
  char** msg_address =
    reinterpret_cast&lt;char**&gt;(sim_-&gt;get_pc() + Instr::kInstrSize);
  char* msg = *msg_address;
  ASSERT(msg != NULL);

  // Update this stop description.
  if (!watched_stops[code].desc) {
    watched_stops[code].desc = msg;
  }

  if (strlen(msg) &gt; 0) {
    if (coverage_log != NULL) {
      fprintf(coverage_log, &quot;%s\n&quot;, str);
      fflush(coverage_log);
    }
    // Overwrite the instruction and address with nops.
    instr-&gt;SetInstructionBits(kNopInstr);
    reinterpret_cast&lt;Instr*&gt;(msg_address)-&gt;SetInstructionBits(kNopInstr);
  }
  sim_-&gt;set_pc(sim_-&gt;get_pc() + 2 * Instruction::kInstructionSize);
}</span>


<span class="deletion" title="deleted">#else</span>  // GENERATED_CODE_COVERAGE

<span class="deletion" title="deleted">#define UNSUPPORTED() printf(&quot;Unsupported instruction.\n&quot;);</span>

<span class="deletion" title="deleted">static void InitializeCoverage() {}</span>


<span class="deletion" title="deleted">void MipsDebugger::Stop(Instruction* instr)</span> {
  // Get the stop code.
  <span class="deletion" title="deleted">uint32_t code = instr-&gt;Bits(25, 6);</span>
  // Retrieve the encoded address, which comes just after this stop.
  <a id='4049' tid='4050', class="move" title="(similarity 100%)">char</a><a id='4051' tid='4052', class="move" title="(similarity 100%)">*</a> <a id='4053' tid='4054', class="move" title="(similarity 100%)">msg</a> = <a id='4055' tid='4056', class="move" title="(similarity 100%)">*</a><a id='4057' tid='4058', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='4059' tid='4060', class="move" title="(similarity 100%)">char</a><a id='4061' tid='4062', class="move" title="(similarity 100%)">*</a><a id='4063' tid='4064', class="move" title="(similarity 100%)">*</a>&gt;(<a id='4065' tid='4066', class="move" title="(similarity 100%)">sim_</a>-&gt;<a id='4067' tid='4068', class="move" title="(similarity 100%)">get_pc</a>() <a id='4069' tid='4070', class="move" title="(similarity 100%)">+</a>
      <a id='4071' tid='4072', class="move" title="(similarity 100%)">Instruction</a><a id='4073' tid='4074', class="move" title="(similarity 100%)">::</a><a id='4075' tid='4076', class="move" title="(similarity 100%)">kInstrSize</a>);
  // Update this stop description.
  <span class="deletion" title="deleted">if (!sim_-&gt;watched_stops[code].desc) {
    sim_-&gt;watched_stops[code].desc = msg;
  }</span>
  <span class="deletion" title="deleted">PrintF(&quot;Simulator hit %s (%u)\n&quot;, msg, code);</span>
  <a id='8113' tid='8114', class="move" title="(similarity 100%)">sim_</a>-&gt;<a id='8115' tid='8116', class="move" title="(similarity 100%)">set_pc</a>(<a id='8117' tid='8118', class="move" title="(similarity 100%)">sim_</a>-&gt;<a id='8119' tid='8120', class="move" title="(similarity 100%)">get_pc</a>() <a id='8121' tid='8122', class="move" title="(similarity 100%)">+</a> <a id='8123' tid='8124', class="move" title="(similarity 100%)">2</a> <a id='8125' tid='8126', class="move" title="(similarity 100%)">*</a> <a id='8127' tid='8128', class="move" title="(similarity 100%)">Instruction</a><a id='8129' tid='8130', class="move" title="(similarity 100%)">::</a><a id='8131' tid='8132', class="move" title="(similarity 100%)">kInstrSize</a>);
  <span class="deletion" title="deleted">Debug();</span>
}
<span class="deletion" title="deleted">#endif</span>  // GENERATED_CODE_COVERAGE


<span class="deletion" title="deleted">int32_t MipsDebugger::GetRegisterValue(int regnum) {
  if (regnum == kNumSimuRegisters) {
    return sim_-&gt;get_pc();
  } else {
    return sim_-&gt;get_register(regnum);
  }
}</span>


<span class="deletion" title="deleted">int32_t MipsDebugger::GetFPURegisterValueInt(int regnum) {
  if (regnum == kNumFPURegisters) {
    return sim_-&gt;get_pc();
  } else {
    return sim_-&gt;get_fpu_register(regnum);
  }
}</span>


<span class="deletion" title="deleted">int64_t MipsDebugger::GetFPURegisterValueLong(int regnum) {
  if (regnum == kNumFPURegisters) {
    return sim_-&gt;get_pc();
  } else {
    return sim_-&gt;get_fpu_register_long(regnum);
  }
}</span>


<span class="deletion" title="deleted">float MipsDebugger::GetFPURegisterValueFloat(int regnum) {
  if (regnum == kNumFPURegisters) {
    return sim_-&gt;get_pc();
  } else {
    return sim_-&gt;get_fpu_register_float(regnum);
  }
}</span>


<span class="deletion" title="deleted">double MipsDebugger::GetFPURegisterValueDouble(int regnum) {
  if (regnum == kNumFPURegisters) {
    return sim_-&gt;get_pc();
  } else {
    return sim_-&gt;get_fpu_register_double(regnum);
  }
}</span>


<span class="deletion" title="deleted">bool MipsDebugger::GetValue(const char* desc, int32_t* value)</span> {
  <span class="deletion" title="deleted">int regnum = Registers::Number(desc);</span>
  <span class="deletion" title="deleted">int fpuregnum = FPURegisters::Number(desc);</span>

  <span class="deletion" title="deleted">if</span> <span class="deletion" title="deleted">(regnum != kInvalidRegister)</span> {
    <a id='8099' tid='8100', class="move" title="(similarity 100%)">*</a><a id='8101' tid='8102', class="move" title="(similarity 100%)">value</a> <a id='8103' tid='8104', class="move" title="(similarity 100%)">=</a> <a id='8105' tid='8106', class="move" title="(similarity 100%)">GetRegisterValue</a>(<a id='8107' tid='8108', class="move" title="(similarity 100%)">regnum</a>);
    <a id='8109' tid='8110', class="move" title="(similarity 100%)">return</a> <a id='8111' tid='8112', class="move" title="(similarity 100%)">true</a>;
  } <span class="deletion" title="deleted">else if (fpuregnum != kInvalidFPURegister) {
    *value = GetFPURegisterValueInt(fpuregnum);
    return true;
  } else if (strncmp(desc, &quot;0x&quot;, 2) == 0) {
    return SScanF(desc, &quot;%x&quot;, reinterpret_cast&lt;uint32_t*&gt;(value)) == 1;
  } else {
    return SScanF(desc, &quot;%i&quot;, value) == 1;
  }</span>
  <span class="deletion" title="deleted">return false;</span>
}


<span class="deletion" title="deleted">bool MipsDebugger::SetBreakpoint(Instruction* breakpc) {
  // Check if a breakpoint can be set. If not return without any side-effects.
  if (sim_-&gt;break_pc_ != NULL) {
    return false;
  }

  // Set the breakpoint.
  sim_-&gt;break_pc_ = breakpc;
  sim_-&gt;break_instr_ = breakpc-&gt;InstructionBits();
  // Not setting the breakpoint instruction in the code itself. It will be set
  // when the debugger shell continues.
  return true;
}</span>


<span class="deletion" title="deleted">bool MipsDebugger::DeleteBreakpoint(Instruction* breakpc) {
  if (sim_-&gt;break_pc_ != NULL) {
    sim_-&gt;break_pc_-&gt;SetInstructionBits(sim_-&gt;break_instr_);
  }

  sim_-&gt;break_pc_ = NULL;
  sim_-&gt;break_instr_ = 0;
  return true;
}</span>


<span class="deletion" title="deleted">void MipsDebugger::UndoBreakpoints() {
  if (sim_-&gt;break_pc_ != NULL) {
    sim_-&gt;break_pc_-&gt;SetInstructionBits(sim_-&gt;break_instr_);
  }
}</span>


<span class="deletion" title="deleted">void MipsDebugger::RedoBreakpoints() {
  if (sim_-&gt;break_pc_ != NULL) {
    sim_-&gt;break_pc_-&gt;SetInstructionBits(kBreakpointInstr);
  }
}</span>


<span class="deletion" title="deleted">void MipsDebugger::PrintAllRegs() {
#define REG_INFO(n) Registers::Name(n), GetRegisterValue(n), GetRegisterValue(n)

  PrintF(&quot;\n&quot;);
  // at, v0, a0.
  PrintF(&quot;%3s: 0x%08x %10d\t%3s: 0x%08x %10d\t%3s: 0x%08x %10d\n&quot;,
         REG_INFO(1), REG_INFO(2), REG_INFO(4));
  // v1, a1.
  PrintF(&quot;%26s\t%3s: 0x%08x %10d\t%3s: 0x%08x %10d\n&quot;,
         &quot;&quot;, REG_INFO(3), REG_INFO(5));
  // a2.
  PrintF(&quot;%26s\t%26s\t%3s: 0x%08x %10d\n&quot;, &quot;&quot;, &quot;&quot;, REG_INFO(6));
  // a3.
  PrintF(&quot;%26s\t%26s\t%3s: 0x%08x %10d\n&quot;, &quot;&quot;, &quot;&quot;, REG_INFO(7));
  PrintF(&quot;\n&quot;);
  // t0-t7, s0-s7
  for (int i = 0; i &lt; 8; i++) {
    PrintF(&quot;%3s: 0x%08x %10d\t%3s: 0x%08x %10d\n&quot;,
           REG_INFO(8+i), REG_INFO(16+i));
  }
  PrintF(&quot;\n&quot;);
  // t8, k0, LO.
  PrintF(&quot;%3s: 0x%08x %10d\t%3s: 0x%08x %10d\t%3s: 0x%08x %10d\n&quot;,
         REG_INFO(24), REG_INFO(26), REG_INFO(32));
  // t9, k1, HI.
  PrintF(&quot;%3s: 0x%08x %10d\t%3s: 0x%08x %10d\t%3s: 0x%08x %10d\n&quot;,
         REG_INFO(25), REG_INFO(27), REG_INFO(33));
  // sp, fp, gp.
  PrintF(&quot;%3s: 0x%08x %10d\t%3s: 0x%08x %10d\t%3s: 0x%08x %10d\n&quot;,
         REG_INFO(29), REG_INFO(30), REG_INFO(28));
  // pc.
  PrintF(&quot;%3s: 0x%08x %10d\t%3s: 0x%08x %10d\n&quot;,
         REG_INFO(31), REG_INFO(34));

#undef REG_INFO
#undef FPU_REG_INFO
}</span>


<span class="deletion" title="deleted">void MipsDebugger::PrintAllRegsIncludingFPU() {
#define FPU_REG_INFO(n) FPURegisters::Name(n), FPURegisters::Name(n+1), \
        GetFPURegisterValueInt(n+1), \
        GetFPURegisterValueInt(n), \
                        GetFPURegisterValueDouble(n)

  PrintAllRegs();

  PrintF(&quot;\n\n&quot;);
  // f0, f1, f2, ... f31.
  PrintF(&quot;%3s,%3s: 0x%08x%08x %16.4e\n&quot;, FPU_REG_INFO(0) );
  PrintF(&quot;%3s,%3s: 0x%08x%08x %16.4e\n&quot;, FPU_REG_INFO(2) );
  PrintF(&quot;%3s,%3s: 0x%08x%08x %16.4e\n&quot;, FPU_REG_INFO(4) );
  PrintF(&quot;%3s,%3s: 0x%08x%08x %16.4e\n&quot;, FPU_REG_INFO(6) );
  PrintF(&quot;%3s,%3s: 0x%08x%08x %16.4e\n&quot;, FPU_REG_INFO(8) );
  PrintF(&quot;%3s,%3s: 0x%08x%08x %16.4e\n&quot;, FPU_REG_INFO(10));
  PrintF(&quot;%3s,%3s: 0x%08x%08x %16.4e\n&quot;, FPU_REG_INFO(12));
  PrintF(&quot;%3s,%3s: 0x%08x%08x %16.4e\n&quot;, FPU_REG_INFO(14));
  PrintF(&quot;%3s,%3s: 0x%08x%08x %16.4e\n&quot;, FPU_REG_INFO(16));
  PrintF(&quot;%3s,%3s: 0x%08x%08x %16.4e\n&quot;, FPU_REG_INFO(18));
  PrintF(&quot;%3s,%3s: 0x%08x%08x %16.4e\n&quot;, FPU_REG_INFO(20));
  PrintF(&quot;%3s,%3s: 0x%08x%08x %16.4e\n&quot;, FPU_REG_INFO(22));
  PrintF(&quot;%3s,%3s: 0x%08x%08x %16.4e\n&quot;, FPU_REG_INFO(24));
  PrintF(&quot;%3s,%3s: 0x%08x%08x %16.4e\n&quot;, FPU_REG_INFO(26));
  PrintF(&quot;%3s,%3s: 0x%08x%08x %16.4e\n&quot;, FPU_REG_INFO(28));
  PrintF(&quot;%3s,%3s: 0x%08x%08x %16.4e\n&quot;, FPU_REG_INFO(30));

#undef REG_INFO
#undef FPU_REG_INFO
}</span>


<span class="deletion" title="deleted">void MipsDebugger::Debug()</span> {
  <a id='7873' tid='7874', class="move" title="(similarity 100%)">intptr_t</a> <a id='7875' tid='7876', class="move" title="(similarity 100%)">last_pc</a> = <a id='7877' tid='7878', class="move" title="(similarity 100%)">-</a><a id='7879' tid='7880', class="move" title="(similarity 100%)">1</a>;
  <a id='7881' tid='7882', class="move" title="(similarity 100%)">bool</a> <a id='7883' tid='7884', class="move" title="(similarity 100%)">done</a> = <a id='7885' tid='7886', class="move" title="(similarity 100%)">false</a>;

#<a id='7887' tid='7888', class="move" title="(similarity 100%)">define</a> <a id='7889' tid='7890', class="move" title="(similarity 100%)">COMMAND_SIZE</a> <a id='7891' tid='7892', class="move" title="(similarity 100%)">63</a>
#<a id='7893' tid='7894', class="move" title="(similarity 100%)">define</a> <a id='7895' tid='7896', class="move" title="(similarity 100%)">ARG_SIZE</a> <a id='7897' tid='7898', class="move" title="(similarity 100%)">255</a>

#<a id='8085' tid='8086', class="move" title="(similarity 100%)">define</a> <a id='8087' tid='8088', class="move" title="(similarity 100%)">STR</a><a id='8089' tid='8090', class="move" title="(similarity 100%)">(</a><a id='8091' tid='8092', class="move" title="(similarity 100%)">a</a><a id='8093' tid='8094', class="move" title="(similarity 100%)">)</a> <a id='8095' tid='8096', class="move" title="(similarity 100%)">#</a><a id='8097' tid='8098', class="move" title="(similarity 100%)">a</a>
#<a id='7899' tid='7900', class="move" title="(similarity 100%)">define</a> <a id='7901' tid='7902', class="move" title="(similarity 100%)">XSTR</a><a id='7903' tid='7904', class="move" title="(similarity 100%)">(</a><a id='7905' tid='7906', class="move" title="(similarity 100%)">a</a><a id='7907' tid='7908', class="move" title="(similarity 100%)">)</a> <a id='7909' tid='7910', class="move" title="(similarity 100%)">STR</a><a id='7911' tid='7912', class="move" title="(similarity 100%)">(</a><a id='7913' tid='7914', class="move" title="(similarity 100%)">a</a><a id='7915' tid='7916', class="move" title="(similarity 100%)">)</a>

  <a id='7917' tid='7918', class="move" title="(similarity 100%)">char</a> <a id='7919' tid='7920', class="move" title="(similarity 100%)">cmd</a>[<a id='7921' tid='7922', class="move" title="(similarity 100%)">COMMAND_SIZE</a> <a id='7923' tid='7924', class="move" title="(similarity 100%)">+</a> <a id='7925' tid='7926', class="move" title="(similarity 100%)">1</a>];
  <a id='7927' tid='7928', class="move" title="(similarity 100%)">char</a> <a id='7929' tid='7930', class="move" title="(similarity 100%)">arg1</a>[<a id='7931' tid='7932', class="move" title="(similarity 100%)">ARG_SIZE</a> <a id='7933' tid='7934', class="move" title="(similarity 100%)">+</a> <a id='7935' tid='7936', class="move" title="(similarity 100%)">1</a>];
  <a id='7937' tid='7938', class="move" title="(similarity 100%)">char</a> <a id='7939' tid='7940', class="move" title="(similarity 100%)">arg2</a>[<a id='7941' tid='7942', class="move" title="(similarity 100%)">ARG_SIZE</a> <a id='7943' tid='7944', class="move" title="(similarity 100%)">+</a> <a id='7945' tid='7946', class="move" title="(similarity 100%)">1</a>];
  <a id='7947' tid='7948', class="move" title="(similarity 100%)">char</a><a id='7949' tid='7950', class="move" title="(similarity 100%)">*</a> <a id='7951' tid='7952', class="move" title="(similarity 100%)">argv</a>[<a id='7953' tid='7954', class="move" title="(similarity 100%)">3</a>] = { <a id='7955' tid='7956', class="move" title="(similarity 100%)">cmd</a>, <a id='7957' tid='7958', class="move" title="(similarity 100%)">arg1</a>, <a id='7959' tid='7960', class="move" title="(similarity 100%)">arg2</a> };

  // Make sure to have a proper terminating character if reaching the limit.
  <a id='7961' tid='7962', class="move" title="(similarity 100%)">cmd</a>[<a id='7963' tid='7964', class="move" title="(similarity 100%)">COMMAND_SIZE</a>] <a id='7965' tid='7966', class="move" title="(similarity 100%)">=</a> <a id='7967' tid='7968', class="move" title="(similarity 100%)">0</a>;
  <a id='7969' tid='7970', class="move" title="(similarity 100%)">arg1</a>[<a id='7971' tid='7972', class="move" title="(similarity 100%)">ARG_SIZE</a>] <a id='7973' tid='7974', class="move" title="(similarity 100%)">=</a> <a id='7975' tid='7976', class="move" title="(similarity 100%)">0</a>;
  <a id='7977' tid='7978', class="move" title="(similarity 100%)">arg2</a>[<a id='7979' tid='7980', class="move" title="(similarity 100%)">ARG_SIZE</a>] <a id='7981' tid='7982', class="move" title="(similarity 100%)">=</a> <a id='7983' tid='7984', class="move" title="(similarity 100%)">0</a>;

  // Undo all set breakpoints while running in the debugger shell. This will
  // make them invisible to all commands.
  <a id='7985' tid='7986', class="move" title="(similarity 100%)">UndoBreakpoints</a>();

  <span class="deletion" title="deleted">while</span> <span class="deletion" title="deleted">(!done && (sim_-&gt;get_pc() != Simulator::end_sim_pc))</span> {
    <a id='7987' tid='7988', class="move" title="(similarity 100%)">if</a> (<a id='7989' tid='7990', class="move" title="(similarity 100%)">last_pc</a> <a id='7991' tid='7992', class="move" title="(similarity 100%)">!=</a> <a id='7993' tid='7994', class="move" title="(similarity 100%)">sim_</a>-&gt;<a id='7995' tid='7996', class="move" title="(similarity 100%)">get_pc</a>()) {
      <a id='7997' tid='7998', class="move" title="(similarity 100%)">disasm</a><a id='7999' tid='8000', class="move" title="(similarity 100%)">::</a><a id='8001' tid='8002', class="move" title="(similarity 100%)">NameConverter</a> <a id='8003' tid='8004', class="move" title="(similarity 100%)">converter</a>;
      <a id='8005' tid='8006', class="move" title="(similarity 100%)">disasm</a><a id='8007' tid='8008', class="move" title="(similarity 100%)">::</a><a id='8009' tid='8010', class="move" title="(similarity 100%)">Disassembler</a> <a id='8011' tid='8012', class="move" title="(similarity 100%)">dasm</a>(<a id='8013' tid='8014', class="move" title="(similarity 100%)">converter</a>);
      // Use a reasonably large buffer.
      <a id='8015' tid='8016', class="move" title="(similarity 100%)">v8</a><a id='8017' tid='8018', class="move" title="(similarity 100%)">::</a><a id='8019' tid='8020', class="move" title="(similarity 100%)">internal</a><a id='8021' tid='8022', class="move" title="(similarity 100%)">::</a><a id='8023' tid='8024', class="move" title="(similarity 100%)">EmbeddedVector</a>&lt;<a id='8025' tid='8026', class="move" title="(similarity 100%)">char</a>, <a id='8027' tid='8028', class="move" title="(similarity 100%)">256</a>&gt; <a id='8029' tid='8030', class="move" title="(similarity 100%)">buffer</a>;
      <a id='8031' tid='8032', class="move" title="(similarity 100%)">dasm</a>.<a id='8033' tid='8034', class="move" title="(similarity 100%)">InstructionDecode</a>(<a id='8035' tid='8036', class="move" title="(similarity 100%)">buffer</a>,
                             <a id='8037' tid='8038', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='8039' tid='8040', class="move" title="(similarity 100%)">byte</a><a id='8041' tid='8042', class="move" title="(similarity 100%)">*</a>&gt;(<a id='8043' tid='8044', class="move" title="(similarity 100%)">sim_</a>-&gt;<a id='8045' tid='8046', class="move" title="(similarity 100%)">get_pc</a>()));
      <a id='8047' tid='8048', class="move" title="(similarity 100%)">PrintF</a>(<a id='8049' tid='8050', class="move" title="(similarity 100%)">&quot;  0x%08x  %s\n&quot;</a>, <a id='8051' tid='8052', class="move" title="(similarity 100%)">sim_</a>-&gt;<a id='8053' tid='8054', class="move" title="(similarity 100%)">get_pc</a>(), <a id='8055' tid='8056', class="move" title="(similarity 100%)">buffer</a>.<a id='8057' tid='8058', class="move" title="(similarity 100%)">start</a>());
      <a id='8059' tid='8060', class="move" title="(similarity 100%)">last_pc</a> <a id='8061' tid='8062', class="move" title="(similarity 100%)">=</a> <a id='8063' tid='8064', class="move" title="(similarity 100%)">sim_</a>-&gt;<a id='8065' tid='8066', class="move" title="(similarity 100%)">get_pc</a>();
    }
    <a id='7635' tid='7636', class="move" title="(similarity 100%)">char</a><a id='7637' tid='7638', class="move" title="(similarity 100%)">*</a> <a id='7639' tid='7640', class="move" title="(similarity 100%)">line</a> = <a id='7641' tid='7642', class="move" title="(similarity 100%)">ReadLine</a>(<a id='7643' tid='7644', class="move" title="(similarity 100%)">&quot;sim&gt; &quot;</a>);
    <a id='7645' tid='7646', class="move" title="(similarity 100%)">if</a> (<a id='7647' tid='7648', class="move" title="(similarity 100%)">line</a> <a id='7649' tid='7650', class="move" title="(similarity 100%)">==</a> <a id='7651' tid='7652', class="move" title="(similarity 100%)">NULL</a>) {
      <a id='7653' tid='7654', class="move" title="(similarity 100%)">break</a>;
    } <a id='7655' tid='7656', class="move" title="(similarity 100%)">else</a> {
      // Use sscanf to parse the individual parts of the command line. At the
      // moment no command expects more than two parameters.
      <a id='7657' tid='7658', class="move" title="(similarity 100%)">int</a> <a id='7659' tid='7660', class="move" title="(similarity 100%)">argc</a> = <a id='7661' tid='7662', class="move" title="(similarity 100%)">SScanF</a>(<a id='7663' tid='7664', class="move" title="(similarity 100%)">line</a>,
                        <a id='7665' tid='7666', class="move" title="(similarity 100%)">&quot;%&quot;</a> <a id='7667' tid='7668', class="move" title="(similarity 100%)">XSTR</a>(<a id='7669' tid='7670', class="move" title="(similarity 100%)">COMMAND_SIZE</a>) <a id='7671' tid='7672', class="move" title="(similarity 100%)">&quot;s &quot;</a>
                        <a id='7673' tid='7674', class="move" title="(similarity 100%)">&quot;%&quot;</a> <a id='7675' tid='7676', class="move" title="(similarity 100%)">XSTR</a>(<a id='7677' tid='7678', class="move" title="(similarity 100%)">ARG_SIZE</a>) <a id='7679' tid='7680', class="move" title="(similarity 100%)">&quot;s &quot;</a>
                        <a id='7681' tid='7682', class="move" title="(similarity 100%)">&quot;%&quot;</a> <a id='7683' tid='7684', class="move" title="(similarity 100%)">XSTR</a>(<a id='7685' tid='7686', class="move" title="(similarity 100%)">ARG_SIZE</a>) <a id='7687' tid='7688', class="move" title="(similarity 100%)">&quot;s&quot;</a>,
                        <a id='7689' tid='7690', class="move" title="(similarity 100%)">cmd</a>, <a id='7691' tid='7692', class="move" title="(similarity 100%)">arg1</a>, <a id='7693' tid='7694', class="move" title="(similarity 100%)">arg2</a>);
      <a id='7695' tid='7696', class="move" title="(similarity 100%)">if</a> ((<a id='7697' tid='7698', class="move" title="(similarity 100%)">strcmp</a>(<a id='7699' tid='7700', class="move" title="(similarity 100%)">cmd</a>, <a id='7701' tid='7702', class="move" title="(similarity 100%)">&quot;si&quot;</a>) <a id='7703' tid='7704', class="move" title="(similarity 100%)">==</a> <a id='7705' tid='7706', class="move" title="(similarity 100%)">0</a>) <a id='7707' tid='7708', class="move" title="(similarity 100%)">||</a> (<a id='7709' tid='7710', class="move" title="(similarity 100%)">strcmp</a>(<a id='7711' tid='7712', class="move" title="(similarity 100%)">cmd</a>, <a id='7713' tid='7714', class="move" title="(similarity 100%)">&quot;stepi&quot;</a>) <a id='7715' tid='7716', class="move" title="(similarity 100%)">==</a> <a id='7717' tid='7718', class="move" title="(similarity 100%)">0</a>)) {
        <span class="deletion" title="deleted">Instruction* instr = reinterpret_cast&lt;Instruction*&gt;(sim_-&gt;get_pc());</span>
        <span class="deletion" title="deleted">if</span> <span class="deletion" title="deleted">(!(instr-&gt;IsTrap()) ||
            instr-&gt;InstructionBits() == rtCallRedirInstr)</span> {
          <a id='7719' tid='7720', class="move" title="(similarity 100%)">sim_</a>-&gt;<a id='7721' tid='7722', class="move" title="(similarity 100%)">InstructionDecode</a>(
              <a id='7723' tid='7724', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='7725' tid='7726', class="move" title="(similarity 100%)">Instruction</a><a id='7727' tid='7728', class="move" title="(similarity 100%)">*</a>&gt;(<a id='7729' tid='7730', class="move" title="(similarity 100%)">sim_</a>-&gt;<a id='7731' tid='7732', class="move" title="(similarity 100%)">get_pc</a>()));
        } <span class="deletion" title="deleted">else {
          // Allow si to jump over generated breakpoints.
          PrintF(&quot;/!\\ Jumping over generated breakpoint.\n&quot;);
          sim_-&gt;set_pc(sim_-&gt;get_pc() + Instruction::kInstrSize);
        }</span>
      } <a id='7733' tid='7734', class="move" title="(similarity 100%)">else</a> <a id='7735' tid='7736', class="move" title="(similarity 100%)">if</a> ((<a id='7737' tid='7738', class="move" title="(similarity 100%)">strcmp</a>(<a id='7739' tid='7740', class="move" title="(similarity 100%)">cmd</a>, <a id='7741' tid='7742', class="move" title="(similarity 100%)">&quot;c&quot;</a>) <a id='7743' tid='7744', class="move" title="(similarity 100%)">==</a> <a id='7745' tid='7746', class="move" title="(similarity 100%)">0</a>) <a id='7747' tid='7748', class="move" title="(similarity 100%)">||</a> (<a id='7749' tid='7750', class="move" title="(similarity 100%)">strcmp</a>(<a id='7751' tid='7752', class="move" title="(similarity 100%)">cmd</a>, <a id='7753' tid='7754', class="move" title="(similarity 100%)">&quot;cont&quot;</a>) <a id='7755' tid='7756', class="move" title="(similarity 100%)">==</a> <a id='7757' tid='7758', class="move" title="(similarity 100%)">0</a>)) {
        // Execute the one instruction we broke at with breakpoints disabled.
        <a id='7759' tid='7760', class="move" title="(similarity 100%)">sim_</a>-&gt;<a id='7761' tid='7762', class="move" title="(similarity 100%)">InstructionDecode</a>(<a id='7763' tid='7764', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='7765' tid='7766', class="move" title="(similarity 100%)">Instruction</a><a id='7767' tid='7768', class="move" title="(similarity 100%)">*</a>&gt;(<a id='7769' tid='7770', class="move" title="(similarity 100%)">sim_</a>-&gt;<a id='7771' tid='7772', class="move" title="(similarity 100%)">get_pc</a>()));
        // Leave the debugger shell.
        <a id='7773' tid='7774', class="move" title="(similarity 100%)">done</a> <a id='7775' tid='7776', class="move" title="(similarity 100%)">=</a> <a id='7777' tid='7778', class="move" title="(similarity 100%)">true</a>;
      } <a id='7779' tid='7780', class="move" title="(similarity 100%)">else</a> <span class="deletion" title="deleted">if</span> ((<a id='7781' tid='7782', class="move" title="(similarity 100%)">strcmp</a>(<a id='7783' tid='7784', class="move" title="(similarity 100%)">cmd</a>, <a id='7785' tid='7786', class="move" title="(similarity 100%)">&quot;p&quot;</a>) <a id='7787' tid='7788', class="move" title="(similarity 100%)">==</a> <a id='7789' tid='7790', class="move" title="(similarity 100%)">0</a>) <a id='7791' tid='7792', class="move" title="(similarity 100%)">||</a> (<a id='7793' tid='7794', class="move" title="(similarity 100%)">strcmp</a>(<a id='7795' tid='7796', class="move" title="(similarity 100%)">cmd</a>, <a id='7797' tid='7798', class="move" title="(similarity 100%)">&quot;print&quot;</a>) <a id='7799' tid='7800', class="move" title="(similarity 100%)">==</a> <a id='7801' tid='7802', class="move" title="(similarity 100%)">0</a>)) <span class="deletion" title="deleted">{
        if (argc == 2) {
          int32_t value;
          float fvalue;
          if (strcmp(arg1, &quot;all&quot;) == 0) {
            PrintAllRegs();
          } else if (strcmp(arg1, &quot;allf&quot;) == 0) {
            PrintAllRegsIncludingFPU();
          } else {
            int regnum = Registers::Number(arg1);
            int fpuregnum = FPURegisters::Number(arg1);

            if (regnum != kInvalidRegister) {
              value = GetRegisterValue(regnum);
              PrintF(&quot;%s: 0x%08x %d \n&quot;, arg1, value, value);
            } else if (fpuregnum != kInvalidFPURegister) {
              if (fpuregnum % 2 == 1) {
                value = GetFPURegisterValueInt(fpuregnum);
                fvalue = GetFPURegisterValueFloat(fpuregnum);
                PrintF(&quot;%s: 0x%08x %11.4e\n&quot;, arg1, value, fvalue);
              } else {
                double dfvalue;
                int32_t lvalue1 = GetFPURegisterValueInt(fpuregnum);
                int32_t lvalue2 = GetFPURegisterValueInt(fpuregnum + 1);
                dfvalue = GetFPURegisterValueDouble(fpuregnum);
                PrintF(&quot;%3s,%3s: 0x%08x%08x %16.4e\n&quot;,
                       FPURegisters::Name(fpuregnum+1),
                       FPURegisters::Name(fpuregnum),
                       lvalue1,
                       lvalue2,
                       dfvalue);
              }
            } else {
              PrintF(&quot;%s unrecognized\n&quot;, arg1);
            }
          }
        } else {
          if (argc == 3) {
            if (strcmp(arg2, &quot;single&quot;) == 0) {
              int32_t value;
              float fvalue;
              int fpuregnum = FPURegisters::Number(arg1);

              if (fpuregnum != kInvalidFPURegister) {
                value = GetFPURegisterValueInt(fpuregnum);
                fvalue = GetFPURegisterValueFloat(fpuregnum);
                PrintF(&quot;%s: 0x%08x %11.4e\n&quot;, arg1, value, fvalue);
              } else {
                PrintF(&quot;%s unrecognized\n&quot;, arg1);
              }
            } else {
              PrintF(&quot;print &lt;fpu register&gt; single\n&quot;);
            }
          } else {
            PrintF(&quot;print &lt;register&gt; or print &lt;fpu register&gt; single\n&quot;);
          }
        }
      }</span> <a id='7167' tid='7168', class="move" title="(similarity 100%)">else</a> <a id='7169' tid='7170', class="move" title="(similarity 100%)">if</a> ((<a id='7171' tid='7172', class="move" title="(similarity 100%)">strcmp</a>(<a id='7173' tid='7174', class="move" title="(similarity 100%)">cmd</a>, <a id='7175' tid='7176', class="move" title="(similarity 100%)">&quot;po&quot;</a>) <a id='7177' tid='7178', class="move" title="(similarity 100%)">==</a> <a id='7179' tid='7180', class="move" title="(similarity 100%)">0</a>)
                 <a id='7181' tid='7182', class="move" title="(similarity 100%)">||</a> (<a id='7183' tid='7184', class="move" title="(similarity 100%)">strcmp</a>(<a id='7185' tid='7186', class="move" title="(similarity 100%)">cmd</a>, <a id='7187' tid='7188', class="move" title="(similarity 100%)">&quot;printobject&quot;</a>) <a id='7189' tid='7190', class="move" title="(similarity 100%)">==</a> <a id='7191' tid='7192', class="move" title="(similarity 100%)">0</a>)) {
        <a id='7193' tid='7194', class="move" title="(similarity 100%)">if</a> (<a id='7195' tid='7196', class="move" title="(similarity 100%)">argc</a> <a id='7197' tid='7198', class="move" title="(similarity 100%)">==</a> <a id='7199' tid='7200', class="move" title="(similarity 100%)">2</a>) {
          <a id='7201' tid='7202', class="move" title="(similarity 100%)">int32_t</a> <a id='7203' tid='7204', class="move" title="(similarity 100%)">value</a>;
          <a id='7205' tid='7206', class="move" title="(similarity 100%)">if</a> (<a id='7207' tid='7208', class="move" title="(similarity 100%)">GetValue</a>(<a id='7209' tid='7210', class="move" title="(similarity 100%)">arg1</a>, <a id='7211' tid='7212', class="move" title="(similarity 100%)">&</a><a id='7213' tid='7214', class="move" title="(similarity 100%)">value</a>)) {
            <a id='7215' tid='7216', class="move" title="(similarity 100%)">Object</a><a id='7217' tid='7218', class="move" title="(similarity 100%)">*</a> <a id='7219' tid='7220', class="move" title="(similarity 100%)">obj</a> = <a id='7221' tid='7222', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='7223' tid='7224', class="move" title="(similarity 100%)">Object</a><a id='7225' tid='7226', class="move" title="(similarity 100%)">*</a>&gt;(<a id='7227' tid='7228', class="move" title="(similarity 100%)">value</a>);
            <a id='7229' tid='7230', class="move" title="(similarity 100%)">PrintF</a>(<a id='7231' tid='7232', class="move" title="(similarity 100%)">&quot;%s: \n&quot;</a>, <a id='7233' tid='7234', class="move" title="(similarity 100%)">arg1</a>);
#<a id='7235' tid='7236', class="move" title="(similarity 100%)">ifdef</a> <a id='7237' tid='7238', class="move" title="(similarity 100%)">DEBUG</a>
            <a id='7239' tid='7240', class="move" title="(similarity 100%)">obj</a>-&gt;<a id='7241' tid='7242', class="move" title="(similarity 100%)">PrintLn</a>();
#<a id='7243' tid='7244', class="move" title="(similarity 100%)">else</a>
            <a id='7245' tid='7246', class="move" title="(similarity 100%)">obj</a>-&gt;<a id='7247' tid='7248', class="move" title="(similarity 100%)">ShortPrint</a>();
            <a id='7249' tid='7250', class="move" title="(similarity 100%)">PrintF</a>(<a id='7251' tid='7252', class="move" title="(similarity 100%)">&quot;\n&quot;</a>);
#<a id='7253' tid='7254', class="move" title="(similarity 100%)">endif</a>
          } <a id='7255' tid='7256', class="move" title="(similarity 100%)">else</a> {
            <a id='7257' tid='7258', class="move" title="(similarity 100%)">PrintF</a>(<a id='7259' tid='7260', class="move" title="(similarity 100%)">&quot;%s unrecognized\n&quot;</a>, <a id='7261' tid='7262', class="move" title="(similarity 100%)">arg1</a>);
          }
        } <a id='7263' tid='7264', class="move" title="(similarity 100%)">else</a> {
          <a id='7265' tid='7266', class="move" title="(similarity 100%)">PrintF</a>(<a id='7267' tid='7268', class="move" title="(similarity 100%)">&quot;printobject &lt;value&gt;\n&quot;</a>);
        }
      } <a id='7269' tid='7270', class="move" title="(similarity 100%)">else</a> <a id='7271' tid='7272', class="move" title="(similarity 100%)">if</a> (<a id='7273' tid='7274', class="move" title="(similarity 100%)">strcmp</a>(<a id='7275' tid='7276', class="move" title="(similarity 100%)">cmd</a>, <a id='7277' tid='7278', class="move" title="(similarity 100%)">&quot;stack&quot;</a>) <a id='7279' tid='7280', class="move" title="(similarity 100%)">==</a> <a id='7281' tid='7282', class="move" title="(similarity 100%)">0</a> <a id='7283' tid='7284', class="move" title="(similarity 100%)">||</a> <a id='7285' tid='7286', class="move" title="(similarity 100%)">strcmp</a>(<a id='7287' tid='7288', class="move" title="(similarity 100%)">cmd</a>, <a id='7289' tid='7290', class="move" title="(similarity 100%)">&quot;mem&quot;</a>) <a id='7291' tid='7292', class="move" title="(similarity 100%)">==</a> <a id='7293' tid='7294', class="move" title="(similarity 100%)">0</a>) {
        <a id='7295' tid='7296', class="move" title="(similarity 100%)">int32_t</a><a id='7297' tid='7298', class="move" title="(similarity 100%)">*</a> <a id='7299' tid='7300', class="move" title="(similarity 100%)">cur</a> = <a id='7301' tid='7302', class="move" title="(similarity 100%)">NULL</a>;
        <a id='7303' tid='7304', class="move" title="(similarity 100%)">int32_t</a><a id='7305' tid='7306', class="move" title="(similarity 100%)">*</a> <a id='7307' tid='7308', class="move" title="(similarity 100%)">end</a> = <a id='7309' tid='7310', class="move" title="(similarity 100%)">NULL</a>;
        <a id='7311' tid='7312', class="move" title="(similarity 100%)">int</a> <a id='7313' tid='7314', class="move" title="(similarity 100%)">next_arg</a> = <a id='7315' tid='7316', class="move" title="(similarity 100%)">1</a>;

        <a id='7317' tid='7318', class="move" title="(similarity 100%)">if</a> (<a id='7319' tid='7320', class="move" title="(similarity 100%)">strcmp</a>(<a id='7321' tid='7322', class="move" title="(similarity 100%)">cmd</a>, <a id='7323' tid='7324', class="move" title="(similarity 100%)">&quot;stack&quot;</a>) <a id='7325' tid='7326', class="move" title="(similarity 100%)">==</a> <a id='7327' tid='7328', class="move" title="(similarity 100%)">0</a>) {
          <a id='7329' tid='7330', class="move" title="(similarity 100%)">cur</a> <a id='7331' tid='7332', class="move" title="(similarity 100%)">=</a> <a id='7333' tid='7334', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='7335' tid='7336', class="move" title="(similarity 100%)">int32_t</a><a id='7337' tid='7338', class="move" title="(similarity 100%)">*</a>&gt;(<a id='7339' tid='7340', class="move" title="(similarity 100%)">sim_</a>-&gt;<a id='7341' tid='7342', class="move" title="(similarity 100%)">get_register</a>(<a id='7343' tid='7344', class="move" title="(similarity 100%)">Simulator</a><a id='7345' tid='7346', class="move" title="(similarity 100%)">::</a><a id='7347' tid='7348', class="move" title="(similarity 100%)">sp</a>));
        } <a id='7349' tid='7350', class="move" title="(similarity 100%)">else</a> {  // Command &quot;mem&quot;.
          <a id='7351' tid='7352', class="move" title="(similarity 100%)">int32_t</a> <a id='7353' tid='7354', class="move" title="(similarity 100%)">value</a>;
          <a id='7355' tid='7356', class="move" title="(similarity 100%)">if</a> (<a id='7357' tid='7358', class="move" title="(similarity 100%)">!</a><a id='7359' tid='7360', class="move" title="(similarity 100%)">GetValue</a>(<a id='7361' tid='7362', class="move" title="(similarity 100%)">arg1</a>, <a id='7363' tid='7364', class="move" title="(similarity 100%)">&</a><a id='7365' tid='7366', class="move" title="(similarity 100%)">value</a>)) {
            <a id='7367' tid='7368', class="move" title="(similarity 100%)">PrintF</a>(<a id='7369' tid='7370', class="move" title="(similarity 100%)">&quot;%s unrecognized\n&quot;</a>, <a id='7371' tid='7372', class="move" title="(similarity 100%)">arg1</a>);
            <a id='7373' tid='7374', class="move" title="(similarity 100%)">continue</a>;
          }
          <a id='7375' tid='7376', class="move" title="(similarity 100%)">cur</a> <a id='7377' tid='7378', class="move" title="(similarity 100%)">=</a> <a id='7379' tid='7380', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='7381' tid='7382', class="move" title="(similarity 100%)">int32_t</a><a id='7383' tid='7384', class="move" title="(similarity 100%)">*</a>&gt;(<a id='7385' tid='7386', class="move" title="(similarity 100%)">value</a>);
          <a id='7387' tid='7388', class="move" title="(similarity 100%)">next_arg</a><a id='7389' tid='7390', class="move" title="(similarity 100%)">++</a>;
        }

        <a id='7391' tid='7392', class="move" title="(similarity 100%)">int32_t</a> <a id='7393' tid='7394', class="move" title="(similarity 100%)">words</a>;
        <a id='7395' tid='7396', class="move" title="(similarity 100%)">if</a> (<a id='7397' tid='7398', class="move" title="(similarity 100%)">argc</a> <a id='7399' tid='7400', class="move" title="(similarity 100%)">==</a> <a id='7401' tid='7402', class="move" title="(similarity 100%)">next_arg</a>) {
          <a id='7403' tid='7404', class="move" title="(similarity 100%)">words</a> <a id='7405' tid='7406', class="move" title="(similarity 100%)">=</a> <a id='7407' tid='7408', class="move" title="(similarity 100%)">10</a>;
        } <a id='7409' tid='7410', class="move" title="(similarity 100%)">else</a> <a id='7411' tid='7412', class="move" title="(similarity 100%)">if</a> (<a id='7413' tid='7414', class="move" title="(similarity 100%)">argc</a> <a id='7415' tid='7416', class="move" title="(similarity 100%)">==</a> <a id='7417' tid='7418', class="move" title="(similarity 100%)">next_arg</a> <a id='7419' tid='7420', class="move" title="(similarity 100%)">+</a> <a id='7421' tid='7422', class="move" title="(similarity 100%)">1</a>) {
          <a id='7423' tid='7424', class="move" title="(similarity 100%)">if</a> (<a id='7425' tid='7426', class="move" title="(similarity 100%)">!</a><a id='7427' tid='7428', class="move" title="(similarity 100%)">GetValue</a>(<a id='7429' tid='7430', class="move" title="(similarity 100%)">argv</a>[<a id='7431' tid='7432', class="move" title="(similarity 100%)">next_arg</a>], <a id='7433' tid='7434', class="move" title="(similarity 100%)">&</a><a id='7435' tid='7436', class="move" title="(similarity 100%)">words</a>)) {
            <a id='7437' tid='7438', class="move" title="(similarity 100%)">words</a> <a id='7439' tid='7440', class="move" title="(similarity 100%)">=</a> <a id='7441' tid='7442', class="move" title="(similarity 100%)">10</a>;
          }
        }
        <a id='7443' tid='7444', class="move" title="(similarity 100%)">end</a> <a id='7445' tid='7446', class="move" title="(similarity 100%)">=</a> <a id='7447' tid='7448', class="move" title="(similarity 100%)">cur</a> <a id='7449' tid='7450', class="move" title="(similarity 100%)">+</a> <a id='7451' tid='7452', class="move" title="(similarity 100%)">words</a>;

        <a id='7453' tid='7454', class="move" title="(similarity 100%)">while</a> (<a id='7455' tid='7456', class="move" title="(similarity 100%)">cur</a> <a id='7457' tid='7458', class="move" title="(similarity 100%)">&lt;</a> <a id='7459' tid='7460', class="move" title="(similarity 100%)">end</a>) {
          <a id='7461' tid='7462', class="move" title="(similarity 100%)">PrintF</a>(<a id='7463' tid='7464', class="move" title="(similarity 100%)">&quot;  0x%08x:  0x%08x %10d&quot;</a>,
                 <a id='7465' tid='7466', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='7467' tid='7468', class="move" title="(similarity 100%)">intptr_t</a>&gt;(<a id='7469' tid='7470', class="move" title="(similarity 100%)">cur</a>), <a id='7471' tid='7472', class="move" title="(similarity 100%)">*</a><a id='7473' tid='7474', class="move" title="(similarity 100%)">cur</a>, <a id='7475' tid='7476', class="move" title="(similarity 100%)">*</a><a id='7477' tid='7478', class="move" title="(similarity 100%)">cur</a>);
          <a id='7479' tid='7480', class="move" title="(similarity 100%)">HeapObject</a><a id='7481' tid='7482', class="move" title="(similarity 100%)">*</a> <a id='7483' tid='7484', class="move" title="(similarity 100%)">obj</a> = <a id='7485' tid='7486', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='7487' tid='7488', class="move" title="(similarity 100%)">HeapObject</a><a id='7489' tid='7490', class="move" title="(similarity 100%)">*</a>&gt;(<a id='7491' tid='7492', class="move" title="(similarity 100%)">*</a><a id='7493' tid='7494', class="move" title="(similarity 100%)">cur</a>);
          <a id='7495' tid='7496', class="move" title="(similarity 100%)">int</a> <a id='7497' tid='7498', class="move" title="(similarity 100%)">value</a> = <a id='7499' tid='7500', class="move" title="(similarity 100%)">*</a><a id='7501' tid='7502', class="move" title="(similarity 100%)">cur</a>;
          <a id='7503' tid='7504', class="move" title="(similarity 100%)">Heap</a><a id='7505' tid='7506', class="move" title="(similarity 100%)">*</a> <a id='7507' tid='7508', class="move" title="(similarity 100%)">current_heap</a> = <a id='7509' tid='7510', class="move" title="(similarity 100%)">v8</a><a id='7511' tid='7512', class="move" title="(similarity 100%)">::</a><a id='7513' tid='7514', class="move" title="(similarity 100%)">internal</a><a id='7515' tid='7516', class="move" title="(similarity 100%)">::</a><a id='7517' tid='7518', class="move" title="(similarity 100%)">Isolate</a><a id='7519' tid='7520', class="move" title="(similarity 100%)">::</a><a id='7521' tid='7522', class="move" title="(similarity 100%)">Current</a>()-&gt;<a id='7523' tid='7524', class="move" title="(similarity 100%)">heap</a>();
          <a id='7525' tid='7526', class="move" title="(similarity 100%)">if</a> (<a id='7527' tid='7528', class="move" title="(similarity 100%)">current_heap</a>-&gt;<a id='7529' tid='7530', class="move" title="(similarity 100%)">Contains</a>(<a id='7531' tid='7532', class="move" title="(similarity 100%)">obj</a>) <a id='7533' tid='7534', class="move" title="(similarity 100%)">||</a> ((<a id='7535' tid='7536', class="move" title="(similarity 100%)">value</a> <a id='7537' tid='7538', class="move" title="(similarity 100%)">&</a> <a id='7539' tid='7540', class="move" title="(similarity 100%)">1</a>) <a id='7541' tid='7542', class="move" title="(similarity 100%)">==</a> <a id='7543' tid='7544', class="move" title="(similarity 100%)">0</a>)) {
            <a id='7545' tid='7546', class="move" title="(similarity 100%)">PrintF</a>(<a id='7547' tid='7548', class="move" title="(similarity 100%)">&quot; (&quot;</a>);
            <a id='7549' tid='7550', class="move" title="(similarity 100%)">if</a> ((<a id='7551' tid='7552', class="move" title="(similarity 100%)">value</a> <a id='7553' tid='7554', class="move" title="(similarity 100%)">&</a> <a id='7555' tid='7556', class="move" title="(similarity 100%)">1</a>) <a id='7557' tid='7558', class="move" title="(similarity 100%)">==</a> <a id='7559' tid='7560', class="move" title="(similarity 100%)">0</a>) {
              <a id='7561' tid='7562', class="move" title="(similarity 100%)">PrintF</a>(<a id='7563' tid='7564', class="move" title="(similarity 100%)">&quot;smi %d&quot;</a>, <a id='7565' tid='7566', class="move" title="(similarity 100%)">value</a> <a id='7567' tid='7568', class="move" title="(similarity 100%)">/</a> <a id='7569' tid='7570', class="move" title="(similarity 100%)">2</a>);
            } <a id='7571' tid='7572', class="move" title="(similarity 100%)">else</a> {
              <a id='7573' tid='7574', class="move" title="(similarity 100%)">obj</a>-&gt;<a id='7575' tid='7576', class="move" title="(similarity 100%)">ShortPrint</a>();
            }
            <a id='7577' tid='7578', class="move" title="(similarity 100%)">PrintF</a>(<a id='7579' tid='7580', class="move" title="(similarity 100%)">&quot;)&quot;</a>);
          }
          <a id='7581' tid='7582', class="move" title="(similarity 100%)">PrintF</a>(<a id='7583' tid='7584', class="move" title="(similarity 100%)">&quot;\n&quot;</a>);
          <a id='7585' tid='7586', class="move" title="(similarity 100%)">cur</a><a id='7587' tid='7588', class="move" title="(similarity 100%)">++</a>;
        }

      } <a id='7589' tid='7590', class="move" title="(similarity 100%)">else</a> <span class="deletion" title="deleted">if</span> <span class="deletion" title="deleted">((strcmp(cmd, &quot;disasm&quot;) == 0) ||
                 (strcmp(cmd, &quot;dpc&quot;) == 0) ||
                 (strcmp(cmd, &quot;di&quot;) == 0))</span> {
        <span class="deletion" title="deleted">disasm::NameConverter converter;</span>
        <span class="deletion" title="deleted">disasm::Disassembler dasm(converter)</span>;
        // Use a reasonably large buffer.
        <a id='7591' tid='7592', class="move" title="(similarity 100%)">v8</a><a id='7593' tid='7594', class="move" title="(similarity 100%)">::</a><a id='7595' tid='7596', class="move" title="(similarity 100%)">internal</a><a id='7597' tid='7598', class="move" title="(similarity 100%)">::</a><a id='7599' tid='7600', class="move" title="(similarity 100%)">EmbeddedVector</a>&lt;<a id='7601' tid='7602', class="move" title="(similarity 100%)">char</a>, <a id='7603' tid='7604', class="move" title="(similarity 100%)">256</a>&gt; <a id='7605' tid='7606', class="move" title="(similarity 100%)">buffer</a>;

        <span class="deletion" title="deleted">byte* cur = NULL;</span>
        <span class="deletion" title="deleted">byte* end = NULL;</span>

        <span class="deletion" title="deleted">if</span> <span class="deletion" title="deleted">(argc == 1)</span> <span class="deletion" title="deleted">{
          cur = reinterpret_cast&lt;byte*&gt;(sim_-&gt;get_pc());
          end = cur + (10 * Instruction::kInstrSize);
        }</span> <span class="deletion" title="deleted">else</span> <span class="deletion" title="deleted">if</span> <span class="deletion" title="deleted">(argc == 2)</span> {
          <span class="deletion" title="deleted">int regnum = Registers::Number(arg1);</span>
          <span class="deletion" title="deleted">if</span> <span class="deletion" title="deleted">(regnum != kInvalidRegister || strncmp(arg1, &quot;0x&quot;, 2) == 0)</span> <span class="deletion" title="deleted">{
            // The argument is an address or a register name.
            int32_t value;
            if (GetValue(arg1, &value)) {
              cur = reinterpret_cast&lt;byte*&gt;(value);
              // Disassemble 10 instructions at &lt;arg1&gt;.
              end = cur + (10 * Instruction::kInstrSize);
            }
          }</span> <a id='5857' tid='5858', class="move" title="(similarity 100%)">else</a> {
            // The argument is the number of instructions.
            <a id='5859' tid='5860', class="move" title="(similarity 100%)">int32_t</a> <a id='5861' tid='5862', class="move" title="(similarity 100%)">value</a>;
            <a id='5863' tid='5864', class="move" title="(similarity 100%)">if</a> (<a id='5865' tid='5866', class="move" title="(similarity 100%)">GetValue</a>(<a id='5867' tid='5868', class="move" title="(similarity 100%)">arg1</a>, <a id='5869' tid='5870', class="move" title="(similarity 100%)">&</a><a id='5871' tid='5872', class="move" title="(similarity 100%)">value</a>)) {
              <a id='5873' tid='5874', class="move" title="(similarity 100%)">cur</a> <a id='5875' tid='5876', class="move" title="(similarity 100%)">=</a> <a id='5877' tid='5878', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='5879' tid='5880', class="move" title="(similarity 100%)">byte</a><a id='5881' tid='5882', class="move" title="(similarity 100%)">*</a>&gt;(<a id='5883' tid='5884', class="move" title="(similarity 100%)">sim_</a>-&gt;<a id='5885' tid='5886', class="move" title="(similarity 100%)">get_pc</a>());
              // Disassemble &lt;arg1&gt; instructions.
              <a id='5887' tid='5888', class="move" title="(similarity 100%)">end</a> <a id='5889' tid='5890', class="move" title="(similarity 100%)">=</a> <a id='5891' tid='5892', class="move" title="(similarity 100%)">cur</a> <a id='5893' tid='5894', class="move" title="(similarity 100%)">+</a> (<a id='5895' tid='5896', class="move" title="(similarity 100%)">value</a> <a id='5897' tid='5898', class="move" title="(similarity 100%)">*</a> <a id='5899' tid='5900', class="move" title="(similarity 100%)">Instruction</a><a id='5901' tid='5902', class="move" title="(similarity 100%)">::</a><a id='5903' tid='5904', class="move" title="(similarity 100%)">kInstrSize</a>);
            }
          }
        } <span class="deletion" title="deleted">else {
          int32_t value1;
          int32_t value2;
          if (GetValue(arg1, &value1) && GetValue(arg2, &value2)) {
            cur = reinterpret_cast&lt;byte*&gt;(value1);
            end = cur + (value2 * Instruction::kInstrSize);
          }
        }</span>

        <span class="deletion" title="deleted">while (cur &lt; end) {
          dasm.InstructionDecode(buffer, cur);
          PrintF(&quot;  0x%08x  %s\n&quot;,
              reinterpret_cast&lt;intptr_t&gt;(cur), buffer.start());
          cur += Instruction::kInstrSize;
        }</span>
      } <span class="deletion" title="deleted">else</span> <a id='6713' tid='6714', class="move" title="(similarity 100%)">if</a> (<a id='6715' tid='6716', class="move" title="(similarity 100%)">strcmp</a>(<a id='6717' tid='6718', class="move" title="(similarity 100%)">cmd</a>, <a id='6719' tid='6720', class="move" title="(similarity 100%)">&quot;gdb&quot;</a>) <a id='6721' tid='6722', class="move" title="(similarity 100%)">==</a> <a id='6723' tid='6724', class="move" title="(similarity 100%)">0</a>) {
        <a id='7087' tid='7088', class="move" title="(similarity 100%)">PrintF</a>(<a id='7089' tid='7090', class="move" title="(similarity 100%)">&quot;relinquishing control to gdb\n&quot;</a>);
        <a id='7091' tid='7092', class="move" title="(similarity 100%)">v8</a><a id='7093' tid='7094', class="move" title="(similarity 100%)">::</a><a id='7095' tid='7096', class="move" title="(similarity 100%)">internal</a><a id='7097' tid='7098', class="move" title="(similarity 100%)">::</a><a id='7099' tid='7100', class="move" title="(similarity 100%)">OS</a><a id='7101' tid='7102', class="move" title="(similarity 100%)">::</a><a id='7103' tid='7104', class="move" title="(similarity 100%)">DebugBreak</a>();
        <a id='7105' tid='7106', class="move" title="(similarity 100%)">PrintF</a>(<a id='7107' tid='7108', class="move" title="(similarity 100%)">&quot;regaining control from gdb\n&quot;</a>);
      } <a id='6725' tid='6726', class="move" title="(similarity 100%)">else</a> <a id='6727' tid='6728', class="move" title="(similarity 100%)">if</a> (<a id='6729' tid='6730', class="move" title="(similarity 100%)">strcmp</a>(<a id='6731' tid='6732', class="move" title="(similarity 100%)">cmd</a>, <a id='6733' tid='6734', class="move" title="(similarity 100%)">&quot;break&quot;</a>) <a id='6735' tid='6736', class="move" title="(similarity 100%)">==</a> <a id='6737' tid='6738', class="move" title="(similarity 100%)">0</a>) {
        <a id='6739' tid='6740', class="move" title="(similarity 100%)">if</a> (<a id='6741' tid='6742', class="move" title="(similarity 100%)">argc</a> <a id='6743' tid='6744', class="move" title="(similarity 100%)">==</a> <a id='6745' tid='6746', class="move" title="(similarity 100%)">2</a>) {
          <a id='6747' tid='6748', class="move" title="(similarity 100%)">int32_t</a> <a id='6749' tid='6750', class="move" title="(similarity 100%)">value</a>;
          <a id='6751' tid='6752', class="move" title="(similarity 100%)">if</a> (<a id='6753' tid='6754', class="move" title="(similarity 100%)">GetValue</a>(<a id='6755' tid='6756', class="move" title="(similarity 100%)">arg1</a>, <a id='6757' tid='6758', class="move" title="(similarity 100%)">&</a><a id='6759' tid='6760', class="move" title="(similarity 100%)">value</a>)) {
            <a id='6761' tid='6762', class="move" title="(similarity 100%)">if</a> (<a id='6763' tid='6764', class="move" title="(similarity 100%)">!</a><a id='6765' tid='6766', class="move" title="(similarity 100%)">SetBreakpoint</a>(<a id='6767' tid='6768', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='6769' tid='6770', class="move" title="(similarity 100%)">Instruction</a><a id='6771' tid='6772', class="move" title="(similarity 100%)">*</a>&gt;(<a id='6773' tid='6774', class="move" title="(similarity 100%)">value</a>))) {
              <a id='6775' tid='6776', class="move" title="(similarity 100%)">PrintF</a>(<a id='6777' tid='6778', class="move" title="(similarity 100%)">&quot;setting breakpoint failed\n&quot;</a>);
            }
          } <a id='6779' tid='6780', class="move" title="(similarity 100%)">else</a> {
            <a id='6781' tid='6782', class="move" title="(similarity 100%)">PrintF</a>(<a id='6783' tid='6784', class="move" title="(similarity 100%)">&quot;%s unrecognized\n&quot;</a>, <a id='6785' tid='6786', class="move" title="(similarity 100%)">arg1</a>);
          }
        } <a id='6787' tid='6788', class="move" title="(similarity 100%)">else</a> {
          <a id='6789' tid='6790', class="move" title="(similarity 100%)">PrintF</a>(<a id='6791' tid='6792', class="move" title="(similarity 100%)">&quot;break &lt;address&gt;\n&quot;</a>);
        }
      } <a id='6793' tid='6794', class="move" title="(similarity 100%)">else</a> <a id='6795' tid='6796', class="move" title="(similarity 100%)">if</a> (<a id='6797' tid='6798', class="move" title="(similarity 100%)">strcmp</a>(<a id='6799' tid='6800', class="move" title="(similarity 100%)">cmd</a>, <a id='6801' tid='6802', class="move" title="(similarity 100%)">&quot;del&quot;</a>) <a id='6803' tid='6804', class="move" title="(similarity 100%)">==</a> <a id='6805' tid='6806', class="move" title="(similarity 100%)">0</a>) {
        <a id='6807' tid='6808', class="move" title="(similarity 100%)">if</a> (<a id='6809' tid='6810', class="move" title="(similarity 100%)">!</a><a id='6811' tid='6812', class="move" title="(similarity 100%)">DeleteBreakpoint</a>(<a id='6813' tid='6814', class="move" title="(similarity 100%)">NULL</a>)) {
          <a id='6815' tid='6816', class="move" title="(similarity 100%)">PrintF</a>(<a id='6817' tid='6818', class="move" title="(similarity 100%)">&quot;deleting breakpoint failed\n&quot;</a>);
        }
      } <a id='6819' tid='6820', class="move" title="(similarity 100%)">else</a> <span class="deletion" title="deleted">if</span> <span class="deletion" title="deleted">(strcmp(cmd, &quot;flags&quot;) == 0)</span> <span class="deletion" title="deleted">{
        PrintF(&quot;No flags on MIPS !\n&quot;);
      }</span> <span class="deletion" title="deleted">else</span> <a id='6447' tid='6448', class="move" title="(similarity 100%)">if</a> (<a id='6449' tid='6450', class="move" title="(similarity 100%)">strcmp</a>(<a id='6451' tid='6452', class="move" title="(similarity 100%)">cmd</a>, <a id='6453' tid='6454', class="move" title="(similarity 100%)">&quot;stop&quot;</a>) <a id='6455' tid='6456', class="move" title="(similarity 100%)">==</a> <a id='6457' tid='6458', class="move" title="(similarity 100%)">0</a>) {
        <a id='6821' tid='6822', class="move" title="(similarity 100%)">int32_t</a> <a id='6823' tid='6824', class="move" title="(similarity 100%)">value</a>;
        <a id='6825' tid='6826', class="move" title="(similarity 100%)">intptr_t</a> <a id='6827' tid='6828', class="move" title="(similarity 100%)">stop_pc</a> = <a id='6829' tid='6830', class="move" title="(similarity 100%)">sim_</a>-&gt;<a id='6831' tid='6832', class="move" title="(similarity 100%)">get_pc</a>() <a id='6833' tid='6834', class="move" title="(similarity 100%)">-</a>
            <a id='6835' tid='6836', class="move" title="(similarity 100%)">2</a> <a id='6837' tid='6838', class="move" title="(similarity 100%)">*</a> <a id='6839' tid='6840', class="move" title="(similarity 100%)">Instruction</a><a id='6841' tid='6842', class="move" title="(similarity 100%)">::</a><a id='6843' tid='6844', class="move" title="(similarity 100%)">kInstrSize</a>;
        <a id='6845' tid='6846', class="move" title="(similarity 100%)">Instruction</a><a id='6847' tid='6848', class="move" title="(similarity 100%)">*</a> <a id='6849' tid='6850', class="move" title="(similarity 100%)">stop_instr</a> = <a id='6851' tid='6852', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='6853' tid='6854', class="move" title="(similarity 100%)">Instruction</a><a id='6855' tid='6856', class="move" title="(similarity 100%)">*</a>&gt;(<a id='6857' tid='6858', class="move" title="(similarity 100%)">stop_pc</a>);
        <a id='6859' tid='6860', class="move" title="(similarity 100%)">Instruction</a><a id='6861' tid='6862', class="move" title="(similarity 100%)">*</a> <a id='6863' tid='6864', class="move" title="(similarity 100%)">msg_address</a> =
          <a id='6865' tid='6866', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='6867' tid='6868', class="move" title="(similarity 100%)">Instruction</a><a id='6869' tid='6870', class="move" title="(similarity 100%)">*</a>&gt;(<a id='6871' tid='6872', class="move" title="(similarity 100%)">stop_pc</a> <a id='6873' tid='6874', class="move" title="(similarity 100%)">+</a>
              <a id='6875' tid='6876', class="move" title="(similarity 100%)">Instruction</a><a id='6877' tid='6878', class="move" title="(similarity 100%)">::</a><a id='6879' tid='6880', class="move" title="(similarity 100%)">kInstrSize</a>);
        <span class="deletion" title="deleted">if</span> ((<a id='6881' tid='6882', class="move" title="(similarity 100%)">argc</a> <a id='6883' tid='6884', class="move" title="(similarity 100%)">==</a> <a id='6885' tid='6886', class="move" title="(similarity 100%)">2</a>) <a id='6887' tid='6888', class="move" title="(similarity 100%)">&&</a> (<a id='6889' tid='6890', class="move" title="(similarity 100%)">strcmp</a>(<a id='6891' tid='6892', class="move" title="(similarity 100%)">arg1</a>, <a id='6893' tid='6894', class="move" title="(similarity 100%)">&quot;unstop&quot;</a>) <a id='6895' tid='6896', class="move" title="(similarity 100%)">==</a> <a id='6897' tid='6898', class="move" title="(similarity 100%)">0</a>)) <span class="deletion" title="deleted">{
          // Remove the current stop.
          if (sim_-&gt;IsStopInstruction(stop_instr)) {
            stop_instr-&gt;SetInstructionBits(kNopInstr);
            msg_address-&gt;SetInstructionBits(kNopInstr);
          } else {
            PrintF(&quot;Not at debugger stop.\n&quot;);
          }
        }</span> <a id='6485' tid='6486', class="move" title="(similarity 100%)">else</a> <a id='6487' tid='6488', class="move" title="(similarity 100%)">if</a> (<a id='6489' tid='6490', class="move" title="(similarity 100%)">argc</a> <a id='6491' tid='6492', class="move" title="(similarity 100%)">==</a> <a id='6493' tid='6494', class="move" title="(similarity 100%)">3</a>) {
          // Print information about all/the specified breakpoint(s).
          <a id='6495' tid='6496', class="move" title="(similarity 100%)">if</a> (<a id='6497' tid='6498', class="move" title="(similarity 100%)">strcmp</a>(<a id='6499' tid='6500', class="move" title="(similarity 100%)">arg1</a>, <a id='6501' tid='6502', class="move" title="(similarity 100%)">&quot;info&quot;</a>) <a id='6503' tid='6504', class="move" title="(similarity 100%)">==</a> <a id='6505' tid='6506', class="move" title="(similarity 100%)">0</a>) {
            <span class="deletion" title="deleted">if</span> <span class="deletion" title="deleted">(strcmp(arg2, &quot;all&quot;) == 0)</span> <span class="deletion" title="deleted">{
              PrintF(&quot;Stop information:\n&quot;);
              for (uint32_t i = kMaxWatchpointCode + 1;
                   i &lt;= kMaxStopCode;
                   i++) {
                sim_-&gt;PrintStopInfo(i);
              }
            }</span> <a id='6507' tid='6508', class="move" title="(similarity 100%)">else</a> <a id='6509' tid='6510', class="move" title="(similarity 100%)">if</a> (<a id='6511' tid='6512', class="move" title="(similarity 100%)">GetValue</a>(<a id='6513' tid='6514', class="move" title="(similarity 100%)">arg2</a>, <a id='6515' tid='6516', class="move" title="(similarity 100%)">&</a><a id='6517' tid='6518', class="move" title="(similarity 100%)">value</a>)) {
              <a id='6519' tid='6520', class="move" title="(similarity 100%)">sim_</a>-&gt;<a id='6521' tid='6522', class="move" title="(similarity 100%)">PrintStopInfo</a>(<a id='6523' tid='6524', class="move" title="(similarity 100%)">value</a>);
            } <a id='6525' tid='6526', class="move" title="(similarity 100%)">else</a> {
              <a id='6527' tid='6528', class="move" title="(similarity 100%)">PrintF</a>(<a id='6529' tid='6530', class="move" title="(similarity 100%)">&quot;Unrecognized argument.\n&quot;</a>);
            }
          } <a id='6531' tid='6532', class="move" title="(similarity 100%)">else</a> <a id='6533' tid='6534', class="move" title="(similarity 100%)">if</a> (<a id='6535' tid='6536', class="move" title="(similarity 100%)">strcmp</a>(<a id='6537' tid='6538', class="move" title="(similarity 100%)">arg1</a>, <a id='6539' tid='6540', class="move" title="(similarity 100%)">&quot;enable&quot;</a>) <a id='6541' tid='6542', class="move" title="(similarity 100%)">==</a> <a id='6543' tid='6544', class="move" title="(similarity 100%)">0</a>) {
            // Enable all/the specified breakpoint(s).
            <span class="deletion" title="deleted">if</span> <span class="deletion" title="deleted">(strcmp(arg2, &quot;all&quot;) == 0)</span> <span class="deletion" title="deleted">{
              for (uint32_t i = kMaxWatchpointCode + 1;
                   i &lt;= kMaxStopCode;
                   i++) {
                sim_-&gt;EnableStop(i);
              }
            }</span> <a id='6545' tid='6546', class="move" title="(similarity 100%)">else</a> <a id='6547' tid='6548', class="move" title="(similarity 100%)">if</a> (<a id='6549' tid='6550', class="move" title="(similarity 100%)">GetValue</a>(<a id='6551' tid='6552', class="move" title="(similarity 100%)">arg2</a>, <a id='6553' tid='6554', class="move" title="(similarity 100%)">&</a><a id='6555' tid='6556', class="move" title="(similarity 100%)">value</a>)) {
              <a id='6557' tid='6558', class="move" title="(similarity 100%)">sim_</a>-&gt;<a id='6559' tid='6560', class="move" title="(similarity 100%)">EnableStop</a>(<a id='6561' tid='6562', class="move" title="(similarity 100%)">value</a>);
            } <a id='6563' tid='6564', class="move" title="(similarity 100%)">else</a> {
              <a id='6565' tid='6566', class="move" title="(similarity 100%)">PrintF</a>(<a id='6567' tid='6568', class="move" title="(similarity 100%)">&quot;Unrecognized argument.\n&quot;</a>);
            }
          } <a id='6569' tid='6570', class="move" title="(similarity 100%)">else</a> <a id='6571' tid='6572', class="move" title="(similarity 100%)">if</a> (<a id='6573' tid='6574', class="move" title="(similarity 100%)">strcmp</a>(<a id='6575' tid='6576', class="move" title="(similarity 100%)">arg1</a>, <a id='6577' tid='6578', class="move" title="(similarity 100%)">&quot;disable&quot;</a>) <a id='6579' tid='6580', class="move" title="(similarity 100%)">==</a> <a id='6581' tid='6582', class="move" title="(similarity 100%)">0</a>) {
            // Disable all/the specified breakpoint(s).
            <span class="deletion" title="deleted">if</span> <span class="deletion" title="deleted">(strcmp(arg2, &quot;all&quot;) == 0)</span> <span class="deletion" title="deleted">{
              for (uint32_t i = kMaxWatchpointCode + 1;
                   i &lt;= kMaxStopCode;
                   i++) {
                sim_-&gt;DisableStop(i);
              }
            }</span> <a id='6583' tid='6584', class="move" title="(similarity 100%)">else</a> <a id='6585' tid='6586', class="move" title="(similarity 100%)">if</a> (<a id='6587' tid='6588', class="move" title="(similarity 100%)">GetValue</a>(<a id='6589' tid='6590', class="move" title="(similarity 100%)">arg2</a>, <a id='6591' tid='6592', class="move" title="(similarity 100%)">&</a><a id='6593' tid='6594', class="move" title="(similarity 100%)">value</a>)) {
              <a id='6595' tid='6596', class="move" title="(similarity 100%)">sim_</a>-&gt;<a id='6597' tid='6598', class="move" title="(similarity 100%)">DisableStop</a>(<a id='6599' tid='6600', class="move" title="(similarity 100%)">value</a>);
            } <a id='6601' tid='6602', class="move" title="(similarity 100%)">else</a> {
              <a id='6603' tid='6604', class="move" title="(similarity 100%)">PrintF</a>(<a id='6605' tid='6606', class="move" title="(similarity 100%)">&quot;Unrecognized argument.\n&quot;</a>);
            }
          }
        } <a id='6607' tid='6608', class="move" title="(similarity 100%)">else</a> {
          <a id='6609' tid='6610', class="move" title="(similarity 100%)">PrintF</a>(<a id='6611' tid='6612', class="move" title="(similarity 100%)">&quot;Wrong usage. Use help command for more information.\n&quot;</a>);
        }
      } <a id='6459' tid='6460', class="move" title="(similarity 100%)">else</a> <span class="deletion" title="deleted">if</span> <span class="deletion" title="deleted">((strcmp(cmd, &quot;stat&quot;) == 0) || (strcmp(cmd, &quot;st&quot;) == 0))</span> {
        // Print registers and disassemble.
        <span class="deletion" title="deleted">PrintAllRegs();</span>
        <span class="deletion" title="deleted">PrintF(&quot;\n&quot;);</span>

        <span class="deletion" title="deleted">disasm::NameConverter converter;</span>
        <span class="deletion" title="deleted">disasm::Disassembler dasm(converter)</span>;
        // Use a reasonably large buffer.
        <a id='4291' tid='4292', class="move" title="(similarity 100%)">v8</a><a id='4293' tid='4294', class="move" title="(similarity 100%)">::</a><a id='4295' tid='4296', class="move" title="(similarity 100%)">internal</a><a id='4297' tid='4298', class="move" title="(similarity 100%)">::</a><a id='4299' tid='4300', class="move" title="(similarity 100%)">EmbeddedVector</a>&lt;<a id='4301' tid='4302', class="move" title="(similarity 100%)">char</a>, <a id='4303' tid='4304', class="move" title="(similarity 100%)">256</a>&gt; <a id='4305' tid='4306', class="move" title="(similarity 100%)">buffer</a>;

        <span class="deletion" title="deleted">byte* cur = NULL;</span>
        <span class="deletion" title="deleted">byte* end = NULL;</span>

        <a id='6125' tid='6126', class="move" title="(similarity 100%)">if</a> (<a id='6127' tid='6128', class="move" title="(similarity 100%)">argc</a> <a id='6129' tid='6130', class="move" title="(similarity 100%)">==</a> <a id='6131' tid='6132', class="move" title="(similarity 100%)">1</a>) {
          <a id='6133' tid='6134', class="move" title="(similarity 100%)">cur</a> <a id='6135' tid='6136', class="move" title="(similarity 100%)">=</a> <a id='6137' tid='6138', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='6139' tid='6140', class="move" title="(similarity 100%)">byte</a><a id='6141' tid='6142', class="move" title="(similarity 100%)">*</a>&gt;(<a id='6143' tid='6144', class="move" title="(similarity 100%)">sim_</a>-&gt;<a id='6145' tid='6146', class="move" title="(similarity 100%)">get_pc</a>());
          <a id='6147' tid='6148', class="move" title="(similarity 100%)">end</a> <a id='6149' tid='6150', class="move" title="(similarity 100%)">=</a> <a id='6151' tid='6152', class="move" title="(similarity 100%)">cur</a> <a id='6153' tid='6154', class="move" title="(similarity 100%)">+</a> (<a id='6155' tid='6156', class="move" title="(similarity 100%)">10</a> <a id='6157' tid='6158', class="move" title="(similarity 100%)">*</a> <a id='6159' tid='6160', class="move" title="(similarity 100%)">Instruction</a><a id='6161' tid='6162', class="move" title="(similarity 100%)">::</a><a id='6163' tid='6164', class="move" title="(similarity 100%)">kInstrSize</a>);
        } <a id='6165' tid='6166', class="move" title="(similarity 100%)">else</a> <a id='6167' tid='6168', class="move" title="(similarity 100%)">if</a> (<a id='6169' tid='6170', class="move" title="(similarity 100%)">argc</a> <a id='6171' tid='6172', class="move" title="(similarity 100%)">==</a> <a id='6173' tid='6174', class="move" title="(similarity 100%)">2</a>) {
          <a id='6175' tid='6176', class="move" title="(similarity 100%)">int32_t</a> <a id='6177' tid='6178', class="move" title="(similarity 100%)">value</a>;
          <a id='6179' tid='6180', class="move" title="(similarity 100%)">if</a> (<a id='6181' tid='6182', class="move" title="(similarity 100%)">GetValue</a>(<a id='6183' tid='6184', class="move" title="(similarity 100%)">arg1</a>, <a id='6185' tid='6186', class="move" title="(similarity 100%)">&</a><a id='6187' tid='6188', class="move" title="(similarity 100%)">value</a>)) {
            <a id='6189' tid='6190', class="move" title="(similarity 100%)">cur</a> <a id='6191' tid='6192', class="move" title="(similarity 100%)">=</a> <a id='6193' tid='6194', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='6195' tid='6196', class="move" title="(similarity 100%)">byte</a><a id='6197' tid='6198', class="move" title="(similarity 100%)">*</a>&gt;(<a id='6199' tid='6200', class="move" title="(similarity 100%)">value</a>);
            // no length parameter passed, assume 10 instructions
            <a id='6201' tid='6202', class="move" title="(similarity 100%)">end</a> <a id='6203' tid='6204', class="move" title="(similarity 100%)">=</a> <a id='6205' tid='6206', class="move" title="(similarity 100%)">cur</a> <a id='6207' tid='6208', class="move" title="(similarity 100%)">+</a> (<a id='6209' tid='6210', class="move" title="(similarity 100%)">10</a> <a id='6211' tid='6212', class="move" title="(similarity 100%)">*</a> <a id='6213' tid='6214', class="move" title="(similarity 100%)">Instruction</a><a id='6215' tid='6216', class="move" title="(similarity 100%)">::</a><a id='6217' tid='6218', class="move" title="(similarity 100%)">kInstrSize</a>);
          }
        } <a id='6219' tid='6220', class="move" title="(similarity 100%)">else</a> {
          <a id='6221' tid='6222', class="move" title="(similarity 100%)">int32_t</a> <a id='6223' tid='6224', class="move" title="(similarity 100%)">value1</a>;
          <a id='6225' tid='6226', class="move" title="(similarity 100%)">int32_t</a> <a id='6227' tid='6228', class="move" title="(similarity 100%)">value2</a>;
          <a id='6229' tid='6230', class="move" title="(similarity 100%)">if</a> (<a id='6231' tid='6232', class="move" title="(similarity 100%)">GetValue</a>(<a id='6233' tid='6234', class="move" title="(similarity 100%)">arg1</a>, <a id='6235' tid='6236', class="move" title="(similarity 100%)">&</a><a id='6237' tid='6238', class="move" title="(similarity 100%)">value1</a>) <a id='6239' tid='6240', class="move" title="(similarity 100%)">&&</a> <a id='6241' tid='6242', class="move" title="(similarity 100%)">GetValue</a>(<a id='6243' tid='6244', class="move" title="(similarity 100%)">arg2</a>, <a id='6245' tid='6246', class="move" title="(similarity 100%)">&</a><a id='6247' tid='6248', class="move" title="(similarity 100%)">value2</a>)) {
            <a id='6249' tid='6250', class="move" title="(similarity 100%)">cur</a> <a id='6251' tid='6252', class="move" title="(similarity 100%)">=</a> <a id='6253' tid='6254', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='6255' tid='6256', class="move" title="(similarity 100%)">byte</a><a id='6257' tid='6258', class="move" title="(similarity 100%)">*</a>&gt;(<a id='6259' tid='6260', class="move" title="(similarity 100%)">value1</a>);
            <a id='6261' tid='6262', class="move" title="(similarity 100%)">end</a> <a id='6263' tid='6264', class="move" title="(similarity 100%)">=</a> <a id='6265' tid='6266', class="move" title="(similarity 100%)">cur</a> <a id='6267' tid='6268', class="move" title="(similarity 100%)">+</a> (<a id='6269' tid='6270', class="move" title="(similarity 100%)">value2</a> <a id='6271' tid='6272', class="move" title="(similarity 100%)">*</a> <a id='6273' tid='6274', class="move" title="(similarity 100%)">Instruction</a><a id='6275' tid='6276', class="move" title="(similarity 100%)">::</a><a id='6277' tid='6278', class="move" title="(similarity 100%)">kInstrSize</a>);
          }
        }

        <span class="deletion" title="deleted">while (cur &lt; end) {
          dasm.InstructionDecode(buffer, cur);
          PrintF(&quot;  0x%08x  %s\n&quot;,
                 reinterpret_cast&lt;intptr_t&gt;(cur), buffer.start());
          cur += Instruction::kInstrSize;
        }</span>
      } <a id='6461' tid='6462', class="move" title="(similarity 100%)">else</a> <span class="deletion" title="deleted">if</span> ((<a id='6463' tid='6464', class="move" title="(similarity 100%)">strcmp</a>(<a id='6465' tid='6466', class="move" title="(similarity 100%)">cmd</a>, <a id='6467' tid='6468', class="move" title="(similarity 100%)">&quot;h&quot;</a>) <a id='6469' tid='6470', class="move" title="(similarity 100%)">==</a> <a id='6471' tid='6472', class="move" title="(similarity 100%)">0</a>) <a id='6473' tid='6474', class="move" title="(similarity 100%)">||</a> (<a id='6475' tid='6476', class="move" title="(similarity 100%)">strcmp</a>(<a id='6477' tid='6478', class="move" title="(similarity 100%)">cmd</a>, <a id='6479' tid='6480', class="move" title="(similarity 100%)">&quot;help&quot;</a>) <a id='6481' tid='6482', class="move" title="(similarity 100%)">==</a> <a id='6483' tid='6484', class="move" title="(similarity 100%)">0</a>)) <span class="deletion" title="deleted">{
        PrintF(&quot;cont\n&quot;);
        PrintF(&quot;  continue execution (alias &#39;c&#39;)\n&quot;);
        PrintF(&quot;stepi\n&quot;);
        PrintF(&quot;  step one instruction (alias &#39;si&#39;)\n&quot;);
        PrintF(&quot;print &lt;register&gt;\n&quot;);
        PrintF(&quot;  print register content (alias &#39;p&#39;)\n&quot;);
        PrintF(&quot;  use register name &#39;all&#39; to print all registers\n&quot;);
        PrintF(&quot;printobject &lt;register&gt;\n&quot;);
        PrintF(&quot;  print an object from a register (alias &#39;po&#39;)\n&quot;);
        PrintF(&quot;stack [&lt;words&gt;]\n&quot;);
        PrintF(&quot;  dump stack content, default dump 10 words)\n&quot;);
        PrintF(&quot;mem &lt;address&gt; [&lt;words&gt;]\n&quot;);
        PrintF(&quot;  dump memory content, default dump 10 words)\n&quot;);
        PrintF(&quot;flags\n&quot;);
        PrintF(&quot;  print flags\n&quot;);
        PrintF(&quot;disasm [&lt;instructions&gt;]\n&quot;);
        PrintF(&quot;disasm [&lt;address/register&gt;]\n&quot;);
        PrintF(&quot;disasm [[&lt;address/register&gt;] &lt;instructions&gt;]\n&quot;);
        PrintF(&quot;  disassemble code, default is 10 instructions\n&quot;);
        PrintF(&quot;  from pc (alias &#39;di&#39;)\n&quot;);
        PrintF(&quot;gdb\n&quot;);
        PrintF(&quot;  enter gdb\n&quot;);
        PrintF(&quot;break &lt;address&gt;\n&quot;);
        PrintF(&quot;  set a break point on the address\n&quot;);
        PrintF(&quot;del\n&quot;);
        PrintF(&quot;  delete the breakpoint\n&quot;);
        PrintF(&quot;stop feature:\n&quot;);
        PrintF(&quot;  Description:\n&quot;);
        PrintF(&quot;    Stops are debug instructions inserted by\n&quot;);
        PrintF(&quot;    the Assembler::stop() function.\n&quot;);
        PrintF(&quot;    When hitting a stop, the Simulator will\n&quot;);
        PrintF(&quot;    stop and and give control to the Debugger.\n&quot;);
        PrintF(&quot;    All stop codes are watched:\n&quot;);
        PrintF(&quot;    - They can be enabled / disabled: the Simulator\n&quot;);
        PrintF(&quot;       will / won&#39;t stop when hitting them.\n&quot;);
        PrintF(&quot;    - The Simulator keeps track of how many times they \n&quot;);
        PrintF(&quot;      are met. (See the info command.) Going over a\n&quot;);
        PrintF(&quot;      disabled stop still increases its counter. \n&quot;);
        PrintF(&quot;  Commands:\n&quot;);
        PrintF(&quot;    stop info all/&lt;code&gt; : print infos about number &lt;code&gt;\n&quot;);
        PrintF(&quot;      or all stop(s).\n&quot;);
        PrintF(&quot;    stop enable/disable all/&lt;code&gt; : enables / disables\n&quot;);
        PrintF(&quot;      all or number &lt;code&gt; stop(s)\n&quot;);
        PrintF(&quot;    stop unstop\n&quot;);
        PrintF(&quot;      ignore the stop instruction at the current location\n&quot;);
        PrintF(&quot;      from now on\n&quot;);
      }</span> <span class="deletion" title="deleted">else {
        PrintF(&quot;Unknown command: %s\n&quot;, cmd);
      }</span>
    }
    <a id='7803' tid='7804', class="move" title="(similarity 100%)">DeleteArray</a>(<a id='7805' tid='7806', class="move" title="(similarity 100%)">line</a>);
  }

  // Add all the breakpoints back to stop execution and enter the debugger
  // shell when hit.
  <a id='8067' tid='8068', class="move" title="(similarity 100%)">RedoBreakpoints</a>();

#<a id='8069' tid='8070', class="move" title="(similarity 100%)">undef</a> <a id='8071' tid='8072', class="move" title="(similarity 100%)">COMMAND_SIZE</a>
#<a id='8073' tid='8074', class="move" title="(similarity 100%)">undef</a> <a id='8075' tid='8076', class="move" title="(similarity 100%)">ARG_SIZE</a>

#<a id='8077' tid='8078', class="move" title="(similarity 100%)">undef</a> <a id='8079' tid='8080', class="move" title="(similarity 100%)">STR</a>
#<a id='8081' tid='8082', class="move" title="(similarity 100%)">undef</a> <a id='8083' tid='8084', class="move" title="(similarity 100%)">XSTR</a>
}


<a id='7807' tid='7808', class="move" title="(similarity 100%)">static</a> <a id='7809' tid='7810', class="move" title="(similarity 100%)">bool</a> <a id='7811' tid='7812', class="move" title="(similarity 100%)">ICacheMatch</a>(<a id='7813' tid='7814', class="move" title="(similarity 100%)">void</a><a id='7815' tid='7816', class="move" title="(similarity 100%)">*</a> <a id='7817' tid='7818', class="move" title="(similarity 100%)">one</a>, <a id='7819' tid='7820', class="move" title="(similarity 100%)">void</a><a id='7821' tid='7822', class="move" title="(similarity 100%)">*</a> <a id='7823' tid='7824', class="move" title="(similarity 100%)">two</a>) {
  <a id='7825' tid='7826', class="move" title="(similarity 100%)">ASSERT</a>((<a id='7827' tid='7828', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='7829' tid='7830', class="move" title="(similarity 100%)">intptr_t</a>&gt;(<a id='7831' tid='7832', class="move" title="(similarity 100%)">one</a>) <a id='7833' tid='7834', class="move" title="(similarity 100%)">&</a> <a id='7835' tid='7836', class="move" title="(similarity 100%)">CachePage</a><a id='7837' tid='7838', class="move" title="(similarity 100%)">::</a><a id='7839' tid='7840', class="move" title="(similarity 100%)">kPageMask</a>) <a id='7841' tid='7842', class="move" title="(similarity 100%)">==</a> <a id='7843' tid='7844', class="move" title="(similarity 100%)">0</a>);
  <a id='7845' tid='7846', class="move" title="(similarity 100%)">ASSERT</a>((<a id='7847' tid='7848', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='7849' tid='7850', class="move" title="(similarity 100%)">intptr_t</a>&gt;(<a id='7851' tid='7852', class="move" title="(similarity 100%)">two</a>) <a id='7853' tid='7854', class="move" title="(similarity 100%)">&</a> <a id='7855' tid='7856', class="move" title="(similarity 100%)">CachePage</a><a id='7857' tid='7858', class="move" title="(similarity 100%)">::</a><a id='7859' tid='7860', class="move" title="(similarity 100%)">kPageMask</a>) <a id='7861' tid='7862', class="move" title="(similarity 100%)">==</a> <a id='7863' tid='7864', class="move" title="(similarity 100%)">0</a>);
  <a id='7865' tid='7866', class="move" title="(similarity 100%)">return</a> <a id='7867' tid='7868', class="move" title="(similarity 100%)">one</a> <a id='7869' tid='7870', class="move" title="(similarity 100%)">==</a> <a id='7871' tid='7872', class="move" title="(similarity 100%)">two</a>;
}


<a id='7607' tid='7608', class="move" title="(similarity 100%)">static</a> <a id='7609' tid='7610', class="move" title="(similarity 100%)">uint32_t</a> <a id='7611' tid='7612', class="move" title="(similarity 100%)">ICacheHash</a>(<a id='7613' tid='7614', class="move" title="(similarity 100%)">void</a><a id='7615' tid='7616', class="move" title="(similarity 100%)">*</a> <a id='7617' tid='7618', class="move" title="(similarity 100%)">key</a>) {
  <a id='7619' tid='7620', class="move" title="(similarity 100%)">return</a> <a id='7621' tid='7622', class="move" title="(similarity 100%)">static_cast</a>&lt;<a id='7623' tid='7624', class="move" title="(similarity 100%)">uint32_t</a>&gt;(<a id='7625' tid='7626', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='7627' tid='7628', class="move" title="(similarity 100%)">uintptr_t</a>&gt;(<a id='7629' tid='7630', class="move" title="(similarity 100%)">key</a>)) <a id='7631' tid='7632', class="move" title="(similarity 100%)">&gt;&gt;</a> <a id='7633' tid='7634', class="move" title="(similarity 100%)">2</a>;
}


<a id='7109' tid='7110', class="move" title="(similarity 100%)">static</a> <a id='7111' tid='7112', class="move" title="(similarity 100%)">bool</a> <a id='7113' tid='7114', class="move" title="(similarity 100%)">AllOnOnePage</a>(<a id='7115' tid='7116', class="move" title="(similarity 100%)">uintptr_t</a> <a id='7117' tid='7118', class="move" title="(similarity 100%)">start</a>, <a id='7119' tid='7120', class="move" title="(similarity 100%)">int</a> <a id='7121' tid='7122', class="move" title="(similarity 100%)">size</a>) {
  <a id='7123' tid='7124', class="move" title="(similarity 100%)">intptr_t</a> <a id='7125' tid='7126', class="move" title="(similarity 100%)">start_page</a> = (<a id='7127' tid='7128', class="move" title="(similarity 100%)">start</a> <a id='7129' tid='7130', class="move" title="(similarity 100%)">&</a> <a id='7131' tid='7132', class="move" title="(similarity 100%)">~</a><a id='7133' tid='7134', class="move" title="(similarity 100%)">CachePage</a><a id='7135' tid='7136', class="move" title="(similarity 100%)">::</a><a id='7137' tid='7138', class="move" title="(similarity 100%)">kPageMask</a>);
  <a id='7139' tid='7140', class="move" title="(similarity 100%)">intptr_t</a> <a id='7141' tid='7142', class="move" title="(similarity 100%)">end_page</a> = ((<a id='7143' tid='7144', class="move" title="(similarity 100%)">start</a> <a id='7145' tid='7146', class="move" title="(similarity 100%)">+</a> <a id='7147' tid='7148', class="move" title="(similarity 100%)">size</a>) <a id='7149' tid='7150', class="move" title="(similarity 100%)">&</a> <a id='7151' tid='7152', class="move" title="(similarity 100%)">~</a><a id='7153' tid='7154', class="move" title="(similarity 100%)">CachePage</a><a id='7155' tid='7156', class="move" title="(similarity 100%)">::</a><a id='7157' tid='7158', class="move" title="(similarity 100%)">kPageMask</a>);
  <a id='7159' tid='7160', class="move" title="(similarity 100%)">return</a> <a id='7161' tid='7162', class="move" title="(similarity 100%)">start_page</a> <a id='7163' tid='7164', class="move" title="(similarity 100%)">==</a> <a id='7165' tid='7166', class="move" title="(similarity 100%)">end_page</a>;
}


<a id='6899' tid='6900', class="move" title="(similarity 100%)">void</a> <a id='6901' tid='6902', class="move" title="(similarity 100%)">Simulator</a><a id='6903' tid='6904', class="move" title="(similarity 100%)">::</a><a id='6905' tid='6906', class="move" title="(similarity 100%)">FlushICache</a>(<a id='6907' tid='6908', class="move" title="(similarity 100%)">v8</a><a id='6909' tid='6910', class="move" title="(similarity 100%)">::</a><a id='6911' tid='6912', class="move" title="(similarity 100%)">internal</a><a id='6913' tid='6914', class="move" title="(similarity 100%)">::</a><a id='6915' tid='6916', class="move" title="(similarity 100%)">HashMap</a><a id='6917' tid='6918', class="move" title="(similarity 100%)">*</a> <a id='6919' tid='6920', class="move" title="(similarity 100%)">i_cache</a>,
                            <a id='6921' tid='6922', class="move" title="(similarity 100%)">void</a><a id='6923' tid='6924', class="move" title="(similarity 100%)">*</a> <a id='6925' tid='6926', class="move" title="(similarity 100%)">start_addr</a>,
                            <a id='6927' tid='6928', class="move" title="(similarity 100%)">size_t</a> <a id='6929' tid='6930', class="move" title="(similarity 100%)">size</a>) {
  <a id='6931' tid='6932', class="move" title="(similarity 100%)">intptr_t</a> <a id='6933' tid='6934', class="move" title="(similarity 100%)">start</a> = <a id='6935' tid='6936', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='6937' tid='6938', class="move" title="(similarity 100%)">intptr_t</a>&gt;(<a id='6939' tid='6940', class="move" title="(similarity 100%)">start_addr</a>);
  <a id='6941' tid='6942', class="move" title="(similarity 100%)">int</a> <a id='6943' tid='6944', class="move" title="(similarity 100%)">intra_line</a> = (<a id='6945' tid='6946', class="move" title="(similarity 100%)">start</a> <a id='6947' tid='6948', class="move" title="(similarity 100%)">&</a> <a id='6949' tid='6950', class="move" title="(similarity 100%)">CachePage</a><a id='6951' tid='6952', class="move" title="(similarity 100%)">::</a><a id='6953' tid='6954', class="move" title="(similarity 100%)">kLineMask</a>);
  <a id='6955' tid='6956', class="move" title="(similarity 100%)">start</a> <a id='6957' tid='6958', class="move" title="(similarity 100%)">-=</a> <a id='6959' tid='6960', class="move" title="(similarity 100%)">intra_line</a>;
  <a id='6961' tid='6962', class="move" title="(similarity 100%)">size</a> <a id='6963' tid='6964', class="move" title="(similarity 100%)">+=</a> <a id='6965' tid='6966', class="move" title="(similarity 100%)">intra_line</a>;
  <a id='6967' tid='6968', class="move" title="(similarity 100%)">size</a> <a id='6969' tid='6970', class="move" title="(similarity 100%)">=</a> ((<a id='6971' tid='6972', class="move" title="(similarity 100%)">size</a> <a id='6973' tid='6974', class="move" title="(similarity 100%)">-</a> <a id='6975' tid='6976', class="move" title="(similarity 100%)">1</a>) <a id='6977' tid='6978', class="move" title="(similarity 100%)">|</a> <a id='6979' tid='6980', class="move" title="(similarity 100%)">CachePage</a><a id='6981' tid='6982', class="move" title="(similarity 100%)">::</a><a id='6983' tid='6984', class="move" title="(similarity 100%)">kLineMask</a>) <a id='6985' tid='6986', class="move" title="(similarity 100%)">+</a> <a id='6987' tid='6988', class="move" title="(similarity 100%)">1</a>;
  <a id='6989' tid='6990', class="move" title="(similarity 100%)">int</a> <a id='6991' tid='6992', class="move" title="(similarity 100%)">offset</a> = (<a id='6993' tid='6994', class="move" title="(similarity 100%)">start</a> <a id='6995' tid='6996', class="move" title="(similarity 100%)">&</a> <a id='6997' tid='6998', class="move" title="(similarity 100%)">CachePage</a><a id='6999' tid='7000', class="move" title="(similarity 100%)">::</a><a id='7001' tid='7002', class="move" title="(similarity 100%)">kPageMask</a>);
  <a id='7003' tid='7004', class="move" title="(similarity 100%)">while</a> (<a id='7005' tid='7006', class="move" title="(similarity 100%)">!</a><a id='7007' tid='7008', class="move" title="(similarity 100%)">AllOnOnePage</a>(<a id='7009' tid='7010', class="move" title="(similarity 100%)">start</a>, <a id='7011' tid='7012', class="move" title="(similarity 100%)">size</a> <a id='7013' tid='7014', class="move" title="(similarity 100%)">-</a> <a id='7015' tid='7016', class="move" title="(similarity 100%)">1</a>)) {
    <a id='7017' tid='7018', class="move" title="(similarity 100%)">int</a> <a id='7019' tid='7020', class="move" title="(similarity 100%)">bytes_to_flush</a> = <a id='7021' tid='7022', class="move" title="(similarity 100%)">CachePage</a><a id='7023' tid='7024', class="move" title="(similarity 100%)">::</a><a id='7025' tid='7026', class="move" title="(similarity 100%)">kPageSize</a> <a id='7027' tid='7028', class="move" title="(similarity 100%)">-</a> <a id='7029' tid='7030', class="move" title="(similarity 100%)">offset</a>;
    <a id='7031' tid='7032', class="move" title="(similarity 100%)">FlushOnePage</a>(<a id='7033' tid='7034', class="move" title="(similarity 100%)">i_cache</a>, <a id='7035' tid='7036', class="move" title="(similarity 100%)">start</a>, <a id='7037' tid='7038', class="move" title="(similarity 100%)">bytes_to_flush</a>);
    <a id='7039' tid='7040', class="move" title="(similarity 100%)">start</a> <a id='7041' tid='7042', class="move" title="(similarity 100%)">+=</a> <a id='7043' tid='7044', class="move" title="(similarity 100%)">bytes_to_flush</a>;
    <a id='7045' tid='7046', class="move" title="(similarity 100%)">size</a> <a id='7047' tid='7048', class="move" title="(similarity 100%)">-=</a> <a id='7049' tid='7050', class="move" title="(similarity 100%)">bytes_to_flush</a>;
    <a id='7051' tid='7052', class="move" title="(similarity 100%)">ASSERT_EQ</a>(<a id='7053' tid='7054', class="move" title="(similarity 100%)">0</a>, <a id='7055' tid='7056', class="move" title="(similarity 100%)">start</a> <a id='7057' tid='7058', class="move" title="(similarity 100%)">&</a> <a id='7059' tid='7060', class="move" title="(similarity 100%)">CachePage</a><a id='7061' tid='7062', class="move" title="(similarity 100%)">::</a><a id='7063' tid='7064', class="move" title="(similarity 100%)">kPageMask</a>);
    <a id='7065' tid='7066', class="move" title="(similarity 100%)">offset</a> <a id='7067' tid='7068', class="move" title="(similarity 100%)">=</a> <a id='7069' tid='7070', class="move" title="(similarity 100%)">0</a>;
  }
  <a id='7071' tid='7072', class="move" title="(similarity 100%)">if</a> (<a id='7073' tid='7074', class="move" title="(similarity 100%)">size</a> <a id='7075' tid='7076', class="move" title="(similarity 100%)">!=</a> <a id='7077' tid='7078', class="move" title="(similarity 100%)">0</a>) {
    <a id='7079' tid='7080', class="move" title="(similarity 100%)">FlushOnePage</a>(<a id='7081' tid='7082', class="move" title="(similarity 100%)">i_cache</a>, <a id='7083' tid='7084', class="move" title="(similarity 100%)">start</a>, <a id='7085' tid='7086', class="move" title="(similarity 100%)">size</a>);
  }
}


<a id='6613' tid='6614', class="move" title="(similarity 100%)">CachePage</a><a id='6615' tid='6616', class="move" title="(similarity 100%)">*</a> <a id='6617' tid='6618', class="move" title="(similarity 100%)">Simulator</a><a id='6619' tid='6620', class="move" title="(similarity 100%)">::</a><a id='6621' tid='6622', class="move" title="(similarity 100%)">GetCachePage</a>(<a id='6623' tid='6624', class="move" title="(similarity 100%)">v8</a><a id='6625' tid='6626', class="move" title="(similarity 100%)">::</a><a id='6627' tid='6628', class="move" title="(similarity 100%)">internal</a><a id='6629' tid='6630', class="move" title="(similarity 100%)">::</a><a id='6631' tid='6632', class="move" title="(similarity 100%)">HashMap</a><a id='6633' tid='6634', class="move" title="(similarity 100%)">*</a> <a id='6635' tid='6636', class="move" title="(similarity 100%)">i_cache</a>, <a id='6637' tid='6638', class="move" title="(similarity 100%)">void</a><a id='6639' tid='6640', class="move" title="(similarity 100%)">*</a> <a id='6641' tid='6642', class="move" title="(similarity 100%)">page</a>) {
  <a id='6643' tid='6644', class="move" title="(similarity 100%)">v8</a><a id='6645' tid='6646', class="move" title="(similarity 100%)">::</a><a id='6647' tid='6648', class="move" title="(similarity 100%)">internal</a><a id='6649' tid='6650', class="move" title="(similarity 100%)">::</a><a id='6651' tid='6652', class="move" title="(similarity 100%)">HashMap</a><a id='6653' tid='6654', class="move" title="(similarity 100%)">::</a><a id='6655' tid='6656', class="move" title="(similarity 100%)">Entry</a><a id='6657' tid='6658', class="move" title="(similarity 100%)">*</a> <a id='6659' tid='6660', class="move" title="(similarity 100%)">entry</a> = <a id='6661' tid='6662', class="move" title="(similarity 100%)">i_cache</a>-&gt;<a id='6663' tid='6664', class="move" title="(similarity 100%)">Lookup</a>(<a id='6665' tid='6666', class="move" title="(similarity 100%)">page</a>,
                                                        <a id='6667' tid='6668', class="move" title="(similarity 100%)">ICacheHash</a>(<a id='6669' tid='6670', class="move" title="(similarity 100%)">page</a>),
                                                        <a id='6671' tid='6672', class="move" title="(similarity 100%)">true</a>);
  <a id='6673' tid='6674', class="move" title="(similarity 100%)">if</a> (<a id='6675' tid='6676', class="move" title="(similarity 100%)">entry</a>-&gt;<a id='6677' tid='6678', class="move" title="(similarity 100%)">value</a> <a id='6679' tid='6680', class="move" title="(similarity 100%)">==</a> <a id='6681' tid='6682', class="move" title="(similarity 100%)">NULL</a>) {
    <a id='6683' tid='6684', class="move" title="(similarity 100%)">CachePage</a><a id='6685' tid='6686', class="move" title="(similarity 100%)">*</a> <a id='6687' tid='6688', class="move" title="(similarity 100%)">new_page</a> = <a id='6689' tid='6690', class="move" title="(similarity 100%)">new</a> <a id='6691' tid='6692', class="move" title="(similarity 100%)">CachePage</a>();
    <a id='6693' tid='6694', class="move" title="(similarity 100%)">entry</a>-&gt;<a id='6695' tid='6696', class="move" title="(similarity 100%)">value</a> <a id='6697' tid='6698', class="move" title="(similarity 100%)">=</a> <a id='6699' tid='6700', class="move" title="(similarity 100%)">new_page</a>;
  }
  <a id='6701' tid='6702', class="move" title="(similarity 100%)">return</a> <a id='6703' tid='6704', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='6705' tid='6706', class="move" title="(similarity 100%)">CachePage</a><a id='6707' tid='6708', class="move" title="(similarity 100%)">*</a>&gt;(<a id='6709' tid='6710', class="move" title="(similarity 100%)">entry</a>-&gt;<a id='6711' tid='6712', class="move" title="(similarity 100%)">value</a>);
}


// Flush from start up to and not including start + size.
<a id='6279' tid='6280', class="move" title="(similarity 100%)">void</a> <a id='6281' tid='6282', class="move" title="(similarity 100%)">Simulator</a><a id='6283' tid='6284', class="move" title="(similarity 100%)">::</a><a id='6285' tid='6286', class="move" title="(similarity 100%)">FlushOnePage</a>(<a id='6287' tid='6288', class="move" title="(similarity 100%)">v8</a><a id='6289' tid='6290', class="move" title="(similarity 100%)">::</a><a id='6291' tid='6292', class="move" title="(similarity 100%)">internal</a><a id='6293' tid='6294', class="move" title="(similarity 100%)">::</a><a id='6295' tid='6296', class="move" title="(similarity 100%)">HashMap</a><a id='6297' tid='6298', class="move" title="(similarity 100%)">*</a> <a id='6299' tid='6300', class="move" title="(similarity 100%)">i_cache</a>,
                             <a id='6301' tid='6302', class="move" title="(similarity 100%)">intptr_t</a> <a id='6303' tid='6304', class="move" title="(similarity 100%)">start</a>,
                             <a id='6305' tid='6306', class="move" title="(similarity 100%)">int</a> <a id='6307' tid='6308', class="move" title="(similarity 100%)">size</a>) {
  <a id='6309' tid='6310', class="move" title="(similarity 100%)">ASSERT</a>(<a id='6311' tid='6312', class="move" title="(similarity 100%)">size</a> <a id='6313' tid='6314', class="move" title="(similarity 100%)">&lt;=</a> <a id='6315' tid='6316', class="move" title="(similarity 100%)">CachePage</a><a id='6317' tid='6318', class="move" title="(similarity 100%)">::</a><a id='6319' tid='6320', class="move" title="(similarity 100%)">kPageSize</a>);
  <a id='6321' tid='6322', class="move" title="(similarity 100%)">ASSERT</a>(<a id='6323' tid='6324', class="move" title="(similarity 100%)">AllOnOnePage</a>(<a id='6325' tid='6326', class="move" title="(similarity 100%)">start</a>, <a id='6327' tid='6328', class="move" title="(similarity 100%)">size</a> <a id='6329' tid='6330', class="move" title="(similarity 100%)">-</a> <a id='6331' tid='6332', class="move" title="(similarity 100%)">1</a>));
  <a id='6333' tid='6334', class="move" title="(similarity 100%)">ASSERT</a>((<a id='6335' tid='6336', class="move" title="(similarity 100%)">start</a> <a id='6337' tid='6338', class="move" title="(similarity 100%)">&</a> <a id='6339' tid='6340', class="move" title="(similarity 100%)">CachePage</a><a id='6341' tid='6342', class="move" title="(similarity 100%)">::</a><a id='6343' tid='6344', class="move" title="(similarity 100%)">kLineMask</a>) <a id='6345' tid='6346', class="move" title="(similarity 100%)">==</a> <a id='6347' tid='6348', class="move" title="(similarity 100%)">0</a>);
  <a id='6349' tid='6350', class="move" title="(similarity 100%)">ASSERT</a>((<a id='6351' tid='6352', class="move" title="(similarity 100%)">size</a> <a id='6353' tid='6354', class="move" title="(similarity 100%)">&</a> <a id='6355' tid='6356', class="move" title="(similarity 100%)">CachePage</a><a id='6357' tid='6358', class="move" title="(similarity 100%)">::</a><a id='6359' tid='6360', class="move" title="(similarity 100%)">kLineMask</a>) <a id='6361' tid='6362', class="move" title="(similarity 100%)">==</a> <a id='6363' tid='6364', class="move" title="(similarity 100%)">0</a>);
  <a id='6365' tid='6366', class="move" title="(similarity 100%)">void</a><a id='6367' tid='6368', class="move" title="(similarity 100%)">*</a> <a id='6369' tid='6370', class="move" title="(similarity 100%)">page</a> = <a id='6371' tid='6372', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='6373' tid='6374', class="move" title="(similarity 100%)">void</a><a id='6375' tid='6376', class="move" title="(similarity 100%)">*</a>&gt;(<a id='6377' tid='6378', class="move" title="(similarity 100%)">start</a> <a id='6379' tid='6380', class="move" title="(similarity 100%)">&</a> (<a id='6381' tid='6382', class="move" title="(similarity 100%)">~</a><a id='6383' tid='6384', class="move" title="(similarity 100%)">CachePage</a><a id='6385' tid='6386', class="move" title="(similarity 100%)">::</a><a id='6387' tid='6388', class="move" title="(similarity 100%)">kPageMask</a>));
  <a id='6389' tid='6390', class="move" title="(similarity 100%)">int</a> <a id='6391' tid='6392', class="move" title="(similarity 100%)">offset</a> = (<a id='6393' tid='6394', class="move" title="(similarity 100%)">start</a> <a id='6395' tid='6396', class="move" title="(similarity 100%)">&</a> <a id='6397' tid='6398', class="move" title="(similarity 100%)">CachePage</a><a id='6399' tid='6400', class="move" title="(similarity 100%)">::</a><a id='6401' tid='6402', class="move" title="(similarity 100%)">kPageMask</a>);
  <a id='6403' tid='6404', class="move" title="(similarity 100%)">CachePage</a><a id='6405' tid='6406', class="move" title="(similarity 100%)">*</a> <a id='6407' tid='6408', class="move" title="(similarity 100%)">cache_page</a> = <a id='6409' tid='6410', class="move" title="(similarity 100%)">GetCachePage</a>(<a id='6411' tid='6412', class="move" title="(similarity 100%)">i_cache</a>, <a id='6413' tid='6414', class="move" title="(similarity 100%)">page</a>);
  <a id='6415' tid='6416', class="move" title="(similarity 100%)">char</a><a id='6417' tid='6418', class="move" title="(similarity 100%)">*</a> <a id='6419' tid='6420', class="move" title="(similarity 100%)">valid_bytemap</a> = <a id='6421' tid='6422', class="move" title="(similarity 100%)">cache_page</a>-&gt;<a id='6423' tid='6424', class="move" title="(similarity 100%)">ValidityByte</a>(<a id='6425' tid='6426', class="move" title="(similarity 100%)">offset</a>);
  <a id='6427' tid='6428', class="move" title="(similarity 100%)">memset</a>(<a id='6429' tid='6430', class="move" title="(similarity 100%)">valid_bytemap</a>, <a id='6431' tid='6432', class="move" title="(similarity 100%)">CachePage</a><a id='6433' tid='6434', class="move" title="(similarity 100%)">::</a><a id='6435' tid='6436', class="move" title="(similarity 100%)">LINE_INVALID</a>, <a id='6437' tid='6438', class="move" title="(similarity 100%)">size</a> <a id='6439' tid='6440', class="move" title="(similarity 100%)">&gt;&gt;</a> <a id='6441' tid='6442', class="move" title="(similarity 100%)">CachePage</a><a id='6443' tid='6444', class="move" title="(similarity 100%)">::</a><a id='6445' tid='6446', class="move" title="(similarity 100%)">kLineShift</a>);
}


<a id='5905' tid='5906', class="move" title="(similarity 100%)">void</a> <a id='5907' tid='5908', class="move" title="(similarity 100%)">Simulator</a><a id='5909' tid='5910', class="move" title="(similarity 100%)">::</a><a id='5911' tid='5912', class="move" title="(similarity 100%)">CheckICache</a>(<a id='5913' tid='5914', class="move" title="(similarity 100%)">v8</a><a id='5915' tid='5916', class="move" title="(similarity 100%)">::</a><a id='5917' tid='5918', class="move" title="(similarity 100%)">internal</a><a id='5919' tid='5920', class="move" title="(similarity 100%)">::</a><a id='5921' tid='5922', class="move" title="(similarity 100%)">HashMap</a><a id='5923' tid='5924', class="move" title="(similarity 100%)">*</a> <a id='5925' tid='5926', class="move" title="(similarity 100%)">i_cache</a>,
                            <a id='5927' tid='5928', class="move" title="(similarity 100%)">Instruction</a><a id='5929' tid='5930', class="move" title="(similarity 100%)">*</a> <a id='5931' tid='5932', class="move" title="(similarity 100%)">instr</a>) {
  <a id='5933' tid='5934', class="move" title="(similarity 100%)">intptr_t</a> <a id='5935' tid='5936', class="move" title="(similarity 100%)">address</a> = <a id='5937' tid='5938', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='5939' tid='5940', class="move" title="(similarity 100%)">intptr_t</a>&gt;(<a id='5941' tid='5942', class="move" title="(similarity 100%)">instr</a>);
  <a id='5943' tid='5944', class="move" title="(similarity 100%)">void</a><a id='5945' tid='5946', class="move" title="(similarity 100%)">*</a> <a id='5947' tid='5948', class="move" title="(similarity 100%)">page</a> = <a id='5949' tid='5950', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='5951' tid='5952', class="move" title="(similarity 100%)">void</a><a id='5953' tid='5954', class="move" title="(similarity 100%)">*</a>&gt;(<a id='5955' tid='5956', class="move" title="(similarity 100%)">address</a> <a id='5957' tid='5958', class="move" title="(similarity 100%)">&</a> (<a id='5959' tid='5960', class="move" title="(similarity 100%)">~</a><a id='5961' tid='5962', class="move" title="(similarity 100%)">CachePage</a><a id='5963' tid='5964', class="move" title="(similarity 100%)">::</a><a id='5965' tid='5966', class="move" title="(similarity 100%)">kPageMask</a>));
  <a id='5967' tid='5968', class="move" title="(similarity 100%)">void</a><a id='5969' tid='5970', class="move" title="(similarity 100%)">*</a> <a id='5971' tid='5972', class="move" title="(similarity 100%)">line</a> = <a id='5973' tid='5974', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='5975' tid='5976', class="move" title="(similarity 100%)">void</a><a id='5977' tid='5978', class="move" title="(similarity 100%)">*</a>&gt;(<a id='5979' tid='5980', class="move" title="(similarity 100%)">address</a> <a id='5981' tid='5982', class="move" title="(similarity 100%)">&</a> (<a id='5983' tid='5984', class="move" title="(similarity 100%)">~</a><a id='5985' tid='5986', class="move" title="(similarity 100%)">CachePage</a><a id='5987' tid='5988', class="move" title="(similarity 100%)">::</a><a id='5989' tid='5990', class="move" title="(similarity 100%)">kLineMask</a>));
  <a id='5991' tid='5992', class="move" title="(similarity 100%)">int</a> <a id='5993' tid='5994', class="move" title="(similarity 100%)">offset</a> = (<a id='5995' tid='5996', class="move" title="(similarity 100%)">address</a> <a id='5997' tid='5998', class="move" title="(similarity 100%)">&</a> <a id='5999' tid='6000', class="move" title="(similarity 100%)">CachePage</a><a id='6001' tid='6002', class="move" title="(similarity 100%)">::</a><a id='6003' tid='6004', class="move" title="(similarity 100%)">kPageMask</a>);
  <a id='6005' tid='6006', class="move" title="(similarity 100%)">CachePage</a><a id='6007' tid='6008', class="move" title="(similarity 100%)">*</a> <a id='6009' tid='6010', class="move" title="(similarity 100%)">cache_page</a> = <a id='6011' tid='6012', class="move" title="(similarity 100%)">GetCachePage</a>(<a id='6013' tid='6014', class="move" title="(similarity 100%)">i_cache</a>, <a id='6015' tid='6016', class="move" title="(similarity 100%)">page</a>);
  <a id='6017' tid='6018', class="move" title="(similarity 100%)">char</a><a id='6019' tid='6020', class="move" title="(similarity 100%)">*</a> <a id='6021' tid='6022', class="move" title="(similarity 100%)">cache_valid_byte</a> = <a id='6023' tid='6024', class="move" title="(similarity 100%)">cache_page</a>-&gt;<a id='6025' tid='6026', class="move" title="(similarity 100%)">ValidityByte</a>(<a id='6027' tid='6028', class="move" title="(similarity 100%)">offset</a>);
  <a id='6029' tid='6030', class="move" title="(similarity 100%)">bool</a> <a id='6031' tid='6032', class="move" title="(similarity 100%)">cache_hit</a> = (<a id='6033' tid='6034', class="move" title="(similarity 100%)">*</a><a id='6035' tid='6036', class="move" title="(similarity 100%)">cache_valid_byte</a> <a id='6037' tid='6038', class="move" title="(similarity 100%)">==</a> <a id='6039' tid='6040', class="move" title="(similarity 100%)">CachePage</a><a id='6041' tid='6042', class="move" title="(similarity 100%)">::</a><a id='6043' tid='6044', class="move" title="(similarity 100%)">LINE_VALID</a>);
  <a id='6045' tid='6046', class="move" title="(similarity 100%)">char</a><a id='6047' tid='6048', class="move" title="(similarity 100%)">*</a> <a id='6049' tid='6050', class="move" title="(similarity 100%)">cached_line</a> = <a id='6051' tid='6052', class="move" title="(similarity 100%)">cache_page</a>-&gt;<a id='6053' tid='6054', class="move" title="(similarity 100%)">CachedData</a>(<a id='6055' tid='6056', class="move" title="(similarity 100%)">offset</a> <a id='6057' tid='6058', class="move" title="(similarity 100%)">&</a> <a id='6059' tid='6060', class="move" title="(similarity 100%)">~</a><a id='6061' tid='6062', class="move" title="(similarity 100%)">CachePage</a><a id='6063' tid='6064', class="move" title="(similarity 100%)">::</a><a id='6065' tid='6066', class="move" title="(similarity 100%)">kLineMask</a>);
  <a id='6067' tid='6068', class="move" title="(similarity 100%)">if</a> (<a id='6069' tid='6070', class="move" title="(similarity 100%)">cache_hit</a>) {
    // Check that the data in memory matches the contents of the I-cache.
    <a id='6071' tid='6072', class="move" title="(similarity 100%)">CHECK</a>(<a id='6073' tid='6074', class="move" title="(similarity 100%)">memcmp</a>(<a id='6075' tid='6076', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='6077' tid='6078', class="move" title="(similarity 100%)">void</a><a id='6079' tid='6080', class="move" title="(similarity 100%)">*</a>&gt;(<a id='6081' tid='6082', class="move" title="(similarity 100%)">instr</a>),
                 <a id='6083' tid='6084', class="move" title="(similarity 100%)">cache_page</a>-&gt;<a id='6085' tid='6086', class="move" title="(similarity 100%)">CachedData</a>(<a id='6087' tid='6088', class="move" title="(similarity 100%)">offset</a>),
                 <a id='6089' tid='6090', class="move" title="(similarity 100%)">Instruction</a><a id='6091' tid='6092', class="move" title="(similarity 100%)">::</a><a id='6093' tid='6094', class="move" title="(similarity 100%)">kInstrSize</a>) <a id='6095' tid='6096', class="move" title="(similarity 100%)">==</a> <a id='6097' tid='6098', class="move" title="(similarity 100%)">0</a>);
  } <a id='6099' tid='6100', class="move" title="(similarity 100%)">else</a> {
    // Cache miss.  Load memory into the cache.
    <a id='6101' tid='6102', class="move" title="(similarity 100%)">memcpy</a>(<a id='6103' tid='6104', class="move" title="(similarity 100%)">cached_line</a>, <a id='6105' tid='6106', class="move" title="(similarity 100%)">line</a>, <a id='6107' tid='6108', class="move" title="(similarity 100%)">CachePage</a><a id='6109' tid='6110', class="move" title="(similarity 100%)">::</a><a id='6111' tid='6112', class="move" title="(similarity 100%)">kLineLength</a>);
    <a id='6113' tid='6114', class="move" title="(similarity 100%)">*</a><a id='6115' tid='6116', class="move" title="(similarity 100%)">cache_valid_byte</a> <a id='6117' tid='6118', class="move" title="(similarity 100%)">=</a> <a id='6119' tid='6120', class="move" title="(similarity 100%)">CachePage</a><a id='6121' tid='6122', class="move" title="(similarity 100%)">::</a><a id='6123' tid='6124', class="move" title="(similarity 100%)">LINE_VALID</a>;
  }
}


<a id='5807' tid='5808', class="move" title="(similarity 100%)">void</a> <a id='5809' tid='5810', class="move" title="(similarity 100%)">Simulator</a><a id='5811' tid='5812', class="move" title="(similarity 100%)">::</a><a id='5813' tid='5814', class="move" title="(similarity 100%)">Initialize</a>(<a id='5815' tid='5816', class="move" title="(similarity 100%)">Isolate</a><a id='5817' tid='5818', class="move" title="(similarity 100%)">*</a> <a id='5819' tid='5820', class="move" title="(similarity 100%)">isolate</a>) {
  <a id='5821' tid='5822', class="move" title="(similarity 100%)">if</a> (<a id='5823' tid='5824', class="move" title="(similarity 100%)">isolate</a>-&gt;<a id='5825' tid='5826', class="move" title="(similarity 100%)">simulator_initialized</a>()) <a id='5827' tid='5828', class="move" title="(similarity 100%)">return</a>;
  <a id='5829' tid='5830', class="move" title="(similarity 100%)">isolate</a>-&gt;<a id='5831' tid='5832', class="move" title="(similarity 100%)">set_simulator_initialized</a>(<a id='5833' tid='5834', class="move" title="(similarity 100%)">true</a>);
  <a id='5835' tid='5836', class="move" title="(similarity 100%)">::</a><a id='5837' tid='5838', class="move" title="(similarity 100%)">v8</a><a id='5839' tid='5840', class="move" title="(similarity 100%)">::</a><a id='5841' tid='5842', class="move" title="(similarity 100%)">internal</a><a id='5843' tid='5844', class="move" title="(similarity 100%)">::</a><a id='5845' tid='5846', class="move" title="(similarity 100%)">ExternalReference</a><a id='5847' tid='5848', class="move" title="(similarity 100%)">::</a><a id='5849' tid='5850', class="move" title="(similarity 100%)">set_redirector</a>(<a id='5851' tid='5852', class="move" title="(similarity 100%)">isolate</a>,
                                                    <a id='5853' tid='5854', class="move" title="(similarity 100%)">&</a><a id='5855' tid='5856', class="move" title="(similarity 100%)">RedirectExternalReference</a>);
}


<a id='5757' tid='5758', class="move" title="(similarity 100%)">Simulator</a><a id='5759' tid='5760', class="move" title="(similarity 100%)">::</a><a id='5761' tid='5762', class="move" title="(similarity 100%)">Simulator</a>(<a id='5763' tid='5764', class="move" title="(similarity 100%)">Isolate</a><a id='5765' tid='5766', class="move" title="(similarity 100%)">*</a> <a id='5767' tid='5768', class="move" title="(similarity 100%)">isolate</a>) : <a id='5769' tid='5770', class="move" title="(similarity 100%)">isolate_</a>(<a id='5771' tid='5772', class="move" title="(similarity 100%)">isolate</a>) {
  <span class="deletion" title="deleted">i_cache_ = isolate_-&gt;simulator_i_cache();</span>
  <a id='5773' tid='5774', class="move" title="(similarity 100%)">if</a> (<a id='5775' tid='5776', class="move" title="(similarity 100%)">i_cache_</a> <a id='5777' tid='5778', class="move" title="(similarity 100%)">==</a> <a id='5779' tid='5780', class="move" title="(similarity 100%)">NULL</a>) {
    <a id='5781' tid='5782', class="move" title="(similarity 100%)">i_cache_</a> <a id='5783' tid='5784', class="move" title="(similarity 100%)">=</a> <a id='5785' tid='5786', class="move" title="(similarity 100%)">new</a> <a id='5787' tid='5788', class="move" title="(similarity 100%)">v8</a><a id='5789' tid='5790', class="move" title="(similarity 100%)">::</a><a id='5791' tid='5792', class="move" title="(similarity 100%)">internal</a><a id='5793' tid='5794', class="move" title="(similarity 100%)">::</a><a id='5795' tid='5796', class="move" title="(similarity 100%)">HashMap</a>(<a id='5797' tid='5798', class="move" title="(similarity 100%)">&</a><a id='5799' tid='5800', class="move" title="(similarity 100%)">ICacheMatch</a>);
    <a id='5801' tid='5802', class="move" title="(similarity 100%)">isolate_</a>-&gt;<a id='5803' tid='5804', class="move" title="(similarity 100%)">set_simulator_i_cache</a>(<a id='5805' tid='5806', class="move" title="(similarity 100%)">i_cache_</a>);
  }
  <span class="deletion" title="deleted">Initialize(isolate);</span>
  // Setup simulator support first. Some of this information is needed to
  // setup the architecture state.
  <span class="deletion" title="deleted">stack_ = reinterpret_cast&lt;char*&gt;(malloc(stack_size_));</span>
  <span class="deletion" title="deleted">pc_modified_ = false;</span>
  <span class="deletion" title="deleted">icount_ = 0;</span>
  <span class="deletion" title="deleted">break_count_ = 0;</span>
  <span class="deletion" title="deleted">break_pc_ = NULL;</span>
  <span class="deletion" title="deleted">break_instr_ = 0;</span>

  // Setup architecture state.
  // All registers are initialized to zero to start with.
  <span class="deletion" title="deleted">for (int i = 0; i &lt; kNumSimuRegisters; i++) {
    registers_[i] = 0;
  }</span>
  <span class="deletion" title="deleted">for (int i = 0; i &lt; kNumFPURegisters; i++) {
    FPUregisters_[i] = 0;
  }</span>
  <span class="deletion" title="deleted">FCSR_ = 0;</span>

  // The sp is initialized to point to the bottom (high address) of the
  // allocated stack area. To be safe in potential stack underflows we leave
  // some buffer below.
  <span class="deletion" title="deleted">registers_[sp] = reinterpret_cast&lt;int32_t&gt;(stack_) + stack_size_ - 64;</span>
  // The ra and pc are initialized to a known bad value that will cause an
  // access violation if the simulator ever tries to execute it.
  <span class="deletion" title="deleted">registers_[pc] = bad_ra;</span>
  <span class="deletion" title="deleted">registers_[ra] = bad_ra;</span>
  <span class="deletion" title="deleted">InitializeCoverage();</span>
  <span class="deletion" title="deleted">for (int i = 0; i &lt; kNumExceptions; i++) {
    exceptions[i] = 0;
  }</span>
}


// When the generated code calls an external reference we need to catch that in
// the simulator.  The external reference will be a function compiled for the
// host architecture.  We need to call that function instead of trying to
// execute it with the simulator.  We do that by redirecting the external
// reference to a swi (software-interrupt) instruction that is handled by
// the simulator.  We write the original destination of the jump just at a known
// offset from the swi instruction so the simulator knows what to call.
<a id='5531' tid='5532', class="move" title="(similarity 100%)">class</a> <a id='5533' tid='5534', class="move" title="(similarity 100%)">Redirection</a> {
 <a id='5535' tid='5536', class="move" title="(similarity 100%)">public</a>:
  <a id='5537' tid='5538', class="move" title="(similarity 100%)">Redirection</a>(<a id='5539' tid='5540', class="move" title="(similarity 100%)">void</a><a id='5541' tid='5542', class="move" title="(similarity 100%)">*</a> <a id='5543' tid='5544', class="move" title="(similarity 100%)">external_function</a>, <a id='5545' tid='5546', class="move" title="(similarity 100%)">ExternalReference</a><a id='5547' tid='5548', class="move" title="(similarity 100%)">::</a><a id='5549' tid='5550', class="move" title="(similarity 100%)">Type</a> <a id='5551' tid='5552', class="move" title="(similarity 100%)">type</a>)
      : <span class="deletion" title="deleted">external_function_(external_function),
        swi_instruction_(rtCallRedirInstr),
        type_(type),
        next_(NULL)</span> {
    <a id='5475' tid='5476', class="move" title="(similarity 100%)">Isolate</a><a id='5477' tid='5478', class="move" title="(similarity 100%)">*</a> <a id='5479' tid='5480', class="move" title="(similarity 100%)">isolate</a> = <a id='5481' tid='5482', class="move" title="(similarity 100%)">Isolate</a><a id='5483' tid='5484', class="move" title="(similarity 100%)">::</a><a id='5485' tid='5486', class="move" title="(similarity 100%)">Current</a>();
    <a id='5487' tid='5488', class="move" title="(similarity 100%)">next_</a> <a id='5489' tid='5490', class="move" title="(similarity 100%)">=</a> <a id='5491' tid='5492', class="move" title="(similarity 100%)">isolate</a>-&gt;<a id='5493' tid='5494', class="move" title="(similarity 100%)">simulator_redirection</a>();
    <a id='5495' tid='5496', class="move" title="(similarity 100%)">Simulator</a><a id='5497' tid='5498', class="move" title="(similarity 100%)">::</a><a id='5499' tid='5500', class="move" title="(similarity 100%)">current</a>(<a id='5501' tid='5502', class="move" title="(similarity 100%)">isolate</a>)-&gt;
        <a id='5503' tid='5504', class="move" title="(similarity 100%)">FlushICache</a>(<a id='5505' tid='5506', class="move" title="(similarity 100%)">isolate</a>-&gt;<a id='5507' tid='5508', class="move" title="(similarity 100%)">simulator_i_cache</a>(),
                    <a id='5509' tid='5510', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='5511' tid='5512', class="move" title="(similarity 100%)">void</a><a id='5513' tid='5514', class="move" title="(similarity 100%)">*</a>&gt;(<a id='5515' tid='5516', class="move" title="(similarity 100%)">&</a><a id='5517' tid='5518', class="move" title="(similarity 100%)">swi_instruction_</a>),
                    <a id='5519' tid='5520', class="move" title="(similarity 100%)">Instruction</a><a id='5521' tid='5522', class="move" title="(similarity 100%)">::</a><a id='5523' tid='5524', class="move" title="(similarity 100%)">kInstrSize</a>);
    <a id='5525' tid='5526', class="move" title="(similarity 100%)">isolate</a>-&gt;<a id='5527' tid='5528', class="move" title="(similarity 100%)">set_simulator_redirection</a>(<a id='5529' tid='5530', class="move" title="(similarity 100%)">this</a>);
  }

  <a id='5553' tid='5554', class="move" title="(similarity 100%)">void</a><a id='5555' tid='5556', class="move" title="(similarity 100%)">*</a> <a id='5557' tid='5558', class="move" title="(similarity 100%)">address_of_swi_instruction</a>() {
    <a id='5559' tid='5560', class="move" title="(similarity 100%)">return</a> <a id='5561' tid='5562', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='5563' tid='5564', class="move" title="(similarity 100%)">void</a><a id='5565' tid='5566', class="move" title="(similarity 100%)">*</a>&gt;(<a id='5567' tid='5568', class="move" title="(similarity 100%)">&</a><a id='5569' tid='5570', class="move" title="(similarity 100%)">swi_instruction_</a>);
  }

  <a id='5571' tid='5572', class="move" title="(similarity 100%)">void</a><a id='5573' tid='5574', class="move" title="(similarity 100%)">*</a> <a id='5575' tid='5576', class="move" title="(similarity 100%)">external_function</a>() { <a id='5577' tid='5578', class="move" title="(similarity 100%)">return</a> <a id='5579' tid='5580', class="move" title="(similarity 100%)">external_function_</a>; }
  <a id='5581' tid='5582', class="move" title="(similarity 100%)">ExternalReference</a><a id='5583' tid='5584', class="move" title="(similarity 100%)">::</a><a id='5585' tid='5586', class="move" title="(similarity 100%)">Type</a> <a id='5587' tid='5588', class="move" title="(similarity 100%)">type</a>() { <a id='5589' tid='5590', class="move" title="(similarity 100%)">return</a> <a id='5591' tid='5592', class="move" title="(similarity 100%)">type_</a>; }

  <a id='5593' tid='5594', class="move" title="(similarity 100%)">static</a> <a id='5595' tid='5596', class="move" title="(similarity 100%)">Redirection</a><a id='5597' tid='5598', class="move" title="(similarity 100%)">*</a> <a id='5599' tid='5600', class="move" title="(similarity 100%)">Get</a>(<a id='5601' tid='5602', class="move" title="(similarity 100%)">void</a><a id='5603' tid='5604', class="move" title="(similarity 100%)">*</a> <a id='5605' tid='5606', class="move" title="(similarity 100%)">external_function</a>,
                          <a id='5607' tid='5608', class="move" title="(similarity 100%)">ExternalReference</a><a id='5609' tid='5610', class="move" title="(similarity 100%)">::</a><a id='5611' tid='5612', class="move" title="(similarity 100%)">Type</a> <a id='5613' tid='5614', class="move" title="(similarity 100%)">type</a>) {
    <a id='5615' tid='5616', class="move" title="(similarity 100%)">Isolate</a><a id='5617' tid='5618', class="move" title="(similarity 100%)">*</a> <a id='5619' tid='5620', class="move" title="(similarity 100%)">isolate</a> = <a id='5621' tid='5622', class="move" title="(similarity 100%)">Isolate</a><a id='5623' tid='5624', class="move" title="(similarity 100%)">::</a><a id='5625' tid='5626', class="move" title="(similarity 100%)">Current</a>();
    <a id='5627' tid='5628', class="move" title="(similarity 100%)">Redirection</a><a id='5629' tid='5630', class="move" title="(similarity 100%)">*</a> <a id='5631' tid='5632', class="move" title="(similarity 100%)">current</a> = <a id='5633' tid='5634', class="move" title="(similarity 100%)">isolate</a>-&gt;<a id='5635' tid='5636', class="move" title="(similarity 100%)">simulator_redirection</a>();
    <a id='5637' tid='5638', class="move" title="(similarity 100%)">for</a> (; <a id='5639' tid='5640', class="move" title="(similarity 100%)">current</a> <a id='5641' tid='5642', class="move" title="(similarity 100%)">!=</a> <a id='5643' tid='5644', class="move" title="(similarity 100%)">NULL</a>; <a id='5645' tid='5646', class="move" title="(similarity 100%)">current</a> <a id='5647' tid='5648', class="move" title="(similarity 100%)">=</a> <a id='5649' tid='5650', class="move" title="(similarity 100%)">current</a>-&gt;<a id='5651' tid='5652', class="move" title="(similarity 100%)">next_</a>) {
      <a id='5653' tid='5654', class="move" title="(similarity 100%)">if</a> (<a id='5655' tid='5656', class="move" title="(similarity 100%)">current</a>-&gt;<a id='5657' tid='5658', class="move" title="(similarity 100%)">external_function_</a> <a id='5659' tid='5660', class="move" title="(similarity 100%)">==</a> <a id='5661' tid='5662', class="move" title="(similarity 100%)">external_function</a>) <a id='5663' tid='5664', class="move" title="(similarity 100%)">return</a> <a id='5665' tid='5666', class="move" title="(similarity 100%)">current</a>;
    }
    <a id='5667' tid='5668', class="move" title="(similarity 100%)">return</a> <a id='5669' tid='5670', class="move" title="(similarity 100%)">new</a> <a id='5671' tid='5672', class="move" title="(similarity 100%)">Redirection</a>(<a id='5673' tid='5674', class="move" title="(similarity 100%)">external_function</a>, <a id='5675' tid='5676', class="move" title="(similarity 100%)">type</a>);
  }

  <a id='5677' tid='5678', class="move" title="(similarity 100%)">static</a> <a id='5679' tid='5680', class="move" title="(similarity 100%)">Redirection</a><a id='5681' tid='5682', class="move" title="(similarity 100%)">*</a> <a id='5683' tid='5684', class="move" title="(similarity 100%)">FromSwiInstruction</a>(<a id='5685' tid='5686', class="move" title="(similarity 100%)">Instruction</a><a id='5687' tid='5688', class="move" title="(similarity 100%)">*</a> <a id='5689' tid='5690', class="move" title="(similarity 100%)">swi_instruction</a>) {
    <a id='5691' tid='5692', class="move" title="(similarity 100%)">char</a><a id='5693' tid='5694', class="move" title="(similarity 100%)">*</a> <a id='5695' tid='5696', class="move" title="(similarity 100%)">addr_of_swi</a> = <a id='5697' tid='5698', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='5699' tid='5700', class="move" title="(similarity 100%)">char</a><a id='5701' tid='5702', class="move" title="(similarity 100%)">*</a>&gt;(<a id='5703' tid='5704', class="move" title="(similarity 100%)">swi_instruction</a>);
    <a id='5705' tid='5706', class="move" title="(similarity 100%)">char</a><a id='5707' tid='5708', class="move" title="(similarity 100%)">*</a> <a id='5709' tid='5710', class="move" title="(similarity 100%)">addr_of_redirection</a> =
        <a id='5711' tid='5712', class="move" title="(similarity 100%)">addr_of_swi</a> <a id='5713' tid='5714', class="move" title="(similarity 100%)">-</a> <a id='5715' tid='5716', class="move" title="(similarity 100%)">OFFSET_OF</a>(<a id='5717' tid='5718', class="move" title="(similarity 100%)">Redirection</a>, <a id='5719' tid='5720', class="move" title="(similarity 100%)">swi_instruction_</a>);
    <a id='5721' tid='5722', class="move" title="(similarity 100%)">return</a> <a id='5723' tid='5724', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='5725' tid='5726', class="move" title="(similarity 100%)">Redirection</a><a id='5727' tid='5728', class="move" title="(similarity 100%)">*</a>&gt;(<a id='5729' tid='5730', class="move" title="(similarity 100%)">addr_of_redirection</a>);
  }

 <a id='5731' tid='5732', class="move" title="(similarity 100%)">private</a>:
  <a id='5733' tid='5734', class="move" title="(similarity 100%)">void</a><a id='5735' tid='5736', class="move" title="(similarity 100%)">*</a> <a id='5737' tid='5738', class="move" title="(similarity 100%)">external_function_</a>;
  <a id='5739' tid='5740', class="move" title="(similarity 100%)">uint32_t</a> <a id='5741' tid='5742', class="move" title="(similarity 100%)">swi_instruction_</a>;
  <a id='5743' tid='5744', class="move" title="(similarity 100%)">ExternalReference</a><a id='5745' tid='5746', class="move" title="(similarity 100%)">::</a><a id='5747' tid='5748', class="move" title="(similarity 100%)">Type</a> <a id='5749' tid='5750', class="move" title="(similarity 100%)">type_</a>;
  <a id='5751' tid='5752', class="move" title="(similarity 100%)">Redirection</a><a id='5753' tid='5754', class="move" title="(similarity 100%)">*</a> <a id='5755' tid='5756', class="move" title="(similarity 100%)">next_</a>;
};


<a id='5429' tid='5430', class="move" title="(similarity 100%)">void</a><a id='5431' tid='5432', class="move" title="(similarity 100%)">*</a> <a id='5433' tid='5434', class="move" title="(similarity 100%)">Simulator</a><a id='5435' tid='5436', class="move" title="(similarity 100%)">::</a><a id='5437' tid='5438', class="move" title="(similarity 100%)">RedirectExternalReference</a>(<a id='5439' tid='5440', class="move" title="(similarity 100%)">void</a><a id='5441' tid='5442', class="move" title="(similarity 100%)">*</a> <a id='5443' tid='5444', class="move" title="(similarity 100%)">external_function</a>,
                                           <a id='5445' tid='5446', class="move" title="(similarity 100%)">ExternalReference</a><a id='5447' tid='5448', class="move" title="(similarity 100%)">::</a><a id='5449' tid='5450', class="move" title="(similarity 100%)">Type</a> <a id='5451' tid='5452', class="move" title="(similarity 100%)">type</a>) {
  <a id='5453' tid='5454', class="move" title="(similarity 100%)">Redirection</a><a id='5455' tid='5456', class="move" title="(similarity 100%)">*</a> <a id='5457' tid='5458', class="move" title="(similarity 100%)">redirection</a> = <a id='5459' tid='5460', class="move" title="(similarity 100%)">Redirection</a><a id='5461' tid='5462', class="move" title="(similarity 100%)">::</a><a id='5463' tid='5464', class="move" title="(similarity 100%)">Get</a>(<a id='5465' tid='5466', class="move" title="(similarity 100%)">external_function</a>, <a id='5467' tid='5468', class="move" title="(similarity 100%)">type</a>);
  <a id='5469' tid='5470', class="move" title="(similarity 100%)">return</a> <a id='5471' tid='5472', class="move" title="(similarity 100%)">redirection</a>-&gt;<a id='5473' tid='5474', class="move" title="(similarity 100%)">address_of_swi_instruction</a>();
}


// Get the active Simulator for the current thread.
<a id='5391' tid='5392', class="move" title="(similarity 100%)">Simulator</a><a id='5393' tid='5394', class="move" title="(similarity 100%)">*</a> <a id='5395' tid='5396', class="move" title="(similarity 100%)">Simulator</a><a id='5397' tid='5398', class="move" title="(similarity 100%)">::</a><a id='5399' tid='5400', class="move" title="(similarity 100%)">current</a>(<a id='5401' tid='5402', class="move" title="(similarity 100%)">Isolate</a><a id='5403' tid='5404', class="move" title="(similarity 100%)">*</a> <a id='5405' tid='5406', class="move" title="(similarity 100%)">isolate</a>) {
  <a id='5407' tid='5408', class="move" title="(similarity 100%)">v8</a><a id='5409' tid='5410', class="move" title="(similarity 100%)">::</a><a id='5411' tid='5412', class="move" title="(similarity 100%)">internal</a><a id='5413' tid='5414', class="move" title="(similarity 100%)">::</a><a id='5415' tid='5416', class="move" title="(similarity 100%)">Isolate</a><a id='5417' tid='5418', class="move" title="(similarity 100%)">::</a><a id='5419' tid='5420', class="move" title="(similarity 100%)">PerIsolateThreadData</a><a id='5421' tid='5422', class="move" title="(similarity 100%)">*</a> <a id='5423' tid='5424', class="move" title="(similarity 100%)">isolate_data</a> =
       <a id='5425' tid='5426', class="move" title="(similarity 100%)">isolate</a>-&gt;<a id='5427' tid='5428', class="move" title="(similarity 100%)">FindOrAllocatePerThreadDataForThisThread</a>();
  <span class="deletion" title="deleted">ASSERT(isolate_data != NULL);</span>
  <span class="deletion" title="deleted">ASSERT(isolate_data != NULL);</span>

  <span class="deletion" title="deleted">Simulator* sim = isolate_data-&gt;simulator();</span>
  <a id='5367' tid='5368', class="move" title="(similarity 100%)">if</a> (<a id='5369' tid='5370', class="move" title="(similarity 100%)">sim</a> <a id='5371' tid='5372', class="move" title="(similarity 100%)">==</a> <a id='5373' tid='5374', class="move" title="(similarity 100%)">NULL</a>) {
    // TODO(146): delete the simulator object when a thread/isolate goes away.
    <a id='5375' tid='5376', class="move" title="(similarity 100%)">sim</a> <a id='5377' tid='5378', class="move" title="(similarity 100%)">=</a> <a id='5379' tid='5380', class="move" title="(similarity 100%)">new</a> <a id='5381' tid='5382', class="move" title="(similarity 100%)">Simulator</a>(<a id='5383' tid='5384', class="move" title="(similarity 100%)">isolate</a>);
    <a id='5385' tid='5386', class="move" title="(similarity 100%)">isolate_data</a>-&gt;<a id='5387' tid='5388', class="move" title="(similarity 100%)">set_simulator</a>(<a id='5389' tid='5390', class="move" title="(similarity 100%)">sim</a>);
  }
  <span class="deletion" title="deleted">return sim;</span>
}


// Sets the register in the architecture state. It will also deal with updating
// Simulator internal state for special registers such as PC.
<a id='5337' tid='5338', class="move" title="(similarity 100%)">void</a> <a id='5339' tid='5340', class="move" title="(similarity 100%)">Simulator</a><a id='5341' tid='5342', class="move" title="(similarity 100%)">::</a><a id='5343' tid='5344', class="move" title="(similarity 100%)">set_register</a>(<a id='5345' tid='5346', class="move" title="(similarity 100%)">int</a> <a id='5347' tid='5348', class="move" title="(similarity 100%)">reg</a>, <a id='5349' tid='5350', class="move" title="(similarity 100%)">int32_t</a> <a id='5351' tid='5352', class="move" title="(similarity 100%)">value</a>) {
  <span class="deletion" title="deleted">ASSERT((reg &gt;= 0) && (reg &lt; kNumSimuRegisters));</span>
  <a id='5353' tid='5354', class="move" title="(similarity 100%)">if</a> (<a id='5355' tid='5356', class="move" title="(similarity 100%)">reg</a> <a id='5357' tid='5358', class="move" title="(similarity 100%)">==</a> <a id='5359' tid='5360', class="move" title="(similarity 100%)">pc</a>) {
    <a id='5361' tid='5362', class="move" title="(similarity 100%)">pc_modified_</a> <a id='5363' tid='5364', class="move" title="(similarity 100%)">=</a> <a id='5365' tid='5366', class="move" title="(similarity 100%)">true</a>;
  }

  // Zero register always holds 0.
  <span class="deletion" title="deleted">registers_[reg] = (reg == 0) ? 0 : value;</span>
}


<span class="deletion" title="deleted">void Simulator::set_fpu_register(int fpureg, int32_t value) {
  ASSERT((fpureg &gt;= 0) && (fpureg &lt; kNumFPURegisters));
  FPUregisters_[fpureg] = value;
}</span>


<span class="deletion" title="deleted">void Simulator::set_fpu_register_float(int fpureg, float value) {
  ASSERT((fpureg &gt;= 0) && (fpureg &lt; kNumFPURegisters));
  *BitCast&lt;float*&gt;(&FPUregisters_[fpureg]) = value;
}</span>


<span class="deletion" title="deleted">void Simulator::set_fpu_register_double(int fpureg, double value) {
  ASSERT((fpureg &gt;= 0) && (fpureg &lt; kNumFPURegisters) && ((fpureg % 2) == 0));
  *BitCast&lt;double*&gt;(&FPUregisters_[fpureg]) = value;
}</span>


// Get the register from the architecture state. This function does handle
// the special case of accessing the PC register.
<a id='5323' tid='5324', class="move" title="(similarity 100%)">int32_t</a> <a id='5325' tid='5326', class="move" title="(similarity 100%)">Simulator</a><a id='5327' tid='5328', class="move" title="(similarity 100%)">::</a><a id='5329' tid='5330', class="move" title="(similarity 100%)">get_register</a>(<a id='5331' tid='5332', class="move" title="(similarity 100%)">int</a> <a id='5333' tid='5334', class="move" title="(similarity 100%)">reg</a>) <a id='5335' tid='5336', class="move" title="(similarity 100%)">const</a> {
  <span class="deletion" title="deleted">ASSERT((reg &gt;= 0) && (reg &lt; kNumSimuRegisters));</span>
  <span class="deletion" title="deleted">if</span> <span class="deletion" title="deleted">(reg == 0)</span>
    <span class="deletion" title="deleted">return 0;</span>
  <span class="deletion" title="deleted">else</span>
    <a id='5301' tid='5302', class="move" title="(similarity 100%)">return</a> <a id='5303' tid='5304', class="move" title="(similarity 100%)">registers_</a>[<a id='5305' tid='5306', class="move" title="(similarity 100%)">reg</a>] <a id='5307' tid='5308', class="move" title="(similarity 100%)">+</a> ((<a id='5309' tid='5310', class="move" title="(similarity 100%)">reg</a> <a id='5311' tid='5312', class="move" title="(similarity 100%)">==</a> <a id='5313' tid='5314', class="move" title="(similarity 100%)">pc</a>) ? <a id='5315' tid='5316', class="move" title="(similarity 100%)">Instruction</a><a id='5317' tid='5318', class="move" title="(similarity 100%)">::</a><a id='5319' tid='5320', class="move" title="(similarity 100%)">kPCReadOffset</a> : <a id='5321' tid='5322', class="move" title="(similarity 100%)">0</a>);
}


<span class="deletion" title="deleted">int32_t Simulator::get_fpu_register(int fpureg) const</span> <span class="deletion" title="deleted">{
  ASSERT((fpureg &gt;= 0) && (fpureg &lt; kNumFPURegisters));
  return FPUregisters_[fpureg];
}</span>


<span class="deletion" title="deleted">int64_t Simulator::get_fpu_register_long(int fpureg) const</span> <span class="deletion" title="deleted">{
  ASSERT((fpureg &gt;= 0) && (fpureg &lt; kNumFPURegisters) && ((fpureg % 2) == 0));
  return *BitCast&lt;int64_t*&gt;(
      const_cast&lt;int32_t*&gt;(&FPUregisters_[fpureg]));
}</span>


<span class="deletion" title="deleted">float Simulator::get_fpu_register_float(int fpureg) const</span> <span class="deletion" title="deleted">{
  ASSERT((fpureg &gt;= 0) && (fpureg &lt; kNumFPURegisters));
  return *BitCast&lt;float*&gt;(
      const_cast&lt;int32_t*&gt;(&FPUregisters_[fpureg]));
}</span>


<span class="deletion" title="deleted">double Simulator::get_fpu_register_double(int fpureg) const</span> <span class="deletion" title="deleted">{
  ASSERT((fpureg &gt;= 0) && (fpureg &lt; kNumFPURegisters) && ((fpureg % 2) == 0));
  return *BitCast&lt;double*&gt;(const_cast&lt;int32_t*&gt;(&FPUregisters_[fpureg]));
}</span>


// For use in calls that take two double values, constructed either
// from a0-a3 or f12 and f14.
<a id='5255' tid='5256', class="move" title="(similarity 100%)">void</a> <a id='5257' tid='5258', class="move" title="(similarity 100%)">Simulator</a><a id='5259' tid='5260', class="move" title="(similarity 100%)">::</a><a id='5261' tid='5262', class="move" title="(similarity 100%)">GetFpArgs</a>(<a id='5263' tid='5264', class="move" title="(similarity 100%)">double</a><a id='5265' tid='5266', class="move" title="(similarity 100%)">*</a> <a id='5267' tid='5268', class="move" title="(similarity 100%)">x</a>, <a id='5269' tid='5270', class="move" title="(similarity 100%)">double</a><a id='5271' tid='5272', class="move" title="(similarity 100%)">*</a> <a id='5273' tid='5274', class="move" title="(similarity 100%)">y</a>) <span class="deletion" title="deleted">{
  if (!IsMipsSoftFloatABI) {
    *x = get_fpu_register_double(12);
    *y = get_fpu_register_double(14);
  } else {
    // We use a char buffer to get around the strict-aliasing rules which
    // otherwise allow the compiler to optimize away the copy.
    char buffer[sizeof(*x)];
    int32_t* reg_buffer = reinterpret_cast&lt;int32_t*&gt;(buffer);

    // Registers a0 and a1 -&gt; x.
    reg_buffer[0] = get_register(a0);
    reg_buffer[1] = get_register(a1);
    memcpy(x, buffer, sizeof(buffer));

    // Registers a2 and a3 -&gt; y.
    reg_buffer[0] = get_register(a2);
    reg_buffer[1] = get_register(a3);
    memcpy(y, buffer, sizeof(buffer));
  }
}</span>


// For use in calls that take one double value, constructed either
// from a0 and a1 or f12.
<a id='5241' tid='5242', class="move" title="(similarity 100%)">void</a> <a id='5243' tid='5244', class="move" title="(similarity 100%)">Simulator</a><a id='5245' tid='5246', class="move" title="(similarity 100%)">::</a><a id='5247' tid='5248', class="move" title="(similarity 100%)">GetFpArgs</a>(<a id='5249' tid='5250', class="move" title="(similarity 100%)">double</a><a id='5251' tid='5252', class="move" title="(similarity 100%)">*</a> <a id='5253' tid='5254', class="move" title="(similarity 100%)">x</a>) <span class="deletion" title="deleted">{
  if (!IsMipsSoftFloatABI) {
    *x = get_fpu_register_double(12);
  } else {
    // We use a char buffer to get around the strict-aliasing rules which
    // otherwise allow the compiler to optimize away the copy.
    char buffer[sizeof(*x)];
    int32_t* reg_buffer = reinterpret_cast&lt;int32_t*&gt;(buffer);
    // Registers a0 and a1 -&gt; x.
    reg_buffer[0] = get_register(a0);
    reg_buffer[1] = get_register(a1);
    memcpy(x, buffer, sizeof(buffer));
  }
}</span>


// For use in calls that take one double value constructed either
// from a0 and a1 or f12 and one integer value.
<a id='5221' tid='5222', class="move" title="(similarity 100%)">void</a> <a id='5223' tid='5224', class="move" title="(similarity 100%)">Simulator</a><a id='5225' tid='5226', class="move" title="(similarity 100%)">::</a><a id='5227' tid='5228', class="move" title="(similarity 100%)">GetFpArgs</a>(<a id='5229' tid='5230', class="move" title="(similarity 100%)">double</a><a id='5231' tid='5232', class="move" title="(similarity 100%)">*</a> <a id='5233' tid='5234', class="move" title="(similarity 100%)">x</a>, <a id='5235' tid='5236', class="move" title="(similarity 100%)">int32_t</a><a id='5237' tid='5238', class="move" title="(similarity 100%)">*</a> <a id='5239' tid='5240', class="move" title="(similarity 100%)">y</a>) <span class="deletion" title="deleted">{
  if (!IsMipsSoftFloatABI) {
    *x = get_fpu_register_double(12);
    *y = get_register(a2);
  } else {
    // We use a char buffer to get around the strict-aliasing rules which
    // otherwise allow the compiler to optimize away the copy.
    char buffer[sizeof(*x)];
    int32_t* reg_buffer = reinterpret_cast&lt;int32_t*&gt;(buffer);
    // Registers 0 and 1 -&gt; x.
    reg_buffer[0] = get_register(a0);
    reg_buffer[1] = get_register(a1);
    memcpy(x, buffer, sizeof(buffer));

    // Register 2 -&gt; y.
    reg_buffer[0] = get_register(a2);
    memcpy(y, buffer, sizeof(*y));
  }
}</span>


// The return value is either in v0/v1 or f0.
<a id='5189' tid='5190', class="move" title="(similarity 100%)">void</a> <a id='5191' tid='5192', class="move" title="(similarity 100%)">Simulator</a><a id='5193' tid='5194', class="move" title="(similarity 100%)">::</a><a id='5195' tid='5196', class="move" title="(similarity 100%)">SetFpResult</a>(<a id='5197' tid='5198', class="move" title="(similarity 100%)">const</a> <a id='5199' tid='5200', class="move" title="(similarity 100%)">double</a><a id='5201' tid='5202', class="move" title="(similarity 100%)">&</a> <a id='5203' tid='5204', class="move" title="(similarity 100%)">result</a>) {
  <span class="deletion" title="deleted">if</span> <span class="deletion" title="deleted">(!IsMipsSoftFloatABI)</span> <span class="deletion" title="deleted">{
    set_fpu_register_double(0, result);
  }</span> <a id='5205' tid='5206', class="move" title="(similarity 100%)">else</a> {
    <a id='5207' tid='5208', class="move" title="(similarity 100%)">char</a> <a id='5209' tid='5210', class="move" title="(similarity 100%)">buffer</a>[<a id='5211' tid='5212', class="move" title="(similarity 100%)">2</a> <a id='5213' tid='5214', class="move" title="(similarity 100%)">*</a> <a id='5215' tid='5216', class="move" title="(similarity 100%)">sizeof</a>(<a id='5217' tid='5218', class="move" title="(similarity 100%)">registers_</a>[<a id='5219' tid='5220', class="move" title="(similarity 100%)">0</a>])];
    <span class="deletion" title="deleted">int32_t* reg_buffer = reinterpret_cast&lt;int32_t*&gt;(buffer);</span>
    <span class="deletion" title="deleted">memcpy(buffer, &result, sizeof(buffer));</span>
    // Copy result to v0 and v1.
    <span class="deletion" title="deleted">set_register(v0, reg_buffer[0]);</span>
    <span class="deletion" title="deleted">set_register(v1, reg_buffer[1]);</span>
  }
}


// Helper functions for setting and testing the FCSR register&#39;s bits.
<span class="deletion" title="deleted">void Simulator::set_fcsr_bit(uint32_t cc, bool value) {
  if (value) {
    FCSR_ |= (1 &lt;&lt; cc);
  } else {
    FCSR_ &= ~(1 &lt;&lt; cc);
  }
}</span>


<span class="deletion" title="deleted">bool Simulator::test_fcsr_bit(uint32_t cc) {
  return FCSR_ & (1 &lt;&lt; cc);
}</span>


// Sets the rounding error codes in FCSR based on the result of the rounding.
// Returns true if the operation was invalid.
<span class="deletion" title="deleted">bool Simulator::set_fcsr_round_error(double original, double rounded) {
  bool ret = false;

  if (!isfinite(original) || !isfinite(rounded)) {
    set_fcsr_bit(kFCSRInvalidOpFlagBit, true);
    ret = true;
  }

  if (original != rounded) {
    set_fcsr_bit(kFCSRInexactFlagBit, true);
  }

  if (rounded &lt; DBL_MIN && rounded &gt; -DBL_MIN && rounded != 0) {
    set_fcsr_bit(kFCSRUnderflowFlagBit, true);
    ret = true;
  }

  if (rounded &gt; INT_MAX || rounded &lt; INT_MIN) {
    set_fcsr_bit(kFCSROverflowFlagBit, true);
    // The reference is not really clear but it seems this is required:
    set_fcsr_bit(kFCSRInvalidOpFlagBit, true);
    ret = true;
  }

  return ret;
}</span>


// Raw access to the PC register.
<a id='5275' tid='5276', class="move" title="(similarity 100%)">void</a> <a id='5277' tid='5278', class="move" title="(similarity 100%)">Simulator</a><a id='5279' tid='5280', class="move" title="(similarity 100%)">::</a><a id='5281' tid='5282', class="move" title="(similarity 100%)">set_pc</a>(<a id='5283' tid='5284', class="move" title="(similarity 100%)">int32_t</a> <a id='5285' tid='5286', class="move" title="(similarity 100%)">value</a>) {
  <a id='5287' tid='5288', class="move" title="(similarity 100%)">pc_modified_</a> <a id='5289' tid='5290', class="move" title="(similarity 100%)">=</a> <a id='5291' tid='5292', class="move" title="(similarity 100%)">true</a>;
  <a id='5293' tid='5294', class="move" title="(similarity 100%)">registers_</a>[<a id='5295' tid='5296', class="move" title="(similarity 100%)">pc</a>] <a id='5297' tid='5298', class="move" title="(similarity 100%)">=</a> <a id='5299' tid='5300', class="move" title="(similarity 100%)">value</a>;
}


<span class="deletion" title="deleted">bool Simulator::has_bad_pc() const</span> <span class="deletion" title="deleted">{
  return ((registers_[pc] == bad_ra) || (registers_[pc] == end_sim_pc));
}</span>


// Raw access to the PC register without the special adjustment when reading.
<span class="deletion" title="deleted">int32_t Simulator::get_pc() const</span> <span class="deletion" title="deleted">{
  return registers_[pc];
}</span>


// The MIPS cannot do unaligned reads and writes.  On some MIPS platforms an
// interrupt is caused.  On others it does a funky rotation thing.  For now we
// simply disallow unaligned reads, but at some point we may want to move to
// emulating the rotate behaviour.  Note that simulator runs have the runtime
// system running directly on the host system and only generated code is
// executed in the simulator.  Since the host is typically IA32 we will not
// get the correct MIPS-like behaviour on unaligned accesses.

<a id='5157' tid='5158', class="move" title="(similarity 100%)">int</a> <a id='5159' tid='5160', class="move" title="(similarity 100%)">Simulator</a><a id='5161' tid='5162', class="move" title="(similarity 100%)">::</a><a id='5163' tid='5164', class="move" title="(similarity 100%)">ReadW</a>(<a id='5165' tid='5166', class="move" title="(similarity 100%)">int32_t</a> <a id='5167' tid='5168', class="move" title="(similarity 100%)">addr</a>, <a id='5169' tid='5170', class="move" title="(similarity 100%)">Instruction</a><a id='5171' tid='5172', class="move" title="(similarity 100%)">*</a> <a id='5173' tid='5174', class="move" title="(similarity 100%)">instr</a>) {
  <span class="deletion" title="deleted">if (addr &gt;=0 && addr &lt; 0x400) {
    // This has to be a NULL-dereference, drop into debugger.
    MipsDebugger dbg(this);
    dbg.Debug();
  }</span>
  <span class="deletion" title="deleted">if</span> <span class="deletion" title="deleted">((addr & kPointerAlignmentMask) == 0)</span> {
    <a id='5175' tid='5176', class="move" title="(similarity 100%)">intptr_t</a><a id='5177' tid='5178', class="move" title="(similarity 100%)">*</a> <a id='5179' tid='5180', class="move" title="(similarity 100%)">ptr</a> = <a id='5181' tid='5182', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='5183' tid='5184', class="move" title="(similarity 100%)">intptr_t</a><a id='5185' tid='5186', class="move" title="(similarity 100%)">*</a>&gt;(<a id='5187' tid='5188', class="move" title="(similarity 100%)">addr</a>);
    <span class="deletion" title="deleted">return *ptr;</span>
  }
  <a id='5141' tid='5142', class="move" title="(similarity 100%)">PrintF</a>(<a id='5143' tid='5144', class="move" title="(similarity 100%)">&quot;Unaligned read at 0x%08x, pc=0x%08&quot;</a> <a id='5145' tid='5146', class="move" title="(similarity 100%)">V8PRIxPTR</a> <a id='5147' tid='5148', class="move" title="(similarity 100%)">&quot;\n&quot;</a>,
         <a id='5149' tid='5150', class="move" title="(similarity 100%)">addr</a>,
         <a id='5151' tid='5152', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='5153' tid='5154', class="move" title="(similarity 100%)">intptr_t</a>&gt;(<a id='5155' tid='5156', class="move" title="(similarity 100%)">instr</a>));
  <span class="deletion" title="deleted">MipsDebugger dbg(this)</span>;
  <span class="deletion" title="deleted">dbg.Debug();</span>
  <span class="deletion" title="deleted">return 0;</span>
}


<a id='5105' tid='5106', class="move" title="(similarity 100%)">void</a> <a id='5107' tid='5108', class="move" title="(similarity 100%)">Simulator</a><a id='5109' tid='5110', class="move" title="(similarity 100%)">::</a><a id='5111' tid='5112', class="move" title="(similarity 100%)">WriteW</a>(<a id='5113' tid='5114', class="move" title="(similarity 100%)">int32_t</a> <a id='5115' tid='5116', class="move" title="(similarity 100%)">addr</a>, <a id='5117' tid='5118', class="move" title="(similarity 100%)">int</a> <a id='5119' tid='5120', class="move" title="(similarity 100%)">value</a>, <a id='5121' tid='5122', class="move" title="(similarity 100%)">Instruction</a><a id='5123' tid='5124', class="move" title="(similarity 100%)">*</a> <a id='5125' tid='5126', class="move" title="(similarity 100%)">instr</a>) {
  <span class="deletion" title="deleted">if (addr &gt;= 0 && addr &lt; 0x400) {
    // This has to be a NULL-dereference, drop into debugger.
    MipsDebugger dbg(this);
    dbg.Debug();
  }</span>
  <span class="deletion" title="deleted">if</span> <span class="deletion" title="deleted">((addr & kPointerAlignmentMask) == 0)</span> {
    <a id='5127' tid='5128', class="move" title="(similarity 100%)">intptr_t</a><a id='5129' tid='5130', class="move" title="(similarity 100%)">*</a> <a id='5131' tid='5132', class="move" title="(similarity 100%)">ptr</a> = <a id='5133' tid='5134', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='5135' tid='5136', class="move" title="(similarity 100%)">intptr_t</a><a id='5137' tid='5138', class="move" title="(similarity 100%)">*</a>&gt;(<a id='5139' tid='5140', class="move" title="(similarity 100%)">addr</a>);
    <span class="deletion" title="deleted">*ptr = value;</span>
    <span class="deletion" title="deleted">return;</span>
  }
  <a id='5089' tid='5090', class="move" title="(similarity 100%)">PrintF</a>(<a id='5091' tid='5092', class="move" title="(similarity 100%)">&quot;Unaligned write at 0x%08x, pc=0x%08&quot;</a> <a id='5093' tid='5094', class="move" title="(similarity 100%)">V8PRIxPTR</a> <a id='5095' tid='5096', class="move" title="(similarity 100%)">&quot;\n&quot;</a>,
         <a id='5097' tid='5098', class="move" title="(similarity 100%)">addr</a>,
         <a id='5099' tid='5100', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='5101' tid='5102', class="move" title="(similarity 100%)">intptr_t</a>&gt;(<a id='5103' tid='5104', class="move" title="(similarity 100%)">instr</a>));
  <span class="deletion" title="deleted">MipsDebugger dbg(this)</span>;
  <span class="deletion" title="deleted">dbg.Debug();</span>
}


<span class="deletion" title="deleted">double Simulator::ReadD(int32_t addr, Instruction* instr) {
  if ((addr & kDoubleAlignmentMask) == 0) {
    double* ptr = reinterpret_cast&lt;double*&gt;(addr);
    return *ptr;
  }
  PrintF(&quot;Unaligned (double) read at 0x%08x, pc=0x%08&quot; V8PRIxPTR &quot;\n&quot;,
         addr,
         reinterpret_cast&lt;intptr_t&gt;(instr));
  OS::Abort();
  return 0;
}</span>


<span class="deletion" title="deleted">void Simulator::WriteD(int32_t addr, double value, Instruction* instr) {
  if ((addr & kDoubleAlignmentMask) == 0) {
    double* ptr = reinterpret_cast&lt;double*&gt;(addr);
    *ptr = value;
    return;
  }
  PrintF(&quot;Unaligned (double) write at 0x%08x, pc=0x%08&quot; V8PRIxPTR &quot;\n&quot;,
         addr,
         reinterpret_cast&lt;intptr_t&gt;(instr));
  OS::Abort();
}</span>


<a id='5057' tid='5058', class="move" title="(similarity 100%)">uint16_t</a> <a id='5059' tid='5060', class="move" title="(similarity 100%)">Simulator</a><a id='5061' tid='5062', class="move" title="(similarity 100%)">::</a><a id='5063' tid='5064', class="move" title="(similarity 100%)">ReadHU</a>(<a id='5065' tid='5066', class="move" title="(similarity 100%)">int32_t</a> <a id='5067' tid='5068', class="move" title="(similarity 100%)">addr</a>, <a id='5069' tid='5070', class="move" title="(similarity 100%)">Instruction</a><a id='5071' tid='5072', class="move" title="(similarity 100%)">*</a> <a id='5073' tid='5074', class="move" title="(similarity 100%)">instr</a>) {
  <span class="deletion" title="deleted">if</span> <span class="deletion" title="deleted">((addr & 1) == 0)</span> {
    <a id='5075' tid='5076', class="move" title="(similarity 100%)">uint16_t</a><a id='5077' tid='5078', class="move" title="(similarity 100%)">*</a> <a id='5079' tid='5080', class="move" title="(similarity 100%)">ptr</a> = <a id='5081' tid='5082', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='5083' tid='5084', class="move" title="(similarity 100%)">uint16_t</a><a id='5085' tid='5086', class="move" title="(similarity 100%)">*</a>&gt;(<a id='5087' tid='5088', class="move" title="(similarity 100%)">addr</a>);
    <span class="deletion" title="deleted">return *ptr;</span>
  }
  <a id='5041' tid='5042', class="move" title="(similarity 100%)">PrintF</a>(<a id='5043' tid='5044', class="move" title="(similarity 100%)">&quot;Unaligned unsigned halfword read at 0x%08x, pc=0x%08&quot;</a> <a id='5045' tid='5046', class="move" title="(similarity 100%)">V8PRIxPTR</a> <a id='5047' tid='5048', class="move" title="(similarity 100%)">&quot;\n&quot;</a>,
         <a id='5049' tid='5050', class="move" title="(similarity 100%)">addr</a>,
         <a id='5051' tid='5052', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='5053' tid='5054', class="move" title="(similarity 100%)">intptr_t</a>&gt;(<a id='5055' tid='5056', class="move" title="(similarity 100%)">instr</a>));
  <span class="deletion" title="deleted">OS::Abort();</span>
  <span class="deletion" title="deleted">return 0;</span>
}


<a id='5009' tid='5010', class="move" title="(similarity 100%)">int16_t</a> <a id='5011' tid='5012', class="move" title="(similarity 100%)">Simulator</a><a id='5013' tid='5014', class="move" title="(similarity 100%)">::</a><a id='5015' tid='5016', class="move" title="(similarity 100%)">ReadH</a>(<a id='5017' tid='5018', class="move" title="(similarity 100%)">int32_t</a> <a id='5019' tid='5020', class="move" title="(similarity 100%)">addr</a>, <a id='5021' tid='5022', class="move" title="(similarity 100%)">Instruction</a><a id='5023' tid='5024', class="move" title="(similarity 100%)">*</a> <a id='5025' tid='5026', class="move" title="(similarity 100%)">instr</a>) {
  <span class="deletion" title="deleted">if</span> <span class="deletion" title="deleted">((addr & 1) == 0)</span> {
    <a id='5027' tid='5028', class="move" title="(similarity 100%)">int16_t</a><a id='5029' tid='5030', class="move" title="(similarity 100%)">*</a> <a id='5031' tid='5032', class="move" title="(similarity 100%)">ptr</a> = <a id='5033' tid='5034', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='5035' tid='5036', class="move" title="(similarity 100%)">int16_t</a><a id='5037' tid='5038', class="move" title="(similarity 100%)">*</a>&gt;(<a id='5039' tid='5040', class="move" title="(similarity 100%)">addr</a>);
    <span class="deletion" title="deleted">return *ptr;</span>
  }
  <span class="deletion" title="deleted">PrintF(&quot;Unaligned signed halfword read at 0x%08x, pc=0x%08&quot; V8PRIxPTR &quot;\n&quot;,
         addr,
         reinterpret_cast&lt;intptr_t&gt;(instr));</span>
  <span class="deletion" title="deleted">OS::Abort();</span>
  <span class="deletion" title="deleted">return 0;</span>
}


<a id='4973' tid='4974', class="move" title="(similarity 100%)">void</a> <a id='4975' tid='4976', class="move" title="(similarity 100%)">Simulator</a><a id='4977' tid='4978', class="move" title="(similarity 100%)">::</a><a id='4979' tid='4980', class="move" title="(similarity 100%)">WriteH</a>(<a id='4981' tid='4982', class="move" title="(similarity 100%)">int32_t</a> <a id='4983' tid='4984', class="move" title="(similarity 100%)">addr</a>, <a id='4985' tid='4986', class="move" title="(similarity 100%)">uint16_t</a> <a id='4987' tid='4988', class="move" title="(similarity 100%)">value</a>, <a id='4989' tid='4990', class="move" title="(similarity 100%)">Instruction</a><a id='4991' tid='4992', class="move" title="(similarity 100%)">*</a> <a id='4993' tid='4994', class="move" title="(similarity 100%)">instr</a>) {
  <span class="deletion" title="deleted">if</span> <span class="deletion" title="deleted">((addr & 1) == 0)</span> {
    <a id='4995' tid='4996', class="move" title="(similarity 100%)">uint16_t</a><a id='4997' tid='4998', class="move" title="(similarity 100%)">*</a> <a id='4999' tid='5000', class="move" title="(similarity 100%)">ptr</a> = <a id='5001' tid='5002', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='5003' tid='5004', class="move" title="(similarity 100%)">uint16_t</a><a id='5005' tid='5006', class="move" title="(similarity 100%)">*</a>&gt;(<a id='5007' tid='5008', class="move" title="(similarity 100%)">addr</a>);
    <span class="deletion" title="deleted">*ptr = value;</span>
    <span class="deletion" title="deleted">return;</span>
  }
  <a id='4957' tid='4958', class="move" title="(similarity 100%)">PrintF</a>(<a id='4959' tid='4960', class="move" title="(similarity 100%)">&quot;Unaligned unsigned halfword write at 0x%08x, pc=0x%08&quot;</a> <a id='4961' tid='4962', class="move" title="(similarity 100%)">V8PRIxPTR</a> <a id='4963' tid='4964', class="move" title="(similarity 100%)">&quot;\n&quot;</a>,
         <a id='4965' tid='4966', class="move" title="(similarity 100%)">addr</a>,
         <a id='4967' tid='4968', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='4969' tid='4970', class="move" title="(similarity 100%)">intptr_t</a>&gt;(<a id='4971' tid='4972', class="move" title="(similarity 100%)">instr</a>));
  <span class="deletion" title="deleted">OS::Abort();</span>
}


<a id='4921' tid='4922', class="move" title="(similarity 100%)">void</a> <a id='4923' tid='4924', class="move" title="(similarity 100%)">Simulator</a><a id='4925' tid='4926', class="move" title="(similarity 100%)">::</a><a id='4927' tid='4928', class="move" title="(similarity 100%)">WriteH</a>(<a id='4929' tid='4930', class="move" title="(similarity 100%)">int32_t</a> <a id='4931' tid='4932', class="move" title="(similarity 100%)">addr</a>, <a id='4933' tid='4934', class="move" title="(similarity 100%)">int16_t</a> <a id='4935' tid='4936', class="move" title="(similarity 100%)">value</a>, <a id='4937' tid='4938', class="move" title="(similarity 100%)">Instruction</a><a id='4939' tid='4940', class="move" title="(similarity 100%)">*</a> <a id='4941' tid='4942', class="move" title="(similarity 100%)">instr</a>) {
  <span class="deletion" title="deleted">if</span> <span class="deletion" title="deleted">((addr & 1) == 0)</span> {
    <a id='4943' tid='4944', class="move" title="(similarity 100%)">int16_t</a><a id='4945' tid='4946', class="move" title="(similarity 100%)">*</a> <a id='4947' tid='4948', class="move" title="(similarity 100%)">ptr</a> = <a id='4949' tid='4950', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='4951' tid='4952', class="move" title="(similarity 100%)">int16_t</a><a id='4953' tid='4954', class="move" title="(similarity 100%)">*</a>&gt;(<a id='4955' tid='4956', class="move" title="(similarity 100%)">addr</a>);
    <span class="deletion" title="deleted">*ptr = value;</span>
    <span class="deletion" title="deleted">return;</span>
  }
  <a id='4905' tid='4906', class="move" title="(similarity 100%)">PrintF</a>(<a id='4907' tid='4908', class="move" title="(similarity 100%)">&quot;Unaligned halfword write at 0x%08x, pc=0x%08&quot;</a> <a id='4909' tid='4910', class="move" title="(similarity 100%)">V8PRIxPTR</a> <a id='4911' tid='4912', class="move" title="(similarity 100%)">&quot;\n&quot;</a>,
         <a id='4913' tid='4914', class="move" title="(similarity 100%)">addr</a>,
         <a id='4915' tid='4916', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='4917' tid='4918', class="move" title="(similarity 100%)">intptr_t</a>&gt;(<a id='4919' tid='4920', class="move" title="(similarity 100%)">instr</a>));
  <span class="deletion" title="deleted">OS::Abort();</span>
}


<span class="deletion" title="deleted">uint32_t Simulator::ReadBU(int32_t addr)</span> {
  <a id='4891' tid='4892', class="move" title="(similarity 100%)">uint8_t</a><a id='4893' tid='4894', class="move" title="(similarity 100%)">*</a> <a id='4895' tid='4896', class="move" title="(similarity 100%)">ptr</a> = <a id='4897' tid='4898', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='4899' tid='4900', class="move" title="(similarity 100%)">uint8_t</a><a id='4901' tid='4902', class="move" title="(similarity 100%)">*</a>&gt;(<a id='4903' tid='4904', class="move" title="(similarity 100%)">addr</a>);
  <span class="deletion" title="deleted">return *ptr & 0xff;</span>
}


<span class="deletion" title="deleted">int32_t Simulator::ReadB(int32_t addr)</span> {
  <a id='4839' tid='4840', class="move" title="(similarity 100%)">int8_t</a><a id='4841' tid='4842', class="move" title="(similarity 100%)">*</a> <a id='4843' tid='4844', class="move" title="(similarity 100%)">ptr</a> = <a id='4845' tid='4846', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='4847' tid='4848', class="move" title="(similarity 100%)">int8_t</a><a id='4849' tid='4850', class="move" title="(similarity 100%)">*</a>&gt;(<a id='4851' tid='4852', class="move" title="(similarity 100%)">addr</a>);
  <span class="deletion" title="deleted">return *ptr;</span>
}


<a id='4853' tid='4854', class="move" title="(similarity 100%)">void</a> <a id='4855' tid='4856', class="move" title="(similarity 100%)">Simulator</a><a id='4857' tid='4858', class="move" title="(similarity 100%)">::</a><a id='4859' tid='4860', class="move" title="(similarity 100%)">WriteB</a>(<a id='4861' tid='4862', class="move" title="(similarity 100%)">int32_t</a> <a id='4863' tid='4864', class="move" title="(similarity 100%)">addr</a>, <a id='4865' tid='4866', class="move" title="(similarity 100%)">uint8_t</a> <a id='4867' tid='4868', class="move" title="(similarity 100%)">value</a>) {
  <a id='4869' tid='4870', class="move" title="(similarity 100%)">uint8_t</a><a id='4871' tid='4872', class="move" title="(similarity 100%)">*</a> <a id='4873' tid='4874', class="move" title="(similarity 100%)">ptr</a> = <a id='4875' tid='4876', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='4877' tid='4878', class="move" title="(similarity 100%)">uint8_t</a><a id='4879' tid='4880', class="move" title="(similarity 100%)">*</a>&gt;(<a id='4881' tid='4882', class="move" title="(similarity 100%)">addr</a>);
  <a id='4883' tid='4884', class="move" title="(similarity 100%)">*</a><a id='4885' tid='4886', class="move" title="(similarity 100%)">ptr</a> <a id='4887' tid='4888', class="move" title="(similarity 100%)">=</a> <a id='4889' tid='4890', class="move" title="(similarity 100%)">value</a>;
}


<a id='4809' tid='4810', class="move" title="(similarity 100%)">void</a> <a id='4811' tid='4812', class="move" title="(similarity 100%)">Simulator</a><a id='4813' tid='4814', class="move" title="(similarity 100%)">::</a><a id='4815' tid='4816', class="move" title="(similarity 100%)">WriteB</a>(<a id='4817' tid='4818', class="move" title="(similarity 100%)">int32_t</a> <a id='4819' tid='4820', class="move" title="(similarity 100%)">addr</a>, <a id='4821' tid='4822', class="move" title="(similarity 100%)">int8_t</a> <a id='4823' tid='4824', class="move" title="(similarity 100%)">value</a>) {
  <a id='4825' tid='4826', class="move" title="(similarity 100%)">int8_t</a><a id='4827' tid='4828', class="move" title="(similarity 100%)">*</a> <a id='4829' tid='4830', class="move" title="(similarity 100%)">ptr</a> = <a id='4831' tid='4832', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='4833' tid='4834', class="move" title="(similarity 100%)">int8_t</a><a id='4835' tid='4836', class="move" title="(similarity 100%)">*</a>&gt;(<a id='4837' tid='4838', class="move" title="(similarity 100%)">addr</a>);
  <span class="deletion" title="deleted">*ptr = value;</span>
}


// Returns the limit of the stack area to enable checking for stack overflows.
<span class="deletion" title="deleted">uintptr_t Simulator::StackLimit() const</span> <span class="deletion" title="deleted">{
  // Leave a safety margin of 256 bytes to prevent overrunning the stack when
  // pushing values.
  return reinterpret_cast&lt;uintptr_t&gt;(stack_) + 256;
}</span>


// Unsupported instructions use Format to print an error and stop execution.
<span class="deletion" title="deleted">void Simulator::Format(Instruction* instr, const char* format) {
  PrintF(&quot;Simulator found unsupported instruction:\n 0x%08x: %s\n&quot;,
         reinterpret_cast&lt;intptr_t&gt;(instr), format);
  UNIMPLEMENTED_MIPS();
}</span>


// Calls into the V8 runtime are based on this very simple interface.
// Note: To be able to return two values from some calls the code in runtime.cc
// uses the ObjectPair which is essentially two 32-bit values stuffed into a
// 64-bit value. With the code below we assume that all runtime calls return
// 64 bits of result. If they don&#39;t, the v1 result register contains a bogus
// value, which is fine because it is caller-saved.
<a id='4777' tid='4778', class="move" title="(similarity 100%)">typedef</a> <a id='4779' tid='4780', class="move" title="(similarity 100%)">int64_t</a> (<a id='4781' tid='4782', class="move" title="(similarity 100%)">*</a><a id='4783' tid='4784', class="move" title="(similarity 100%)">SimulatorRuntimeCall</a>)(<a id='4785' tid='4786', class="move" title="(similarity 100%)">int32_t</a> <a id='4787' tid='4788', class="move" title="(similarity 100%)">arg0</a>,
                                        <a id='4789' tid='4790', class="move" title="(similarity 100%)">int32_t</a> <a id='4791' tid='4792', class="move" title="(similarity 100%)">arg1</a>,
                                        <a id='4793' tid='4794', class="move" title="(similarity 100%)">int32_t</a> <a id='4795' tid='4796', class="move" title="(similarity 100%)">arg2</a>,
                                        <a id='4797' tid='4798', class="move" title="(similarity 100%)">int32_t</a> <a id='4799' tid='4800', class="move" title="(similarity 100%)">arg3</a>,
                                        <a id='4801' tid='4802', class="move" title="(similarity 100%)">int32_t</a> <a id='4803' tid='4804', class="move" title="(similarity 100%)">arg4</a>,
                                        <a id='4805' tid='4806', class="move" title="(similarity 100%)">int32_t</a> <a id='4807' tid='4808', class="move" title="(similarity 100%)">arg5</a>);
<a id='4753' tid='4754', class="move" title="(similarity 100%)">typedef</a> <a id='4755' tid='4756', class="move" title="(similarity 100%)">double</a> (<a id='4757' tid='4758', class="move" title="(similarity 100%)">*</a><a id='4759' tid='4760', class="move" title="(similarity 100%)">SimulatorRuntimeFPCall</a>)(<a id='4761' tid='4762', class="move" title="(similarity 100%)">int32_t</a> <a id='4763' tid='4764', class="move" title="(similarity 100%)">arg0</a>,
                                         <a id='4765' tid='4766', class="move" title="(similarity 100%)">int32_t</a> <a id='4767' tid='4768', class="move" title="(similarity 100%)">arg1</a>,
                                         <a id='4769' tid='4770', class="move" title="(similarity 100%)">int32_t</a> <a id='4771' tid='4772', class="move" title="(similarity 100%)">arg2</a>,
                                         <a id='4773' tid='4774', class="move" title="(similarity 100%)">int32_t</a> <a id='4775' tid='4776', class="move" title="(similarity 100%)">arg3</a>);

// This signature supports direct call in to API function native callback
// (refer to InvocationCallback in v8.h).
<a id='4731' tid='4732', class="move" title="(similarity 100%)">typedef</a> <a id='4733' tid='4734', class="move" title="(similarity 100%)">v8</a><a id='4735' tid='4736', class="move" title="(similarity 100%)">::</a><a id='4737' tid='4738', class="move" title="(similarity 100%)">Handle</a>&lt;<a id='4739' tid='4740', class="move" title="(similarity 100%)">v8</a><a id='4741' tid='4742', class="move" title="(similarity 100%)">::</a><a id='4743' tid='4744', class="move" title="(similarity 100%)">Value</a>&gt; (<a id='4745' tid='4746', class="move" title="(similarity 100%)">*</a><a id='4747' tid='4748', class="move" title="(similarity 100%)">SimulatorRuntimeDirectApiCall</a>)(<a id='4749' tid='4750', class="move" title="(similarity 100%)">int32_t</a> <a id='4751' tid='4752', class="move" title="(similarity 100%)">arg0</a>);

// This signature supports direct call to accessor getter callback.
<a id='4705' tid='4706', class="move" title="(similarity 100%)">typedef</a> <a id='4707' tid='4708', class="move" title="(similarity 100%)">v8</a><a id='4709' tid='4710', class="move" title="(similarity 100%)">::</a><a id='4711' tid='4712', class="move" title="(similarity 100%)">Handle</a>&lt;<a id='4713' tid='4714', class="move" title="(similarity 100%)">v8</a><a id='4715' tid='4716', class="move" title="(similarity 100%)">::</a><a id='4717' tid='4718', class="move" title="(similarity 100%)">Value</a>&gt; (<a id='4719' tid='4720', class="move" title="(similarity 100%)">*</a><a id='4721' tid='4722', class="move" title="(similarity 100%)">SimulatorRuntimeDirectGetterCall</a>)(<a id='4723' tid='4724', class="move" title="(similarity 100%)">int32_t</a> <a id='4725' tid='4726', class="move" title="(similarity 100%)">arg0</a>,
                                                                  <a id='4727' tid='4728', class="move" title="(similarity 100%)">int32_t</a> <a id='4729' tid='4730', class="move" title="(similarity 100%)">arg1</a>);

// Software interrupt instructions are used by the simulator to call into the
// C-based V8 runtime. They are also used for debugging with simulator.
<a id='4677' tid='4678', class="move" title="(similarity 100%)">void</a> <a id='4679' tid='4680', class="move" title="(similarity 100%)">Simulator</a><a id='4681' tid='4682', class="move" title="(similarity 100%)">::</a><a id='4683' tid='4684', class="move" title="(similarity 100%)">SoftwareInterrupt</a>(<a id='4685' tid='4686', class="move" title="(similarity 100%)">Instruction</a><a id='4687' tid='4688', class="move" title="(similarity 100%)">*</a> <a id='4689' tid='4690', class="move" title="(similarity 100%)">instr</a>) {
  // There are several instructions that could get us here,
  // the break_ instruction, or several variants of traps. All
  // Are &quot;SPECIAL&quot; class opcode, and are distinuished by function.
  <span class="deletion" title="deleted">int32_t func = instr-&gt;FunctionFieldRaw();</span>
  <span class="deletion" title="deleted">uint32_t code = (func == BREAK) ? instr-&gt;Bits(25, 6) : -1;</span>

  // We first check if we met a call_rt_redirected.
  <span class="deletion" title="deleted">if</span> <span class="deletion" title="deleted">(instr-&gt;InstructionBits() == rtCallRedirInstr)</span> {
    <a id='4691' tid='4692', class="move" title="(similarity 100%)">Redirection</a><a id='4693' tid='4694', class="move" title="(similarity 100%)">*</a> <a id='4695' tid='4696', class="move" title="(similarity 100%)">redirection</a> = <a id='4697' tid='4698', class="move" title="(similarity 100%)">Redirection</a><a id='4699' tid='4700', class="move" title="(similarity 100%)">::</a><a id='4701' tid='4702', class="move" title="(similarity 100%)">FromSwiInstruction</a>(<a id='4703' tid='4704', class="move" title="(similarity 100%)">instr</a>);
    <span class="deletion" title="deleted">int32_t arg0 = get_register(a0);</span>
    <span class="deletion" title="deleted">int32_t arg1 = get_register(a1);</span>
    <span class="deletion" title="deleted">int32_t arg2 = get_register(a2);</span>
    <span class="deletion" title="deleted">int32_t arg3 = get_register(a3);</span>
    <span class="deletion" title="deleted">int32_t arg4 = 0;</span>
    <span class="deletion" title="deleted">int32_t arg5 = 0;</span>

    // Need to check if sp is valid before assigning arg4, arg5.
    // This is a fix for cctest test-api/CatchStackOverflow which causes
    // the stack to overflow. For some reason arm doesn&#39;t need this
    // stack check here.
    <a id='4661' tid='4662', class="move" title="(similarity 100%)">int32_t</a><a id='4663' tid='4664', class="move" title="(similarity 100%)">*</a> <a id='4665' tid='4666', class="move" title="(similarity 100%)">stack_pointer</a> = <a id='4667' tid='4668', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='4669' tid='4670', class="move" title="(similarity 100%)">int32_t</a><a id='4671' tid='4672', class="move" title="(similarity 100%)">*</a>&gt;(<a id='4673' tid='4674', class="move" title="(similarity 100%)">get_register</a>(<a id='4675' tid='4676', class="move" title="(similarity 100%)">sp</a>));
    <span class="deletion" title="deleted">int32_t* stack = reinterpret_cast&lt;int32_t*&gt;(stack_);</span>
    <span class="deletion" title="deleted">if (stack_pointer &gt;= stack && stack_pointer &lt; stack + stack_size_ - 5) {
      // Args 4 and 5 are on the stack after the reserved space for args 0..3.
      arg4 = stack_pointer[4];
      arg5 = stack_pointer[5];
    }</span>

    <a id='4537' tid='4538', class="move" title="(similarity 100%)">bool</a> <a id='4539' tid='4540', class="move" title="(similarity 100%)">fp_call</a> =
         (<a id='4541' tid='4542', class="move" title="(similarity 100%)">redirection</a>-&gt;<a id='4543' tid='4544', class="move" title="(similarity 100%)">type</a>() <a id='4545' tid='4546', class="move" title="(similarity 100%)">==</a> <a id='4547' tid='4548', class="move" title="(similarity 100%)">ExternalReference</a><a id='4549' tid='4550', class="move" title="(similarity 100%)">::</a><a id='4551' tid='4552', class="move" title="(similarity 100%)">BUILTIN_FP_FP_CALL</a>) <a id='4553' tid='4554', class="move" title="(similarity 100%)">||</a>
         (<a id='4555' tid='4556', class="move" title="(similarity 100%)">redirection</a>-&gt;<a id='4557' tid='4558', class="move" title="(similarity 100%)">type</a>() <a id='4559' tid='4560', class="move" title="(similarity 100%)">==</a> <a id='4561' tid='4562', class="move" title="(similarity 100%)">ExternalReference</a><a id='4563' tid='4564', class="move" title="(similarity 100%)">::</a><a id='4565' tid='4566', class="move" title="(similarity 100%)">BUILTIN_COMPARE_CALL</a>) <a id='4567' tid='4568', class="move" title="(similarity 100%)">||</a>
         (<a id='4569' tid='4570', class="move" title="(similarity 100%)">redirection</a>-&gt;<a id='4571' tid='4572', class="move" title="(similarity 100%)">type</a>() <a id='4573' tid='4574', class="move" title="(similarity 100%)">==</a> <a id='4575' tid='4576', class="move" title="(similarity 100%)">ExternalReference</a><a id='4577' tid='4578', class="move" title="(similarity 100%)">::</a><a id='4579' tid='4580', class="move" title="(similarity 100%)">BUILTIN_FP_CALL</a>) <a id='4581' tid='4582', class="move" title="(similarity 100%)">||</a>
         (<a id='4583' tid='4584', class="move" title="(similarity 100%)">redirection</a>-&gt;<a id='4585' tid='4586', class="move" title="(similarity 100%)">type</a>() <a id='4587' tid='4588', class="move" title="(similarity 100%)">==</a> <a id='4589' tid='4590', class="move" title="(similarity 100%)">ExternalReference</a><a id='4591' tid='4592', class="move" title="(similarity 100%)">::</a><a id='4593' tid='4594', class="move" title="(similarity 100%)">BUILTIN_FP_INT_CALL</a>);

    <span class="deletion" title="deleted">if (!IsMipsSoftFloatABI) {
      // With the hard floating point calling convention, double
      // arguments are passed in FPU registers. Fetch the arguments
      // from there and call the builtin using soft floating point
      // convention.
      switch (redirection-&gt;type()) {
      case ExternalReference::BUILTIN_FP_FP_CALL:
      case ExternalReference::BUILTIN_COMPARE_CALL:
        arg0 = get_fpu_register(f12);
        arg1 = get_fpu_register(f13);
        arg2 = get_fpu_register(f14);
        arg3 = get_fpu_register(f15);
        break;
      case ExternalReference::BUILTIN_FP_CALL:
        arg0 = get_fpu_register(f12);
        arg1 = get_fpu_register(f13);
        break;
      case ExternalReference::BUILTIN_FP_INT_CALL:
        arg0 = get_fpu_register(f12);
        arg1 = get_fpu_register(f13);
        arg2 = get_register(a2);
        break;
      default:
        break;
      }
    }</span>

    // This is dodgy but it works because the C entry stubs are never moved.
    // See comment in codegen-arm.cc and bug 1242173.
    <span class="deletion" title="deleted">int32_t saved_ra = get_register(ra);</span>

    <span class="deletion" title="deleted">intptr_t external =
          reinterpret_cast&lt;intptr_t&gt;(redirection-&gt;external_function());</span>

    // Based on CpuFeatures::IsSupported(FPU), Mips will use either hardware
    // FPU, or gcc soft-float routines. Hardware FPU is simulated in this
    // simulator. Soft-float has additional abstraction of ExternalReference,
    // to support serialization.
    <a id='4325' tid='4326', class="move" title="(similarity 100%)">if</a> (<a id='4327' tid='4328', class="move" title="(similarity 100%)">fp_call</a>) {
      <span class="deletion" title="deleted">SimulatorRuntimeFPCall target =
                  reinterpret_cast&lt;SimulatorRuntimeFPCall&gt;(external);</span>
      <a id='4219' tid='4220', class="move" title="(similarity 100%)">if</a> (<a id='4221' tid='4222', class="move" title="(similarity 100%)">::</a><a id='4223' tid='4224', class="move" title="(similarity 100%)">v8</a><a id='4225' tid='4226', class="move" title="(similarity 100%)">::</a><a id='4227' tid='4228', class="move" title="(similarity 100%)">internal</a><a id='4229' tid='4230', class="move" title="(similarity 100%)">::</a><a id='4231' tid='4232', class="move" title="(similarity 100%)">FLAG_trace_sim</a>) {
        <span class="deletion" title="deleted">double dval0, dval1;</span>
        <span class="deletion" title="deleted">int32_t ival;</span>
        <a id='4329' tid='4330', class="move" title="(similarity 100%)">switch</a> (<a id='4331' tid='4332', class="move" title="(similarity 100%)">redirection</a>-&gt;<a id='4333' tid='4334', class="move" title="(similarity 100%)">type</a>()) {
          <a id='4335' tid='4336', class="move" title="(similarity 100%)">case</a> <a id='4337' tid='4338', class="move" title="(similarity 100%)">ExternalReference</a><a id='4339' tid='4340', class="move" title="(similarity 100%)">::</a><a id='4341' tid='4342', class="move" title="(similarity 100%)">BUILTIN_FP_FP_CALL</a>:
          <a id='4343' tid='4344', class="move" title="(similarity 100%)">case</a> <a id='4345' tid='4346', class="move" title="(similarity 100%)">ExternalReference</a><a id='4347' tid='4348', class="move" title="(similarity 100%)">::</a><a id='4349' tid='4350', class="move" title="(similarity 100%)">BUILTIN_COMPARE_CALL</a>:
            <a id='4351' tid='4352', class="move" title="(similarity 100%)">GetFpArgs</a>(<a id='4353' tid='4354', class="move" title="(similarity 100%)">&</a><a id='4355' tid='4356', class="move" title="(similarity 100%)">dval0</a>, <a id='4357' tid='4358', class="move" title="(similarity 100%)">&</a><a id='4359' tid='4360', class="move" title="(similarity 100%)">dval1</a>);
            <a id='4361' tid='4362', class="move" title="(similarity 100%)">PrintF</a>(<a id='4363' tid='4364', class="move" title="(similarity 100%)">&quot;Call to host function at %p with args %f, %f&quot;</a>,
                <a id='4365' tid='4366', class="move" title="(similarity 100%)">FUNCTION_ADDR</a>(<a id='4367' tid='4368', class="move" title="(similarity 100%)">target</a>), <a id='4369' tid='4370', class="move" title="(similarity 100%)">dval0</a>, <a id='4371' tid='4372', class="move" title="(similarity 100%)">dval1</a>);
            <a id='4373' tid='4374', class="move" title="(similarity 100%)">break</a>;
          <a id='4375' tid='4376', class="move" title="(similarity 100%)">case</a> <a id='4377' tid='4378', class="move" title="(similarity 100%)">ExternalReference</a><a id='4379' tid='4380', class="move" title="(similarity 100%)">::</a><a id='4381' tid='4382', class="move" title="(similarity 100%)">BUILTIN_FP_CALL</a>:
            <a id='4383' tid='4384', class="move" title="(similarity 100%)">GetFpArgs</a>(<a id='4385' tid='4386', class="move" title="(similarity 100%)">&</a><a id='4387' tid='4388', class="move" title="(similarity 100%)">dval0</a>);
            <a id='4389' tid='4390', class="move" title="(similarity 100%)">PrintF</a>(<a id='4391' tid='4392', class="move" title="(similarity 100%)">&quot;Call to host function at %p with arg %f&quot;</a>,
                <a id='4393' tid='4394', class="move" title="(similarity 100%)">FUNCTION_ADDR</a>(<a id='4395' tid='4396', class="move" title="(similarity 100%)">target</a>), <a id='4397' tid='4398', class="move" title="(similarity 100%)">dval0</a>);
            <a id='4399' tid='4400', class="move" title="(similarity 100%)">break</a>;
          <a id='4401' tid='4402', class="move" title="(similarity 100%)">case</a> <a id='4403' tid='4404', class="move" title="(similarity 100%)">ExternalReference</a><a id='4405' tid='4406', class="move" title="(similarity 100%)">::</a><a id='4407' tid='4408', class="move" title="(similarity 100%)">BUILTIN_FP_INT_CALL</a>:
            <a id='4409' tid='4410', class="move" title="(similarity 100%)">GetFpArgs</a>(<a id='4411' tid='4412', class="move" title="(similarity 100%)">&</a><a id='4413' tid='4414', class="move" title="(similarity 100%)">dval0</a>, <a id='4415' tid='4416', class="move" title="(similarity 100%)">&</a><a id='4417' tid='4418', class="move" title="(similarity 100%)">ival</a>);
            <a id='4419' tid='4420', class="move" title="(similarity 100%)">PrintF</a>(<a id='4421' tid='4422', class="move" title="(similarity 100%)">&quot;Call to host function at %p with args %f, %d&quot;</a>,
                <a id='4423' tid='4424', class="move" title="(similarity 100%)">FUNCTION_ADDR</a>(<a id='4425' tid='4426', class="move" title="(similarity 100%)">target</a>), <a id='4427' tid='4428', class="move" title="(similarity 100%)">dval0</a>, <a id='4429' tid='4430', class="move" title="(similarity 100%)">ival</a>);
            <a id='4431' tid='4432', class="move" title="(similarity 100%)">break</a>;
          <a id='4433' tid='4434', class="move" title="(similarity 100%)">default</a>:
            <a id='4435' tid='4436', class="move" title="(similarity 100%)">UNREACHABLE</a>();
            <a id='4437' tid='4438', class="move" title="(similarity 100%)">break</a>;
        }
      }
      <a id='4205' tid='4206', class="move" title="(similarity 100%)">double</a> <a id='4207' tid='4208', class="move" title="(similarity 100%)">result</a> = <a id='4209' tid='4210', class="move" title="(similarity 100%)">target</a>(<a id='4211' tid='4212', class="move" title="(similarity 100%)">arg0</a>, <a id='4213' tid='4214', class="move" title="(similarity 100%)">arg1</a>, <a id='4215' tid='4216', class="move" title="(similarity 100%)">arg2</a>, <a id='4217' tid='4218', class="move" title="(similarity 100%)">arg3</a>);
      <span class="deletion" title="deleted">if (redirection-&gt;type() != ExternalReference::BUILTIN_COMPARE_CALL) {
          SetFpResult(result);
      } else {
        int32_t gpreg_pair[2];
        memcpy(&gpreg_pair[0], &result, 2 * sizeof(int32_t));
        set_register(v0, gpreg_pair[0]);
        set_register(v1, gpreg_pair[1]);
      }</span>
    } <a id='4439' tid='4440', class="move" title="(similarity 100%)">else</a> <span class="deletion" title="deleted">if</span> <span class="deletion" title="deleted">(redirection-&gt;type() == ExternalReference::DIRECT_API_CALL)</span> <span class="deletion" title="deleted">{
      // See DirectCEntryStub::GenerateCall for explanation of register usage.
      SimulatorRuntimeDirectApiCall target =
                  reinterpret_cast&lt;SimulatorRuntimeDirectApiCall&gt;(external);
      if (::v8::internal::FLAG_trace_sim) {
        PrintF(&quot;Call to host function at %p args %08x\n&quot;,
               FUNCTION_ADDR(target), arg1);
      }
      v8::Handle&lt;v8::Value&gt; result = target(arg1);
      *(reinterpret_cast&lt;int*&gt;(arg0)) = (int32_t) *result;
      set_register(v0, arg0);
    }</span> <a id='4441' tid='4442', class="move" title="(similarity 100%)">else</a> <span class="deletion" title="deleted">if</span> <span class="deletion" title="deleted">(redirection-&gt;type() == ExternalReference::DIRECT_GETTER_CALL)</span> <span class="deletion" title="deleted">{
      // See DirectCEntryStub::GenerateCall for explanation of register usage.
      SimulatorRuntimeDirectGetterCall target =
                  reinterpret_cast&lt;SimulatorRuntimeDirectGetterCall&gt;(external);
      if (::v8::internal::FLAG_trace_sim) {
        PrintF(&quot;Call to host function at %p args %08x %08x\n&quot;,
               FUNCTION_ADDR(target), arg1, arg2);
      }
      v8::Handle&lt;v8::Value&gt; result = target(arg1, arg2);
      *(reinterpret_cast&lt;int*&gt;(arg0)) = (int32_t) *result;
      set_register(v0, arg0);
    }</span> <span class="deletion" title="deleted">else</span> {
      <span class="deletion" title="deleted">SimulatorRuntimeCall target =
                  reinterpret_cast&lt;SimulatorRuntimeCall&gt;(external);</span>
      <span class="deletion" title="deleted">if (::v8::internal::FLAG_trace_sim) {
        PrintF(
            &quot;Call to host function at %p &quot;
            &quot;args %08x, %08x, %08x, %08x, %08x, %08x\n&quot;,
            FUNCTION_ADDR(target),
            arg0,
            arg1,
            arg2,
            arg3,
            arg4,
            arg5);
      }</span>
      <a id='4443' tid='4444', class="move" title="(similarity 100%)">int64_t</a> <a id='4445' tid='4446', class="move" title="(similarity 100%)">result</a> = <a id='4447' tid='4448', class="move" title="(similarity 100%)">target</a>(<a id='4449' tid='4450', class="move" title="(similarity 100%)">arg0</a>, <a id='4451' tid='4452', class="move" title="(similarity 100%)">arg1</a>, <a id='4453' tid='4454', class="move" title="(similarity 100%)">arg2</a>, <a id='4455' tid='4456', class="move" title="(similarity 100%)">arg3</a>, <a id='4457' tid='4458', class="move" title="(similarity 100%)">arg4</a>, <a id='4459' tid='4460', class="move" title="(similarity 100%)">arg5</a>);
      <span class="deletion" title="deleted">set_register(v0, static_cast&lt;int32_t&gt;(result));</span>
      <span class="deletion" title="deleted">set_register(v1, static_cast&lt;int32_t&gt;(result &gt;&gt; 32));</span>
    }
    <span class="deletion" title="deleted">if (::v8::internal::FLAG_trace_sim) {
      PrintF(&quot;Returned %08x : %08x\n&quot;, get_register(v1), get_register(v0));
    }</span>
    <span class="deletion" title="deleted">set_register(ra, saved_ra);</span>
    <span class="deletion" title="deleted">set_pc(get_register(ra));</span>

  } <span class="deletion" title="deleted">else if (func == BREAK && code &lt;= kMaxStopCode) {
    if (IsWatchpoint(code)) {
      PrintWatchpoint(code);
    } else {
      IncreaseStopCounter(code);
      HandleStop(code, instr);
    }
  } else {
    // All remaining break_ codes, and all traps are handled here.
    MipsDebugger dbg(this);
    dbg.Debug();
  }</span>
}


// Stop helper functions.
<span class="deletion" title="deleted">bool Simulator::IsWatchpoint(uint32_t code) {
  return (code &lt;= kMaxWatchpointCode);
}</span>


<span class="deletion" title="deleted">void Simulator::PrintWatchpoint(uint32_t code) {
  MipsDebugger dbg(this);
  ++break_count_;
  PrintF(&quot;\n---- break %d marker: %3d  (instr count: %8d) ----------&quot;
         &quot;----------------------------------&quot;,
         code, break_count_, icount_);
  dbg.PrintAllRegs();  // Print registers and continue running.
}</span>


<span class="deletion" title="deleted">void Simulator::HandleStop(uint32_t code, Instruction* instr)</span> {
  // Stop if it is enabled, otherwise go on jumping over the stop
  // and the message address.
  <span class="deletion" title="deleted">if</span> <span class="deletion" title="deleted">(IsEnabledStop(code))</span> <span class="deletion" title="deleted">{
    MipsDebugger dbg(this);
    dbg.Stop(instr);
  }</span> <a id='4307' tid='4308', class="move" title="(similarity 100%)">else</a> {
    <a id='4309' tid='4310', class="move" title="(similarity 100%)">set_pc</a>(<a id='4311' tid='4312', class="move" title="(similarity 100%)">get_pc</a>() <a id='4313' tid='4314', class="move" title="(similarity 100%)">+</a> <a id='4315' tid='4316', class="move" title="(similarity 100%)">2</a> <a id='4317' tid='4318', class="move" title="(similarity 100%)">*</a> <a id='4319' tid='4320', class="move" title="(similarity 100%)">Instruction</a><a id='4321' tid='4322', class="move" title="(similarity 100%)">::</a><a id='4323' tid='4324', class="move" title="(similarity 100%)">kInstrSize</a>);
  }
}


<span class="deletion" title="deleted">bool Simulator::IsStopInstruction(Instruction* instr) {
  int32_t func = instr-&gt;FunctionFieldRaw();
  uint32_t code = static_cast&lt;uint32_t&gt;(instr-&gt;Bits(25, 6));
  return (func == BREAK) && code &gt; kMaxWatchpointCode && code &lt;= kMaxStopCode;
}</span>


<span class="deletion" title="deleted">bool Simulator::IsEnabledStop(uint32_t code) {
  ASSERT(code &lt;= kMaxStopCode);
  ASSERT(code &gt; kMaxWatchpointCode);
  return !(watched_stops[code].count & kStopDisabledBit);
}</span>


<span class="deletion" title="deleted">void Simulator::EnableStop(uint32_t code) {
  if (!IsEnabledStop(code)) {
    watched_stops[code].count &= ~kStopDisabledBit;
  }
}</span>


<span class="deletion" title="deleted">void Simulator::DisableStop(uint32_t code) {
  if (IsEnabledStop(code)) {
    watched_stops[code].count |= kStopDisabledBit;
  }
}</span>


<a id='4595' tid='4596', class="move" title="(similarity 100%)">void</a> <a id='4597' tid='4598', class="move" title="(similarity 100%)">Simulator</a><a id='4599' tid='4600', class="move" title="(similarity 100%)">::</a><a id='4601' tid='4602', class="move" title="(similarity 100%)">IncreaseStopCounter</a>(<a id='4603' tid='4604', class="move" title="(similarity 100%)">uint32_t</a> <a id='4605' tid='4606', class="move" title="(similarity 100%)">code</a>) {
  <span class="deletion" title="deleted">ASSERT(code &lt;= kMaxStopCode);</span>
  <a id='4607' tid='4608', class="move" title="(similarity 100%)">if</a> ((<a id='4609' tid='4610', class="move" title="(similarity 100%)">watched_stops</a>[<a id='4611' tid='4612', class="move" title="(similarity 100%)">code</a>].<a id='4613' tid='4614', class="move" title="(similarity 100%)">count</a> <a id='4615' tid='4616', class="move" title="(similarity 100%)">&</a> <a id='4617' tid='4618', class="move" title="(similarity 100%)">~</a>(<a id='4619' tid='4620', class="move" title="(similarity 100%)">1</a> <a id='4621' tid='4622', class="move" title="(similarity 100%)">&lt;&lt;</a> <a id='4623' tid='4624', class="move" title="(similarity 100%)">31</a>)) <a id='4625' tid='4626', class="move" title="(similarity 100%)">==</a> <a id='4627' tid='4628', class="move" title="(similarity 100%)">0x7fffffff</a>) {
    <a id='4629' tid='4630', class="move" title="(similarity 100%)">PrintF</a>(<a id='4631' tid='4632', class="move" title="(similarity 100%)">&quot;Stop counter for code %i has overflowed.\n&quot;</a>
           <a id='4633' tid='4634', class="move" title="(similarity 100%)">&quot;Enabling this code and reseting the counter to 0.\n&quot;</a>, <a id='4635' tid='4636', class="move" title="(similarity 100%)">code</a>);
    <a id='4637' tid='4638', class="move" title="(similarity 100%)">watched_stops</a>[<a id='4639' tid='4640', class="move" title="(similarity 100%)">code</a>].<a id='4641' tid='4642', class="move" title="(similarity 100%)">count</a> <a id='4643' tid='4644', class="move" title="(similarity 100%)">=</a> <a id='4645' tid='4646', class="move" title="(similarity 100%)">0</a>;
    <a id='4647' tid='4648', class="move" title="(similarity 100%)">EnableStop</a>(<a id='4649' tid='4650', class="move" title="(similarity 100%)">code</a>);
  } <a id='4651' tid='4652', class="move" title="(similarity 100%)">else</a> {
    <a id='4653' tid='4654', class="move" title="(similarity 100%)">watched_stops</a>[<a id='4655' tid='4656', class="move" title="(similarity 100%)">code</a>].<a id='4657' tid='4658', class="move" title="(similarity 100%)">count</a><a id='4659' tid='4660', class="move" title="(similarity 100%)">++</a>;
  }
}


// Print a stop status.
<a id='4509' tid='4510', class="move" title="(similarity 100%)">void</a> <a id='4511' tid='4512', class="move" title="(similarity 100%)">Simulator</a><a id='4513' tid='4514', class="move" title="(similarity 100%)">::</a><a id='4515' tid='4516', class="move" title="(similarity 100%)">PrintStopInfo</a>(<a id='4517' tid='4518', class="move" title="(similarity 100%)">uint32_t</a> <a id='4519' tid='4520', class="move" title="(similarity 100%)">code</a>) {
  <span class="deletion" title="deleted">if (code &lt;= kMaxWatchpointCode) {
    PrintF(&quot;That is a watchpoint, not a stop.\n&quot;);
    return;
  } else if (code &gt; kMaxStopCode) {
    PrintF(&quot;Code too large, only %u stops can be used\n&quot;, kMaxStopCode + 1);
    return;
  }</span>
  <span class="deletion" title="deleted">const char* state = IsEnabledStop(code) ? &quot;Enabled&quot; : &quot;Disabled&quot;;</span>
  <a id='4521' tid='4522', class="move" title="(similarity 100%)">int32_t</a> <a id='4523' tid='4524', class="move" title="(similarity 100%)">count</a> = <a id='4525' tid='4526', class="move" title="(similarity 100%)">watched_stops</a>[<a id='4527' tid='4528', class="move" title="(similarity 100%)">code</a>].<a id='4529' tid='4530', class="move" title="(similarity 100%)">count</a> <a id='4531' tid='4532', class="move" title="(similarity 100%)">&</a> <a id='4533' tid='4534', class="move" title="(similarity 100%)">~</a><a id='4535' tid='4536', class="move" title="(similarity 100%)">kStopDisabledBit</a>;
  // Don&#39;t print the state of unused breakpoints.
  <a id='4461' tid='4462', class="move" title="(similarity 100%)">if</a> (<a id='4463' tid='4464', class="move" title="(similarity 100%)">count</a> <a id='4465' tid='4466', class="move" title="(similarity 100%)">!=</a> <a id='4467' tid='4468', class="move" title="(similarity 100%)">0</a>) {
    <a id='4469' tid='4470', class="move" title="(similarity 100%)">if</a> (<a id='4471' tid='4472', class="move" title="(similarity 100%)">watched_stops</a>[<a id='4473' tid='4474', class="move" title="(similarity 100%)">code</a>].<a id='4475' tid='4476', class="move" title="(similarity 100%)">desc</a>) {
      <a id='4477' tid='4478', class="move" title="(similarity 100%)">PrintF</a>(<a id='4479' tid='4480', class="move" title="(similarity 100%)">&quot;stop %i - 0x%x: \t%s, \tcounter = %i, \t%s\n&quot;</a>,
             <a id='4481' tid='4482', class="move" title="(similarity 100%)">code</a>, <a id='4483' tid='4484', class="move" title="(similarity 100%)">code</a>, <a id='4485' tid='4486', class="move" title="(similarity 100%)">state</a>, <a id='4487' tid='4488', class="move" title="(similarity 100%)">count</a>, <a id='4489' tid='4490', class="move" title="(similarity 100%)">watched_stops</a>[<a id='4491' tid='4492', class="move" title="(similarity 100%)">code</a>].<a id='4493' tid='4494', class="move" title="(similarity 100%)">desc</a>);
    } <a id='4495' tid='4496', class="move" title="(similarity 100%)">else</a> {
      <a id='4497' tid='4498', class="move" title="(similarity 100%)">PrintF</a>(<a id='4499' tid='4500', class="move" title="(similarity 100%)">&quot;stop %i - 0x%x: \t%s, \tcounter = %i\n&quot;</a>,
             <a id='4501' tid='4502', class="move" title="(similarity 100%)">code</a>, <a id='4503' tid='4504', class="move" title="(similarity 100%)">code</a>, <a id='4505' tid='4506', class="move" title="(similarity 100%)">state</a>, <a id='4507' tid='4508', class="move" title="(similarity 100%)">count</a>);
    }
  }
}


<span class="deletion" title="deleted">void Simulator::SignalExceptions() {
  for (int i = 1; i &lt; kNumExceptions; i++) {
    if (exceptions[i] != 0) {
      V8_Fatal(__FILE__, __LINE__, &quot;Error: Exception %i raised.&quot;, i);
    }
  }
}</span>


// Handle execution based on instruction types.

<span class="deletion" title="deleted">void Simulator::ConfigureTypeRegister(Instruction* instr,
                                      int32_t& alu_out,
                                      int64_t& i64hilo,
                                      uint64_t& u64hilo,
                                      int32_t& next_pc,
                                      bool& do_interrupt) {
  // Every local variable declared here needs to be const.
  // This is to make sure that changed values are sent back to
  // DecodeTypeRegister correctly.

  // Instruction fields.
  const Opcode   op     = instr-&gt;OpcodeFieldRaw();
  const int32_t  rs_reg = instr-&gt;RsValue();
  const int32_t  rs     = get_register(rs_reg);
  const uint32_t rs_u   = static_cast&lt;uint32_t&gt;(rs);
  const int32_t  rt_reg = instr-&gt;RtValue();
  const int32_t  rt     = get_register(rt_reg);
  const uint32_t rt_u   = static_cast&lt;uint32_t&gt;(rt);
  const int32_t  rd_reg = instr-&gt;RdValue();
  const uint32_t sa     = instr-&gt;SaValue();

  const int32_t  fs_reg = instr-&gt;FsValue();


  // ---------- Configuration.
  switch (op) {
    case COP1:    // Coprocessor instructions.
      switch (instr-&gt;RsFieldRaw()) {
        case BC1:   // Handled in DecodeTypeImmed, should never come here.
          UNREACHABLE();
          break;
        case CFC1:
          // At the moment only FCSR is supported.
          ASSERT(fs_reg == kFCSRRegister);
          alu_out = FCSR_;
          break;
        case MFC1:
          alu_out = get_fpu_register(fs_reg);
          break;
        case MFHC1:
          UNIMPLEMENTED_MIPS();
          break;
        case CTC1:
        case MTC1:
        case MTHC1:
          // Do the store in the execution step.
          break;
        case S:
        case D:
        case W:
        case L:
        case PS:
          // Do everything in the execution step.
          break;
        default:
          UNIMPLEMENTED_MIPS();
      };
      break;
    case SPECIAL:
      switch (instr-&gt;FunctionFieldRaw()) {
        case JR:
        case JALR:
          next_pc = get_register(instr-&gt;RsValue());
          break;
        case SLL:
          alu_out = rt &lt;&lt; sa;
          break;
        case SRL:
          if (rs_reg == 0) {
            // Regular logical right shift of a word by a fixed number of
            // bits instruction. RS field is always equal to 0.
            alu_out = rt_u &gt;&gt; sa;
          } else {
            // Logical right-rotate of a word by a fixed number of bits. This
            // is special case of SRL instruction, added in MIPS32 Release 2.
            // RS field is equal to 00001.
            alu_out = (rt_u &gt;&gt; sa) | (rt_u &lt;&lt; (32 - sa));
          }
          break;
        case SRA:
          alu_out = rt &gt;&gt; sa;
          break;
        case SLLV:
          alu_out = rt &lt;&lt; rs;
          break;
        case SRLV:
          if (sa == 0) {
            // Regular logical right-shift of a word by a variable number of
            // bits instruction. SA field is always equal to 0.
            alu_out = rt_u &gt;&gt; rs;
          } else {
            // Logical right-rotate of a word by a variable number of bits.
            // This is special case od SRLV instruction, added in MIPS32
            // Release 2. SA field is equal to 00001.
            alu_out = (rt_u &gt;&gt; rs_u) | (rt_u &lt;&lt; (32 - rs_u));
          }
          break;
        case SRAV:
          alu_out = rt &gt;&gt; rs;
          break;
        case MFHI:
          alu_out = get_register(HI);
          break;
        case MFLO:
          alu_out = get_register(LO);
          break;
        case MULT:
          i64hilo = static_cast&lt;int64_t&gt;(rs) * static_cast&lt;int64_t&gt;(rt);
          break;
        case MULTU:
          u64hilo = static_cast&lt;uint64_t&gt;(rs_u) * static_cast&lt;uint64_t&gt;(rt_u);
          break;
        case ADD:
          if (HaveSameSign(rs, rt)) {
            if (rs &gt; 0) {
              exceptions[kIntegerOverflow] = rs &gt; (Registers::kMaxValue - rt);
            } else if (rs &lt; 0) {
              exceptions[kIntegerUnderflow] = rs &lt; (Registers::kMinValue - rt);
            }
          }
          alu_out = rs + rt;
          break;
        case ADDU:
          alu_out = rs + rt;
          break;
        case SUB:
          if (!HaveSameSign(rs, rt)) {
            if (rs &gt; 0) {
              exceptions[kIntegerOverflow] = rs &gt; (Registers::kMaxValue + rt);
            } else if (rs &lt; 0) {
              exceptions[kIntegerUnderflow] = rs &lt; (Registers::kMinValue + rt);
            }
          }
          alu_out = rs - rt;
          break;
        case SUBU:
          alu_out = rs - rt;
          break;
        case AND:
          alu_out = rs & rt;
          break;
        case OR:
          alu_out = rs | rt;
          break;
        case XOR:
          alu_out = rs ^ rt;
          break;
        case NOR:
          alu_out = ~(rs | rt);
          break;
        case SLT:
          alu_out = rs &lt; rt ? 1 : 0;
          break;
        case SLTU:
          alu_out = rs_u &lt; rt_u ? 1 : 0;
          break;
        // Break and trap instructions.
        case BREAK:

          do_interrupt = true;
          break;
        case TGE:
          do_interrupt = rs &gt;= rt;
          break;
        case TGEU:
          do_interrupt = rs_u &gt;= rt_u;
          break;
        case TLT:
          do_interrupt = rs &lt; rt;
          break;
        case TLTU:
          do_interrupt = rs_u &lt; rt_u;
          break;
        case TEQ:
          do_interrupt = rs == rt;
          break;
        case TNE:
          do_interrupt = rs != rt;
          break;
        case MOVN:
        case MOVZ:
        case MOVCI:
          // No action taken on decode.
          break;
        case DIV:
        case DIVU:
          // div and divu never raise exceptions.
          break;
        default:
          UNREACHABLE();
      };
      break;
    case SPECIAL2:
      switch (instr-&gt;FunctionFieldRaw()) {
        case MUL:
          alu_out = rs_u * rt_u;  // Only the lower 32 bits are kept.
          break;
        case CLZ:
          alu_out = __builtin_clz(rs_u);
          break;
        default:
          UNREACHABLE();
      };
      break;
    case SPECIAL3:
      switch (instr-&gt;FunctionFieldRaw()) {
        case INS: {   // Mips32r2 instruction.
          // Interpret rd field as 5-bit msb of insert.
          uint16_t msb = rd_reg;
          // Interpret sa field as 5-bit lsb of insert.
          uint16_t lsb = sa;
          uint16_t size = msb - lsb + 1;
          uint32_t mask = (1 &lt;&lt; size) - 1;
          alu_out = (rt_u & ~(mask &lt;&lt; lsb)) | ((rs_u & mask) &lt;&lt; lsb);
          break;
        }
        case EXT: {   // Mips32r2 instruction.
          // Interpret rd field as 5-bit msb of extract.
          uint16_t msb = rd_reg;
          // Interpret sa field as 5-bit lsb of extract.
          uint16_t lsb = sa;
          uint16_t size = msb + 1;
          uint32_t mask = (1 &lt;&lt; size) - 1;
          alu_out = (rs_u & (mask &lt;&lt; lsb)) &gt;&gt; lsb;
          break;
        }
        default:
          UNREACHABLE();
      };
      break;
    default:
      UNREACHABLE();
  };
}</span>


<span class="deletion" title="deleted">void Simulator::DecodeTypeRegister(Instruction* instr) {
  // Instruction fields.
  const Opcode   op     = instr-&gt;OpcodeFieldRaw();
  const int32_t  rs_reg = instr-&gt;RsValue();
  const int32_t  rs     = get_register(rs_reg);
  const uint32_t rs_u   = static_cast&lt;uint32_t&gt;(rs);
  const int32_t  rt_reg = instr-&gt;RtValue();
  const int32_t  rt     = get_register(rt_reg);
  const uint32_t rt_u   = static_cast&lt;uint32_t&gt;(rt);
  const int32_t  rd_reg = instr-&gt;RdValue();

  const int32_t  fs_reg = instr-&gt;FsValue();
  const int32_t  ft_reg = instr-&gt;FtValue();
  const int32_t  fd_reg = instr-&gt;FdValue();
  int64_t  i64hilo = 0;
  uint64_t u64hilo = 0;

  // ALU output.
  // It should not be used as is. Instructions using it should always
  // initialize it first.
  int32_t alu_out = 0x12345678;

  // For break and trap instructions.
  bool do_interrupt = false;

  // For jr and jalr.
  // Get current pc.
  int32_t current_pc = get_pc();
  // Next pc
  int32_t next_pc = 0;

  // Setup the variables if needed before executing the instruction.
  ConfigureTypeRegister(instr,
                        alu_out,
                        i64hilo,
                        u64hilo,
                        next_pc,
                        do_interrupt);

  // ---------- Raise exceptions triggered.
  SignalExceptions();

  // ---------- Execution.
  switch (op) {
    case COP1:
      switch (instr-&gt;RsFieldRaw()) {
        case BC1:   // Branch on coprocessor condition.
          UNREACHABLE();
          break;
        case CFC1:
          set_register(rt_reg, alu_out);
        case MFC1:
          set_register(rt_reg, alu_out);
          break;
        case MFHC1:
          UNIMPLEMENTED_MIPS();
          break;
        case CTC1:
          // At the moment only FCSR is supported.
          ASSERT(fs_reg == kFCSRRegister);
          FCSR_ = registers_[rt_reg];
          break;
        case MTC1:
          FPUregisters_[fs_reg] = registers_[rt_reg];
          break;
        case MTHC1:
          UNIMPLEMENTED_MIPS();
          break;
        case S:
          float f;
          switch (instr-&gt;FunctionFieldRaw()) {
            case CVT_D_S:
              f = get_fpu_register_float(fs_reg);
              set_fpu_register_double(fd_reg, static_cast&lt;double&gt;(f));
              break;
            case CVT_W_S:
            case CVT_L_S:
            case TRUNC_W_S:
            case TRUNC_L_S:
            case ROUND_W_S:
            case ROUND_L_S:
            case FLOOR_W_S:
            case FLOOR_L_S:
            case CEIL_W_S:
            case CEIL_L_S:
            case CVT_PS_S:
              UNIMPLEMENTED_MIPS();
              break;
            default:
              UNREACHABLE();
          }
          break;
        case D:
          double ft, fs;
          uint32_t cc, fcsr_cc;
          int64_t  i64;
          fs = get_fpu_register_double(fs_reg);
          ft = get_fpu_register_double(ft_reg);
          cc = instr-&gt;FCccValue();
          fcsr_cc = get_fcsr_condition_bit(cc);
          switch (instr-&gt;FunctionFieldRaw()) {
            case ADD_D:
              set_fpu_register_double(fd_reg, fs + ft);
              break;
            case SUB_D:
              set_fpu_register_double(fd_reg, fs - ft);
              break;
            case MUL_D:
              set_fpu_register_double(fd_reg, fs * ft);
              break;
            case DIV_D:
              set_fpu_register_double(fd_reg, fs / ft);
              break;
            case ABS_D:
              set_fpu_register_double(fd_reg, fs &lt; 0 ? -fs : fs);
              break;
            case MOV_D:
              set_fpu_register_double(fd_reg, fs);
              break;
            case NEG_D:
              set_fpu_register_double(fd_reg, -fs);
              break;
            case SQRT_D:
              set_fpu_register_double(fd_reg, sqrt(fs));
              break;
            case C_UN_D:
              set_fcsr_bit(fcsr_cc, isnan(fs) || isnan(ft));
              break;
            case C_EQ_D:
              set_fcsr_bit(fcsr_cc, (fs == ft));
              break;
            case C_UEQ_D:
              set_fcsr_bit(fcsr_cc, (fs == ft) || (isnan(fs) || isnan(ft)));
              break;
            case C_OLT_D:
              set_fcsr_bit(fcsr_cc, (fs &lt; ft));
              break;
            case C_ULT_D:
              set_fcsr_bit(fcsr_cc, (fs &lt; ft) || (isnan(fs) || isnan(ft)));
              break;
            case C_OLE_D:
              set_fcsr_bit(fcsr_cc, (fs &lt;= ft));
              break;
            case C_ULE_D:
              set_fcsr_bit(fcsr_cc, (fs &lt;= ft) || (isnan(fs) || isnan(ft)));
              break;
            case CVT_W_D:   // Convert double to word.
              // Rounding modes are not yet supported.
              ASSERT((FCSR_ & 3) == 0);
              // In rounding mode 0 it should behave like ROUND.
            case ROUND_W_D:  // Round double to word.
              {
                double rounded = fs &gt; 0 ? floor(fs + 0.5) : ceil(fs - 0.5);
                int32_t result = static_cast&lt;int32_t&gt;(rounded);
                set_fpu_register(fd_reg, result);
                if (set_fcsr_round_error(fs, rounded)) {
                  set_fpu_register(fd_reg, kFPUInvalidResult);
                }
              }
              break;
            case TRUNC_W_D:  // Truncate double to word (round towards 0).
              {
                double rounded = trunc(fs);
                int32_t result = static_cast&lt;int32_t&gt;(rounded);
                set_fpu_register(fd_reg, result);
                if (set_fcsr_round_error(fs, rounded)) {
                  set_fpu_register(fd_reg, kFPUInvalidResult);
                }
              }
              break;
            case FLOOR_W_D:  // Round double to word towards negative infinity.
              {
                double rounded = floor(fs);
                int32_t result = static_cast&lt;int32_t&gt;(rounded);
                set_fpu_register(fd_reg, result);
                if (set_fcsr_round_error(fs, rounded)) {
                  set_fpu_register(fd_reg, kFPUInvalidResult);
                }
              }
              break;
            case CEIL_W_D:  // Round double to word towards positive infinity.
              {
                double rounded = ceil(fs);
                int32_t result = static_cast&lt;int32_t&gt;(rounded);
                set_fpu_register(fd_reg, result);
                if (set_fcsr_round_error(fs, rounded)) {
                  set_fpu_register(fd_reg, kFPUInvalidResult);
                }
              }
              break;
            case CVT_S_D:  // Convert double to float (single).
              set_fpu_register_float(fd_reg, static_cast&lt;float&gt;(fs));
              break;
            case CVT_L_D: {  // Mips32r2: Truncate double to 64-bit long-word.
              double rounded = trunc(fs);
              i64 = static_cast&lt;int64_t&gt;(rounded);
              set_fpu_register(fd_reg, i64 & 0xffffffff);
              set_fpu_register(fd_reg + 1, i64 &gt;&gt; 32);
              break;
            }
            case TRUNC_L_D: {  // Mips32r2 instruction.
              double rounded = trunc(fs);
              i64 = static_cast&lt;int64_t&gt;(rounded);
              set_fpu_register(fd_reg, i64 & 0xffffffff);
              set_fpu_register(fd_reg + 1, i64 &gt;&gt; 32);
              break;
            }
            case ROUND_L_D: {  // Mips32r2 instruction.
              double rounded = fs &gt; 0 ? floor(fs + 0.5) : ceil(fs - 0.5);
              i64 = static_cast&lt;int64_t&gt;(rounded);
              set_fpu_register(fd_reg, i64 & 0xffffffff);
              set_fpu_register(fd_reg + 1, i64 &gt;&gt; 32);
              break;
            }
            case FLOOR_L_D:  // Mips32r2 instruction.
              i64 = static_cast&lt;int64_t&gt;(floor(fs));
              set_fpu_register(fd_reg, i64 & 0xffffffff);
              set_fpu_register(fd_reg + 1, i64 &gt;&gt; 32);
              break;
            case CEIL_L_D:  // Mips32r2 instruction.
              i64 = static_cast&lt;int64_t&gt;(ceil(fs));
              set_fpu_register(fd_reg, i64 & 0xffffffff);
              set_fpu_register(fd_reg + 1, i64 &gt;&gt; 32);
              break;
            case C_F_D:
              UNIMPLEMENTED_MIPS();
              break;
            default:
              UNREACHABLE();
          }
          break;
        case W:
          switch (instr-&gt;FunctionFieldRaw()) {
            case CVT_S_W:   // Convert word to float (single).
              alu_out = get_fpu_register(fs_reg);
              set_fpu_register_float(fd_reg, static_cast&lt;float&gt;(alu_out));
              break;
            case CVT_D_W:   // Convert word to double.
              alu_out = get_fpu_register(fs_reg);
              set_fpu_register_double(fd_reg, static_cast&lt;double&gt;(alu_out));
              break;
            default:
              UNREACHABLE();
          };
          break;
        case L:
          switch (instr-&gt;FunctionFieldRaw()) {
          case CVT_D_L:  // Mips32r2 instruction.
            // Watch the signs here, we want 2 32-bit vals
            // to make a sign-64.
            i64 = (uint32_t) get_fpu_register(fs_reg);
            i64 |= ((int64_t) get_fpu_register(fs_reg + 1) &lt;&lt; 32);
            set_fpu_register_double(fd_reg, static_cast&lt;double&gt;(i64));
            break;
            case CVT_S_L:
              UNIMPLEMENTED_MIPS();
              break;
            default:
              UNREACHABLE();
          }
          break;
        case PS:
          break;
        default:
          UNREACHABLE();
      };
      break;
    case SPECIAL:
      switch (instr-&gt;FunctionFieldRaw()) {
        case JR: {
          Instruction* branch_delay_instr = reinterpret_cast&lt;Instruction*&gt;(
              current_pc+Instruction::kInstrSize);
          BranchDelayInstructionDecode(branch_delay_instr);
          set_pc(next_pc);
          pc_modified_ = true;
          break;
        }
        case JALR: {
          Instruction* branch_delay_instr = reinterpret_cast&lt;Instruction*&gt;(
              current_pc+Instruction::kInstrSize);
          BranchDelayInstructionDecode(branch_delay_instr);
          set_register(31, current_pc + 2 * Instruction::kInstrSize);
          set_pc(next_pc);
          pc_modified_ = true;
          break;
        }
        // Instructions using HI and LO registers.
        case MULT:
          set_register(LO, static_cast&lt;int32_t&gt;(i64hilo & 0xffffffff));
          set_register(HI, static_cast&lt;int32_t&gt;(i64hilo &gt;&gt; 32));
          break;
        case MULTU:
          set_register(LO, static_cast&lt;int32_t&gt;(u64hilo & 0xffffffff));
          set_register(HI, static_cast&lt;int32_t&gt;(u64hilo &gt;&gt; 32));
          break;
        case DIV:
          // Divide by zero was not checked in the configuration step - div and
          // divu do not raise exceptions. On division by 0, the result will
          // be UNPREDICTABLE.
          if (rt != 0) {
            set_register(LO, rs / rt);
            set_register(HI, rs % rt);
          }
          break;
        case DIVU:
          if (rt_u != 0) {
            set_register(LO, rs_u / rt_u);
            set_register(HI, rs_u % rt_u);
          }
          break;
        // Break and trap instructions.
        case BREAK:
        case TGE:
        case TGEU:
        case TLT:
        case TLTU:
        case TEQ:
        case TNE:
          if (do_interrupt) {
            SoftwareInterrupt(instr);
          }
          break;
        // Conditional moves.
        case MOVN:
          if (rt) set_register(rd_reg, rs);
          break;
        case MOVCI: {
          uint32_t cc = instr-&gt;FBccValue();
          uint32_t fcsr_cc = get_fcsr_condition_bit(cc);
          if (instr-&gt;Bit(16)) {  // Read Tf bit.
            if (test_fcsr_bit(fcsr_cc)) set_register(rd_reg, rs);
          } else {
            if (!test_fcsr_bit(fcsr_cc)) set_register(rd_reg, rs);
          }
          break;
        }
        case MOVZ:
          if (!rt) set_register(rd_reg, rs);
          break;
        default:  // For other special opcodes we do the default operation.
          set_register(rd_reg, alu_out);
      };
      break;
    case SPECIAL2:
      switch (instr-&gt;FunctionFieldRaw()) {
        case MUL:
          set_register(rd_reg, alu_out);
          // HI and LO are UNPREDICTABLE after the operation.
          set_register(LO, Unpredictable);
          set_register(HI, Unpredictable);
          break;
        default:  // For other special2 opcodes we do the default operation.
          set_register(rd_reg, alu_out);
      }
      break;
    case SPECIAL3:
      switch (instr-&gt;FunctionFieldRaw()) {
        case INS:
          // Ins instr leaves result in Rt, rather than Rd.
          set_register(rt_reg, alu_out);
          break;
        case EXT:
          // Ext instr leaves result in Rt, rather than Rd.
          set_register(rt_reg, alu_out);
          break;
        default:
          UNREACHABLE();
      };
      break;
    // Unimplemented opcodes raised an error in the configuration step before,
    // so we can use the default here to set the destination register in common
    // cases.
    default:
      set_register(rd_reg, alu_out);
  };
}</span>


// Type 2: instructions using a 16 bytes immediate. (eg: addi, beq).
<span class="deletion" title="deleted">void Simulator::DecodeTypeImmediate(Instruction* instr) {
  // Instruction fields.
  Opcode   op     = instr-&gt;OpcodeFieldRaw();
  int32_t  rs     = get_register(instr-&gt;RsValue());
  uint32_t rs_u   = static_cast&lt;uint32_t&gt;(rs);
  int32_t  rt_reg = instr-&gt;RtValue();  // Destination register.
  int32_t  rt     = get_register(rt_reg);
  int16_t  imm16  = instr-&gt;Imm16Value();

  int32_t  ft_reg = instr-&gt;FtValue();  // Destination register.

  // Zero extended immediate.
  uint32_t  oe_imm16 = 0xffff & imm16;
  // Sign extended immediate.
  int32_t   se_imm16 = imm16;

  // Get current pc.
  int32_t current_pc = get_pc();
  // Next pc.
  int32_t next_pc = bad_ra;

  // Used for conditional branch instructions.
  bool do_branch = false;
  bool execute_branch_delay_instruction = false;

  // Used for arithmetic instructions.
  int32_t alu_out = 0;
  // Floating point.
  double fp_out = 0.0;
  uint32_t cc, cc_value, fcsr_cc;

  // Used for memory instructions.
  int32_t addr = 0x0;
  // Value to be written in memory.
  uint32_t mem_value = 0x0;

  // ---------- Configuration (and execution for REGIMM).
  switch (op) {
    // ------------- COP1. Coprocessor instructions.
    case COP1:
      switch (instr-&gt;RsFieldRaw()) {
        case BC1:   // Branch on coprocessor condition.
          cc = instr-&gt;FBccValue();
          fcsr_cc = get_fcsr_condition_bit(cc);
          cc_value = test_fcsr_bit(fcsr_cc);
          do_branch = (instr-&gt;FBtrueValue()) ? cc_value : !cc_value;
          execute_branch_delay_instruction = true;
          // Set next_pc.
          if (do_branch) {
            next_pc = current_pc + (imm16 &lt;&lt; 2) + Instruction::kInstrSize;
          } else {
            next_pc = current_pc + kBranchReturnOffset;
          }
          break;
        default:
          UNREACHABLE();
      };
      break;
    // ------------- REGIMM class.
    case REGIMM:
      switch (instr-&gt;RtFieldRaw()) {
        case BLTZ:
          do_branch = (rs  &lt; 0);
          break;
        case BLTZAL:
          do_branch = rs  &lt; 0;
          break;
        case BGEZ:
          do_branch = rs &gt;= 0;
          break;
        case BGEZAL:
          do_branch = rs &gt;= 0;
          break;
        default:
          UNREACHABLE();
      };
      switch (instr-&gt;RtFieldRaw()) {
        case BLTZ:
        case BLTZAL:
        case BGEZ:
        case BGEZAL:
          // Branch instructions common part.
          execute_branch_delay_instruction = true;
          // Set next_pc.
          if (do_branch) {
            next_pc = current_pc + (imm16 &lt;&lt; 2) + Instruction::kInstrSize;
            if (instr-&gt;IsLinkingInstruction()) {
              set_register(31, current_pc + kBranchReturnOffset);
            }
          } else {
            next_pc = current_pc + kBranchReturnOffset;
          }
        default:
          break;
        };
    break;  // case REGIMM.
    // ------------- Branch instructions.
    // When comparing to zero, the encoding of rt field is always 0, so we don&#39;t
    // need to replace rt with zero.
    case BEQ:
      do_branch = (rs == rt);
      break;
    case BNE:
      do_branch = rs != rt;
      break;
    case BLEZ:
      do_branch = rs &lt;= 0;
      break;
    case BGTZ:
      do_branch = rs  &gt; 0;
      break;
    // ------------- Arithmetic instructions.
    case ADDI:
      if (HaveSameSign(rs, se_imm16)) {
        if (rs &gt; 0) {
          exceptions[kIntegerOverflow] = rs &gt; (Registers::kMaxValue - se_imm16);
        } else if (rs &lt; 0) {
          exceptions[kIntegerUnderflow] =
              rs &lt; (Registers::kMinValue - se_imm16);
        }
      }
      alu_out = rs + se_imm16;
      break;
    case ADDIU:
      alu_out = rs + se_imm16;
      break;
    case SLTI:
      alu_out = (rs &lt; se_imm16) ? 1 : 0;
      break;
    case SLTIU:
      alu_out = (rs_u &lt; static_cast&lt;uint32_t&gt;(se_imm16)) ? 1 : 0;
      break;
    case ANDI:
        alu_out = rs & oe_imm16;
      break;
    case ORI:
        alu_out = rs | oe_imm16;
      break;
    case XORI:
        alu_out = rs ^ oe_imm16;
      break;
    case LUI:
        alu_out = (oe_imm16 &lt;&lt; 16);
      break;
    // ------------- Memory instructions.
    case LB:
      addr = rs + se_imm16;
      alu_out = ReadB(addr);
      break;
    case LH:
      addr = rs + se_imm16;
      alu_out = ReadH(addr, instr);
      break;
    case LWL: {
      // al_offset is offset of the effective address within an aligned word.
      uint8_t al_offset = (rs + se_imm16) & kPointerAlignmentMask;
      uint8_t byte_shift = kPointerAlignmentMask - al_offset;
      uint32_t mask = (1 &lt;&lt; byte_shift * 8) - 1;
      addr = rs + se_imm16 - al_offset;
      alu_out = ReadW(addr, instr);
      alu_out &lt;&lt;= byte_shift * 8;
      alu_out |= rt & mask;
      break;
    }
    case LW:
      addr = rs + se_imm16;
      alu_out = ReadW(addr, instr);
      break;
    case LBU:
      addr = rs + se_imm16;
      alu_out = ReadBU(addr);
      break;
    case LHU:
      addr = rs + se_imm16;
      alu_out = ReadHU(addr, instr);
      break;
    case LWR: {
      // al_offset is offset of the effective address within an aligned word.
      uint8_t al_offset = (rs + se_imm16) & kPointerAlignmentMask;
      uint8_t byte_shift = kPointerAlignmentMask - al_offset;
      uint32_t mask = al_offset ? (~0 &lt;&lt; (byte_shift + 1) * 8) : 0;
      addr = rs + se_imm16 - al_offset;
      alu_out = ReadW(addr, instr);
      alu_out = static_cast&lt;uint32_t&gt; (alu_out) &gt;&gt; al_offset * 8;
      alu_out |= rt & mask;
      break;
    }
    case SB:
      addr = rs + se_imm16;
      break;
    case SH:
      addr = rs + se_imm16;
      break;
    case SWL: {
      uint8_t al_offset = (rs + se_imm16) & kPointerAlignmentMask;
      uint8_t byte_shift = kPointerAlignmentMask - al_offset;
      uint32_t mask = byte_shift ? (~0 &lt;&lt; (al_offset + 1) * 8) : 0;
      addr = rs + se_imm16 - al_offset;
      mem_value = ReadW(addr, instr) & mask;
      mem_value |= static_cast&lt;uint32_t&gt;(rt) &gt;&gt; byte_shift * 8;
      break;
    }
    case SW:
      addr = rs + se_imm16;
      break;
    case SWR: {
      uint8_t al_offset = (rs + se_imm16) & kPointerAlignmentMask;
      uint32_t mask = (1 &lt;&lt; al_offset * 8) - 1;
      addr = rs + se_imm16 - al_offset;
      mem_value = ReadW(addr, instr);
      mem_value = (rt &lt;&lt; al_offset * 8) | (mem_value & mask);
      break;
    }
    case LWC1:
      addr = rs + se_imm16;
      alu_out = ReadW(addr, instr);
      break;
    case LDC1:
      addr = rs + se_imm16;
      fp_out = ReadD(addr, instr);
      break;
    case SWC1:
    case SDC1:
      addr = rs + se_imm16;
      break;
    default:
      UNREACHABLE();
  };

  // ---------- Raise exceptions triggered.
  SignalExceptions();

  // ---------- Execution.
  switch (op) {
    // ------------- Branch instructions.
    case BEQ:
    case BNE:
    case BLEZ:
    case BGTZ:
      // Branch instructions common part.
      execute_branch_delay_instruction = true;
      // Set next_pc.
      if (do_branch) {
        next_pc = current_pc + (imm16 &lt;&lt; 2) + Instruction::kInstrSize;
        if (instr-&gt;IsLinkingInstruction()) {
          set_register(31, current_pc + 2* Instruction::kInstrSize);
        }
      } else {
        next_pc = current_pc + 2 * Instruction::kInstrSize;
      }
      break;
    // ------------- Arithmetic instructions.
    case ADDI:
    case ADDIU:
    case SLTI:
    case SLTIU:
    case ANDI:
    case ORI:
    case XORI:
    case LUI:
      set_register(rt_reg, alu_out);
      break;
    // ------------- Memory instructions.
    case LB:
    case LH:
    case LWL:
    case LW:
    case LBU:
    case LHU:
    case LWR:
      set_register(rt_reg, alu_out);
      break;
    case SB:
      WriteB(addr, static_cast&lt;int8_t&gt;(rt));
      break;
    case SH:
      WriteH(addr, static_cast&lt;uint16_t&gt;(rt), instr);
      break;
    case SWL:
      WriteW(addr, mem_value, instr);
      break;
    case SW:
      WriteW(addr, rt, instr);
      break;
    case SWR:
      WriteW(addr, mem_value, instr);
      break;
    case LWC1:
      set_fpu_register(ft_reg, alu_out);
      break;
    case LDC1:
      set_fpu_register_double(ft_reg, fp_out);
      break;
    case SWC1:
      addr = rs + se_imm16;
      WriteW(addr, get_fpu_register(ft_reg), instr);
      break;
    case SDC1:
      addr = rs + se_imm16;
      WriteD(addr, get_fpu_register_double(ft_reg), instr);
      break;
    default:
      break;
  };


  if (execute_branch_delay_instruction) {
    // Execute branch delay slot
    // We don&#39;t check for end_sim_pc. First it should not be met as the current
    // pc is valid. Secondly a jump should always execute its branch delay slot.
    Instruction* branch_delay_instr =
      reinterpret_cast&lt;Instruction*&gt;(current_pc+Instruction::kInstrSize);
    BranchDelayInstructionDecode(branch_delay_instr);
  }

  // If needed update pc after the branch delay execution.
  if (next_pc != bad_ra) {
    set_pc(next_pc);
  }
}</span>


// Type 3: instructions using a 26 bytes immediate. (eg: j, jal).
<span class="deletion" title="deleted">void Simulator::DecodeTypeJump(Instruction* instr) {
  // Get current pc.
  int32_t current_pc = get_pc();
  // Get unchanged bits of pc.
  int32_t pc_high_bits = current_pc & 0xf0000000;
  // Next pc.
  int32_t next_pc = pc_high_bits | (instr-&gt;Imm26Value() &lt;&lt; 2);

  // Execute branch delay slot.
  // We don&#39;t check for end_sim_pc. First it should not be met as the current pc
  // is valid. Secondly a jump should always execute its branch delay slot.
  Instruction* branch_delay_instr =
      reinterpret_cast&lt;Instruction*&gt;(current_pc + Instruction::kInstrSize);
  BranchDelayInstructionDecode(branch_delay_instr);

  // Update pc and ra if necessary.
  // Do this after the branch delay execution.
  if (instr-&gt;IsLinkingInstruction()) {
    set_register(31, current_pc + 2 * Instruction::kInstrSize);
  }
  set_pc(next_pc);
  pc_modified_ = true;
}</span>


// Executes the current instruction.
<a id='3991' tid='3992', class="move" title="(similarity 100%)">void</a> <a id='3993' tid='3994', class="move" title="(similarity 100%)">Simulator</a><a id='3995' tid='3996', class="move" title="(similarity 100%)">::</a><a id='3997' tid='3998', class="move" title="(similarity 100%)">InstructionDecode</a>(<a id='3999' tid='4000', class="move" title="(similarity 100%)">Instruction</a><a id='4001' tid='4002', class="move" title="(similarity 100%)">*</a> <a id='4003' tid='4004', class="move" title="(similarity 100%)">instr</a>) {
  <a id='4029' tid='4030', class="move" title="(similarity 100%)">if</a> (<a id='4031' tid='4032', class="move" title="(similarity 100%)">v8</a><a id='4033' tid='4034', class="move" title="(similarity 100%)">::</a><a id='4035' tid='4036', class="move" title="(similarity 100%)">internal</a><a id='4037' tid='4038', class="move" title="(similarity 100%)">::</a><a id='4039' tid='4040', class="move" title="(similarity 100%)">FLAG_check_icache</a>) {
    <a id='4041' tid='4042', class="move" title="(similarity 100%)">CheckICache</a>(<a id='4043' tid='4044', class="move" title="(similarity 100%)">isolate_</a>-&gt;<a id='4045' tid='4046', class="move" title="(similarity 100%)">simulator_i_cache</a>(), <a id='4047' tid='4048', class="move" title="(similarity 100%)">instr</a>);
  }
  <span class="deletion" title="deleted">pc_modified_ = false;</span>
  <span class="deletion" title="deleted">if</span> <span class="deletion" title="deleted">(::v8::internal::FLAG_trace_sim)</span> {
    <span class="deletion" title="deleted">disasm::NameConverter converter;</span>
    <span class="deletion" title="deleted">disasm::Disassembler dasm(converter)</span>;
    // Use a reasonably large buffer.
    <span class="deletion" title="deleted">v8::internal::EmbeddedVector&lt;char, 256&gt; buffer;</span>
    <a id='3977' tid='3978', class="move" title="(similarity 100%)">dasm</a>.<a id='3979' tid='3980', class="move" title="(similarity 100%)">InstructionDecode</a>(<a id='3981' tid='3982', class="move" title="(similarity 100%)">buffer</a>, <a id='3983' tid='3984', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='3985' tid='3986', class="move" title="(similarity 100%)">byte</a><a id='3987' tid='3988', class="move" title="(similarity 100%)">*</a>&gt;(<a id='3989' tid='3990', class="move" title="(similarity 100%)">instr</a>));
    <a id='3963' tid='3964', class="move" title="(similarity 100%)">PrintF</a>(<a id='3965' tid='3966', class="move" title="(similarity 100%)">&quot;  0x%08x  %s\n&quot;</a>, <a id='3967' tid='3968', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='3969' tid='3970', class="move" title="(similarity 100%)">intptr_t</a>&gt;(<a id='3971' tid='3972', class="move" title="(similarity 100%)">instr</a>),
        <a id='3973' tid='3974', class="move" title="(similarity 100%)">buffer</a>.<a id='3975' tid='3976', class="move" title="(similarity 100%)">start</a>());
  }

  <span class="deletion" title="deleted">switch (instr-&gt;InstructionType()) {
    case Instruction::kRegisterType:
      DecodeTypeRegister(instr);
      break;
    case Instruction::kImmediateType:
      DecodeTypeImmediate(instr);
      break;
    case Instruction::kJumpType:
      DecodeTypeJump(instr);
      break;
    default:
      UNSUPPORTED();
  }</span>
  <a id='4005' tid='4006', class="move" title="(similarity 100%)">if</a> (<a id='4007' tid='4008', class="move" title="(similarity 100%)">!</a><a id='4009' tid='4010', class="move" title="(similarity 100%)">pc_modified_</a>) {
    <a id='4011' tid='4012', class="move" title="(similarity 100%)">set_register</a>(<a id='4013' tid='4014', class="move" title="(similarity 100%)">pc</a>, <a id='4015' tid='4016', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='4017' tid='4018', class="move" title="(similarity 100%)">int32_t</a>&gt;(<a id='4019' tid='4020', class="move" title="(similarity 100%)">instr</a>) <a id='4021' tid='4022', class="move" title="(similarity 100%)">+</a>
                 <a id='4023' tid='4024', class="move" title="(similarity 100%)">Instruction</a><a id='4025' tid='4026', class="move" title="(similarity 100%)">::</a><a id='4027' tid='4028', class="move" title="(similarity 100%)">kInstrSize</a>);
  }
}



<span class="deletion" title="deleted">void Simulator::Execute() {
  // Get the PC to simulate. Cannot use the accessor here as we need the
  // raw PC value and not the one used as input to arithmetic instructions.
  int program_counter = get_pc();
  if (::v8::internal::FLAG_stop_sim_at == 0) {
    // Fast version of the dispatch loop without checking whether the simulator
    // should be stopping at a particular executed instruction.
    while (program_counter != end_sim_pc) {
      Instruction* instr = reinterpret_cast&lt;Instruction*&gt;(program_counter);
      icount_++;
      InstructionDecode(instr);
      program_counter = get_pc();
    }
  } else {
    // FLAG_stop_sim_at is at the non-default value. Stop in the debugger when
    // we reach the particular instuction count.
    while (program_counter != end_sim_pc) {
      Instruction* instr = reinterpret_cast&lt;Instruction*&gt;(program_counter);
      icount_++;
      if (icount_ == ::v8::internal::FLAG_stop_sim_at) {
        MipsDebugger dbg(this);
        dbg.Debug();
      } else {
        InstructionDecode(instr);
      }
      program_counter = get_pc();
    }
  }
}</span>


<a id='4247' tid='4248', class="move" title="(similarity 100%)">int32_t</a> <a id='4249' tid='4250', class="move" title="(similarity 100%)">Simulator</a><a id='4251' tid='4252', class="move" title="(similarity 100%)">::</a><a id='4253' tid='4254', class="move" title="(similarity 100%)">Call</a>(<a id='4255' tid='4256', class="move" title="(similarity 100%)">byte</a><a id='4257' tid='4258', class="move" title="(similarity 100%)">*</a> <a id='4259' tid='4260', class="move" title="(similarity 100%)">entry</a>, <a id='4261' tid='4262', class="move" title="(similarity 100%)">int</a> <a id='4263' tid='4264', class="move" title="(similarity 100%)">argument_count</a>, <a id='4265' tid='4266', class="move" title="(similarity 100%)">...</a>) {
  <span class="deletion" title="deleted">va_list parameters;</span>
  <span class="deletion" title="deleted">va_start(parameters, argument_count);</span>
  // Setup arguments.

  // First four arguments passed in registers.
  <span class="deletion" title="deleted">ASSERT(argument_count &gt;= 4);</span>
  <span class="deletion" title="deleted">set_register(a0, va_arg(parameters, int32_t));</span>
  <span class="deletion" title="deleted">set_register(a1, va_arg(parameters, int32_t));</span>
  <span class="deletion" title="deleted">set_register(a2, va_arg(parameters, int32_t));</span>
  <span class="deletion" title="deleted">set_register(a3, va_arg(parameters, int32_t));</span>

  // Remaining arguments passed on stack.
  <span class="deletion" title="deleted">int original_stack = get_register(sp);</span>
  // Compute position of stack on entry to generated code.
  <span class="deletion" title="deleted">int entry_stack = (original_stack - (argument_count - 4) * sizeof(int32_t)
                                    - kCArgsSlotsSize);</span>
  <a id='4267' tid='4268', class="move" title="(similarity 100%)">if</a> (<a id='4269' tid='4270', class="move" title="(similarity 100%)">OS</a><a id='4271' tid='4272', class="move" title="(similarity 100%)">::</a><a id='4273' tid='4274', class="move" title="(similarity 100%)">ActivationFrameAlignment</a>() <a id='4275' tid='4276', class="move" title="(similarity 100%)">!=</a> <a id='4277' tid='4278', class="move" title="(similarity 100%)">0</a>) {
    <a id='4279' tid='4280', class="move" title="(similarity 100%)">entry_stack</a> <a id='4281' tid='4282', class="move" title="(similarity 100%)">&=</a> <a id='4283' tid='4284', class="move" title="(similarity 100%)">-</a><a id='4285' tid='4286', class="move" title="(similarity 100%)">OS</a><a id='4287' tid='4288', class="move" title="(similarity 100%)">::</a><a id='4289' tid='4290', class="move" title="(similarity 100%)">ActivationFrameAlignment</a>();
  }
  // Store remaining arguments on stack, from low to high memory.
  <a id='4233' tid='4234', class="move" title="(similarity 100%)">intptr_t</a><a id='4235' tid='4236', class="move" title="(similarity 100%)">*</a> <a id='4237' tid='4238', class="move" title="(similarity 100%)">stack_argument</a> = <a id='4239' tid='4240', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='4241' tid='4242', class="move" title="(similarity 100%)">intptr_t</a><a id='4243' tid='4244', class="move" title="(similarity 100%)">*</a>&gt;(<a id='4245' tid='4246', class="move" title="(similarity 100%)">entry_stack</a>);
  <span class="deletion" title="deleted">for</span> (<a id='4131' tid='4132', class="move" title="(similarity 100%)">int</a> <a id='4133' tid='4134', class="move" title="(similarity 100%)">i</a> = <a id='4135' tid='4136', class="move" title="(similarity 100%)">4</a>; <a id='4137' tid='4138', class="move" title="(similarity 100%)">i</a> <a id='4139' tid='4140', class="move" title="(similarity 100%)">&lt;</a> <a id='4141' tid='4142', class="move" title="(similarity 100%)">argument_count</a>; <a id='4143' tid='4144', class="move" title="(similarity 100%)">i</a><a id='4145' tid='4146', class="move" title="(similarity 100%)">++</a>) <span class="deletion" title="deleted">{
    stack_argument[i - 4 + kArgsSlotsNum] = va_arg(parameters, int32_t);
  }</span>
  <span class="deletion" title="deleted">va_end(parameters);</span>
  <span class="deletion" title="deleted">set_register(sp, entry_stack);</span>

  // Prepare to execute the code at entry.
  <span class="deletion" title="deleted">set_register(pc, reinterpret_cast&lt;int32_t&gt;(entry));</span>
  // Put down marker for end of simulation. The simulator will stop simulation
  // when the PC reaches this value. By saving the &quot;end simulation&quot; value into
  // the LR the simulation stops when returning to this call point.
  <span class="deletion" title="deleted">set_register(ra, end_sim_pc);</span>

  // Remember the values of callee-saved registers.
  // The code below assumes that r9 is not used as sb (static base) in
  // simulator code and therefore is regarded as a callee-saved register.
  <span class="deletion" title="deleted">int32_t s0_val = get_register(s0);</span>
  <span class="deletion" title="deleted">int32_t s1_val = get_register(s1);</span>
  <span class="deletion" title="deleted">int32_t s2_val = get_register(s2);</span>
  <span class="deletion" title="deleted">int32_t s3_val = get_register(s3);</span>
  <span class="deletion" title="deleted">int32_t s4_val = get_register(s4);</span>
  <span class="deletion" title="deleted">int32_t s5_val = get_register(s5);</span>
  <span class="deletion" title="deleted">int32_t s6_val = get_register(s6);</span>
  <span class="deletion" title="deleted">int32_t s7_val = get_register(s7);</span>
  <span class="deletion" title="deleted">int32_t gp_val = get_register(gp);</span>
  <span class="deletion" title="deleted">int32_t sp_val = get_register(sp);</span>
  <span class="deletion" title="deleted">int32_t fp_val = get_register(fp);</span>

  // Setup the callee-saved registers with a known value. To be able to check
  // that they are preserved properly across JS execution.
  <span class="deletion" title="deleted">int32_t callee_saved_value = icount_;</span>
  <span class="deletion" title="deleted">set_register(s0, callee_saved_value);</span>
  <span class="deletion" title="deleted">set_register(s1, callee_saved_value);</span>
  <span class="deletion" title="deleted">set_register(s2, callee_saved_value);</span>
  <span class="deletion" title="deleted">set_register(s3, callee_saved_value);</span>
  <span class="deletion" title="deleted">set_register(s4, callee_saved_value);</span>
  <span class="deletion" title="deleted">set_register(s5, callee_saved_value);</span>
  <span class="deletion" title="deleted">set_register(s6, callee_saved_value);</span>
  <span class="deletion" title="deleted">set_register(s7, callee_saved_value);</span>
  <span class="deletion" title="deleted">set_register(gp, callee_saved_value);</span>
  <span class="deletion" title="deleted">set_register(fp, callee_saved_value);</span>

  // Start the simulation.
  <span class="deletion" title="deleted">Execute();</span>

  // Check that the callee-saved registers have been preserved.
  <span class="deletion" title="deleted">CHECK_EQ(callee_saved_value, get_register(s0));</span>
  <span class="deletion" title="deleted">CHECK_EQ(callee_saved_value, get_register(s1));</span>
  <span class="deletion" title="deleted">CHECK_EQ(callee_saved_value, get_register(s2));</span>
  <span class="deletion" title="deleted">CHECK_EQ(callee_saved_value, get_register(s3));</span>
  <span class="deletion" title="deleted">CHECK_EQ(callee_saved_value, get_register(s4));</span>
  <span class="deletion" title="deleted">CHECK_EQ(callee_saved_value, get_register(s5));</span>
  <span class="deletion" title="deleted">CHECK_EQ(callee_saved_value, get_register(s6));</span>
  <span class="deletion" title="deleted">CHECK_EQ(callee_saved_value, get_register(s7));</span>
  <span class="deletion" title="deleted">CHECK_EQ(callee_saved_value, get_register(gp));</span>
  <span class="deletion" title="deleted">CHECK_EQ(callee_saved_value, get_register(fp));</span>

  // Restore callee-saved registers with the original value.
  <span class="deletion" title="deleted">set_register(s0, s0_val);</span>
  <span class="deletion" title="deleted">set_register(s1, s1_val);</span>
  <span class="deletion" title="deleted">set_register(s2, s2_val);</span>
  <span class="deletion" title="deleted">set_register(s3, s3_val);</span>
  <span class="deletion" title="deleted">set_register(s4, s4_val);</span>
  <span class="deletion" title="deleted">set_register(s5, s5_val);</span>
  <span class="deletion" title="deleted">set_register(s6, s6_val);</span>
  <span class="deletion" title="deleted">set_register(s7, s7_val);</span>
  <span class="deletion" title="deleted">set_register(gp, gp_val);</span>
  <span class="deletion" title="deleted">set_register(sp, sp_val);</span>
  <span class="deletion" title="deleted">set_register(fp, fp_val);</span>

  // Pop stack passed arguments.
  <span class="deletion" title="deleted">CHECK_EQ(entry_stack, get_register(sp));</span>
  <span class="deletion" title="deleted">set_register(sp, original_stack);</span>

  <span class="deletion" title="deleted">int32_t result = get_register(v0);</span>
  <span class="deletion" title="deleted">return result;</span>
}


<a id='4147' tid='4148', class="move" title="(similarity 100%)">uintptr_t</a> <a id='4149' tid='4150', class="move" title="(similarity 100%)">Simulator</a><a id='4151' tid='4152', class="move" title="(similarity 100%)">::</a><a id='4153' tid='4154', class="move" title="(similarity 100%)">PushAddress</a>(<a id='4155' tid='4156', class="move" title="(similarity 100%)">uintptr_t</a> <a id='4157' tid='4158', class="move" title="(similarity 100%)">address</a>) {
  <a id='4159' tid='4160', class="move" title="(similarity 100%)">int</a> <a id='4161' tid='4162', class="move" title="(similarity 100%)">new_sp</a> = <a id='4163' tid='4164', class="move" title="(similarity 100%)">get_register</a>(<a id='4165' tid='4166', class="move" title="(similarity 100%)">sp</a>) <a id='4167' tid='4168', class="move" title="(similarity 100%)">-</a> <a id='4169' tid='4170', class="move" title="(similarity 100%)">sizeof</a>(<a id='4171' tid='4172', class="move" title="(similarity 100%)">uintptr_t</a>);
  <a id='4173' tid='4174', class="move" title="(similarity 100%)">uintptr_t</a><a id='4175' tid='4176', class="move" title="(similarity 100%)">*</a> <a id='4177' tid='4178', class="move" title="(similarity 100%)">stack_slot</a> = <a id='4179' tid='4180', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='4181' tid='4182', class="move" title="(similarity 100%)">uintptr_t</a><a id='4183' tid='4184', class="move" title="(similarity 100%)">*</a>&gt;(<a id='4185' tid='4186', class="move" title="(similarity 100%)">new_sp</a>);
  <a id='4187' tid='4188', class="move" title="(similarity 100%)">*</a><a id='4189' tid='4190', class="move" title="(similarity 100%)">stack_slot</a> <a id='4191' tid='4192', class="move" title="(similarity 100%)">=</a> <a id='4193' tid='4194', class="move" title="(similarity 100%)">address</a>;
  <a id='4195' tid='4196', class="move" title="(similarity 100%)">set_register</a>(<a id='4197' tid='4198', class="move" title="(similarity 100%)">sp</a>, <a id='4199' tid='4200', class="move" title="(similarity 100%)">new_sp</a>);
  <a id='4201' tid='4202', class="move" title="(similarity 100%)">return</a> <a id='4203' tid='4204', class="move" title="(similarity 100%)">new_sp</a>;
}


<a id='4077' tid='4078', class="move" title="(similarity 100%)">uintptr_t</a> <a id='4079' tid='4080', class="move" title="(similarity 100%)">Simulator</a><a id='4081' tid='4082', class="move" title="(similarity 100%)">::</a><a id='4083' tid='4084', class="move" title="(similarity 100%)">PopAddress</a>() {
  <a id='4085' tid='4086', class="move" title="(similarity 100%)">int</a> <a id='4087' tid='4088', class="move" title="(similarity 100%)">current_sp</a> = <a id='4089' tid='4090', class="move" title="(similarity 100%)">get_register</a>(<a id='4091' tid='4092', class="move" title="(similarity 100%)">sp</a>);
  <a id='4093' tid='4094', class="move" title="(similarity 100%)">uintptr_t</a><a id='4095' tid='4096', class="move" title="(similarity 100%)">*</a> <a id='4097' tid='4098', class="move" title="(similarity 100%)">stack_slot</a> = <a id='4099' tid='4100', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='4101' tid='4102', class="move" title="(similarity 100%)">uintptr_t</a><a id='4103' tid='4104', class="move" title="(similarity 100%)">*</a>&gt;(<a id='4105' tid='4106', class="move" title="(similarity 100%)">current_sp</a>);
  <a id='4107' tid='4108', class="move" title="(similarity 100%)">uintptr_t</a> <a id='4109' tid='4110', class="move" title="(similarity 100%)">address</a> = <a id='4111' tid='4112', class="move" title="(similarity 100%)">*</a><a id='4113' tid='4114', class="move" title="(similarity 100%)">stack_slot</a>;
  <a id='4115' tid='4116', class="move" title="(similarity 100%)">set_register</a>(<a id='4117' tid='4118', class="move" title="(similarity 100%)">sp</a>, <a id='4119' tid='4120', class="move" title="(similarity 100%)">current_sp</a> <a id='4121' tid='4122', class="move" title="(similarity 100%)">+</a> <a id='4123' tid='4124', class="move" title="(similarity 100%)">sizeof</a>(<a id='4125' tid='4126', class="move" title="(similarity 100%)">uintptr_t</a>));
  <a id='4127' tid='4128', class="move" title="(similarity 100%)">return</a> <a id='4129' tid='4130', class="move" title="(similarity 100%)">address</a>;
}


<span class="deletion" title="deleted">#undef UNSUPPORTED</span>

} }  // namespace v8::internal

<span class="deletion" title="deleted">#endif</span>  // USE_SIMULATOR

<span class="deletion" title="deleted">#endif</span>  // V8_TARGET_ARCH_MIPS


</pre>
</div>
<div id="right" class="src">
<pre>
<a id='rightstart' tid='leftstart'></a>
// Copyright 2011 the V8 project authors. All rights reserved.
// Redistribution and use in source and binary forms, with or without
// modification, are permitted provided that the following conditions are
// met:
//
//     * Redistributions of source code must retain the above copyright
//       notice, this list of conditions and the following disclaimer.
//     * Redistributions in binary form must reproduce the above
//       copyright notice, this list of conditions and the following
//       disclaimer in the documentation and/or other materials provided
//       with the distribution.
//     * Neither the name of Google Inc. nor the names of its
//       contributors may be used to endorse or promote products derived
//       from this software without specific prior written permission.
//
// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
// &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
// LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
// A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
// OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
// SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
// LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
// DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
// THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

<span class="insertion" title="inserted">#include &lt;stdlib.h&gt;</span>
<span class="insertion" title="inserted">#include &lt;math.h&gt;</span>
<span class="insertion" title="inserted">#include &lt;cstdarg&gt;</span>
<span class="insertion" title="inserted">#include &quot;v8.h&quot;</span>

<span class="insertion" title="inserted">#if defined(V8_TARGET_ARCH_ARM)</span>

<span class="insertion" title="inserted">#include &quot;disasm.h&quot;</span>
<span class="insertion" title="inserted">#include &quot;assembler.h&quot;</span>
<span class="insertion" title="inserted">#include &quot;arm/constants-arm.h&quot;</span>
<span class="insertion" title="inserted">#include &quot;arm/simulator-arm.h&quot;</span>

<span class="insertion" title="inserted">#if defined(USE_SIMULATOR)</span>

// Only build the simulator if not compiling for real ARM hardware.
namespace <span class="insertion" title="inserted">v8</span> {
namespace <span class="insertion" title="inserted">internal</span> {

// This macro provides a platform independent use of sscanf. The reason for
// SScanF not being implemented in a platform independent way through
// ::v8::internal::OS in the same way as SNPrintF is that the
// Windows C Run-Time Library does not provide vsscanf.
<span class="insertion" title="inserted">#define SScanF sscanf</span>  // NOLINT

// The ArmDebugger class is used by the simulator while debugging simulated ARM
// code.
<span class="insertion" title="inserted">class</span> <span class="insertion" title="inserted">ArmDebugger</span> {
 <span class="insertion" title="inserted">public:</span>
  <span class="insertion" title="inserted">explicit ArmDebugger(Simulator* sim)</span>;
  <span class="insertion" title="inserted">~ArmDebugger();</span>

  <span class="insertion" title="inserted">void Stop(Instruction* instr)</span>;
  <span class="insertion" title="inserted">void Debug()</span>;

 <span class="insertion" title="inserted">private:</span>
  <span class="insertion" title="inserted">static const Instr kBreakpointInstr =
      (al | (7*B25) | (1*B24) | kBreakpoint);</span>
  <span class="insertion" title="inserted">static const Instr kNopInstr = (al | (13*B21));</span>

  <span class="insertion" title="inserted">Simulator* sim_;</span>

  <span class="insertion" title="inserted">int32_t GetRegisterValue(int regnum)</span>;
  <span class="insertion" title="inserted">double GetRegisterPairDoubleValue(int regnum)</span>;
  <span class="insertion" title="inserted">double GetVFPDoubleRegisterValue(int regnum)</span>;
  <a id='8168' tid='8167', class="move" title="(similarity 100%)">bool</a> <a id='8170' tid='8169', class="move" title="(similarity 100%)">GetValue</a>(<a id='8172' tid='8171', class="move" title="(similarity 100%)">const</a> <a id='8174' tid='8173', class="move" title="(similarity 100%)">char</a><a id='8176' tid='8175', class="move" title="(similarity 100%)">*</a> <a id='8178' tid='8177', class="move" title="(similarity 100%)">desc</a>, <a id='8180' tid='8179', class="move" title="(similarity 100%)">int32_t</a><a id='8182' tid='8181', class="move" title="(similarity 100%)">*</a> <a id='8184' tid='8183', class="move" title="(similarity 100%)">value</a>);
  <span class="insertion" title="inserted">bool GetVFPSingleValue(const char* desc, float* value)</span>;
  <span class="insertion" title="inserted">bool GetVFPDoubleValue(const char* desc, double* value)</span>;

  // Set or delete a breakpoint. Returns true if successful.
  <span class="insertion" title="inserted">bool SetBreakpoint(Instruction* breakpc)</span>;
  <span class="insertion" title="inserted">bool DeleteBreakpoint(Instruction* breakpc)</span>;

  // Undo and redo all breakpoints. This is needed to bracket disassembly and
  // execution to skip past breakpoints when run from the debugger.
  <span class="insertion" title="inserted">void UndoBreakpoints()</span>;
  <span class="insertion" title="inserted">void RedoBreakpoints()</span>;
};


<span class="insertion" title="inserted">ArmDebugger::ArmDebugger(Simulator* sim) {
  sim_ = sim;
}</span>


<span class="insertion" title="inserted">ArmDebugger::~ArmDebugger() {
}</span>



<span class="insertion" title="inserted">#ifdef GENERATED_CODE_COVERAGE</span>
<span class="insertion" title="inserted">static FILE* coverage_log = NULL;</span>


<a id='8134' tid='8133', class="move" title="(similarity 100%)">static</a> <a id='8136' tid='8135', class="move" title="(similarity 100%)">void</a> <a id='8138' tid='8137', class="move" title="(similarity 100%)">InitializeCoverage</a>() {
  <a id='8140' tid='8139', class="move" title="(similarity 100%)">char</a><a id='8142' tid='8141', class="move" title="(similarity 100%)">*</a> <a id='8144' tid='8143', class="move" title="(similarity 100%)">file_name</a> = <a id='8146' tid='8145', class="move" title="(similarity 100%)">getenv</a>(<a id='8148' tid='8147', class="move" title="(similarity 100%)">&quot;V8_GENERATED_CODE_COVERAGE_LOG&quot;</a>);
  <a id='8150' tid='8149', class="move" title="(similarity 100%)">if</a> (<a id='8152' tid='8151', class="move" title="(similarity 100%)">file_name</a> <a id='8154' tid='8153', class="move" title="(similarity 100%)">!=</a> <a id='8156' tid='8155', class="move" title="(similarity 100%)">NULL</a>) {
    <a id='8158' tid='8157', class="move" title="(similarity 100%)">coverage_log</a> <a id='8160' tid='8159', class="move" title="(similarity 100%)">=</a> <a id='8162' tid='8161', class="move" title="(similarity 100%)">fopen</a>(<a id='8164' tid='8163', class="move" title="(similarity 100%)">file_name</a>, <a id='8166' tid='8165', class="move" title="(similarity 100%)">&quot;aw+&quot;</a>);
  }
}


<span class="insertion" title="inserted">void ArmDebugger::Stop(Instruction* instr)</span> {
  // Get the stop code.
  <span class="insertion" title="inserted">uint32_t code = instr-&gt;SvcValue() & kStopCodeMask;</span>
  // Retrieve the encoded address, which comes just after this stop.
  <span class="insertion" title="inserted">char** msg_address =
    reinterpret_cast&lt;char**&gt;(sim_-&gt;get_pc() + Instruction::kInstrSize);</span>
  <span class="insertion" title="inserted">char* msg = *msg_address;</span>
  <span class="insertion" title="inserted">ASSERT(msg != NULL);</span>

  // Update this stop description.
  <span class="insertion" title="inserted">if (isWatchedStop(code) && !watched_stops[code].desc) {
    watched_stops[code].desc = msg;
  }</span>

  <span class="insertion" title="inserted">if (strlen(msg) &gt; 0) {
    if (coverage_log != NULL) {
      fprintf(coverage_log, &quot;%s\n&quot;, msg);
      fflush(coverage_log);
    }
    // Overwrite the instruction and address with nops.
    instr-&gt;SetInstructionBits(kNopInstr);
    reinterpret_cast&lt;Instruction*&gt;(msg_address)-&gt;SetInstructionBits(kNopInstr);
  }</span>
  <a id='8114' tid='8113', class="move" title="(similarity 100%)">sim_</a>-&gt;<a id='8116' tid='8115', class="move" title="(similarity 100%)">set_pc</a>(<a id='8118' tid='8117', class="move" title="(similarity 100%)">sim_</a>-&gt;<a id='8120' tid='8119', class="move" title="(similarity 100%)">get_pc</a>() <a id='8122' tid='8121', class="move" title="(similarity 100%)">+</a> <a id='8124' tid='8123', class="move" title="(similarity 100%)">2</a> <a id='8126' tid='8125', class="move" title="(similarity 100%)">*</a> <a id='8128' tid='8127', class="move" title="(similarity 100%)">Instruction</a><a id='8130' tid='8129', class="move" title="(similarity 100%)">::</a><a id='8132' tid='8131', class="move" title="(similarity 100%)">kInstrSize</a>);
}

<span class="insertion" title="inserted">#else</span>  // ndef GENERATED_CODE_COVERAGE

<span class="insertion" title="inserted">static void InitializeCoverage() {
}</span>


<span class="insertion" title="inserted">void ArmDebugger::Stop(Instruction* instr)</span> {
  // Get the stop code.
  <span class="insertion" title="inserted">uint32_t code = instr-&gt;SvcValue() & kStopCodeMask;</span>
  // Retrieve the encoded address, which comes just after this stop.
  <a id='4050' tid='4049', class="move" title="(similarity 100%)">char</a><a id='4052' tid='4051', class="move" title="(similarity 100%)">*</a> <a id='4054' tid='4053', class="move" title="(similarity 100%)">msg</a> = <a id='4056' tid='4055', class="move" title="(similarity 100%)">*</a><a id='4058' tid='4057', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='4060' tid='4059', class="move" title="(similarity 100%)">char</a><a id='4062' tid='4061', class="move" title="(similarity 100%)">*</a><a id='4064' tid='4063', class="move" title="(similarity 100%)">*</a>&gt;(<a id='4066' tid='4065', class="move" title="(similarity 100%)">sim_</a>-&gt;<a id='4068' tid='4067', class="move" title="(similarity 100%)">get_pc</a>()
                                        <a id='4070' tid='4069', class="move" title="(similarity 100%)">+</a> <a id='4072' tid='4071', class="move" title="(similarity 100%)">Instruction</a><a id='4074' tid='4073', class="move" title="(similarity 100%)">::</a><a id='4076' tid='4075', class="move" title="(similarity 100%)">kInstrSize</a>);
  // Update this stop description.
  <span class="insertion" title="inserted">if (sim_-&gt;isWatchedStop(code) && !sim_-&gt;watched_stops[code].desc) {
    sim_-&gt;watched_stops[code].desc = msg;
  }</span>
  // Print the stop message and code if it is not the default code.
  <span class="insertion" title="inserted">if (code != kMaxStopCode) {
    PrintF(&quot;Simulator hit stop %u: %s\n&quot;, code, msg);
  } else {
    PrintF(&quot;Simulator hit %s\n&quot;, msg);
  }</span>
  <span class="insertion" title="inserted">sim_-&gt;set_pc(sim_-&gt;get_pc() + 2 * Instruction::kInstrSize);</span>
  <span class="insertion" title="inserted">Debug();</span>
}
<span class="insertion" title="inserted">#endif</span>


<span class="insertion" title="inserted">int32_t ArmDebugger::GetRegisterValue(int regnum) {
  if (regnum == kPCRegister) {
    return sim_-&gt;get_pc();
  } else {
    return sim_-&gt;get_register(regnum);
  }
}</span>


<span class="insertion" title="inserted">double ArmDebugger::GetRegisterPairDoubleValue(int regnum) {
  return sim_-&gt;get_double_from_register_pair(regnum);
}</span>


<span class="insertion" title="inserted">double ArmDebugger::GetVFPDoubleRegisterValue(int regnum) {
  return sim_-&gt;get_double_from_d_register(regnum);
}</span>


<span class="insertion" title="inserted">bool ArmDebugger::GetValue(const char* desc, int32_t* value)</span> {
  <span class="insertion" title="inserted">int regnum = Registers::Number(desc);</span>
  <span class="insertion" title="inserted">if</span> <span class="insertion" title="inserted">(regnum != kNoRegister)</span> {
    <a id='8100' tid='8099', class="move" title="(similarity 100%)">*</a><a id='8102' tid='8101', class="move" title="(similarity 100%)">value</a> <a id='8104' tid='8103', class="move" title="(similarity 100%)">=</a> <a id='8106' tid='8105', class="move" title="(similarity 100%)">GetRegisterValue</a>(<a id='8108' tid='8107', class="move" title="(similarity 100%)">regnum</a>);
    <a id='8110' tid='8109', class="move" title="(similarity 100%)">return</a> <a id='8112' tid='8111', class="move" title="(similarity 100%)">true</a>;
  } <span class="insertion" title="inserted">else {
    if (strncmp(desc, &quot;0x&quot;, 2) == 0) {
      return SScanF(desc + 2, &quot;%x&quot;, reinterpret_cast&lt;uint32_t*&gt;(value)) == 1;
    } else {
      return SScanF(desc, &quot;%u&quot;, reinterpret_cast&lt;uint32_t*&gt;(value)) == 1;
    }
  }</span>
  <span class="insertion" title="inserted">return false;</span>
}


<span class="insertion" title="inserted">bool ArmDebugger::GetVFPSingleValue(const char* desc, float* value) {
  bool is_double;
  int regnum = VFPRegisters::Number(desc, &is_double);
  if (regnum != kNoRegister && !is_double) {
    *value = sim_-&gt;get_float_from_s_register(regnum);
    return true;
  }
  return false;
}</span>


<span class="insertion" title="inserted">bool ArmDebugger::GetVFPDoubleValue(const char* desc, double* value) {
  bool is_double;
  int regnum = VFPRegisters::Number(desc, &is_double);
  if (regnum != kNoRegister && is_double) {
    *value = sim_-&gt;get_double_from_d_register(regnum);
    return true;
  }
  return false;
}</span>


<span class="insertion" title="inserted">bool ArmDebugger::SetBreakpoint(Instruction* breakpc) {
  // Check if a breakpoint can be set. If not return without any side-effects.
  if (sim_-&gt;break_pc_ != NULL) {
    return false;
  }

  // Set the breakpoint.
  sim_-&gt;break_pc_ = breakpc;
  sim_-&gt;break_instr_ = breakpc-&gt;InstructionBits();
  // Not setting the breakpoint instruction in the code itself. It will be set
  // when the debugger shell continues.
  return true;
}</span>


<span class="insertion" title="inserted">bool ArmDebugger::DeleteBreakpoint(Instruction* breakpc) {
  if (sim_-&gt;break_pc_ != NULL) {
    sim_-&gt;break_pc_-&gt;SetInstructionBits(sim_-&gt;break_instr_);
  }

  sim_-&gt;break_pc_ = NULL;
  sim_-&gt;break_instr_ = 0;
  return true;
}</span>


<span class="insertion" title="inserted">void ArmDebugger::UndoBreakpoints() {
  if (sim_-&gt;break_pc_ != NULL) {
    sim_-&gt;break_pc_-&gt;SetInstructionBits(sim_-&gt;break_instr_);
  }
}</span>


<span class="insertion" title="inserted">void ArmDebugger::RedoBreakpoints() {
  if (sim_-&gt;break_pc_ != NULL) {
    sim_-&gt;break_pc_-&gt;SetInstructionBits(kBreakpointInstr);
  }
}</span>


<span class="insertion" title="inserted">void ArmDebugger::Debug()</span> {
  <a id='7874' tid='7873', class="move" title="(similarity 100%)">intptr_t</a> <a id='7876' tid='7875', class="move" title="(similarity 100%)">last_pc</a> = <a id='7878' tid='7877', class="move" title="(similarity 100%)">-</a><a id='7880' tid='7879', class="move" title="(similarity 100%)">1</a>;
  <a id='7882' tid='7881', class="move" title="(similarity 100%)">bool</a> <a id='7884' tid='7883', class="move" title="(similarity 100%)">done</a> = <a id='7886' tid='7885', class="move" title="(similarity 100%)">false</a>;

#<a id='7888' tid='7887', class="move" title="(similarity 100%)">define</a> <a id='7890' tid='7889', class="move" title="(similarity 100%)">COMMAND_SIZE</a> <a id='7892' tid='7891', class="move" title="(similarity 100%)">63</a>
#<a id='7894' tid='7893', class="move" title="(similarity 100%)">define</a> <a id='7896' tid='7895', class="move" title="(similarity 100%)">ARG_SIZE</a> <a id='7898' tid='7897', class="move" title="(similarity 100%)">255</a>

#<a id='8086' tid='8085', class="move" title="(similarity 100%)">define</a> <a id='8088' tid='8087', class="move" title="(similarity 100%)">STR</a><a id='8090' tid='8089', class="move" title="(similarity 100%)">(</a><a id='8092' tid='8091', class="move" title="(similarity 100%)">a</a><a id='8094' tid='8093', class="move" title="(similarity 100%)">)</a> <a id='8096' tid='8095', class="move" title="(similarity 100%)">#</a><a id='8098' tid='8097', class="move" title="(similarity 100%)">a</a>
#<a id='7900' tid='7899', class="move" title="(similarity 100%)">define</a> <a id='7902' tid='7901', class="move" title="(similarity 100%)">XSTR</a><a id='7904' tid='7903', class="move" title="(similarity 100%)">(</a><a id='7906' tid='7905', class="move" title="(similarity 100%)">a</a><a id='7908' tid='7907', class="move" title="(similarity 100%)">)</a> <a id='7910' tid='7909', class="move" title="(similarity 100%)">STR</a><a id='7912' tid='7911', class="move" title="(similarity 100%)">(</a><a id='7914' tid='7913', class="move" title="(similarity 100%)">a</a><a id='7916' tid='7915', class="move" title="(similarity 100%)">)</a>

  <a id='7918' tid='7917', class="move" title="(similarity 100%)">char</a> <a id='7920' tid='7919', class="move" title="(similarity 100%)">cmd</a>[<a id='7922' tid='7921', class="move" title="(similarity 100%)">COMMAND_SIZE</a> <a id='7924' tid='7923', class="move" title="(similarity 100%)">+</a> <a id='7926' tid='7925', class="move" title="(similarity 100%)">1</a>];
  <a id='7928' tid='7927', class="move" title="(similarity 100%)">char</a> <a id='7930' tid='7929', class="move" title="(similarity 100%)">arg1</a>[<a id='7932' tid='7931', class="move" title="(similarity 100%)">ARG_SIZE</a> <a id='7934' tid='7933', class="move" title="(similarity 100%)">+</a> <a id='7936' tid='7935', class="move" title="(similarity 100%)">1</a>];
  <a id='7938' tid='7937', class="move" title="(similarity 100%)">char</a> <a id='7940' tid='7939', class="move" title="(similarity 100%)">arg2</a>[<a id='7942' tid='7941', class="move" title="(similarity 100%)">ARG_SIZE</a> <a id='7944' tid='7943', class="move" title="(similarity 100%)">+</a> <a id='7946' tid='7945', class="move" title="(similarity 100%)">1</a>];
  <a id='7948' tid='7947', class="move" title="(similarity 100%)">char</a><a id='7950' tid='7949', class="move" title="(similarity 100%)">*</a> <a id='7952' tid='7951', class="move" title="(similarity 100%)">argv</a>[<a id='7954' tid='7953', class="move" title="(similarity 100%)">3</a>] = { <a id='7956' tid='7955', class="move" title="(similarity 100%)">cmd</a>, <a id='7958' tid='7957', class="move" title="(similarity 100%)">arg1</a>, <a id='7960' tid='7959', class="move" title="(similarity 100%)">arg2</a> };

  // make sure to have a proper terminating character if reaching the limit
  <a id='7962' tid='7961', class="move" title="(similarity 100%)">cmd</a>[<a id='7964' tid='7963', class="move" title="(similarity 100%)">COMMAND_SIZE</a>] <a id='7966' tid='7965', class="move" title="(similarity 100%)">=</a> <a id='7968' tid='7967', class="move" title="(similarity 100%)">0</a>;
  <a id='7970' tid='7969', class="move" title="(similarity 100%)">arg1</a>[<a id='7972' tid='7971', class="move" title="(similarity 100%)">ARG_SIZE</a>] <a id='7974' tid='7973', class="move" title="(similarity 100%)">=</a> <a id='7976' tid='7975', class="move" title="(similarity 100%)">0</a>;
  <a id='7978' tid='7977', class="move" title="(similarity 100%)">arg2</a>[<a id='7980' tid='7979', class="move" title="(similarity 100%)">ARG_SIZE</a>] <a id='7982' tid='7981', class="move" title="(similarity 100%)">=</a> <a id='7984' tid='7983', class="move" title="(similarity 100%)">0</a>;

  // Undo all set breakpoints while running in the debugger shell. This will
  // make them invisible to all commands.
  <a id='7986' tid='7985', class="move" title="(similarity 100%)">UndoBreakpoints</a>();

  <span class="insertion" title="inserted">while</span> <span class="insertion" title="inserted">(!done)</span> {
    <a id='7988' tid='7987', class="move" title="(similarity 100%)">if</a> (<a id='7990' tid='7989', class="move" title="(similarity 100%)">last_pc</a> <a id='7992' tid='7991', class="move" title="(similarity 100%)">!=</a> <a id='7994' tid='7993', class="move" title="(similarity 100%)">sim_</a>-&gt;<a id='7996' tid='7995', class="move" title="(similarity 100%)">get_pc</a>()) {
      <a id='7998' tid='7997', class="move" title="(similarity 100%)">disasm</a><a id='8000' tid='7999', class="move" title="(similarity 100%)">::</a><a id='8002' tid='8001', class="move" title="(similarity 100%)">NameConverter</a> <a id='8004' tid='8003', class="move" title="(similarity 100%)">converter</a>;
      <a id='8006' tid='8005', class="move" title="(similarity 100%)">disasm</a><a id='8008' tid='8007', class="move" title="(similarity 100%)">::</a><a id='8010' tid='8009', class="move" title="(similarity 100%)">Disassembler</a> <a id='8012' tid='8011', class="move" title="(similarity 100%)">dasm</a>(<a id='8014' tid='8013', class="move" title="(similarity 100%)">converter</a>);
      // use a reasonably large buffer
      <a id='8016' tid='8015', class="move" title="(similarity 100%)">v8</a><a id='8018' tid='8017', class="move" title="(similarity 100%)">::</a><a id='8020' tid='8019', class="move" title="(similarity 100%)">internal</a><a id='8022' tid='8021', class="move" title="(similarity 100%)">::</a><a id='8024' tid='8023', class="move" title="(similarity 100%)">EmbeddedVector</a>&lt;<a id='8026' tid='8025', class="move" title="(similarity 100%)">char</a>, <a id='8028' tid='8027', class="move" title="(similarity 100%)">256</a>&gt; <a id='8030' tid='8029', class="move" title="(similarity 100%)">buffer</a>;
      <a id='8032' tid='8031', class="move" title="(similarity 100%)">dasm</a>.<a id='8034' tid='8033', class="move" title="(similarity 100%)">InstructionDecode</a>(<a id='8036' tid='8035', class="move" title="(similarity 100%)">buffer</a>,
                             <a id='8038' tid='8037', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='8040' tid='8039', class="move" title="(similarity 100%)">byte</a><a id='8042' tid='8041', class="move" title="(similarity 100%)">*</a>&gt;(<a id='8044' tid='8043', class="move" title="(similarity 100%)">sim_</a>-&gt;<a id='8046' tid='8045', class="move" title="(similarity 100%)">get_pc</a>()));
      <a id='8048' tid='8047', class="move" title="(similarity 100%)">PrintF</a>(<a id='8050' tid='8049', class="move" title="(similarity 100%)">&quot;  0x%08x  %s\n&quot;</a>, <a id='8052' tid='8051', class="move" title="(similarity 100%)">sim_</a>-&gt;<a id='8054' tid='8053', class="move" title="(similarity 100%)">get_pc</a>(), <a id='8056' tid='8055', class="move" title="(similarity 100%)">buffer</a>.<a id='8058' tid='8057', class="move" title="(similarity 100%)">start</a>());
      <a id='8060' tid='8059', class="move" title="(similarity 100%)">last_pc</a> <a id='8062' tid='8061', class="move" title="(similarity 100%)">=</a> <a id='8064' tid='8063', class="move" title="(similarity 100%)">sim_</a>-&gt;<a id='8066' tid='8065', class="move" title="(similarity 100%)">get_pc</a>();
    }
    <a id='7636' tid='7635', class="move" title="(similarity 100%)">char</a><a id='7638' tid='7637', class="move" title="(similarity 100%)">*</a> <a id='7640' tid='7639', class="move" title="(similarity 100%)">line</a> = <a id='7642' tid='7641', class="move" title="(similarity 100%)">ReadLine</a>(<a id='7644' tid='7643', class="move" title="(similarity 100%)">&quot;sim&gt; &quot;</a>);
    <a id='7646' tid='7645', class="move" title="(similarity 100%)">if</a> (<a id='7648' tid='7647', class="move" title="(similarity 100%)">line</a> <a id='7650' tid='7649', class="move" title="(similarity 100%)">==</a> <a id='7652' tid='7651', class="move" title="(similarity 100%)">NULL</a>) {
      <a id='7654' tid='7653', class="move" title="(similarity 100%)">break</a>;
    } <a id='7656' tid='7655', class="move" title="(similarity 100%)">else</a> {
      // Use sscanf to parse the individual parts of the command line. At the
      // moment no command expects more than two parameters.
      <a id='7658' tid='7657', class="move" title="(similarity 100%)">int</a> <a id='7660' tid='7659', class="move" title="(similarity 100%)">argc</a> = <a id='7662' tid='7661', class="move" title="(similarity 100%)">SScanF</a>(<a id='7664' tid='7663', class="move" title="(similarity 100%)">line</a>,
                        <a id='7666' tid='7665', class="move" title="(similarity 100%)">&quot;%&quot;</a> <a id='7668' tid='7667', class="move" title="(similarity 100%)">XSTR</a>(<a id='7670' tid='7669', class="move" title="(similarity 100%)">COMMAND_SIZE</a>) <a id='7672' tid='7671', class="move" title="(similarity 100%)">&quot;s &quot;</a>
                        <a id='7674' tid='7673', class="move" title="(similarity 100%)">&quot;%&quot;</a> <a id='7676' tid='7675', class="move" title="(similarity 100%)">XSTR</a>(<a id='7678' tid='7677', class="move" title="(similarity 100%)">ARG_SIZE</a>) <a id='7680' tid='7679', class="move" title="(similarity 100%)">&quot;s &quot;</a>
                        <a id='7682' tid='7681', class="move" title="(similarity 100%)">&quot;%&quot;</a> <a id='7684' tid='7683', class="move" title="(similarity 100%)">XSTR</a>(<a id='7686' tid='7685', class="move" title="(similarity 100%)">ARG_SIZE</a>) <a id='7688' tid='7687', class="move" title="(similarity 100%)">&quot;s&quot;</a>,
                        <a id='7690' tid='7689', class="move" title="(similarity 100%)">cmd</a>, <a id='7692' tid='7691', class="move" title="(similarity 100%)">arg1</a>, <a id='7694' tid='7693', class="move" title="(similarity 100%)">arg2</a>);
      <a id='7696' tid='7695', class="move" title="(similarity 100%)">if</a> ((<a id='7698' tid='7697', class="move" title="(similarity 100%)">strcmp</a>(<a id='7700' tid='7699', class="move" title="(similarity 100%)">cmd</a>, <a id='7702' tid='7701', class="move" title="(similarity 100%)">&quot;si&quot;</a>) <a id='7704' tid='7703', class="move" title="(similarity 100%)">==</a> <a id='7706' tid='7705', class="move" title="(similarity 100%)">0</a>) <a id='7708' tid='7707', class="move" title="(similarity 100%)">||</a> (<a id='7710' tid='7709', class="move" title="(similarity 100%)">strcmp</a>(<a id='7712' tid='7711', class="move" title="(similarity 100%)">cmd</a>, <a id='7714' tid='7713', class="move" title="(similarity 100%)">&quot;stepi&quot;</a>) <a id='7716' tid='7715', class="move" title="(similarity 100%)">==</a> <a id='7718' tid='7717', class="move" title="(similarity 100%)">0</a>)) {
        <a id='7720' tid='7719', class="move" title="(similarity 100%)">sim_</a>-&gt;<a id='7722' tid='7721', class="move" title="(similarity 100%)">InstructionDecode</a>(<a id='7724' tid='7723', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='7726' tid='7725', class="move" title="(similarity 100%)">Instruction</a><a id='7728' tid='7727', class="move" title="(similarity 100%)">*</a>&gt;(<a id='7730' tid='7729', class="move" title="(similarity 100%)">sim_</a>-&gt;<a id='7732' tid='7731', class="move" title="(similarity 100%)">get_pc</a>()));
      } <a id='7734' tid='7733', class="move" title="(similarity 100%)">else</a> <a id='7736' tid='7735', class="move" title="(similarity 100%)">if</a> ((<a id='7738' tid='7737', class="move" title="(similarity 100%)">strcmp</a>(<a id='7740' tid='7739', class="move" title="(similarity 100%)">cmd</a>, <a id='7742' tid='7741', class="move" title="(similarity 100%)">&quot;c&quot;</a>) <a id='7744' tid='7743', class="move" title="(similarity 100%)">==</a> <a id='7746' tid='7745', class="move" title="(similarity 100%)">0</a>) <a id='7748' tid='7747', class="move" title="(similarity 100%)">||</a> (<a id='7750' tid='7749', class="move" title="(similarity 100%)">strcmp</a>(<a id='7752' tid='7751', class="move" title="(similarity 100%)">cmd</a>, <a id='7754' tid='7753', class="move" title="(similarity 100%)">&quot;cont&quot;</a>) <a id='7756' tid='7755', class="move" title="(similarity 100%)">==</a> <a id='7758' tid='7757', class="move" title="(similarity 100%)">0</a>)) {
        // Execute the one instruction we broke at with breakpoints disabled.
        <a id='7760' tid='7759', class="move" title="(similarity 100%)">sim_</a>-&gt;<a id='7762' tid='7761', class="move" title="(similarity 100%)">InstructionDecode</a>(<a id='7764' tid='7763', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='7766' tid='7765', class="move" title="(similarity 100%)">Instruction</a><a id='7768' tid='7767', class="move" title="(similarity 100%)">*</a>&gt;(<a id='7770' tid='7769', class="move" title="(similarity 100%)">sim_</a>-&gt;<a id='7772' tid='7771', class="move" title="(similarity 100%)">get_pc</a>()));
        // Leave the debugger shell.
        <a id='7774' tid='7773', class="move" title="(similarity 100%)">done</a> <a id='7776' tid='7775', class="move" title="(similarity 100%)">=</a> <a id='7778' tid='7777', class="move" title="(similarity 100%)">true</a>;
      } <a id='7780' tid='7779', class="move" title="(similarity 100%)">else</a> <span class="insertion" title="inserted">if</span> ((<a id='7782' tid='7781', class="move" title="(similarity 100%)">strcmp</a>(<a id='7784' tid='7783', class="move" title="(similarity 100%)">cmd</a>, <a id='7786' tid='7785', class="move" title="(similarity 100%)">&quot;p&quot;</a>) <a id='7788' tid='7787', class="move" title="(similarity 100%)">==</a> <a id='7790' tid='7789', class="move" title="(similarity 100%)">0</a>) <a id='7792' tid='7791', class="move" title="(similarity 100%)">||</a> (<a id='7794' tid='7793', class="move" title="(similarity 100%)">strcmp</a>(<a id='7796' tid='7795', class="move" title="(similarity 100%)">cmd</a>, <a id='7798' tid='7797', class="move" title="(similarity 100%)">&quot;print&quot;</a>) <a id='7800' tid='7799', class="move" title="(similarity 100%)">==</a> <a id='7802' tid='7801', class="move" title="(similarity 100%)">0</a>)) <span class="insertion" title="inserted">{
        if (argc == 2 || (argc == 3 && strcmp(arg2, &quot;fp&quot;) == 0)) {
          int32_t value;
          float svalue;
          double dvalue;
          if (strcmp(arg1, &quot;all&quot;) == 0) {
            for (int i = 0; i &lt; kNumRegisters; i++) {
              value = GetRegisterValue(i);
              PrintF(&quot;%3s: 0x%08x %10d&quot;, Registers::Name(i), value, value);
              if ((argc == 3 && strcmp(arg2, &quot;fp&quot;) == 0) &&
                  i &lt; 8 &&
                  (i % 2) == 0) {
                dvalue = GetRegisterPairDoubleValue(i);
                PrintF(&quot; (%f)\n&quot;, dvalue);
              } else {
                PrintF(&quot;\n&quot;);
              }
            }
            for (int i = 0; i &lt; kNumVFPDoubleRegisters; i++) {
              dvalue = GetVFPDoubleRegisterValue(i);
              uint64_t as_words = BitCast&lt;uint64_t&gt;(dvalue);
              PrintF(&quot;%3s: %f 0x%08x %08x\n&quot;,
                     VFPRegisters::Name(i, true),
                     dvalue,
                     static_cast&lt;uint32_t&gt;(as_words &gt;&gt; 32),
                     static_cast&lt;uint32_t&gt;(as_words & 0xffffffff));
            }
          } else {
            if (GetValue(arg1, &value)) {
              PrintF(&quot;%s: 0x%08x %d \n&quot;, arg1, value, value);
            } else if (GetVFPSingleValue(arg1, &svalue)) {
              uint32_t as_word = BitCast&lt;uint32_t&gt;(svalue);
              PrintF(&quot;%s: %f 0x%08x\n&quot;, arg1, svalue, as_word);
            } else if (GetVFPDoubleValue(arg1, &dvalue)) {
              uint64_t as_words = BitCast&lt;uint64_t&gt;(dvalue);
              PrintF(&quot;%s: %f 0x%08x %08x\n&quot;,
                     arg1,
                     dvalue,
                     static_cast&lt;uint32_t&gt;(as_words &gt;&gt; 32),
                     static_cast&lt;uint32_t&gt;(as_words & 0xffffffff));
            } else {
              PrintF(&quot;%s unrecognized\n&quot;, arg1);
            }
          }
        } else {
          PrintF(&quot;print &lt;register&gt;\n&quot;);
        }
      }</span> <a id='7168' tid='7167', class="move" title="(similarity 100%)">else</a> <a id='7170' tid='7169', class="move" title="(similarity 100%)">if</a> ((<a id='7172' tid='7171', class="move" title="(similarity 100%)">strcmp</a>(<a id='7174' tid='7173', class="move" title="(similarity 100%)">cmd</a>, <a id='7176' tid='7175', class="move" title="(similarity 100%)">&quot;po&quot;</a>) <a id='7178' tid='7177', class="move" title="(similarity 100%)">==</a> <a id='7180' tid='7179', class="move" title="(similarity 100%)">0</a>)
                 <a id='7182' tid='7181', class="move" title="(similarity 100%)">||</a> (<a id='7184' tid='7183', class="move" title="(similarity 100%)">strcmp</a>(<a id='7186' tid='7185', class="move" title="(similarity 100%)">cmd</a>, <a id='7188' tid='7187', class="move" title="(similarity 100%)">&quot;printobject&quot;</a>) <a id='7190' tid='7189', class="move" title="(similarity 100%)">==</a> <a id='7192' tid='7191', class="move" title="(similarity 100%)">0</a>)) {
        <a id='7194' tid='7193', class="move" title="(similarity 100%)">if</a> (<a id='7196' tid='7195', class="move" title="(similarity 100%)">argc</a> <a id='7198' tid='7197', class="move" title="(similarity 100%)">==</a> <a id='7200' tid='7199', class="move" title="(similarity 100%)">2</a>) {
          <a id='7202' tid='7201', class="move" title="(similarity 100%)">int32_t</a> <a id='7204' tid='7203', class="move" title="(similarity 100%)">value</a>;
          <a id='7206' tid='7205', class="move" title="(similarity 100%)">if</a> (<a id='7208' tid='7207', class="move" title="(similarity 100%)">GetValue</a>(<a id='7210' tid='7209', class="move" title="(similarity 100%)">arg1</a>, <a id='7212' tid='7211', class="move" title="(similarity 100%)">&</a><a id='7214' tid='7213', class="move" title="(similarity 100%)">value</a>)) {
            <a id='7216' tid='7215', class="move" title="(similarity 100%)">Object</a><a id='7218' tid='7217', class="move" title="(similarity 100%)">*</a> <a id='7220' tid='7219', class="move" title="(similarity 100%)">obj</a> = <a id='7222' tid='7221', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='7224' tid='7223', class="move" title="(similarity 100%)">Object</a><a id='7226' tid='7225', class="move" title="(similarity 100%)">*</a>&gt;(<a id='7228' tid='7227', class="move" title="(similarity 100%)">value</a>);
            <a id='7230' tid='7229', class="move" title="(similarity 100%)">PrintF</a>(<a id='7232' tid='7231', class="move" title="(similarity 100%)">&quot;%s: \n&quot;</a>, <a id='7234' tid='7233', class="move" title="(similarity 100%)">arg1</a>);
#<a id='7236' tid='7235', class="move" title="(similarity 100%)">ifdef</a> <a id='7238' tid='7237', class="move" title="(similarity 100%)">DEBUG</a>
            <a id='7240' tid='7239', class="move" title="(similarity 100%)">obj</a>-&gt;<a id='7242' tid='7241', class="move" title="(similarity 100%)">PrintLn</a>();
#<a id='7244' tid='7243', class="move" title="(similarity 100%)">else</a>
            <a id='7246' tid='7245', class="move" title="(similarity 100%)">obj</a>-&gt;<a id='7248' tid='7247', class="move" title="(similarity 100%)">ShortPrint</a>();
            <a id='7250' tid='7249', class="move" title="(similarity 100%)">PrintF</a>(<a id='7252' tid='7251', class="move" title="(similarity 100%)">&quot;\n&quot;</a>);
#<a id='7254' tid='7253', class="move" title="(similarity 100%)">endif</a>
          } <a id='7256' tid='7255', class="move" title="(similarity 100%)">else</a> {
            <a id='7258' tid='7257', class="move" title="(similarity 100%)">PrintF</a>(<a id='7260' tid='7259', class="move" title="(similarity 100%)">&quot;%s unrecognized\n&quot;</a>, <a id='7262' tid='7261', class="move" title="(similarity 100%)">arg1</a>);
          }
        } <a id='7264' tid='7263', class="move" title="(similarity 100%)">else</a> {
          <a id='7266' tid='7265', class="move" title="(similarity 100%)">PrintF</a>(<a id='7268' tid='7267', class="move" title="(similarity 100%)">&quot;printobject &lt;value&gt;\n&quot;</a>);
        }
      } <a id='7270' tid='7269', class="move" title="(similarity 100%)">else</a> <a id='7272' tid='7271', class="move" title="(similarity 100%)">if</a> (<a id='7274' tid='7273', class="move" title="(similarity 100%)">strcmp</a>(<a id='7276' tid='7275', class="move" title="(similarity 100%)">cmd</a>, <a id='7278' tid='7277', class="move" title="(similarity 100%)">&quot;stack&quot;</a>) <a id='7280' tid='7279', class="move" title="(similarity 100%)">==</a> <a id='7282' tid='7281', class="move" title="(similarity 100%)">0</a> <a id='7284' tid='7283', class="move" title="(similarity 100%)">||</a> <a id='7286' tid='7285', class="move" title="(similarity 100%)">strcmp</a>(<a id='7288' tid='7287', class="move" title="(similarity 100%)">cmd</a>, <a id='7290' tid='7289', class="move" title="(similarity 100%)">&quot;mem&quot;</a>) <a id='7292' tid='7291', class="move" title="(similarity 100%)">==</a> <a id='7294' tid='7293', class="move" title="(similarity 100%)">0</a>) {
        <a id='7296' tid='7295', class="move" title="(similarity 100%)">int32_t</a><a id='7298' tid='7297', class="move" title="(similarity 100%)">*</a> <a id='7300' tid='7299', class="move" title="(similarity 100%)">cur</a> = <a id='7302' tid='7301', class="move" title="(similarity 100%)">NULL</a>;
        <a id='7304' tid='7303', class="move" title="(similarity 100%)">int32_t</a><a id='7306' tid='7305', class="move" title="(similarity 100%)">*</a> <a id='7308' tid='7307', class="move" title="(similarity 100%)">end</a> = <a id='7310' tid='7309', class="move" title="(similarity 100%)">NULL</a>;
        <a id='7312' tid='7311', class="move" title="(similarity 100%)">int</a> <a id='7314' tid='7313', class="move" title="(similarity 100%)">next_arg</a> = <a id='7316' tid='7315', class="move" title="(similarity 100%)">1</a>;

        <a id='7318' tid='7317', class="move" title="(similarity 100%)">if</a> (<a id='7320' tid='7319', class="move" title="(similarity 100%)">strcmp</a>(<a id='7322' tid='7321', class="move" title="(similarity 100%)">cmd</a>, <a id='7324' tid='7323', class="move" title="(similarity 100%)">&quot;stack&quot;</a>) <a id='7326' tid='7325', class="move" title="(similarity 100%)">==</a> <a id='7328' tid='7327', class="move" title="(similarity 100%)">0</a>) {
          <a id='7330' tid='7329', class="move" title="(similarity 100%)">cur</a> <a id='7332' tid='7331', class="move" title="(similarity 100%)">=</a> <a id='7334' tid='7333', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='7336' tid='7335', class="move" title="(similarity 100%)">int32_t</a><a id='7338' tid='7337', class="move" title="(similarity 100%)">*</a>&gt;(<a id='7340' tid='7339', class="move" title="(similarity 100%)">sim_</a>-&gt;<a id='7342' tid='7341', class="move" title="(similarity 100%)">get_register</a>(<a id='7344' tid='7343', class="move" title="(similarity 100%)">Simulator</a><a id='7346' tid='7345', class="move" title="(similarity 100%)">::</a><a id='7348' tid='7347', class="move" title="(similarity 100%)">sp</a>));
        } <a id='7350' tid='7349', class="move" title="(similarity 100%)">else</a> {  // &quot;mem&quot;
          <a id='7352' tid='7351', class="move" title="(similarity 100%)">int32_t</a> <a id='7354' tid='7353', class="move" title="(similarity 100%)">value</a>;
          <a id='7356' tid='7355', class="move" title="(similarity 100%)">if</a> (<a id='7358' tid='7357', class="move" title="(similarity 100%)">!</a><a id='7360' tid='7359', class="move" title="(similarity 100%)">GetValue</a>(<a id='7362' tid='7361', class="move" title="(similarity 100%)">arg1</a>, <a id='7364' tid='7363', class="move" title="(similarity 100%)">&</a><a id='7366' tid='7365', class="move" title="(similarity 100%)">value</a>)) {
            <a id='7368' tid='7367', class="move" title="(similarity 100%)">PrintF</a>(<a id='7370' tid='7369', class="move" title="(similarity 100%)">&quot;%s unrecognized\n&quot;</a>, <a id='7372' tid='7371', class="move" title="(similarity 100%)">arg1</a>);
            <a id='7374' tid='7373', class="move" title="(similarity 100%)">continue</a>;
          }
          <a id='7376' tid='7375', class="move" title="(similarity 100%)">cur</a> <a id='7378' tid='7377', class="move" title="(similarity 100%)">=</a> <a id='7380' tid='7379', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='7382' tid='7381', class="move" title="(similarity 100%)">int32_t</a><a id='7384' tid='7383', class="move" title="(similarity 100%)">*</a>&gt;(<a id='7386' tid='7385', class="move" title="(similarity 100%)">value</a>);
          <a id='7388' tid='7387', class="move" title="(similarity 100%)">next_arg</a><a id='7390' tid='7389', class="move" title="(similarity 100%)">++</a>;
        }

        <a id='7392' tid='7391', class="move" title="(similarity 100%)">int32_t</a> <a id='7394' tid='7393', class="move" title="(similarity 100%)">words</a>;
        <a id='7396' tid='7395', class="move" title="(similarity 100%)">if</a> (<a id='7398' tid='7397', class="move" title="(similarity 100%)">argc</a> <a id='7400' tid='7399', class="move" title="(similarity 100%)">==</a> <a id='7402' tid='7401', class="move" title="(similarity 100%)">next_arg</a>) {
          <a id='7404' tid='7403', class="move" title="(similarity 100%)">words</a> <a id='7406' tid='7405', class="move" title="(similarity 100%)">=</a> <a id='7408' tid='7407', class="move" title="(similarity 100%)">10</a>;
        } <a id='7410' tid='7409', class="move" title="(similarity 100%)">else</a> <a id='7412' tid='7411', class="move" title="(similarity 100%)">if</a> (<a id='7414' tid='7413', class="move" title="(similarity 100%)">argc</a> <a id='7416' tid='7415', class="move" title="(similarity 100%)">==</a> <a id='7418' tid='7417', class="move" title="(similarity 100%)">next_arg</a> <a id='7420' tid='7419', class="move" title="(similarity 100%)">+</a> <a id='7422' tid='7421', class="move" title="(similarity 100%)">1</a>) {
          <a id='7424' tid='7423', class="move" title="(similarity 100%)">if</a> (<a id='7426' tid='7425', class="move" title="(similarity 100%)">!</a><a id='7428' tid='7427', class="move" title="(similarity 100%)">GetValue</a>(<a id='7430' tid='7429', class="move" title="(similarity 100%)">argv</a>[<a id='7432' tid='7431', class="move" title="(similarity 100%)">next_arg</a>], <a id='7434' tid='7433', class="move" title="(similarity 100%)">&</a><a id='7436' tid='7435', class="move" title="(similarity 100%)">words</a>)) {
            <a id='7438' tid='7437', class="move" title="(similarity 100%)">words</a> <a id='7440' tid='7439', class="move" title="(similarity 100%)">=</a> <a id='7442' tid='7441', class="move" title="(similarity 100%)">10</a>;
          }
        }
        <a id='7444' tid='7443', class="move" title="(similarity 100%)">end</a> <a id='7446' tid='7445', class="move" title="(similarity 100%)">=</a> <a id='7448' tid='7447', class="move" title="(similarity 100%)">cur</a> <a id='7450' tid='7449', class="move" title="(similarity 100%)">+</a> <a id='7452' tid='7451', class="move" title="(similarity 100%)">words</a>;

        <a id='7454' tid='7453', class="move" title="(similarity 100%)">while</a> (<a id='7456' tid='7455', class="move" title="(similarity 100%)">cur</a> <a id='7458' tid='7457', class="move" title="(similarity 100%)">&lt;</a> <a id='7460' tid='7459', class="move" title="(similarity 100%)">end</a>) {
          <a id='7462' tid='7461', class="move" title="(similarity 100%)">PrintF</a>(<a id='7464' tid='7463', class="move" title="(similarity 100%)">&quot;  0x%08x:  0x%08x %10d&quot;</a>,
                 <a id='7466' tid='7465', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='7468' tid='7467', class="move" title="(similarity 100%)">intptr_t</a>&gt;(<a id='7470' tid='7469', class="move" title="(similarity 100%)">cur</a>), <a id='7472' tid='7471', class="move" title="(similarity 100%)">*</a><a id='7474' tid='7473', class="move" title="(similarity 100%)">cur</a>, <a id='7476' tid='7475', class="move" title="(similarity 100%)">*</a><a id='7478' tid='7477', class="move" title="(similarity 100%)">cur</a>);
          <a id='7480' tid='7479', class="move" title="(similarity 100%)">HeapObject</a><a id='7482' tid='7481', class="move" title="(similarity 100%)">*</a> <a id='7484' tid='7483', class="move" title="(similarity 100%)">obj</a> = <a id='7486' tid='7485', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='7488' tid='7487', class="move" title="(similarity 100%)">HeapObject</a><a id='7490' tid='7489', class="move" title="(similarity 100%)">*</a>&gt;(<a id='7492' tid='7491', class="move" title="(similarity 100%)">*</a><a id='7494' tid='7493', class="move" title="(similarity 100%)">cur</a>);
          <a id='7496' tid='7495', class="move" title="(similarity 100%)">int</a> <a id='7498' tid='7497', class="move" title="(similarity 100%)">value</a> = <a id='7500' tid='7499', class="move" title="(similarity 100%)">*</a><a id='7502' tid='7501', class="move" title="(similarity 100%)">cur</a>;
          <a id='7504' tid='7503', class="move" title="(similarity 100%)">Heap</a><a id='7506' tid='7505', class="move" title="(similarity 100%)">*</a> <a id='7508' tid='7507', class="move" title="(similarity 100%)">current_heap</a> = <a id='7510' tid='7509', class="move" title="(similarity 100%)">v8</a><a id='7512' tid='7511', class="move" title="(similarity 100%)">::</a><a id='7514' tid='7513', class="move" title="(similarity 100%)">internal</a><a id='7516' tid='7515', class="move" title="(similarity 100%)">::</a><a id='7518' tid='7517', class="move" title="(similarity 100%)">Isolate</a><a id='7520' tid='7519', class="move" title="(similarity 100%)">::</a><a id='7522' tid='7521', class="move" title="(similarity 100%)">Current</a>()-&gt;<a id='7524' tid='7523', class="move" title="(similarity 100%)">heap</a>();
          <a id='7526' tid='7525', class="move" title="(similarity 100%)">if</a> (<a id='7528' tid='7527', class="move" title="(similarity 100%)">current_heap</a>-&gt;<a id='7530' tid='7529', class="move" title="(similarity 100%)">Contains</a>(<a id='7532' tid='7531', class="move" title="(similarity 100%)">obj</a>) <a id='7534' tid='7533', class="move" title="(similarity 100%)">||</a> ((<a id='7536' tid='7535', class="move" title="(similarity 100%)">value</a> <a id='7538' tid='7537', class="move" title="(similarity 100%)">&</a> <a id='7540' tid='7539', class="move" title="(similarity 100%)">1</a>) <a id='7542' tid='7541', class="move" title="(similarity 100%)">==</a> <a id='7544' tid='7543', class="move" title="(similarity 100%)">0</a>)) {
            <a id='7546' tid='7545', class="move" title="(similarity 100%)">PrintF</a>(<a id='7548' tid='7547', class="move" title="(similarity 100%)">&quot; (&quot;</a>);
            <a id='7550' tid='7549', class="move" title="(similarity 100%)">if</a> ((<a id='7552' tid='7551', class="move" title="(similarity 100%)">value</a> <a id='7554' tid='7553', class="move" title="(similarity 100%)">&</a> <a id='7556' tid='7555', class="move" title="(similarity 100%)">1</a>) <a id='7558' tid='7557', class="move" title="(similarity 100%)">==</a> <a id='7560' tid='7559', class="move" title="(similarity 100%)">0</a>) {
              <a id='7562' tid='7561', class="move" title="(similarity 100%)">PrintF</a>(<a id='7564' tid='7563', class="move" title="(similarity 100%)">&quot;smi %d&quot;</a>, <a id='7566' tid='7565', class="move" title="(similarity 100%)">value</a> <a id='7568' tid='7567', class="move" title="(similarity 100%)">/</a> <a id='7570' tid='7569', class="move" title="(similarity 100%)">2</a>);
            } <a id='7572' tid='7571', class="move" title="(similarity 100%)">else</a> {
              <a id='7574' tid='7573', class="move" title="(similarity 100%)">obj</a>-&gt;<a id='7576' tid='7575', class="move" title="(similarity 100%)">ShortPrint</a>();
            }
            <a id='7578' tid='7577', class="move" title="(similarity 100%)">PrintF</a>(<a id='7580' tid='7579', class="move" title="(similarity 100%)">&quot;)&quot;</a>);
          }
          <a id='7582' tid='7581', class="move" title="(similarity 100%)">PrintF</a>(<a id='7584' tid='7583', class="move" title="(similarity 100%)">&quot;\n&quot;</a>);
          <a id='7586' tid='7585', class="move" title="(similarity 100%)">cur</a><a id='7588' tid='7587', class="move" title="(similarity 100%)">++</a>;
        }
      } <a id='7590' tid='7589', class="move" title="(similarity 100%)">else</a> <span class="insertion" title="inserted">if</span> <span class="insertion" title="inserted">(strcmp(cmd, &quot;disasm&quot;) == 0 || strcmp(cmd, &quot;di&quot;) == 0)</span> {
        <span class="insertion" title="inserted">disasm::NameConverter converter;</span>
        <span class="insertion" title="inserted">disasm::Disassembler dasm(converter)</span>;
        // use a reasonably large buffer
        <a id='7592' tid='7591', class="move" title="(similarity 100%)">v8</a><a id='7594' tid='7593', class="move" title="(similarity 100%)">::</a><a id='7596' tid='7595', class="move" title="(similarity 100%)">internal</a><a id='7598' tid='7597', class="move" title="(similarity 100%)">::</a><a id='7600' tid='7599', class="move" title="(similarity 100%)">EmbeddedVector</a>&lt;<a id='7602' tid='7601', class="move" title="(similarity 100%)">char</a>, <a id='7604' tid='7603', class="move" title="(similarity 100%)">256</a>&gt; <a id='7606' tid='7605', class="move" title="(similarity 100%)">buffer</a>;

        <span class="insertion" title="inserted">byte* prev = NULL;</span>
        <span class="insertion" title="inserted">byte* cur = NULL;</span>
        <span class="insertion" title="inserted">byte* end = NULL;</span>

        <a id='6126' tid='6125', class="move" title="(similarity 100%)">if</a> (<a id='6128' tid='6127', class="move" title="(similarity 100%)">argc</a> <a id='6130' tid='6129', class="move" title="(similarity 100%)">==</a> <a id='6132' tid='6131', class="move" title="(similarity 100%)">1</a>) {
          <a id='6134' tid='6133', class="move" title="(similarity 100%)">cur</a> <a id='6136' tid='6135', class="move" title="(similarity 100%)">=</a> <a id='6138' tid='6137', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='6140' tid='6139', class="move" title="(similarity 100%)">byte</a><a id='6142' tid='6141', class="move" title="(similarity 100%)">*</a>&gt;(<a id='6144' tid='6143', class="move" title="(similarity 100%)">sim_</a>-&gt;<a id='6146' tid='6145', class="move" title="(similarity 100%)">get_pc</a>());
          <a id='6148' tid='6147', class="move" title="(similarity 100%)">end</a> <a id='6150' tid='6149', class="move" title="(similarity 100%)">=</a> <a id='6152' tid='6151', class="move" title="(similarity 100%)">cur</a> <a id='6154' tid='6153', class="move" title="(similarity 100%)">+</a> (<a id='6156' tid='6155', class="move" title="(similarity 100%)">10</a> <a id='6158' tid='6157', class="move" title="(similarity 100%)">*</a> <a id='6160' tid='6159', class="move" title="(similarity 100%)">Instruction</a><a id='6162' tid='6161', class="move" title="(similarity 100%)">::</a><a id='6164' tid='6163', class="move" title="(similarity 100%)">kInstrSize</a>);
        } <a id='6166' tid='6165', class="move" title="(similarity 100%)">else</a> <a id='6168' tid='6167', class="move" title="(similarity 100%)">if</a> (<a id='6170' tid='6169', class="move" title="(similarity 100%)">argc</a> <a id='6172' tid='6171', class="move" title="(similarity 100%)">==</a> <a id='6174' tid='6173', class="move" title="(similarity 100%)">2</a>) {
          <span class="insertion" title="inserted">int regnum = Registers::Number(arg1);</span>
          <span class="insertion" title="inserted">if</span> <span class="insertion" title="inserted">(regnum != kNoRegister || strncmp(arg1, &quot;0x&quot;, 2) == 0)</span> {
            // The argument is an address or a register name.
            <a id='6176' tid='6175', class="move" title="(similarity 100%)">int32_t</a> <a id='6178' tid='6177', class="move" title="(similarity 100%)">value</a>;
            <a id='6180' tid='6179', class="move" title="(similarity 100%)">if</a> (<a id='6182' tid='6181', class="move" title="(similarity 100%)">GetValue</a>(<a id='6184' tid='6183', class="move" title="(similarity 100%)">arg1</a>, <a id='6186' tid='6185', class="move" title="(similarity 100%)">&</a><a id='6188' tid='6187', class="move" title="(similarity 100%)">value</a>)) {
              <a id='6190' tid='6189', class="move" title="(similarity 100%)">cur</a> <a id='6192' tid='6191', class="move" title="(similarity 100%)">=</a> <a id='6194' tid='6193', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='6196' tid='6195', class="move" title="(similarity 100%)">byte</a><a id='6198' tid='6197', class="move" title="(similarity 100%)">*</a>&gt;(<a id='6200' tid='6199', class="move" title="(similarity 100%)">value</a>);
              // Disassemble 10 instructions at &lt;arg1&gt;.
              <a id='6202' tid='6201', class="move" title="(similarity 100%)">end</a> <a id='6204' tid='6203', class="move" title="(similarity 100%)">=</a> <a id='6206' tid='6205', class="move" title="(similarity 100%)">cur</a> <a id='6208' tid='6207', class="move" title="(similarity 100%)">+</a> (<a id='6210' tid='6209', class="move" title="(similarity 100%)">10</a> <a id='6212' tid='6211', class="move" title="(similarity 100%)">*</a> <a id='6214' tid='6213', class="move" title="(similarity 100%)">Instruction</a><a id='6216' tid='6215', class="move" title="(similarity 100%)">::</a><a id='6218' tid='6217', class="move" title="(similarity 100%)">kInstrSize</a>);
            }
          } <a id='5858' tid='5857', class="move" title="(similarity 100%)">else</a> {
            // The argument is the number of instructions.
            <a id='5860' tid='5859', class="move" title="(similarity 100%)">int32_t</a> <a id='5862' tid='5861', class="move" title="(similarity 100%)">value</a>;
            <a id='5864' tid='5863', class="move" title="(similarity 100%)">if</a> (<a id='5866' tid='5865', class="move" title="(similarity 100%)">GetValue</a>(<a id='5868' tid='5867', class="move" title="(similarity 100%)">arg1</a>, <a id='5870' tid='5869', class="move" title="(similarity 100%)">&</a><a id='5872' tid='5871', class="move" title="(similarity 100%)">value</a>)) {
              <a id='5874' tid='5873', class="move" title="(similarity 100%)">cur</a> <a id='5876' tid='5875', class="move" title="(similarity 100%)">=</a> <a id='5878' tid='5877', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='5880' tid='5879', class="move" title="(similarity 100%)">byte</a><a id='5882' tid='5881', class="move" title="(similarity 100%)">*</a>&gt;(<a id='5884' tid='5883', class="move" title="(similarity 100%)">sim_</a>-&gt;<a id='5886' tid='5885', class="move" title="(similarity 100%)">get_pc</a>());
              // Disassemble &lt;arg1&gt; instructions.
              <a id='5888' tid='5887', class="move" title="(similarity 100%)">end</a> <a id='5890' tid='5889', class="move" title="(similarity 100%)">=</a> <a id='5892' tid='5891', class="move" title="(similarity 100%)">cur</a> <a id='5894' tid='5893', class="move" title="(similarity 100%)">+</a> (<a id='5896' tid='5895', class="move" title="(similarity 100%)">value</a> <a id='5898' tid='5897', class="move" title="(similarity 100%)">*</a> <a id='5900' tid='5899', class="move" title="(similarity 100%)">Instruction</a><a id='5902' tid='5901', class="move" title="(similarity 100%)">::</a><a id='5904' tid='5903', class="move" title="(similarity 100%)">kInstrSize</a>);
            }
          }
        } <a id='6220' tid='6219', class="move" title="(similarity 100%)">else</a> {
          <a id='6222' tid='6221', class="move" title="(similarity 100%)">int32_t</a> <a id='6224' tid='6223', class="move" title="(similarity 100%)">value1</a>;
          <a id='6226' tid='6225', class="move" title="(similarity 100%)">int32_t</a> <a id='6228' tid='6227', class="move" title="(similarity 100%)">value2</a>;
          <a id='6230' tid='6229', class="move" title="(similarity 100%)">if</a> (<a id='6232' tid='6231', class="move" title="(similarity 100%)">GetValue</a>(<a id='6234' tid='6233', class="move" title="(similarity 100%)">arg1</a>, <a id='6236' tid='6235', class="move" title="(similarity 100%)">&</a><a id='6238' tid='6237', class="move" title="(similarity 100%)">value1</a>) <a id='6240' tid='6239', class="move" title="(similarity 100%)">&&</a> <a id='6242' tid='6241', class="move" title="(similarity 100%)">GetValue</a>(<a id='6244' tid='6243', class="move" title="(similarity 100%)">arg2</a>, <a id='6246' tid='6245', class="move" title="(similarity 100%)">&</a><a id='6248' tid='6247', class="move" title="(similarity 100%)">value2</a>)) {
            <a id='6250' tid='6249', class="move" title="(similarity 100%)">cur</a> <a id='6252' tid='6251', class="move" title="(similarity 100%)">=</a> <a id='6254' tid='6253', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='6256' tid='6255', class="move" title="(similarity 100%)">byte</a><a id='6258' tid='6257', class="move" title="(similarity 100%)">*</a>&gt;(<a id='6260' tid='6259', class="move" title="(similarity 100%)">value1</a>);
            <a id='6262' tid='6261', class="move" title="(similarity 100%)">end</a> <a id='6264' tid='6263', class="move" title="(similarity 100%)">=</a> <a id='6266' tid='6265', class="move" title="(similarity 100%)">cur</a> <a id='6268' tid='6267', class="move" title="(similarity 100%)">+</a> (<a id='6270' tid='6269', class="move" title="(similarity 100%)">value2</a> <a id='6272' tid='6271', class="move" title="(similarity 100%)">*</a> <a id='6274' tid='6273', class="move" title="(similarity 100%)">Instruction</a><a id='6276' tid='6275', class="move" title="(similarity 100%)">::</a><a id='6278' tid='6277', class="move" title="(similarity 100%)">kInstrSize</a>);
          }
        }

        <span class="insertion" title="inserted">while (cur &lt; end) {
          prev = cur;
          cur += dasm.InstructionDecode(buffer, cur);
          PrintF(&quot;  0x%08x  %s\n&quot;,
                 reinterpret_cast&lt;intptr_t&gt;(prev), buffer.start());
        }</span>
      } <span class="insertion" title="inserted">else</span> <a id='6714' tid='6713', class="move" title="(similarity 100%)">if</a> (<a id='6716' tid='6715', class="move" title="(similarity 100%)">strcmp</a>(<a id='6718' tid='6717', class="move" title="(similarity 100%)">cmd</a>, <a id='6720' tid='6719', class="move" title="(similarity 100%)">&quot;gdb&quot;</a>) <a id='6722' tid='6721', class="move" title="(similarity 100%)">==</a> <a id='6724' tid='6723', class="move" title="(similarity 100%)">0</a>) {
        <a id='7088' tid='7087', class="move" title="(similarity 100%)">PrintF</a>(<a id='7090' tid='7089', class="move" title="(similarity 100%)">&quot;relinquishing control to gdb\n&quot;</a>);
        <a id='7092' tid='7091', class="move" title="(similarity 100%)">v8</a><a id='7094' tid='7093', class="move" title="(similarity 100%)">::</a><a id='7096' tid='7095', class="move" title="(similarity 100%)">internal</a><a id='7098' tid='7097', class="move" title="(similarity 100%)">::</a><a id='7100' tid='7099', class="move" title="(similarity 100%)">OS</a><a id='7102' tid='7101', class="move" title="(similarity 100%)">::</a><a id='7104' tid='7103', class="move" title="(similarity 100%)">DebugBreak</a>();
        <a id='7106' tid='7105', class="move" title="(similarity 100%)">PrintF</a>(<a id='7108' tid='7107', class="move" title="(similarity 100%)">&quot;regaining control from gdb\n&quot;</a>);
      } <a id='6726' tid='6725', class="move" title="(similarity 100%)">else</a> <a id='6728' tid='6727', class="move" title="(similarity 100%)">if</a> (<a id='6730' tid='6729', class="move" title="(similarity 100%)">strcmp</a>(<a id='6732' tid='6731', class="move" title="(similarity 100%)">cmd</a>, <a id='6734' tid='6733', class="move" title="(similarity 100%)">&quot;break&quot;</a>) <a id='6736' tid='6735', class="move" title="(similarity 100%)">==</a> <a id='6738' tid='6737', class="move" title="(similarity 100%)">0</a>) {
        <a id='6740' tid='6739', class="move" title="(similarity 100%)">if</a> (<a id='6742' tid='6741', class="move" title="(similarity 100%)">argc</a> <a id='6744' tid='6743', class="move" title="(similarity 100%)">==</a> <a id='6746' tid='6745', class="move" title="(similarity 100%)">2</a>) {
          <a id='6748' tid='6747', class="move" title="(similarity 100%)">int32_t</a> <a id='6750' tid='6749', class="move" title="(similarity 100%)">value</a>;
          <a id='6752' tid='6751', class="move" title="(similarity 100%)">if</a> (<a id='6754' tid='6753', class="move" title="(similarity 100%)">GetValue</a>(<a id='6756' tid='6755', class="move" title="(similarity 100%)">arg1</a>, <a id='6758' tid='6757', class="move" title="(similarity 100%)">&</a><a id='6760' tid='6759', class="move" title="(similarity 100%)">value</a>)) {
            <a id='6762' tid='6761', class="move" title="(similarity 100%)">if</a> (<a id='6764' tid='6763', class="move" title="(similarity 100%)">!</a><a id='6766' tid='6765', class="move" title="(similarity 100%)">SetBreakpoint</a>(<a id='6768' tid='6767', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='6770' tid='6769', class="move" title="(similarity 100%)">Instruction</a><a id='6772' tid='6771', class="move" title="(similarity 100%)">*</a>&gt;(<a id='6774' tid='6773', class="move" title="(similarity 100%)">value</a>))) {
              <a id='6776' tid='6775', class="move" title="(similarity 100%)">PrintF</a>(<a id='6778' tid='6777', class="move" title="(similarity 100%)">&quot;setting breakpoint failed\n&quot;</a>);
            }
          } <a id='6780' tid='6779', class="move" title="(similarity 100%)">else</a> {
            <a id='6782' tid='6781', class="move" title="(similarity 100%)">PrintF</a>(<a id='6784' tid='6783', class="move" title="(similarity 100%)">&quot;%s unrecognized\n&quot;</a>, <a id='6786' tid='6785', class="move" title="(similarity 100%)">arg1</a>);
          }
        } <a id='6788' tid='6787', class="move" title="(similarity 100%)">else</a> {
          <a id='6790' tid='6789', class="move" title="(similarity 100%)">PrintF</a>(<a id='6792' tid='6791', class="move" title="(similarity 100%)">&quot;break &lt;address&gt;\n&quot;</a>);
        }
      } <a id='6794' tid='6793', class="move" title="(similarity 100%)">else</a> <a id='6796' tid='6795', class="move" title="(similarity 100%)">if</a> (<a id='6798' tid='6797', class="move" title="(similarity 100%)">strcmp</a>(<a id='6800' tid='6799', class="move" title="(similarity 100%)">cmd</a>, <a id='6802' tid='6801', class="move" title="(similarity 100%)">&quot;del&quot;</a>) <a id='6804' tid='6803', class="move" title="(similarity 100%)">==</a> <a id='6806' tid='6805', class="move" title="(similarity 100%)">0</a>) {
        <a id='6808' tid='6807', class="move" title="(similarity 100%)">if</a> (<a id='6810' tid='6809', class="move" title="(similarity 100%)">!</a><a id='6812' tid='6811', class="move" title="(similarity 100%)">DeleteBreakpoint</a>(<a id='6814' tid='6813', class="move" title="(similarity 100%)">NULL</a>)) {
          <a id='6816' tid='6815', class="move" title="(similarity 100%)">PrintF</a>(<a id='6818' tid='6817', class="move" title="(similarity 100%)">&quot;deleting breakpoint failed\n&quot;</a>);
        }
      } <a id='6820' tid='6819', class="move" title="(similarity 100%)">else</a> <span class="insertion" title="inserted">if</span> <span class="insertion" title="inserted">(strcmp(cmd, &quot;flags&quot;) == 0)</span> <span class="insertion" title="inserted">{
        PrintF(&quot;N flag: %d; &quot;, sim_-&gt;n_flag_);
        PrintF(&quot;Z flag: %d; &quot;, sim_-&gt;z_flag_);
        PrintF(&quot;C flag: %d; &quot;, sim_-&gt;c_flag_);
        PrintF(&quot;V flag: %d\n&quot;, sim_-&gt;v_flag_);
        PrintF(&quot;INVALID OP flag: %d; &quot;, sim_-&gt;inv_op_vfp_flag_);
        PrintF(&quot;DIV BY ZERO flag: %d; &quot;, sim_-&gt;div_zero_vfp_flag_);
        PrintF(&quot;OVERFLOW flag: %d; &quot;, sim_-&gt;overflow_vfp_flag_);
        PrintF(&quot;UNDERFLOW flag: %d; &quot;, sim_-&gt;underflow_vfp_flag_);
        PrintF(&quot;INEXACT flag: %d;\n&quot;, sim_-&gt;inexact_vfp_flag_);
      }</span> <span class="insertion" title="inserted">else</span> <a id='6448' tid='6447', class="move" title="(similarity 100%)">if</a> (<a id='6450' tid='6449', class="move" title="(similarity 100%)">strcmp</a>(<a id='6452' tid='6451', class="move" title="(similarity 100%)">cmd</a>, <a id='6454' tid='6453', class="move" title="(similarity 100%)">&quot;stop&quot;</a>) <a id='6456' tid='6455', class="move" title="(similarity 100%)">==</a> <a id='6458' tid='6457', class="move" title="(similarity 100%)">0</a>) {
        <a id='6822' tid='6821', class="move" title="(similarity 100%)">int32_t</a> <a id='6824' tid='6823', class="move" title="(similarity 100%)">value</a>;
        <a id='6826' tid='6825', class="move" title="(similarity 100%)">intptr_t</a> <a id='6828' tid='6827', class="move" title="(similarity 100%)">stop_pc</a> = <a id='6830' tid='6829', class="move" title="(similarity 100%)">sim_</a>-&gt;<a id='6832' tid='6831', class="move" title="(similarity 100%)">get_pc</a>() <a id='6834' tid='6833', class="move" title="(similarity 100%)">-</a> <a id='6836' tid='6835', class="move" title="(similarity 100%)">2</a> <a id='6838' tid='6837', class="move" title="(similarity 100%)">*</a> <a id='6840' tid='6839', class="move" title="(similarity 100%)">Instruction</a><a id='6842' tid='6841', class="move" title="(similarity 100%)">::</a><a id='6844' tid='6843', class="move" title="(similarity 100%)">kInstrSize</a>;
        <a id='6846' tid='6845', class="move" title="(similarity 100%)">Instruction</a><a id='6848' tid='6847', class="move" title="(similarity 100%)">*</a> <a id='6850' tid='6849', class="move" title="(similarity 100%)">stop_instr</a> = <a id='6852' tid='6851', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='6854' tid='6853', class="move" title="(similarity 100%)">Instruction</a><a id='6856' tid='6855', class="move" title="(similarity 100%)">*</a>&gt;(<a id='6858' tid='6857', class="move" title="(similarity 100%)">stop_pc</a>);
        <a id='6860' tid='6859', class="move" title="(similarity 100%)">Instruction</a><a id='6862' tid='6861', class="move" title="(similarity 100%)">*</a> <a id='6864' tid='6863', class="move" title="(similarity 100%)">msg_address</a> =
          <a id='6866' tid='6865', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='6868' tid='6867', class="move" title="(similarity 100%)">Instruction</a><a id='6870' tid='6869', class="move" title="(similarity 100%)">*</a>&gt;(<a id='6872' tid='6871', class="move" title="(similarity 100%)">stop_pc</a> <a id='6874' tid='6873', class="move" title="(similarity 100%)">+</a> <a id='6876' tid='6875', class="move" title="(similarity 100%)">Instruction</a><a id='6878' tid='6877', class="move" title="(similarity 100%)">::</a><a id='6880' tid='6879', class="move" title="(similarity 100%)">kInstrSize</a>);
        <span class="insertion" title="inserted">if</span> ((<a id='6882' tid='6881', class="move" title="(similarity 100%)">argc</a> <a id='6884' tid='6883', class="move" title="(similarity 100%)">==</a> <a id='6886' tid='6885', class="move" title="(similarity 100%)">2</a>) <a id='6888' tid='6887', class="move" title="(similarity 100%)">&&</a> (<a id='6890' tid='6889', class="move" title="(similarity 100%)">strcmp</a>(<a id='6892' tid='6891', class="move" title="(similarity 100%)">arg1</a>, <a id='6894' tid='6893', class="move" title="(similarity 100%)">&quot;unstop&quot;</a>) <a id='6896' tid='6895', class="move" title="(similarity 100%)">==</a> <a id='6898' tid='6897', class="move" title="(similarity 100%)">0</a>)) <span class="insertion" title="inserted">{
          // Remove the current stop.
          if (sim_-&gt;isStopInstruction(stop_instr)) {
            stop_instr-&gt;SetInstructionBits(kNopInstr);
            msg_address-&gt;SetInstructionBits(kNopInstr);
          } else {
            PrintF(&quot;Not at debugger stop.\n&quot;);
          }
        }</span> <a id='6486' tid='6485', class="move" title="(similarity 100%)">else</a> <a id='6488' tid='6487', class="move" title="(similarity 100%)">if</a> (<a id='6490' tid='6489', class="move" title="(similarity 100%)">argc</a> <a id='6492' tid='6491', class="move" title="(similarity 100%)">==</a> <a id='6494' tid='6493', class="move" title="(similarity 100%)">3</a>) {
          // Print information about all/the specified breakpoint(s).
          <a id='6496' tid='6495', class="move" title="(similarity 100%)">if</a> (<a id='6498' tid='6497', class="move" title="(similarity 100%)">strcmp</a>(<a id='6500' tid='6499', class="move" title="(similarity 100%)">arg1</a>, <a id='6502' tid='6501', class="move" title="(similarity 100%)">&quot;info&quot;</a>) <a id='6504' tid='6503', class="move" title="(similarity 100%)">==</a> <a id='6506' tid='6505', class="move" title="(similarity 100%)">0</a>) {
            <span class="insertion" title="inserted">if</span> <span class="insertion" title="inserted">(strcmp(arg2, &quot;all&quot;) == 0)</span> <span class="insertion" title="inserted">{
              PrintF(&quot;Stop information:\n&quot;);
              for (uint32_t i = 0; i &lt; sim_-&gt;kNumOfWatchedStops; i++) {
                sim_-&gt;PrintStopInfo(i);
              }
            }</span> <a id='6508' tid='6507', class="move" title="(similarity 100%)">else</a> <a id='6510' tid='6509', class="move" title="(similarity 100%)">if</a> (<a id='6512' tid='6511', class="move" title="(similarity 100%)">GetValue</a>(<a id='6514' tid='6513', class="move" title="(similarity 100%)">arg2</a>, <a id='6516' tid='6515', class="move" title="(similarity 100%)">&</a><a id='6518' tid='6517', class="move" title="(similarity 100%)">value</a>)) {
              <a id='6520' tid='6519', class="move" title="(similarity 100%)">sim_</a>-&gt;<a id='6522' tid='6521', class="move" title="(similarity 100%)">PrintStopInfo</a>(<a id='6524' tid='6523', class="move" title="(similarity 100%)">value</a>);
            } <a id='6526' tid='6525', class="move" title="(similarity 100%)">else</a> {
              <a id='6528' tid='6527', class="move" title="(similarity 100%)">PrintF</a>(<a id='6530' tid='6529', class="move" title="(similarity 100%)">&quot;Unrecognized argument.\n&quot;</a>);
            }
          } <a id='6532' tid='6531', class="move" title="(similarity 100%)">else</a> <a id='6534' tid='6533', class="move" title="(similarity 100%)">if</a> (<a id='6536' tid='6535', class="move" title="(similarity 100%)">strcmp</a>(<a id='6538' tid='6537', class="move" title="(similarity 100%)">arg1</a>, <a id='6540' tid='6539', class="move" title="(similarity 100%)">&quot;enable&quot;</a>) <a id='6542' tid='6541', class="move" title="(similarity 100%)">==</a> <a id='6544' tid='6543', class="move" title="(similarity 100%)">0</a>) {
            // Enable all/the specified breakpoint(s).
            <span class="insertion" title="inserted">if</span> <span class="insertion" title="inserted">(strcmp(arg2, &quot;all&quot;) == 0)</span> <span class="insertion" title="inserted">{
              for (uint32_t i = 0; i &lt; sim_-&gt;kNumOfWatchedStops; i++) {
                sim_-&gt;EnableStop(i);
              }
            }</span> <a id='6546' tid='6545', class="move" title="(similarity 100%)">else</a> <a id='6548' tid='6547', class="move" title="(similarity 100%)">if</a> (<a id='6550' tid='6549', class="move" title="(similarity 100%)">GetValue</a>(<a id='6552' tid='6551', class="move" title="(similarity 100%)">arg2</a>, <a id='6554' tid='6553', class="move" title="(similarity 100%)">&</a><a id='6556' tid='6555', class="move" title="(similarity 100%)">value</a>)) {
              <a id='6558' tid='6557', class="move" title="(similarity 100%)">sim_</a>-&gt;<a id='6560' tid='6559', class="move" title="(similarity 100%)">EnableStop</a>(<a id='6562' tid='6561', class="move" title="(similarity 100%)">value</a>);
            } <a id='6564' tid='6563', class="move" title="(similarity 100%)">else</a> {
              <a id='6566' tid='6565', class="move" title="(similarity 100%)">PrintF</a>(<a id='6568' tid='6567', class="move" title="(similarity 100%)">&quot;Unrecognized argument.\n&quot;</a>);
            }
          } <a id='6570' tid='6569', class="move" title="(similarity 100%)">else</a> <a id='6572' tid='6571', class="move" title="(similarity 100%)">if</a> (<a id='6574' tid='6573', class="move" title="(similarity 100%)">strcmp</a>(<a id='6576' tid='6575', class="move" title="(similarity 100%)">arg1</a>, <a id='6578' tid='6577', class="move" title="(similarity 100%)">&quot;disable&quot;</a>) <a id='6580' tid='6579', class="move" title="(similarity 100%)">==</a> <a id='6582' tid='6581', class="move" title="(similarity 100%)">0</a>) {
            // Disable all/the specified breakpoint(s).
            <span class="insertion" title="inserted">if</span> <span class="insertion" title="inserted">(strcmp(arg2, &quot;all&quot;) == 0)</span> <span class="insertion" title="inserted">{
              for (uint32_t i = 0; i &lt; sim_-&gt;kNumOfWatchedStops; i++) {
                sim_-&gt;DisableStop(i);
              }
            }</span> <a id='6584' tid='6583', class="move" title="(similarity 100%)">else</a> <a id='6586' tid='6585', class="move" title="(similarity 100%)">if</a> (<a id='6588' tid='6587', class="move" title="(similarity 100%)">GetValue</a>(<a id='6590' tid='6589', class="move" title="(similarity 100%)">arg2</a>, <a id='6592' tid='6591', class="move" title="(similarity 100%)">&</a><a id='6594' tid='6593', class="move" title="(similarity 100%)">value</a>)) {
              <a id='6596' tid='6595', class="move" title="(similarity 100%)">sim_</a>-&gt;<a id='6598' tid='6597', class="move" title="(similarity 100%)">DisableStop</a>(<a id='6600' tid='6599', class="move" title="(similarity 100%)">value</a>);
            } <a id='6602' tid='6601', class="move" title="(similarity 100%)">else</a> {
              <a id='6604' tid='6603', class="move" title="(similarity 100%)">PrintF</a>(<a id='6606' tid='6605', class="move" title="(similarity 100%)">&quot;Unrecognized argument.\n&quot;</a>);
            }
          }
        } <a id='6608' tid='6607', class="move" title="(similarity 100%)">else</a> {
          <a id='6610' tid='6609', class="move" title="(similarity 100%)">PrintF</a>(<a id='6612' tid='6611', class="move" title="(similarity 100%)">&quot;Wrong usage. Use help command for more information.\n&quot;</a>);
        }
      } <a id='6460' tid='6459', class="move" title="(similarity 100%)">else</a> <span class="insertion" title="inserted">if</span> <span class="insertion" title="inserted">((strcmp(cmd, &quot;t&quot;) == 0) || strcmp(cmd, &quot;trace&quot;) == 0)</span> <span class="insertion" title="inserted">{
        ::v8::internal::FLAG_trace_sim = !::v8::internal::FLAG_trace_sim;
        PrintF(&quot;Trace of executed instructions is %s\n&quot;,
               ::v8::internal::FLAG_trace_sim ? &quot;on&quot; : &quot;off&quot;);
      }</span> <a id='6462' tid='6461', class="move" title="(similarity 100%)">else</a> <span class="insertion" title="inserted">if</span> ((<a id='6464' tid='6463', class="move" title="(similarity 100%)">strcmp</a>(<a id='6466' tid='6465', class="move" title="(similarity 100%)">cmd</a>, <a id='6468' tid='6467', class="move" title="(similarity 100%)">&quot;h&quot;</a>) <a id='6470' tid='6469', class="move" title="(similarity 100%)">==</a> <a id='6472' tid='6471', class="move" title="(similarity 100%)">0</a>) <a id='6474' tid='6473', class="move" title="(similarity 100%)">||</a> (<a id='6476' tid='6475', class="move" title="(similarity 100%)">strcmp</a>(<a id='6478' tid='6477', class="move" title="(similarity 100%)">cmd</a>, <a id='6480' tid='6479', class="move" title="(similarity 100%)">&quot;help&quot;</a>) <a id='6482' tid='6481', class="move" title="(similarity 100%)">==</a> <a id='6484' tid='6483', class="move" title="(similarity 100%)">0</a>)) <span class="insertion" title="inserted">{
        PrintF(&quot;cont\n&quot;);
        PrintF(&quot;  continue execution (alias &#39;c&#39;)\n&quot;);
        PrintF(&quot;stepi\n&quot;);
        PrintF(&quot;  step one instruction (alias &#39;si&#39;)\n&quot;);
        PrintF(&quot;print &lt;register&gt;\n&quot;);
        PrintF(&quot;  print register content (alias &#39;p&#39;)\n&quot;);
        PrintF(&quot;  use register name &#39;all&#39; to print all registers\n&quot;);
        PrintF(&quot;  add argument &#39;fp&#39; to print register pair double values\n&quot;);
        PrintF(&quot;printobject &lt;register&gt;\n&quot;);
        PrintF(&quot;  print an object from a register (alias &#39;po&#39;)\n&quot;);
        PrintF(&quot;flags\n&quot;);
        PrintF(&quot;  print flags\n&quot;);
        PrintF(&quot;stack [&lt;words&gt;]\n&quot;);
        PrintF(&quot;  dump stack content, default dump 10 words)\n&quot;);
        PrintF(&quot;mem &lt;address&gt; [&lt;words&gt;]\n&quot;);
        PrintF(&quot;  dump memory content, default dump 10 words)\n&quot;);
        PrintF(&quot;disasm [&lt;instructions&gt;]\n&quot;);
        PrintF(&quot;disasm [&lt;address/register&gt;]\n&quot;);
        PrintF(&quot;disasm [[&lt;address/register&gt;] &lt;instructions&gt;]\n&quot;);
        PrintF(&quot;  disassemble code, default is 10 instructions\n&quot;);
        PrintF(&quot;  from pc (alias &#39;di&#39;)\n&quot;);
        PrintF(&quot;gdb\n&quot;);
        PrintF(&quot;  enter gdb\n&quot;);
        PrintF(&quot;break &lt;address&gt;\n&quot;);
        PrintF(&quot;  set a break point on the address\n&quot;);
        PrintF(&quot;del\n&quot;);
        PrintF(&quot;  delete the breakpoint\n&quot;);
        PrintF(&quot;trace (alias &#39;t&#39;)\n&quot;);
        PrintF(&quot;  toogle the tracing of all executed statements\n&quot;);
        PrintF(&quot;stop feature:\n&quot;);
        PrintF(&quot;  Description:\n&quot;);
        PrintF(&quot;    Stops are debug instructions inserted by\n&quot;);
        PrintF(&quot;    the Assembler::stop() function.\n&quot;);
        PrintF(&quot;    When hitting a stop, the Simulator will\n&quot;);
        PrintF(&quot;    stop and and give control to the ArmDebugger.\n&quot;);
        PrintF(&quot;    The first %d stop codes are watched:\n&quot;,
               Simulator::kNumOfWatchedStops);
        PrintF(&quot;    - They can be enabled / disabled: the Simulator\n&quot;);
        PrintF(&quot;      will / won&#39;t stop when hitting them.\n&quot;);
        PrintF(&quot;    - The Simulator keeps track of how many times they \n&quot;);
        PrintF(&quot;      are met. (See the info command.) Going over a\n&quot;);
        PrintF(&quot;      disabled stop still increases its counter. \n&quot;);
        PrintF(&quot;  Commands:\n&quot;);
        PrintF(&quot;    stop info all/&lt;code&gt; : print infos about number &lt;code&gt;\n&quot;);
        PrintF(&quot;      or all stop(s).\n&quot;);
        PrintF(&quot;    stop enable/disable all/&lt;code&gt; : enables / disables\n&quot;);
        PrintF(&quot;      all or number &lt;code&gt; stop(s)\n&quot;);
        PrintF(&quot;    stop unstop\n&quot;);
        PrintF(&quot;      ignore the stop instruction at the current location\n&quot;);
        PrintF(&quot;      from now on\n&quot;);
      }</span> <span class="insertion" title="inserted">else {
        PrintF(&quot;Unknown command: %s\n&quot;, cmd);
      }</span>
    }
    <a id='7804' tid='7803', class="move" title="(similarity 100%)">DeleteArray</a>(<a id='7806' tid='7805', class="move" title="(similarity 100%)">line</a>);
  }

  // Add all the breakpoints back to stop execution and enter the debugger
  // shell when hit.
  <a id='8068' tid='8067', class="move" title="(similarity 100%)">RedoBreakpoints</a>();

#<a id='8070' tid='8069', class="move" title="(similarity 100%)">undef</a> <a id='8072' tid='8071', class="move" title="(similarity 100%)">COMMAND_SIZE</a>
#<a id='8074' tid='8073', class="move" title="(similarity 100%)">undef</a> <a id='8076' tid='8075', class="move" title="(similarity 100%)">ARG_SIZE</a>

#<a id='8078' tid='8077', class="move" title="(similarity 100%)">undef</a> <a id='8080' tid='8079', class="move" title="(similarity 100%)">STR</a>
#<a id='8082' tid='8081', class="move" title="(similarity 100%)">undef</a> <a id='8084' tid='8083', class="move" title="(similarity 100%)">XSTR</a>
}


<a id='7808' tid='7807', class="move" title="(similarity 100%)">static</a> <a id='7810' tid='7809', class="move" title="(similarity 100%)">bool</a> <a id='7812' tid='7811', class="move" title="(similarity 100%)">ICacheMatch</a>(<a id='7814' tid='7813', class="move" title="(similarity 100%)">void</a><a id='7816' tid='7815', class="move" title="(similarity 100%)">*</a> <a id='7818' tid='7817', class="move" title="(similarity 100%)">one</a>, <a id='7820' tid='7819', class="move" title="(similarity 100%)">void</a><a id='7822' tid='7821', class="move" title="(similarity 100%)">*</a> <a id='7824' tid='7823', class="move" title="(similarity 100%)">two</a>) {
  <a id='7826' tid='7825', class="move" title="(similarity 100%)">ASSERT</a>((<a id='7828' tid='7827', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='7830' tid='7829', class="move" title="(similarity 100%)">intptr_t</a>&gt;(<a id='7832' tid='7831', class="move" title="(similarity 100%)">one</a>) <a id='7834' tid='7833', class="move" title="(similarity 100%)">&</a> <a id='7836' tid='7835', class="move" title="(similarity 100%)">CachePage</a><a id='7838' tid='7837', class="move" title="(similarity 100%)">::</a><a id='7840' tid='7839', class="move" title="(similarity 100%)">kPageMask</a>) <a id='7842' tid='7841', class="move" title="(similarity 100%)">==</a> <a id='7844' tid='7843', class="move" title="(similarity 100%)">0</a>);
  <a id='7846' tid='7845', class="move" title="(similarity 100%)">ASSERT</a>((<a id='7848' tid='7847', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='7850' tid='7849', class="move" title="(similarity 100%)">intptr_t</a>&gt;(<a id='7852' tid='7851', class="move" title="(similarity 100%)">two</a>) <a id='7854' tid='7853', class="move" title="(similarity 100%)">&</a> <a id='7856' tid='7855', class="move" title="(similarity 100%)">CachePage</a><a id='7858' tid='7857', class="move" title="(similarity 100%)">::</a><a id='7860' tid='7859', class="move" title="(similarity 100%)">kPageMask</a>) <a id='7862' tid='7861', class="move" title="(similarity 100%)">==</a> <a id='7864' tid='7863', class="move" title="(similarity 100%)">0</a>);
  <a id='7866' tid='7865', class="move" title="(similarity 100%)">return</a> <a id='7868' tid='7867', class="move" title="(similarity 100%)">one</a> <a id='7870' tid='7869', class="move" title="(similarity 100%)">==</a> <a id='7872' tid='7871', class="move" title="(similarity 100%)">two</a>;
}


<a id='7608' tid='7607', class="move" title="(similarity 100%)">static</a> <a id='7610' tid='7609', class="move" title="(similarity 100%)">uint32_t</a> <a id='7612' tid='7611', class="move" title="(similarity 100%)">ICacheHash</a>(<a id='7614' tid='7613', class="move" title="(similarity 100%)">void</a><a id='7616' tid='7615', class="move" title="(similarity 100%)">*</a> <a id='7618' tid='7617', class="move" title="(similarity 100%)">key</a>) {
  <a id='7620' tid='7619', class="move" title="(similarity 100%)">return</a> <a id='7622' tid='7621', class="move" title="(similarity 100%)">static_cast</a>&lt;<a id='7624' tid='7623', class="move" title="(similarity 100%)">uint32_t</a>&gt;(<a id='7626' tid='7625', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='7628' tid='7627', class="move" title="(similarity 100%)">uintptr_t</a>&gt;(<a id='7630' tid='7629', class="move" title="(similarity 100%)">key</a>)) <a id='7632' tid='7631', class="move" title="(similarity 100%)">&gt;&gt;</a> <a id='7634' tid='7633', class="move" title="(similarity 100%)">2</a>;
}


<a id='7110' tid='7109', class="move" title="(similarity 100%)">static</a> <a id='7112' tid='7111', class="move" title="(similarity 100%)">bool</a> <a id='7114' tid='7113', class="move" title="(similarity 100%)">AllOnOnePage</a>(<a id='7116' tid='7115', class="move" title="(similarity 100%)">uintptr_t</a> <a id='7118' tid='7117', class="move" title="(similarity 100%)">start</a>, <a id='7120' tid='7119', class="move" title="(similarity 100%)">int</a> <a id='7122' tid='7121', class="move" title="(similarity 100%)">size</a>) {
  <a id='7124' tid='7123', class="move" title="(similarity 100%)">intptr_t</a> <a id='7126' tid='7125', class="move" title="(similarity 100%)">start_page</a> = (<a id='7128' tid='7127', class="move" title="(similarity 100%)">start</a> <a id='7130' tid='7129', class="move" title="(similarity 100%)">&</a> <a id='7132' tid='7131', class="move" title="(similarity 100%)">~</a><a id='7134' tid='7133', class="move" title="(similarity 100%)">CachePage</a><a id='7136' tid='7135', class="move" title="(similarity 100%)">::</a><a id='7138' tid='7137', class="move" title="(similarity 100%)">kPageMask</a>);
  <a id='7140' tid='7139', class="move" title="(similarity 100%)">intptr_t</a> <a id='7142' tid='7141', class="move" title="(similarity 100%)">end_page</a> = ((<a id='7144' tid='7143', class="move" title="(similarity 100%)">start</a> <a id='7146' tid='7145', class="move" title="(similarity 100%)">+</a> <a id='7148' tid='7147', class="move" title="(similarity 100%)">size</a>) <a id='7150' tid='7149', class="move" title="(similarity 100%)">&</a> <a id='7152' tid='7151', class="move" title="(similarity 100%)">~</a><a id='7154' tid='7153', class="move" title="(similarity 100%)">CachePage</a><a id='7156' tid='7155', class="move" title="(similarity 100%)">::</a><a id='7158' tid='7157', class="move" title="(similarity 100%)">kPageMask</a>);
  <a id='7160' tid='7159', class="move" title="(similarity 100%)">return</a> <a id='7162' tid='7161', class="move" title="(similarity 100%)">start_page</a> <a id='7164' tid='7163', class="move" title="(similarity 100%)">==</a> <a id='7166' tid='7165', class="move" title="(similarity 100%)">end_page</a>;
}


<a id='6900' tid='6899', class="move" title="(similarity 100%)">void</a> <a id='6902' tid='6901', class="move" title="(similarity 100%)">Simulator</a><a id='6904' tid='6903', class="move" title="(similarity 100%)">::</a><a id='6906' tid='6905', class="move" title="(similarity 100%)">FlushICache</a>(<a id='6908' tid='6907', class="move" title="(similarity 100%)">v8</a><a id='6910' tid='6909', class="move" title="(similarity 100%)">::</a><a id='6912' tid='6911', class="move" title="(similarity 100%)">internal</a><a id='6914' tid='6913', class="move" title="(similarity 100%)">::</a><a id='6916' tid='6915', class="move" title="(similarity 100%)">HashMap</a><a id='6918' tid='6917', class="move" title="(similarity 100%)">*</a> <a id='6920' tid='6919', class="move" title="(similarity 100%)">i_cache</a>,
                            <a id='6922' tid='6921', class="move" title="(similarity 100%)">void</a><a id='6924' tid='6923', class="move" title="(similarity 100%)">*</a> <a id='6926' tid='6925', class="move" title="(similarity 100%)">start_addr</a>,
                            <a id='6928' tid='6927', class="move" title="(similarity 100%)">size_t</a> <a id='6930' tid='6929', class="move" title="(similarity 100%)">size</a>) {
  <a id='6932' tid='6931', class="move" title="(similarity 100%)">intptr_t</a> <a id='6934' tid='6933', class="move" title="(similarity 100%)">start</a> = <a id='6936' tid='6935', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='6938' tid='6937', class="move" title="(similarity 100%)">intptr_t</a>&gt;(<a id='6940' tid='6939', class="move" title="(similarity 100%)">start_addr</a>);
  <a id='6942' tid='6941', class="move" title="(similarity 100%)">int</a> <a id='6944' tid='6943', class="move" title="(similarity 100%)">intra_line</a> = (<a id='6946' tid='6945', class="move" title="(similarity 100%)">start</a> <a id='6948' tid='6947', class="move" title="(similarity 100%)">&</a> <a id='6950' tid='6949', class="move" title="(similarity 100%)">CachePage</a><a id='6952' tid='6951', class="move" title="(similarity 100%)">::</a><a id='6954' tid='6953', class="move" title="(similarity 100%)">kLineMask</a>);
  <a id='6956' tid='6955', class="move" title="(similarity 100%)">start</a> <a id='6958' tid='6957', class="move" title="(similarity 100%)">-=</a> <a id='6960' tid='6959', class="move" title="(similarity 100%)">intra_line</a>;
  <a id='6962' tid='6961', class="move" title="(similarity 100%)">size</a> <a id='6964' tid='6963', class="move" title="(similarity 100%)">+=</a> <a id='6966' tid='6965', class="move" title="(similarity 100%)">intra_line</a>;
  <a id='6968' tid='6967', class="move" title="(similarity 100%)">size</a> <a id='6970' tid='6969', class="move" title="(similarity 100%)">=</a> ((<a id='6972' tid='6971', class="move" title="(similarity 100%)">size</a> <a id='6974' tid='6973', class="move" title="(similarity 100%)">-</a> <a id='6976' tid='6975', class="move" title="(similarity 100%)">1</a>) <a id='6978' tid='6977', class="move" title="(similarity 100%)">|</a> <a id='6980' tid='6979', class="move" title="(similarity 100%)">CachePage</a><a id='6982' tid='6981', class="move" title="(similarity 100%)">::</a><a id='6984' tid='6983', class="move" title="(similarity 100%)">kLineMask</a>) <a id='6986' tid='6985', class="move" title="(similarity 100%)">+</a> <a id='6988' tid='6987', class="move" title="(similarity 100%)">1</a>;
  <a id='6990' tid='6989', class="move" title="(similarity 100%)">int</a> <a id='6992' tid='6991', class="move" title="(similarity 100%)">offset</a> = (<a id='6994' tid='6993', class="move" title="(similarity 100%)">start</a> <a id='6996' tid='6995', class="move" title="(similarity 100%)">&</a> <a id='6998' tid='6997', class="move" title="(similarity 100%)">CachePage</a><a id='7000' tid='6999', class="move" title="(similarity 100%)">::</a><a id='7002' tid='7001', class="move" title="(similarity 100%)">kPageMask</a>);
  <a id='7004' tid='7003', class="move" title="(similarity 100%)">while</a> (<a id='7006' tid='7005', class="move" title="(similarity 100%)">!</a><a id='7008' tid='7007', class="move" title="(similarity 100%)">AllOnOnePage</a>(<a id='7010' tid='7009', class="move" title="(similarity 100%)">start</a>, <a id='7012' tid='7011', class="move" title="(similarity 100%)">size</a> <a id='7014' tid='7013', class="move" title="(similarity 100%)">-</a> <a id='7016' tid='7015', class="move" title="(similarity 100%)">1</a>)) {
    <a id='7018' tid='7017', class="move" title="(similarity 100%)">int</a> <a id='7020' tid='7019', class="move" title="(similarity 100%)">bytes_to_flush</a> = <a id='7022' tid='7021', class="move" title="(similarity 100%)">CachePage</a><a id='7024' tid='7023', class="move" title="(similarity 100%)">::</a><a id='7026' tid='7025', class="move" title="(similarity 100%)">kPageSize</a> <a id='7028' tid='7027', class="move" title="(similarity 100%)">-</a> <a id='7030' tid='7029', class="move" title="(similarity 100%)">offset</a>;
    <a id='7032' tid='7031', class="move" title="(similarity 100%)">FlushOnePage</a>(<a id='7034' tid='7033', class="move" title="(similarity 100%)">i_cache</a>, <a id='7036' tid='7035', class="move" title="(similarity 100%)">start</a>, <a id='7038' tid='7037', class="move" title="(similarity 100%)">bytes_to_flush</a>);
    <a id='7040' tid='7039', class="move" title="(similarity 100%)">start</a> <a id='7042' tid='7041', class="move" title="(similarity 100%)">+=</a> <a id='7044' tid='7043', class="move" title="(similarity 100%)">bytes_to_flush</a>;
    <a id='7046' tid='7045', class="move" title="(similarity 100%)">size</a> <a id='7048' tid='7047', class="move" title="(similarity 100%)">-=</a> <a id='7050' tid='7049', class="move" title="(similarity 100%)">bytes_to_flush</a>;
    <a id='7052' tid='7051', class="move" title="(similarity 100%)">ASSERT_EQ</a>(<a id='7054' tid='7053', class="move" title="(similarity 100%)">0</a>, <a id='7056' tid='7055', class="move" title="(similarity 100%)">start</a> <a id='7058' tid='7057', class="move" title="(similarity 100%)">&</a> <a id='7060' tid='7059', class="move" title="(similarity 100%)">CachePage</a><a id='7062' tid='7061', class="move" title="(similarity 100%)">::</a><a id='7064' tid='7063', class="move" title="(similarity 100%)">kPageMask</a>);
    <a id='7066' tid='7065', class="move" title="(similarity 100%)">offset</a> <a id='7068' tid='7067', class="move" title="(similarity 100%)">=</a> <a id='7070' tid='7069', class="move" title="(similarity 100%)">0</a>;
  }
  <a id='7072' tid='7071', class="move" title="(similarity 100%)">if</a> (<a id='7074' tid='7073', class="move" title="(similarity 100%)">size</a> <a id='7076' tid='7075', class="move" title="(similarity 100%)">!=</a> <a id='7078' tid='7077', class="move" title="(similarity 100%)">0</a>) {
    <a id='7080' tid='7079', class="move" title="(similarity 100%)">FlushOnePage</a>(<a id='7082' tid='7081', class="move" title="(similarity 100%)">i_cache</a>, <a id='7084' tid='7083', class="move" title="(similarity 100%)">start</a>, <a id='7086' tid='7085', class="move" title="(similarity 100%)">size</a>);
  }
}


<a id='6614' tid='6613', class="move" title="(similarity 100%)">CachePage</a><a id='6616' tid='6615', class="move" title="(similarity 100%)">*</a> <a id='6618' tid='6617', class="move" title="(similarity 100%)">Simulator</a><a id='6620' tid='6619', class="move" title="(similarity 100%)">::</a><a id='6622' tid='6621', class="move" title="(similarity 100%)">GetCachePage</a>(<a id='6624' tid='6623', class="move" title="(similarity 100%)">v8</a><a id='6626' tid='6625', class="move" title="(similarity 100%)">::</a><a id='6628' tid='6627', class="move" title="(similarity 100%)">internal</a><a id='6630' tid='6629', class="move" title="(similarity 100%)">::</a><a id='6632' tid='6631', class="move" title="(similarity 100%)">HashMap</a><a id='6634' tid='6633', class="move" title="(similarity 100%)">*</a> <a id='6636' tid='6635', class="move" title="(similarity 100%)">i_cache</a>, <a id='6638' tid='6637', class="move" title="(similarity 100%)">void</a><a id='6640' tid='6639', class="move" title="(similarity 100%)">*</a> <a id='6642' tid='6641', class="move" title="(similarity 100%)">page</a>) {
  <a id='6644' tid='6643', class="move" title="(similarity 100%)">v8</a><a id='6646' tid='6645', class="move" title="(similarity 100%)">::</a><a id='6648' tid='6647', class="move" title="(similarity 100%)">internal</a><a id='6650' tid='6649', class="move" title="(similarity 100%)">::</a><a id='6652' tid='6651', class="move" title="(similarity 100%)">HashMap</a><a id='6654' tid='6653', class="move" title="(similarity 100%)">::</a><a id='6656' tid='6655', class="move" title="(similarity 100%)">Entry</a><a id='6658' tid='6657', class="move" title="(similarity 100%)">*</a> <a id='6660' tid='6659', class="move" title="(similarity 100%)">entry</a> = <a id='6662' tid='6661', class="move" title="(similarity 100%)">i_cache</a>-&gt;<a id='6664' tid='6663', class="move" title="(similarity 100%)">Lookup</a>(<a id='6666' tid='6665', class="move" title="(similarity 100%)">page</a>,
                                                        <a id='6668' tid='6667', class="move" title="(similarity 100%)">ICacheHash</a>(<a id='6670' tid='6669', class="move" title="(similarity 100%)">page</a>),
                                                        <a id='6672' tid='6671', class="move" title="(similarity 100%)">true</a>);
  <a id='6674' tid='6673', class="move" title="(similarity 100%)">if</a> (<a id='6676' tid='6675', class="move" title="(similarity 100%)">entry</a>-&gt;<a id='6678' tid='6677', class="move" title="(similarity 100%)">value</a> <a id='6680' tid='6679', class="move" title="(similarity 100%)">==</a> <a id='6682' tid='6681', class="move" title="(similarity 100%)">NULL</a>) {
    <a id='6684' tid='6683', class="move" title="(similarity 100%)">CachePage</a><a id='6686' tid='6685', class="move" title="(similarity 100%)">*</a> <a id='6688' tid='6687', class="move" title="(similarity 100%)">new_page</a> = <a id='6690' tid='6689', class="move" title="(similarity 100%)">new</a> <a id='6692' tid='6691', class="move" title="(similarity 100%)">CachePage</a>();
    <a id='6694' tid='6693', class="move" title="(similarity 100%)">entry</a>-&gt;<a id='6696' tid='6695', class="move" title="(similarity 100%)">value</a> <a id='6698' tid='6697', class="move" title="(similarity 100%)">=</a> <a id='6700' tid='6699', class="move" title="(similarity 100%)">new_page</a>;
  }
  <a id='6702' tid='6701', class="move" title="(similarity 100%)">return</a> <a id='6704' tid='6703', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='6706' tid='6705', class="move" title="(similarity 100%)">CachePage</a><a id='6708' tid='6707', class="move" title="(similarity 100%)">*</a>&gt;(<a id='6710' tid='6709', class="move" title="(similarity 100%)">entry</a>-&gt;<a id='6712' tid='6711', class="move" title="(similarity 100%)">value</a>);
}


// Flush from start up to and not including start + size.
<a id='6280' tid='6279', class="move" title="(similarity 100%)">void</a> <a id='6282' tid='6281', class="move" title="(similarity 100%)">Simulator</a><a id='6284' tid='6283', class="move" title="(similarity 100%)">::</a><a id='6286' tid='6285', class="move" title="(similarity 100%)">FlushOnePage</a>(<a id='6288' tid='6287', class="move" title="(similarity 100%)">v8</a><a id='6290' tid='6289', class="move" title="(similarity 100%)">::</a><a id='6292' tid='6291', class="move" title="(similarity 100%)">internal</a><a id='6294' tid='6293', class="move" title="(similarity 100%)">::</a><a id='6296' tid='6295', class="move" title="(similarity 100%)">HashMap</a><a id='6298' tid='6297', class="move" title="(similarity 100%)">*</a> <a id='6300' tid='6299', class="move" title="(similarity 100%)">i_cache</a>,
                             <a id='6302' tid='6301', class="move" title="(similarity 100%)">intptr_t</a> <a id='6304' tid='6303', class="move" title="(similarity 100%)">start</a>,
                             <a id='6306' tid='6305', class="move" title="(similarity 100%)">int</a> <a id='6308' tid='6307', class="move" title="(similarity 100%)">size</a>) {
  <a id='6310' tid='6309', class="move" title="(similarity 100%)">ASSERT</a>(<a id='6312' tid='6311', class="move" title="(similarity 100%)">size</a> <a id='6314' tid='6313', class="move" title="(similarity 100%)">&lt;=</a> <a id='6316' tid='6315', class="move" title="(similarity 100%)">CachePage</a><a id='6318' tid='6317', class="move" title="(similarity 100%)">::</a><a id='6320' tid='6319', class="move" title="(similarity 100%)">kPageSize</a>);
  <a id='6322' tid='6321', class="move" title="(similarity 100%)">ASSERT</a>(<a id='6324' tid='6323', class="move" title="(similarity 100%)">AllOnOnePage</a>(<a id='6326' tid='6325', class="move" title="(similarity 100%)">start</a>, <a id='6328' tid='6327', class="move" title="(similarity 100%)">size</a> <a id='6330' tid='6329', class="move" title="(similarity 100%)">-</a> <a id='6332' tid='6331', class="move" title="(similarity 100%)">1</a>));
  <a id='6334' tid='6333', class="move" title="(similarity 100%)">ASSERT</a>((<a id='6336' tid='6335', class="move" title="(similarity 100%)">start</a> <a id='6338' tid='6337', class="move" title="(similarity 100%)">&</a> <a id='6340' tid='6339', class="move" title="(similarity 100%)">CachePage</a><a id='6342' tid='6341', class="move" title="(similarity 100%)">::</a><a id='6344' tid='6343', class="move" title="(similarity 100%)">kLineMask</a>) <a id='6346' tid='6345', class="move" title="(similarity 100%)">==</a> <a id='6348' tid='6347', class="move" title="(similarity 100%)">0</a>);
  <a id='6350' tid='6349', class="move" title="(similarity 100%)">ASSERT</a>((<a id='6352' tid='6351', class="move" title="(similarity 100%)">size</a> <a id='6354' tid='6353', class="move" title="(similarity 100%)">&</a> <a id='6356' tid='6355', class="move" title="(similarity 100%)">CachePage</a><a id='6358' tid='6357', class="move" title="(similarity 100%)">::</a><a id='6360' tid='6359', class="move" title="(similarity 100%)">kLineMask</a>) <a id='6362' tid='6361', class="move" title="(similarity 100%)">==</a> <a id='6364' tid='6363', class="move" title="(similarity 100%)">0</a>);
  <a id='6366' tid='6365', class="move" title="(similarity 100%)">void</a><a id='6368' tid='6367', class="move" title="(similarity 100%)">*</a> <a id='6370' tid='6369', class="move" title="(similarity 100%)">page</a> = <a id='6372' tid='6371', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='6374' tid='6373', class="move" title="(similarity 100%)">void</a><a id='6376' tid='6375', class="move" title="(similarity 100%)">*</a>&gt;(<a id='6378' tid='6377', class="move" title="(similarity 100%)">start</a> <a id='6380' tid='6379', class="move" title="(similarity 100%)">&</a> (<a id='6382' tid='6381', class="move" title="(similarity 100%)">~</a><a id='6384' tid='6383', class="move" title="(similarity 100%)">CachePage</a><a id='6386' tid='6385', class="move" title="(similarity 100%)">::</a><a id='6388' tid='6387', class="move" title="(similarity 100%)">kPageMask</a>));
  <a id='6390' tid='6389', class="move" title="(similarity 100%)">int</a> <a id='6392' tid='6391', class="move" title="(similarity 100%)">offset</a> = (<a id='6394' tid='6393', class="move" title="(similarity 100%)">start</a> <a id='6396' tid='6395', class="move" title="(similarity 100%)">&</a> <a id='6398' tid='6397', class="move" title="(similarity 100%)">CachePage</a><a id='6400' tid='6399', class="move" title="(similarity 100%)">::</a><a id='6402' tid='6401', class="move" title="(similarity 100%)">kPageMask</a>);
  <a id='6404' tid='6403', class="move" title="(similarity 100%)">CachePage</a><a id='6406' tid='6405', class="move" title="(similarity 100%)">*</a> <a id='6408' tid='6407', class="move" title="(similarity 100%)">cache_page</a> = <a id='6410' tid='6409', class="move" title="(similarity 100%)">GetCachePage</a>(<a id='6412' tid='6411', class="move" title="(similarity 100%)">i_cache</a>, <a id='6414' tid='6413', class="move" title="(similarity 100%)">page</a>);
  <a id='6416' tid='6415', class="move" title="(similarity 100%)">char</a><a id='6418' tid='6417', class="move" title="(similarity 100%)">*</a> <a id='6420' tid='6419', class="move" title="(similarity 100%)">valid_bytemap</a> = <a id='6422' tid='6421', class="move" title="(similarity 100%)">cache_page</a>-&gt;<a id='6424' tid='6423', class="move" title="(similarity 100%)">ValidityByte</a>(<a id='6426' tid='6425', class="move" title="(similarity 100%)">offset</a>);
  <a id='6428' tid='6427', class="move" title="(similarity 100%)">memset</a>(<a id='6430' tid='6429', class="move" title="(similarity 100%)">valid_bytemap</a>, <a id='6432' tid='6431', class="move" title="(similarity 100%)">CachePage</a><a id='6434' tid='6433', class="move" title="(similarity 100%)">::</a><a id='6436' tid='6435', class="move" title="(similarity 100%)">LINE_INVALID</a>, <a id='6438' tid='6437', class="move" title="(similarity 100%)">size</a> <a id='6440' tid='6439', class="move" title="(similarity 100%)">&gt;&gt;</a> <a id='6442' tid='6441', class="move" title="(similarity 100%)">CachePage</a><a id='6444' tid='6443', class="move" title="(similarity 100%)">::</a><a id='6446' tid='6445', class="move" title="(similarity 100%)">kLineShift</a>);
}


<a id='5906' tid='5905', class="move" title="(similarity 100%)">void</a> <a id='5908' tid='5907', class="move" title="(similarity 100%)">Simulator</a><a id='5910' tid='5909', class="move" title="(similarity 100%)">::</a><a id='5912' tid='5911', class="move" title="(similarity 100%)">CheckICache</a>(<a id='5914' tid='5913', class="move" title="(similarity 100%)">v8</a><a id='5916' tid='5915', class="move" title="(similarity 100%)">::</a><a id='5918' tid='5917', class="move" title="(similarity 100%)">internal</a><a id='5920' tid='5919', class="move" title="(similarity 100%)">::</a><a id='5922' tid='5921', class="move" title="(similarity 100%)">HashMap</a><a id='5924' tid='5923', class="move" title="(similarity 100%)">*</a> <a id='5926' tid='5925', class="move" title="(similarity 100%)">i_cache</a>,
                            <a id='5928' tid='5927', class="move" title="(similarity 100%)">Instruction</a><a id='5930' tid='5929', class="move" title="(similarity 100%)">*</a> <a id='5932' tid='5931', class="move" title="(similarity 100%)">instr</a>) {
  <a id='5934' tid='5933', class="move" title="(similarity 100%)">intptr_t</a> <a id='5936' tid='5935', class="move" title="(similarity 100%)">address</a> = <a id='5938' tid='5937', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='5940' tid='5939', class="move" title="(similarity 100%)">intptr_t</a>&gt;(<a id='5942' tid='5941', class="move" title="(similarity 100%)">instr</a>);
  <a id='5944' tid='5943', class="move" title="(similarity 100%)">void</a><a id='5946' tid='5945', class="move" title="(similarity 100%)">*</a> <a id='5948' tid='5947', class="move" title="(similarity 100%)">page</a> = <a id='5950' tid='5949', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='5952' tid='5951', class="move" title="(similarity 100%)">void</a><a id='5954' tid='5953', class="move" title="(similarity 100%)">*</a>&gt;(<a id='5956' tid='5955', class="move" title="(similarity 100%)">address</a> <a id='5958' tid='5957', class="move" title="(similarity 100%)">&</a> (<a id='5960' tid='5959', class="move" title="(similarity 100%)">~</a><a id='5962' tid='5961', class="move" title="(similarity 100%)">CachePage</a><a id='5964' tid='5963', class="move" title="(similarity 100%)">::</a><a id='5966' tid='5965', class="move" title="(similarity 100%)">kPageMask</a>));
  <a id='5968' tid='5967', class="move" title="(similarity 100%)">void</a><a id='5970' tid='5969', class="move" title="(similarity 100%)">*</a> <a id='5972' tid='5971', class="move" title="(similarity 100%)">line</a> = <a id='5974' tid='5973', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='5976' tid='5975', class="move" title="(similarity 100%)">void</a><a id='5978' tid='5977', class="move" title="(similarity 100%)">*</a>&gt;(<a id='5980' tid='5979', class="move" title="(similarity 100%)">address</a> <a id='5982' tid='5981', class="move" title="(similarity 100%)">&</a> (<a id='5984' tid='5983', class="move" title="(similarity 100%)">~</a><a id='5986' tid='5985', class="move" title="(similarity 100%)">CachePage</a><a id='5988' tid='5987', class="move" title="(similarity 100%)">::</a><a id='5990' tid='5989', class="move" title="(similarity 100%)">kLineMask</a>));
  <a id='5992' tid='5991', class="move" title="(similarity 100%)">int</a> <a id='5994' tid='5993', class="move" title="(similarity 100%)">offset</a> = (<a id='5996' tid='5995', class="move" title="(similarity 100%)">address</a> <a id='5998' tid='5997', class="move" title="(similarity 100%)">&</a> <a id='6000' tid='5999', class="move" title="(similarity 100%)">CachePage</a><a id='6002' tid='6001', class="move" title="(similarity 100%)">::</a><a id='6004' tid='6003', class="move" title="(similarity 100%)">kPageMask</a>);
  <a id='6006' tid='6005', class="move" title="(similarity 100%)">CachePage</a><a id='6008' tid='6007', class="move" title="(similarity 100%)">*</a> <a id='6010' tid='6009', class="move" title="(similarity 100%)">cache_page</a> = <a id='6012' tid='6011', class="move" title="(similarity 100%)">GetCachePage</a>(<a id='6014' tid='6013', class="move" title="(similarity 100%)">i_cache</a>, <a id='6016' tid='6015', class="move" title="(similarity 100%)">page</a>);
  <a id='6018' tid='6017', class="move" title="(similarity 100%)">char</a><a id='6020' tid='6019', class="move" title="(similarity 100%)">*</a> <a id='6022' tid='6021', class="move" title="(similarity 100%)">cache_valid_byte</a> = <a id='6024' tid='6023', class="move" title="(similarity 100%)">cache_page</a>-&gt;<a id='6026' tid='6025', class="move" title="(similarity 100%)">ValidityByte</a>(<a id='6028' tid='6027', class="move" title="(similarity 100%)">offset</a>);
  <a id='6030' tid='6029', class="move" title="(similarity 100%)">bool</a> <a id='6032' tid='6031', class="move" title="(similarity 100%)">cache_hit</a> = (<a id='6034' tid='6033', class="move" title="(similarity 100%)">*</a><a id='6036' tid='6035', class="move" title="(similarity 100%)">cache_valid_byte</a> <a id='6038' tid='6037', class="move" title="(similarity 100%)">==</a> <a id='6040' tid='6039', class="move" title="(similarity 100%)">CachePage</a><a id='6042' tid='6041', class="move" title="(similarity 100%)">::</a><a id='6044' tid='6043', class="move" title="(similarity 100%)">LINE_VALID</a>);
  <a id='6046' tid='6045', class="move" title="(similarity 100%)">char</a><a id='6048' tid='6047', class="move" title="(similarity 100%)">*</a> <a id='6050' tid='6049', class="move" title="(similarity 100%)">cached_line</a> = <a id='6052' tid='6051', class="move" title="(similarity 100%)">cache_page</a>-&gt;<a id='6054' tid='6053', class="move" title="(similarity 100%)">CachedData</a>(<a id='6056' tid='6055', class="move" title="(similarity 100%)">offset</a> <a id='6058' tid='6057', class="move" title="(similarity 100%)">&</a> <a id='6060' tid='6059', class="move" title="(similarity 100%)">~</a><a id='6062' tid='6061', class="move" title="(similarity 100%)">CachePage</a><a id='6064' tid='6063', class="move" title="(similarity 100%)">::</a><a id='6066' tid='6065', class="move" title="(similarity 100%)">kLineMask</a>);
  <a id='6068' tid='6067', class="move" title="(similarity 100%)">if</a> (<a id='6070' tid='6069', class="move" title="(similarity 100%)">cache_hit</a>) {
    // Check that the data in memory matches the contents of the I-cache.
    <a id='6072' tid='6071', class="move" title="(similarity 100%)">CHECK</a>(<a id='6074' tid='6073', class="move" title="(similarity 100%)">memcmp</a>(<a id='6076' tid='6075', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='6078' tid='6077', class="move" title="(similarity 100%)">void</a><a id='6080' tid='6079', class="move" title="(similarity 100%)">*</a>&gt;(<a id='6082' tid='6081', class="move" title="(similarity 100%)">instr</a>),
                 <a id='6084' tid='6083', class="move" title="(similarity 100%)">cache_page</a>-&gt;<a id='6086' tid='6085', class="move" title="(similarity 100%)">CachedData</a>(<a id='6088' tid='6087', class="move" title="(similarity 100%)">offset</a>),
                 <a id='6090' tid='6089', class="move" title="(similarity 100%)">Instruction</a><a id='6092' tid='6091', class="move" title="(similarity 100%)">::</a><a id='6094' tid='6093', class="move" title="(similarity 100%)">kInstrSize</a>) <a id='6096' tid='6095', class="move" title="(similarity 100%)">==</a> <a id='6098' tid='6097', class="move" title="(similarity 100%)">0</a>);
  } <a id='6100' tid='6099', class="move" title="(similarity 100%)">else</a> {
    // Cache miss.  Load memory into the cache.
    <a id='6102' tid='6101', class="move" title="(similarity 100%)">memcpy</a>(<a id='6104' tid='6103', class="move" title="(similarity 100%)">cached_line</a>, <a id='6106' tid='6105', class="move" title="(similarity 100%)">line</a>, <a id='6108' tid='6107', class="move" title="(similarity 100%)">CachePage</a><a id='6110' tid='6109', class="move" title="(similarity 100%)">::</a><a id='6112' tid='6111', class="move" title="(similarity 100%)">kLineLength</a>);
    <a id='6114' tid='6113', class="move" title="(similarity 100%)">*</a><a id='6116' tid='6115', class="move" title="(similarity 100%)">cache_valid_byte</a> <a id='6118' tid='6117', class="move" title="(similarity 100%)">=</a> <a id='6120' tid='6119', class="move" title="(similarity 100%)">CachePage</a><a id='6122' tid='6121', class="move" title="(similarity 100%)">::</a><a id='6124' tid='6123', class="move" title="(similarity 100%)">LINE_VALID</a>;
  }
}


<a id='5808' tid='5807', class="move" title="(similarity 100%)">void</a> <a id='5810' tid='5809', class="move" title="(similarity 100%)">Simulator</a><a id='5812' tid='5811', class="move" title="(similarity 100%)">::</a><a id='5814' tid='5813', class="move" title="(similarity 100%)">Initialize</a>(<a id='5816' tid='5815', class="move" title="(similarity 100%)">Isolate</a><a id='5818' tid='5817', class="move" title="(similarity 100%)">*</a> <a id='5820' tid='5819', class="move" title="(similarity 100%)">isolate</a>) {
  <a id='5822' tid='5821', class="move" title="(similarity 100%)">if</a> (<a id='5824' tid='5823', class="move" title="(similarity 100%)">isolate</a>-&gt;<a id='5826' tid='5825', class="move" title="(similarity 100%)">simulator_initialized</a>()) <a id='5828' tid='5827', class="move" title="(similarity 100%)">return</a>;
  <a id='5830' tid='5829', class="move" title="(similarity 100%)">isolate</a>-&gt;<a id='5832' tid='5831', class="move" title="(similarity 100%)">set_simulator_initialized</a>(<a id='5834' tid='5833', class="move" title="(similarity 100%)">true</a>);
  <a id='5836' tid='5835', class="move" title="(similarity 100%)">::</a><a id='5838' tid='5837', class="move" title="(similarity 100%)">v8</a><a id='5840' tid='5839', class="move" title="(similarity 100%)">::</a><a id='5842' tid='5841', class="move" title="(similarity 100%)">internal</a><a id='5844' tid='5843', class="move" title="(similarity 100%)">::</a><a id='5846' tid='5845', class="move" title="(similarity 100%)">ExternalReference</a><a id='5848' tid='5847', class="move" title="(similarity 100%)">::</a><a id='5850' tid='5849', class="move" title="(similarity 100%)">set_redirector</a>(<a id='5852' tid='5851', class="move" title="(similarity 100%)">isolate</a>,
                                                    <a id='5854' tid='5853', class="move" title="(similarity 100%)">&</a><a id='5856' tid='5855', class="move" title="(similarity 100%)">RedirectExternalReference</a>);
}


<a id='5758' tid='5757', class="move" title="(similarity 100%)">Simulator</a><a id='5760' tid='5759', class="move" title="(similarity 100%)">::</a><a id='5762' tid='5761', class="move" title="(similarity 100%)">Simulator</a>(<a id='5764' tid='5763', class="move" title="(similarity 100%)">Isolate</a><a id='5766' tid='5765', class="move" title="(similarity 100%)">*</a> <a id='5768' tid='5767', class="move" title="(similarity 100%)">isolate</a>) : <a id='5770' tid='5769', class="move" title="(similarity 100%)">isolate_</a>(<a id='5772' tid='5771', class="move" title="(similarity 100%)">isolate</a>) {
  <span class="insertion" title="inserted">i_cache_ = isolate_-&gt;simulator_i_cache();</span>
  <a id='5774' tid='5773', class="move" title="(similarity 100%)">if</a> (<a id='5776' tid='5775', class="move" title="(similarity 100%)">i_cache_</a> <a id='5778' tid='5777', class="move" title="(similarity 100%)">==</a> <a id='5780' tid='5779', class="move" title="(similarity 100%)">NULL</a>) {
    <a id='5782' tid='5781', class="move" title="(similarity 100%)">i_cache_</a> <a id='5784' tid='5783', class="move" title="(similarity 100%)">=</a> <a id='5786' tid='5785', class="move" title="(similarity 100%)">new</a> <a id='5788' tid='5787', class="move" title="(similarity 100%)">v8</a><a id='5790' tid='5789', class="move" title="(similarity 100%)">::</a><a id='5792' tid='5791', class="move" title="(similarity 100%)">internal</a><a id='5794' tid='5793', class="move" title="(similarity 100%)">::</a><a id='5796' tid='5795', class="move" title="(similarity 100%)">HashMap</a>(<a id='5798' tid='5797', class="move" title="(similarity 100%)">&</a><a id='5800' tid='5799', class="move" title="(similarity 100%)">ICacheMatch</a>);
    <a id='5802' tid='5801', class="move" title="(similarity 100%)">isolate_</a>-&gt;<a id='5804' tid='5803', class="move" title="(similarity 100%)">set_simulator_i_cache</a>(<a id='5806' tid='5805', class="move" title="(similarity 100%)">i_cache_</a>);
  }
  <span class="insertion" title="inserted">Initialize(isolate);</span>
  // Setup simulator support first. Some of this information is needed to
  // setup the architecture state.
  <span class="insertion" title="inserted">size_t stack_size = 1 * 1024*1024;</span>  // allocate 1MB for stack
  <span class="insertion" title="inserted">stack_ = reinterpret_cast&lt;char*&gt;(malloc(stack_size));</span>
  <span class="insertion" title="inserted">pc_modified_ = false;</span>
  <span class="insertion" title="inserted">icount_ = 0;</span>
  <span class="insertion" title="inserted">break_pc_ = NULL;</span>
  <span class="insertion" title="inserted">break_instr_ = 0;</span>

  // Setup architecture state.
  // All registers are initialized to zero to start with.
  <span class="insertion" title="inserted">for (int i = 0; i &lt; num_registers; i++) {
    registers_[i] = 0;
  }</span>
  <span class="insertion" title="inserted">n_flag_ = false;</span>
  <span class="insertion" title="inserted">z_flag_ = false;</span>
  <span class="insertion" title="inserted">c_flag_ = false;</span>
  <span class="insertion" title="inserted">v_flag_ = false;</span>

  // Initializing VFP registers.
  // All registers are initialized to zero to start with
  // even though s_registers_ & d_registers_ share the same
  // physical registers in the target.
  <span class="insertion" title="inserted">for (int i = 0; i &lt; num_s_registers; i++) {
    vfp_register[i] = 0;
  }</span>
  <span class="insertion" title="inserted">n_flag_FPSCR_ = false;</span>
  <span class="insertion" title="inserted">z_flag_FPSCR_ = false;</span>
  <span class="insertion" title="inserted">c_flag_FPSCR_ = false;</span>
  <span class="insertion" title="inserted">v_flag_FPSCR_ = false;</span>
  <span class="insertion" title="inserted">FPSCR_rounding_mode_ = RZ;</span>

  <span class="insertion" title="inserted">inv_op_vfp_flag_ = false;</span>
  <span class="insertion" title="inserted">div_zero_vfp_flag_ = false;</span>
  <span class="insertion" title="inserted">overflow_vfp_flag_ = false;</span>
  <span class="insertion" title="inserted">underflow_vfp_flag_ = false;</span>
  <span class="insertion" title="inserted">inexact_vfp_flag_ = false;</span>

  // The sp is initialized to point to the bottom (high address) of the
  // allocated stack area. To be safe in potential stack underflows we leave
  // some buffer below.
  <span class="insertion" title="inserted">registers_[sp] = reinterpret_cast&lt;int32_t&gt;(stack_) + stack_size - 64;</span>
  // The lr and pc are initialized to a known bad value that will cause an
  // access violation if the simulator ever tries to execute it.
  <span class="insertion" title="inserted">registers_[pc] = bad_lr;</span>
  <span class="insertion" title="inserted">registers_[lr] = bad_lr;</span>
  <span class="insertion" title="inserted">InitializeCoverage();</span>
}


// When the generated code calls an external reference we need to catch that in
// the simulator.  The external reference will be a function compiled for the
// host architecture.  We need to call that function instead of trying to
// execute it with the simulator.  We do that by redirecting the external
// reference to a svc (Supervisor Call) instruction that is handled by
// the simulator.  We write the original destination of the jump just at a known
// offset from the svc instruction so the simulator knows what to call.
<a id='5532' tid='5531', class="move" title="(similarity 100%)">class</a> <a id='5534' tid='5533', class="move" title="(similarity 100%)">Redirection</a> {
 <a id='5536' tid='5535', class="move" title="(similarity 100%)">public</a>:
  <a id='5538' tid='5537', class="move" title="(similarity 100%)">Redirection</a>(<a id='5540' tid='5539', class="move" title="(similarity 100%)">void</a><a id='5542' tid='5541', class="move" title="(similarity 100%)">*</a> <a id='5544' tid='5543', class="move" title="(similarity 100%)">external_function</a>, <a id='5546' tid='5545', class="move" title="(similarity 100%)">ExternalReference</a><a id='5548' tid='5547', class="move" title="(similarity 100%)">::</a><a id='5550' tid='5549', class="move" title="(similarity 100%)">Type</a> <a id='5552' tid='5551', class="move" title="(similarity 100%)">type</a>)
      : <span class="insertion" title="inserted">external_function_(external_function),
        swi_instruction_(al | (0xf*B24) | kCallRtRedirected),
        type_(type),
        next_(NULL)</span> {
    <a id='5476' tid='5475', class="move" title="(similarity 100%)">Isolate</a><a id='5478' tid='5477', class="move" title="(similarity 100%)">*</a> <a id='5480' tid='5479', class="move" title="(similarity 100%)">isolate</a> = <a id='5482' tid='5481', class="move" title="(similarity 100%)">Isolate</a><a id='5484' tid='5483', class="move" title="(similarity 100%)">::</a><a id='5486' tid='5485', class="move" title="(similarity 100%)">Current</a>();
    <a id='5488' tid='5487', class="move" title="(similarity 100%)">next_</a> <a id='5490' tid='5489', class="move" title="(similarity 100%)">=</a> <a id='5492' tid='5491', class="move" title="(similarity 100%)">isolate</a>-&gt;<a id='5494' tid='5493', class="move" title="(similarity 100%)">simulator_redirection</a>();
    <a id='5496' tid='5495', class="move" title="(similarity 100%)">Simulator</a><a id='5498' tid='5497', class="move" title="(similarity 100%)">::</a><a id='5500' tid='5499', class="move" title="(similarity 100%)">current</a>(<a id='5502' tid='5501', class="move" title="(similarity 100%)">isolate</a>)-&gt;
        <a id='5504' tid='5503', class="move" title="(similarity 100%)">FlushICache</a>(<a id='5506' tid='5505', class="move" title="(similarity 100%)">isolate</a>-&gt;<a id='5508' tid='5507', class="move" title="(similarity 100%)">simulator_i_cache</a>(),
                    <a id='5510' tid='5509', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='5512' tid='5511', class="move" title="(similarity 100%)">void</a><a id='5514' tid='5513', class="move" title="(similarity 100%)">*</a>&gt;(<a id='5516' tid='5515', class="move" title="(similarity 100%)">&</a><a id='5518' tid='5517', class="move" title="(similarity 100%)">swi_instruction_</a>),
                    <a id='5520' tid='5519', class="move" title="(similarity 100%)">Instruction</a><a id='5522' tid='5521', class="move" title="(similarity 100%)">::</a><a id='5524' tid='5523', class="move" title="(similarity 100%)">kInstrSize</a>);
    <a id='5526' tid='5525', class="move" title="(similarity 100%)">isolate</a>-&gt;<a id='5528' tid='5527', class="move" title="(similarity 100%)">set_simulator_redirection</a>(<a id='5530' tid='5529', class="move" title="(similarity 100%)">this</a>);
  }

  <a id='5554' tid='5553', class="move" title="(similarity 100%)">void</a><a id='5556' tid='5555', class="move" title="(similarity 100%)">*</a> <a id='5558' tid='5557', class="move" title="(similarity 100%)">address_of_swi_instruction</a>() {
    <a id='5560' tid='5559', class="move" title="(similarity 100%)">return</a> <a id='5562' tid='5561', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='5564' tid='5563', class="move" title="(similarity 100%)">void</a><a id='5566' tid='5565', class="move" title="(similarity 100%)">*</a>&gt;(<a id='5568' tid='5567', class="move" title="(similarity 100%)">&</a><a id='5570' tid='5569', class="move" title="(similarity 100%)">swi_instruction_</a>);
  }

  <a id='5572' tid='5571', class="move" title="(similarity 100%)">void</a><a id='5574' tid='5573', class="move" title="(similarity 100%)">*</a> <a id='5576' tid='5575', class="move" title="(similarity 100%)">external_function</a>() { <a id='5578' tid='5577', class="move" title="(similarity 100%)">return</a> <a id='5580' tid='5579', class="move" title="(similarity 100%)">external_function_</a>; }
  <a id='5582' tid='5581', class="move" title="(similarity 100%)">ExternalReference</a><a id='5584' tid='5583', class="move" title="(similarity 100%)">::</a><a id='5586' tid='5585', class="move" title="(similarity 100%)">Type</a> <a id='5588' tid='5587', class="move" title="(similarity 100%)">type</a>() { <a id='5590' tid='5589', class="move" title="(similarity 100%)">return</a> <a id='5592' tid='5591', class="move" title="(similarity 100%)">type_</a>; }

  <a id='5594' tid='5593', class="move" title="(similarity 100%)">static</a> <a id='5596' tid='5595', class="move" title="(similarity 100%)">Redirection</a><a id='5598' tid='5597', class="move" title="(similarity 100%)">*</a> <a id='5600' tid='5599', class="move" title="(similarity 100%)">Get</a>(<a id='5602' tid='5601', class="move" title="(similarity 100%)">void</a><a id='5604' tid='5603', class="move" title="(similarity 100%)">*</a> <a id='5606' tid='5605', class="move" title="(similarity 100%)">external_function</a>,
                          <a id='5608' tid='5607', class="move" title="(similarity 100%)">ExternalReference</a><a id='5610' tid='5609', class="move" title="(similarity 100%)">::</a><a id='5612' tid='5611', class="move" title="(similarity 100%)">Type</a> <a id='5614' tid='5613', class="move" title="(similarity 100%)">type</a>) {
    <a id='5616' tid='5615', class="move" title="(similarity 100%)">Isolate</a><a id='5618' tid='5617', class="move" title="(similarity 100%)">*</a> <a id='5620' tid='5619', class="move" title="(similarity 100%)">isolate</a> = <a id='5622' tid='5621', class="move" title="(similarity 100%)">Isolate</a><a id='5624' tid='5623', class="move" title="(similarity 100%)">::</a><a id='5626' tid='5625', class="move" title="(similarity 100%)">Current</a>();
    <a id='5628' tid='5627', class="move" title="(similarity 100%)">Redirection</a><a id='5630' tid='5629', class="move" title="(similarity 100%)">*</a> <a id='5632' tid='5631', class="move" title="(similarity 100%)">current</a> = <a id='5634' tid='5633', class="move" title="(similarity 100%)">isolate</a>-&gt;<a id='5636' tid='5635', class="move" title="(similarity 100%)">simulator_redirection</a>();
    <a id='5638' tid='5637', class="move" title="(similarity 100%)">for</a> (; <a id='5640' tid='5639', class="move" title="(similarity 100%)">current</a> <a id='5642' tid='5641', class="move" title="(similarity 100%)">!=</a> <a id='5644' tid='5643', class="move" title="(similarity 100%)">NULL</a>; <a id='5646' tid='5645', class="move" title="(similarity 100%)">current</a> <a id='5648' tid='5647', class="move" title="(similarity 100%)">=</a> <a id='5650' tid='5649', class="move" title="(similarity 100%)">current</a>-&gt;<a id='5652' tid='5651', class="move" title="(similarity 100%)">next_</a>) {
      <a id='5654' tid='5653', class="move" title="(similarity 100%)">if</a> (<a id='5656' tid='5655', class="move" title="(similarity 100%)">current</a>-&gt;<a id='5658' tid='5657', class="move" title="(similarity 100%)">external_function_</a> <a id='5660' tid='5659', class="move" title="(similarity 100%)">==</a> <a id='5662' tid='5661', class="move" title="(similarity 100%)">external_function</a>) <a id='5664' tid='5663', class="move" title="(similarity 100%)">return</a> <a id='5666' tid='5665', class="move" title="(similarity 100%)">current</a>;
    }
    <a id='5668' tid='5667', class="move" title="(similarity 100%)">return</a> <a id='5670' tid='5669', class="move" title="(similarity 100%)">new</a> <a id='5672' tid='5671', class="move" title="(similarity 100%)">Redirection</a>(<a id='5674' tid='5673', class="move" title="(similarity 100%)">external_function</a>, <a id='5676' tid='5675', class="move" title="(similarity 100%)">type</a>);
  }

  <a id='5678' tid='5677', class="move" title="(similarity 100%)">static</a> <a id='5680' tid='5679', class="move" title="(similarity 100%)">Redirection</a><a id='5682' tid='5681', class="move" title="(similarity 100%)">*</a> <a id='5684' tid='5683', class="move" title="(similarity 100%)">FromSwiInstruction</a>(<a id='5686' tid='5685', class="move" title="(similarity 100%)">Instruction</a><a id='5688' tid='5687', class="move" title="(similarity 100%)">*</a> <a id='5690' tid='5689', class="move" title="(similarity 100%)">swi_instruction</a>) {
    <a id='5692' tid='5691', class="move" title="(similarity 100%)">char</a><a id='5694' tid='5693', class="move" title="(similarity 100%)">*</a> <a id='5696' tid='5695', class="move" title="(similarity 100%)">addr_of_swi</a> = <a id='5698' tid='5697', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='5700' tid='5699', class="move" title="(similarity 100%)">char</a><a id='5702' tid='5701', class="move" title="(similarity 100%)">*</a>&gt;(<a id='5704' tid='5703', class="move" title="(similarity 100%)">swi_instruction</a>);
    <a id='5706' tid='5705', class="move" title="(similarity 100%)">char</a><a id='5708' tid='5707', class="move" title="(similarity 100%)">*</a> <a id='5710' tid='5709', class="move" title="(similarity 100%)">addr_of_redirection</a> =
        <a id='5712' tid='5711', class="move" title="(similarity 100%)">addr_of_swi</a> <a id='5714' tid='5713', class="move" title="(similarity 100%)">-</a> <a id='5716' tid='5715', class="move" title="(similarity 100%)">OFFSET_OF</a>(<a id='5718' tid='5717', class="move" title="(similarity 100%)">Redirection</a>, <a id='5720' tid='5719', class="move" title="(similarity 100%)">swi_instruction_</a>);
    <a id='5722' tid='5721', class="move" title="(similarity 100%)">return</a> <a id='5724' tid='5723', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='5726' tid='5725', class="move" title="(similarity 100%)">Redirection</a><a id='5728' tid='5727', class="move" title="(similarity 100%)">*</a>&gt;(<a id='5730' tid='5729', class="move" title="(similarity 100%)">addr_of_redirection</a>);
  }

 <a id='5732' tid='5731', class="move" title="(similarity 100%)">private</a>:
  <a id='5734' tid='5733', class="move" title="(similarity 100%)">void</a><a id='5736' tid='5735', class="move" title="(similarity 100%)">*</a> <a id='5738' tid='5737', class="move" title="(similarity 100%)">external_function_</a>;
  <a id='5740' tid='5739', class="move" title="(similarity 100%)">uint32_t</a> <a id='5742' tid='5741', class="move" title="(similarity 100%)">swi_instruction_</a>;
  <a id='5744' tid='5743', class="move" title="(similarity 100%)">ExternalReference</a><a id='5746' tid='5745', class="move" title="(similarity 100%)">::</a><a id='5748' tid='5747', class="move" title="(similarity 100%)">Type</a> <a id='5750' tid='5749', class="move" title="(similarity 100%)">type_</a>;
  <a id='5752' tid='5751', class="move" title="(similarity 100%)">Redirection</a><a id='5754' tid='5753', class="move" title="(similarity 100%)">*</a> <a id='5756' tid='5755', class="move" title="(similarity 100%)">next_</a>;
};


<a id='5430' tid='5429', class="move" title="(similarity 100%)">void</a><a id='5432' tid='5431', class="move" title="(similarity 100%)">*</a> <a id='5434' tid='5433', class="move" title="(similarity 100%)">Simulator</a><a id='5436' tid='5435', class="move" title="(similarity 100%)">::</a><a id='5438' tid='5437', class="move" title="(similarity 100%)">RedirectExternalReference</a>(<a id='5440' tid='5439', class="move" title="(similarity 100%)">void</a><a id='5442' tid='5441', class="move" title="(similarity 100%)">*</a> <a id='5444' tid='5443', class="move" title="(similarity 100%)">external_function</a>,
                                           <a id='5446' tid='5445', class="move" title="(similarity 100%)">ExternalReference</a><a id='5448' tid='5447', class="move" title="(similarity 100%)">::</a><a id='5450' tid='5449', class="move" title="(similarity 100%)">Type</a> <a id='5452' tid='5451', class="move" title="(similarity 100%)">type</a>) {
  <a id='5454' tid='5453', class="move" title="(similarity 100%)">Redirection</a><a id='5456' tid='5455', class="move" title="(similarity 100%)">*</a> <a id='5458' tid='5457', class="move" title="(similarity 100%)">redirection</a> = <a id='5460' tid='5459', class="move" title="(similarity 100%)">Redirection</a><a id='5462' tid='5461', class="move" title="(similarity 100%)">::</a><a id='5464' tid='5463', class="move" title="(similarity 100%)">Get</a>(<a id='5466' tid='5465', class="move" title="(similarity 100%)">external_function</a>, <a id='5468' tid='5467', class="move" title="(similarity 100%)">type</a>);
  <a id='5470' tid='5469', class="move" title="(similarity 100%)">return</a> <a id='5472' tid='5471', class="move" title="(similarity 100%)">redirection</a>-&gt;<a id='5474' tid='5473', class="move" title="(similarity 100%)">address_of_swi_instruction</a>();
}


// Get the active Simulator for the current thread.
<a id='5392' tid='5391', class="move" title="(similarity 100%)">Simulator</a><a id='5394' tid='5393', class="move" title="(similarity 100%)">*</a> <a id='5396' tid='5395', class="move" title="(similarity 100%)">Simulator</a><a id='5398' tid='5397', class="move" title="(similarity 100%)">::</a><a id='5400' tid='5399', class="move" title="(similarity 100%)">current</a>(<a id='5402' tid='5401', class="move" title="(similarity 100%)">Isolate</a><a id='5404' tid='5403', class="move" title="(similarity 100%)">*</a> <a id='5406' tid='5405', class="move" title="(similarity 100%)">isolate</a>) {
  <a id='5408' tid='5407', class="move" title="(similarity 100%)">v8</a><a id='5410' tid='5409', class="move" title="(similarity 100%)">::</a><a id='5412' tid='5411', class="move" title="(similarity 100%)">internal</a><a id='5414' tid='5413', class="move" title="(similarity 100%)">::</a><a id='5416' tid='5415', class="move" title="(similarity 100%)">Isolate</a><a id='5418' tid='5417', class="move" title="(similarity 100%)">::</a><a id='5420' tid='5419', class="move" title="(similarity 100%)">PerIsolateThreadData</a><a id='5422' tid='5421', class="move" title="(similarity 100%)">*</a> <a id='5424' tid='5423', class="move" title="(similarity 100%)">isolate_data</a> =
      <a id='5426' tid='5425', class="move" title="(similarity 100%)">isolate</a>-&gt;<a id='5428' tid='5427', class="move" title="(similarity 100%)">FindOrAllocatePerThreadDataForThisThread</a>();
  <span class="insertion" title="inserted">ASSERT(isolate_data != NULL);</span>

  <span class="insertion" title="inserted">Simulator* sim = isolate_data-&gt;simulator();</span>
  <a id='5368' tid='5367', class="move" title="(similarity 100%)">if</a> (<a id='5370' tid='5369', class="move" title="(similarity 100%)">sim</a> <a id='5372' tid='5371', class="move" title="(similarity 100%)">==</a> <a id='5374' tid='5373', class="move" title="(similarity 100%)">NULL</a>) {
    // TODO(146): delete the simulator object when a thread/isolate goes away.
    <a id='5376' tid='5375', class="move" title="(similarity 100%)">sim</a> <a id='5378' tid='5377', class="move" title="(similarity 100%)">=</a> <a id='5380' tid='5379', class="move" title="(similarity 100%)">new</a> <a id='5382' tid='5381', class="move" title="(similarity 100%)">Simulator</a>(<a id='5384' tid='5383', class="move" title="(similarity 100%)">isolate</a>);
    <a id='5386' tid='5385', class="move" title="(similarity 100%)">isolate_data</a>-&gt;<a id='5388' tid='5387', class="move" title="(similarity 100%)">set_simulator</a>(<a id='5390' tid='5389', class="move" title="(similarity 100%)">sim</a>);
  }
  <span class="insertion" title="inserted">return sim;</span>
}


// Sets the register in the architecture state. It will also deal with updating
// Simulator internal state for special registers such as PC.
<a id='5338' tid='5337', class="move" title="(similarity 100%)">void</a> <a id='5340' tid='5339', class="move" title="(similarity 100%)">Simulator</a><a id='5342' tid='5341', class="move" title="(similarity 100%)">::</a><a id='5344' tid='5343', class="move" title="(similarity 100%)">set_register</a>(<a id='5346' tid='5345', class="move" title="(similarity 100%)">int</a> <a id='5348' tid='5347', class="move" title="(similarity 100%)">reg</a>, <a id='5350' tid='5349', class="move" title="(similarity 100%)">int32_t</a> <a id='5352' tid='5351', class="move" title="(similarity 100%)">value</a>) {
  <span class="insertion" title="inserted">ASSERT((reg &gt;= 0) && (reg &lt; num_registers));</span>
  <a id='5354' tid='5353', class="move" title="(similarity 100%)">if</a> (<a id='5356' tid='5355', class="move" title="(similarity 100%)">reg</a> <a id='5358' tid='5357', class="move" title="(similarity 100%)">==</a> <a id='5360' tid='5359', class="move" title="(similarity 100%)">pc</a>) {
    <a id='5362' tid='5361', class="move" title="(similarity 100%)">pc_modified_</a> <a id='5364' tid='5363', class="move" title="(similarity 100%)">=</a> <a id='5366' tid='5365', class="move" title="(similarity 100%)">true</a>;
  }
  <span class="insertion" title="inserted">registers_[reg] = value;</span>
}


// Get the register from the architecture state. This function does handle
// the special case of accessing the PC register.
<a id='5324' tid='5323', class="move" title="(similarity 100%)">int32_t</a> <a id='5326' tid='5325', class="move" title="(similarity 100%)">Simulator</a><a id='5328' tid='5327', class="move" title="(similarity 100%)">::</a><a id='5330' tid='5329', class="move" title="(similarity 100%)">get_register</a>(<a id='5332' tid='5331', class="move" title="(similarity 100%)">int</a> <a id='5334' tid='5333', class="move" title="(similarity 100%)">reg</a>) <a id='5336' tid='5335', class="move" title="(similarity 100%)">const</a> {
  <span class="insertion" title="inserted">ASSERT((reg &gt;= 0) && (reg &lt; num_registers));</span>
  // Stupid code added to avoid bug in GCC.
  // See: http://gcc.gnu.org/bugzilla/show_bug.cgi?id=43949
  <span class="insertion" title="inserted">if (reg &gt;= num_registers) return 0;</span>
  // End stupid code.
  <a id='5302' tid='5301', class="move" title="(similarity 100%)">return</a> <a id='5304' tid='5303', class="move" title="(similarity 100%)">registers_</a>[<a id='5306' tid='5305', class="move" title="(similarity 100%)">reg</a>] <a id='5308' tid='5307', class="move" title="(similarity 100%)">+</a> ((<a id='5310' tid='5309', class="move" title="(similarity 100%)">reg</a> <a id='5312' tid='5311', class="move" title="(similarity 100%)">==</a> <a id='5314' tid='5313', class="move" title="(similarity 100%)">pc</a>) ? <a id='5316' tid='5315', class="move" title="(similarity 100%)">Instruction</a><a id='5318' tid='5317', class="move" title="(similarity 100%)">::</a><a id='5320' tid='5319', class="move" title="(similarity 100%)">kPCReadOffset</a> : <a id='5322' tid='5321', class="move" title="(similarity 100%)">0</a>);
}


<span class="insertion" title="inserted">double Simulator::get_double_from_register_pair(int reg) {
  ASSERT((reg &gt;= 0) && (reg &lt; num_registers) && ((reg % 2) == 0));

  double dm_val = 0.0;
  // Read the bits from the unsigned integer register_[] array
  // into the double precision floating point value and return it.
  char buffer[2 * sizeof(vfp_register[0])];
  memcpy(buffer, &registers_[reg], 2 * sizeof(registers_[0]));
  memcpy(&dm_val, buffer, 2 * sizeof(registers_[0]));
  return(dm_val);
}</span>


<span class="insertion" title="inserted">void Simulator::set_dw_register(int dreg, const int* dbl) {
  ASSERT((dreg &gt;= 0) && (dreg &lt; num_d_registers));
  registers_[dreg] = dbl[0];
  registers_[dreg + 1] = dbl[1];
}</span>


// Raw access to the PC register.
<a id='5276' tid='5275', class="move" title="(similarity 100%)">void</a> <a id='5278' tid='5277', class="move" title="(similarity 100%)">Simulator</a><a id='5280' tid='5279', class="move" title="(similarity 100%)">::</a><a id='5282' tid='5281', class="move" title="(similarity 100%)">set_pc</a>(<a id='5284' tid='5283', class="move" title="(similarity 100%)">int32_t</a> <a id='5286' tid='5285', class="move" title="(similarity 100%)">value</a>) {
  <a id='5288' tid='5287', class="move" title="(similarity 100%)">pc_modified_</a> <a id='5290' tid='5289', class="move" title="(similarity 100%)">=</a> <a id='5292' tid='5291', class="move" title="(similarity 100%)">true</a>;
  <a id='5294' tid='5293', class="move" title="(similarity 100%)">registers_</a>[<a id='5296' tid='5295', class="move" title="(similarity 100%)">pc</a>] <a id='5298' tid='5297', class="move" title="(similarity 100%)">=</a> <a id='5300' tid='5299', class="move" title="(similarity 100%)">value</a>;
}


<span class="insertion" title="inserted">bool Simulator::has_bad_pc() const</span> <span class="insertion" title="inserted">{
  return ((registers_[pc] == bad_lr) || (registers_[pc] == end_sim_pc));
}</span>


// Raw access to the PC register without the special adjustment when reading.
<span class="insertion" title="inserted">int32_t Simulator::get_pc() const</span> <span class="insertion" title="inserted">{
  return registers_[pc];
}</span>


// Getting from and setting into VFP registers.
<span class="insertion" title="inserted">void Simulator::set_s_register(int sreg, unsigned int value) {
  ASSERT((sreg &gt;= 0) && (sreg &lt; num_s_registers));
  vfp_register[sreg] = value;
}</span>


<span class="insertion" title="inserted">unsigned int Simulator::get_s_register(int sreg) const</span> <span class="insertion" title="inserted">{
  ASSERT((sreg &gt;= 0) && (sreg &lt; num_s_registers));
  return vfp_register[sreg];
}</span>


<span class="insertion" title="inserted">void Simulator::set_s_register_from_float(int sreg, const float flt) {
  ASSERT((sreg &gt;= 0) && (sreg &lt; num_s_registers));
  // Read the bits from the single precision floating point value
  // into the unsigned integer element of vfp_register[] given by index=sreg.
  char buffer[sizeof(vfp_register[0])];
  memcpy(buffer, &flt, sizeof(vfp_register[0]));
  memcpy(&vfp_register[sreg], buffer, sizeof(vfp_register[0]));
}</span>


<span class="insertion" title="inserted">void Simulator::set_s_register_from_sinteger(int sreg, const int sint) {
  ASSERT((sreg &gt;= 0) && (sreg &lt; num_s_registers));
  // Read the bits from the integer value into the unsigned integer element of
  // vfp_register[] given by index=sreg.
  char buffer[sizeof(vfp_register[0])];
  memcpy(buffer, &sint, sizeof(vfp_register[0]));
  memcpy(&vfp_register[sreg], buffer, sizeof(vfp_register[0]));
}</span>


<span class="insertion" title="inserted">void Simulator::set_d_register_from_double(int dreg, const double& dbl) {
  ASSERT((dreg &gt;= 0) && (dreg &lt; num_d_registers));
  // Read the bits from the double precision floating point value into the two
  // consecutive unsigned integer elements of vfp_register[] given by index
  // 2*sreg and 2*sreg+1.
  char buffer[2 * sizeof(vfp_register[0])];
  memcpy(buffer, &dbl, 2 * sizeof(vfp_register[0]));
  memcpy(&vfp_register[dreg * 2], buffer, 2 * sizeof(vfp_register[0]));
}</span>


<span class="insertion" title="inserted">float Simulator::get_float_from_s_register(int sreg) {
  ASSERT((sreg &gt;= 0) && (sreg &lt; num_s_registers));

  float sm_val = 0.0;
  // Read the bits from the unsigned integer vfp_register[] array
  // into the single precision floating point value and return it.
  char buffer[sizeof(vfp_register[0])];
  memcpy(buffer, &vfp_register[sreg], sizeof(vfp_register[0]));
  memcpy(&sm_val, buffer, sizeof(vfp_register[0]));
  return(sm_val);
}</span>


<span class="insertion" title="inserted">int Simulator::get_sinteger_from_s_register(int sreg) {
  ASSERT((sreg &gt;= 0) && (sreg &lt; num_s_registers));

  int sm_val = 0;
  // Read the bits from the unsigned integer vfp_register[] array
  // into the single precision floating point value and return it.
  char buffer[sizeof(vfp_register[0])];
  memcpy(buffer, &vfp_register[sreg], sizeof(vfp_register[0]));
  memcpy(&sm_val, buffer, sizeof(vfp_register[0]));
  return(sm_val);
}</span>


<span class="insertion" title="inserted">double Simulator::get_double_from_d_register(int dreg) {
  ASSERT((dreg &gt;= 0) && (dreg &lt; num_d_registers));

  double dm_val = 0.0;
  // Read the bits from the unsigned integer vfp_register[] array
  // into the double precision floating point value and return it.
  char buffer[2 * sizeof(vfp_register[0])];
  memcpy(buffer, &vfp_register[2 * dreg], 2 * sizeof(vfp_register[0]));
  memcpy(&dm_val, buffer, 2 * sizeof(vfp_register[0]));
  return(dm_val);
}</span>


// For use in calls that take two double values, constructed either
// from r0-r3 or d0 and d1.
<a id='5256' tid='5255', class="move" title="(similarity 100%)">void</a> <a id='5258' tid='5257', class="move" title="(similarity 100%)">Simulator</a><a id='5260' tid='5259', class="move" title="(similarity 100%)">::</a><a id='5262' tid='5261', class="move" title="(similarity 100%)">GetFpArgs</a>(<a id='5264' tid='5263', class="move" title="(similarity 100%)">double</a><a id='5266' tid='5265', class="move" title="(similarity 100%)">*</a> <a id='5268' tid='5267', class="move" title="(similarity 100%)">x</a>, <a id='5270' tid='5269', class="move" title="(similarity 100%)">double</a><a id='5272' tid='5271', class="move" title="(similarity 100%)">*</a> <a id='5274' tid='5273', class="move" title="(similarity 100%)">y</a>) <span class="insertion" title="inserted">{
  if (use_eabi_hardfloat()) {
    *x = vfp_register[0];
    *y = vfp_register[1];
  } else {
    // We use a char buffer to get around the strict-aliasing rules which
    // otherwise allow the compiler to optimize away the copy.
    char buffer[sizeof(*x)];
    // Registers 0 and 1 -&gt; x.
    memcpy(buffer, registers_, sizeof(*x));
    memcpy(x, buffer, sizeof(*x));
    // Registers 2 and 3 -&gt; y.
    memcpy(buffer, registers_ + 2, sizeof(*y));
    memcpy(y, buffer, sizeof(*y));
  }
}</span>

// For use in calls that take one double value, constructed either
// from r0 and r1 or d0.
<a id='5242' tid='5241', class="move" title="(similarity 100%)">void</a> <a id='5244' tid='5243', class="move" title="(similarity 100%)">Simulator</a><a id='5246' tid='5245', class="move" title="(similarity 100%)">::</a><a id='5248' tid='5247', class="move" title="(similarity 100%)">GetFpArgs</a>(<a id='5250' tid='5249', class="move" title="(similarity 100%)">double</a><a id='5252' tid='5251', class="move" title="(similarity 100%)">*</a> <a id='5254' tid='5253', class="move" title="(similarity 100%)">x</a>) <span class="insertion" title="inserted">{
  if (use_eabi_hardfloat()) {
    *x = vfp_register[0];
  } else {
    // We use a char buffer to get around the strict-aliasing rules which
    // otherwise allow the compiler to optimize away the copy.
    char buffer[sizeof(*x)];
    // Registers 0 and 1 -&gt; x.
    memcpy(buffer, registers_, sizeof(*x));
    memcpy(x, buffer, sizeof(*x));
  }
}</span>


// For use in calls that take one double value constructed either
// from r0 and r1 or d0 and one integer value.
<a id='5222' tid='5221', class="move" title="(similarity 100%)">void</a> <a id='5224' tid='5223', class="move" title="(similarity 100%)">Simulator</a><a id='5226' tid='5225', class="move" title="(similarity 100%)">::</a><a id='5228' tid='5227', class="move" title="(similarity 100%)">GetFpArgs</a>(<a id='5230' tid='5229', class="move" title="(similarity 100%)">double</a><a id='5232' tid='5231', class="move" title="(similarity 100%)">*</a> <a id='5234' tid='5233', class="move" title="(similarity 100%)">x</a>, <a id='5236' tid='5235', class="move" title="(similarity 100%)">int32_t</a><a id='5238' tid='5237', class="move" title="(similarity 100%)">*</a> <a id='5240' tid='5239', class="move" title="(similarity 100%)">y</a>) <span class="insertion" title="inserted">{
  if (use_eabi_hardfloat()) {
    *x = vfp_register[0];
    *y = registers_[1];
  } else {
    // We use a char buffer to get around the strict-aliasing rules which
    // otherwise allow the compiler to optimize away the copy.
    char buffer[sizeof(*x)];
    // Registers 0 and 1 -&gt; x.
    memcpy(buffer, registers_, sizeof(*x));
    memcpy(x, buffer, sizeof(*x));
    // Register 2 -&gt; y.
    memcpy(buffer, registers_ + 2, sizeof(*y));
    memcpy(y, buffer, sizeof(*y));
  }
}</span>


// The return value is either in r0/r1 or d0.
<a id='5190' tid='5189', class="move" title="(similarity 100%)">void</a> <a id='5192' tid='5191', class="move" title="(similarity 100%)">Simulator</a><a id='5194' tid='5193', class="move" title="(similarity 100%)">::</a><a id='5196' tid='5195', class="move" title="(similarity 100%)">SetFpResult</a>(<a id='5198' tid='5197', class="move" title="(similarity 100%)">const</a> <a id='5200' tid='5199', class="move" title="(similarity 100%)">double</a><a id='5202' tid='5201', class="move" title="(similarity 100%)">&</a> <a id='5204' tid='5203', class="move" title="(similarity 100%)">result</a>) {
  <span class="insertion" title="inserted">if</span> <span class="insertion" title="inserted">(use_eabi_hardfloat())</span> <span class="insertion" title="inserted">{
    char buffer[2 * sizeof(vfp_register[0])];
    memcpy(buffer, &result, sizeof(buffer));
    // Copy result to d0.
    memcpy(vfp_register, buffer, sizeof(buffer));
  }</span> <a id='5206' tid='5205', class="move" title="(similarity 100%)">else</a> {
    <a id='5208' tid='5207', class="move" title="(similarity 100%)">char</a> <a id='5210' tid='5209', class="move" title="(similarity 100%)">buffer</a>[<a id='5212' tid='5211', class="move" title="(similarity 100%)">2</a> <a id='5214' tid='5213', class="move" title="(similarity 100%)">*</a> <a id='5216' tid='5215', class="move" title="(similarity 100%)">sizeof</a>(<a id='5218' tid='5217', class="move" title="(similarity 100%)">registers_</a>[<a id='5220' tid='5219', class="move" title="(similarity 100%)">0</a>])];
    <span class="insertion" title="inserted">memcpy(buffer, &result, sizeof(buffer));</span>
    // Copy result to r0 and r1.
    <span class="insertion" title="inserted">memcpy(registers_, buffer, sizeof(buffer));</span>
  }
}


<span class="insertion" title="inserted">void Simulator::TrashCallerSaveRegisters() {
  // We don&#39;t trash the registers with the return value.
  registers_[2] = 0x50Bad4U;
  registers_[3] = 0x50Bad4U;
  registers_[12] = 0x50Bad4U;
}</span>

// Some Operating Systems allow unaligned access on ARMv7 targets. We
// assume that unaligned accesses are not allowed unless the v8 build system
// defines the CAN_USE_UNALIGNED_ACCESSES macro to be non-zero.
// The following statements below describes the behavior of the ARM CPUs
// that don&#39;t support unaligned access.
// Some ARM platforms raise an interrupt on detecting unaligned access.
// On others it does a funky rotation thing.  For now we
// simply disallow unaligned reads.  Note that simulator runs have the runtime
// system running directly on the host system and only generated code is
// executed in the simulator.  Since the host is typically IA32 we will not
// get the correct ARM-like behaviour on unaligned accesses for those ARM
// targets that don&#39;t support unaligned loads and stores.


<a id='5158' tid='5157', class="move" title="(similarity 100%)">int</a> <a id='5160' tid='5159', class="move" title="(similarity 100%)">Simulator</a><a id='5162' tid='5161', class="move" title="(similarity 100%)">::</a><a id='5164' tid='5163', class="move" title="(similarity 100%)">ReadW</a>(<a id='5166' tid='5165', class="move" title="(similarity 100%)">int32_t</a> <a id='5168' tid='5167', class="move" title="(similarity 100%)">addr</a>, <a id='5170' tid='5169', class="move" title="(similarity 100%)">Instruction</a><a id='5172' tid='5171', class="move" title="(similarity 100%)">*</a> <a id='5174' tid='5173', class="move" title="(similarity 100%)">instr</a>) {
<span class="insertion" title="inserted">#if V8_TARGET_CAN_READ_UNALIGNED</span>
  <a id='5176' tid='5175', class="move" title="(similarity 100%)">intptr_t</a><a id='5178' tid='5177', class="move" title="(similarity 100%)">*</a> <a id='5180' tid='5179', class="move" title="(similarity 100%)">ptr</a> = <a id='5182' tid='5181', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='5184' tid='5183', class="move" title="(similarity 100%)">intptr_t</a><a id='5186' tid='5185', class="move" title="(similarity 100%)">*</a>&gt;(<a id='5188' tid='5187', class="move" title="(similarity 100%)">addr</a>);
  <span class="insertion" title="inserted">return *ptr;</span>
<span class="insertion" title="inserted">#else</span>
  <span class="insertion" title="inserted">if ((addr & 3) == 0) {
    intptr_t* ptr = reinterpret_cast&lt;intptr_t*&gt;(addr);
    return *ptr;
  }</span>
  <a id='5142' tid='5141', class="move" title="(similarity 100%)">PrintF</a>(<a id='5144' tid='5143', class="move" title="(similarity 100%)">&quot;Unaligned read at 0x%08x, pc=0x%08&quot;</a> <a id='5146' tid='5145', class="move" title="(similarity 100%)">V8PRIxPTR</a> <a id='5148' tid='5147', class="move" title="(similarity 100%)">&quot;\n&quot;</a>,
         <a id='5150' tid='5149', class="move" title="(similarity 100%)">addr</a>,
         <a id='5152' tid='5151', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='5154' tid='5153', class="move" title="(similarity 100%)">intptr_t</a>&gt;(<a id='5156' tid='5155', class="move" title="(similarity 100%)">instr</a>));
  <span class="insertion" title="inserted">UNIMPLEMENTED();</span>
  <span class="insertion" title="inserted">return 0;</span>
<span class="insertion" title="inserted">#endif</span>
}


<a id='5106' tid='5105', class="move" title="(similarity 100%)">void</a> <a id='5108' tid='5107', class="move" title="(similarity 100%)">Simulator</a><a id='5110' tid='5109', class="move" title="(similarity 100%)">::</a><a id='5112' tid='5111', class="move" title="(similarity 100%)">WriteW</a>(<a id='5114' tid='5113', class="move" title="(similarity 100%)">int32_t</a> <a id='5116' tid='5115', class="move" title="(similarity 100%)">addr</a>, <a id='5118' tid='5117', class="move" title="(similarity 100%)">int</a> <a id='5120' tid='5119', class="move" title="(similarity 100%)">value</a>, <a id='5122' tid='5121', class="move" title="(similarity 100%)">Instruction</a><a id='5124' tid='5123', class="move" title="(similarity 100%)">*</a> <a id='5126' tid='5125', class="move" title="(similarity 100%)">instr</a>) {
<span class="insertion" title="inserted">#if V8_TARGET_CAN_READ_UNALIGNED</span>
  <a id='5128' tid='5127', class="move" title="(similarity 100%)">intptr_t</a><a id='5130' tid='5129', class="move" title="(similarity 100%)">*</a> <a id='5132' tid='5131', class="move" title="(similarity 100%)">ptr</a> = <a id='5134' tid='5133', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='5136' tid='5135', class="move" title="(similarity 100%)">intptr_t</a><a id='5138' tid='5137', class="move" title="(similarity 100%)">*</a>&gt;(<a id='5140' tid='5139', class="move" title="(similarity 100%)">addr</a>);
  <span class="insertion" title="inserted">*ptr = value;</span>
  <span class="insertion" title="inserted">return;</span>
<span class="insertion" title="inserted">#else</span>
  <span class="insertion" title="inserted">if ((addr & 3) == 0) {
    intptr_t* ptr = reinterpret_cast&lt;intptr_t*&gt;(addr);
    *ptr = value;
    return;
  }</span>
  <a id='5090' tid='5089', class="move" title="(similarity 100%)">PrintF</a>(<a id='5092' tid='5091', class="move" title="(similarity 100%)">&quot;Unaligned write at 0x%08x, pc=0x%08&quot;</a> <a id='5094' tid='5093', class="move" title="(similarity 100%)">V8PRIxPTR</a> <a id='5096' tid='5095', class="move" title="(similarity 100%)">&quot;\n&quot;</a>,
         <a id='5098' tid='5097', class="move" title="(similarity 100%)">addr</a>,
         <a id='5100' tid='5099', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='5102' tid='5101', class="move" title="(similarity 100%)">intptr_t</a>&gt;(<a id='5104' tid='5103', class="move" title="(similarity 100%)">instr</a>));
  <span class="insertion" title="inserted">UNIMPLEMENTED();</span>
<span class="insertion" title="inserted">#endif</span>
}


<a id='5058' tid='5057', class="move" title="(similarity 100%)">uint16_t</a> <a id='5060' tid='5059', class="move" title="(similarity 100%)">Simulator</a><a id='5062' tid='5061', class="move" title="(similarity 100%)">::</a><a id='5064' tid='5063', class="move" title="(similarity 100%)">ReadHU</a>(<a id='5066' tid='5065', class="move" title="(similarity 100%)">int32_t</a> <a id='5068' tid='5067', class="move" title="(similarity 100%)">addr</a>, <a id='5070' tid='5069', class="move" title="(similarity 100%)">Instruction</a><a id='5072' tid='5071', class="move" title="(similarity 100%)">*</a> <a id='5074' tid='5073', class="move" title="(similarity 100%)">instr</a>) {
<span class="insertion" title="inserted">#if V8_TARGET_CAN_READ_UNALIGNED</span>
  <a id='5076' tid='5075', class="move" title="(similarity 100%)">uint16_t</a><a id='5078' tid='5077', class="move" title="(similarity 100%)">*</a> <a id='5080' tid='5079', class="move" title="(similarity 100%)">ptr</a> = <a id='5082' tid='5081', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='5084' tid='5083', class="move" title="(similarity 100%)">uint16_t</a><a id='5086' tid='5085', class="move" title="(similarity 100%)">*</a>&gt;(<a id='5088' tid='5087', class="move" title="(similarity 100%)">addr</a>);
  <span class="insertion" title="inserted">return *ptr;</span>
<span class="insertion" title="inserted">#else</span>
  <span class="insertion" title="inserted">if ((addr & 1) == 0) {
    uint16_t* ptr = reinterpret_cast&lt;uint16_t*&gt;(addr);
    return *ptr;
  }</span>
  <a id='5042' tid='5041', class="move" title="(similarity 100%)">PrintF</a>(<a id='5044' tid='5043', class="move" title="(similarity 100%)">&quot;Unaligned unsigned halfword read at 0x%08x, pc=0x%08&quot;</a> <a id='5046' tid='5045', class="move" title="(similarity 100%)">V8PRIxPTR</a> <a id='5048' tid='5047', class="move" title="(similarity 100%)">&quot;\n&quot;</a>,
         <a id='5050' tid='5049', class="move" title="(similarity 100%)">addr</a>,
         <a id='5052' tid='5051', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='5054' tid='5053', class="move" title="(similarity 100%)">intptr_t</a>&gt;(<a id='5056' tid='5055', class="move" title="(similarity 100%)">instr</a>));
  <span class="insertion" title="inserted">UNIMPLEMENTED();</span>
  <span class="insertion" title="inserted">return 0;</span>
<span class="insertion" title="inserted">#endif</span>
}


<a id='5010' tid='5009', class="move" title="(similarity 100%)">int16_t</a> <a id='5012' tid='5011', class="move" title="(similarity 100%)">Simulator</a><a id='5014' tid='5013', class="move" title="(similarity 100%)">::</a><a id='5016' tid='5015', class="move" title="(similarity 100%)">ReadH</a>(<a id='5018' tid='5017', class="move" title="(similarity 100%)">int32_t</a> <a id='5020' tid='5019', class="move" title="(similarity 100%)">addr</a>, <a id='5022' tid='5021', class="move" title="(similarity 100%)">Instruction</a><a id='5024' tid='5023', class="move" title="(similarity 100%)">*</a> <a id='5026' tid='5025', class="move" title="(similarity 100%)">instr</a>) {
<span class="insertion" title="inserted">#if V8_TARGET_CAN_READ_UNALIGNED</span>
  <a id='5028' tid='5027', class="move" title="(similarity 100%)">int16_t</a><a id='5030' tid='5029', class="move" title="(similarity 100%)">*</a> <a id='5032' tid='5031', class="move" title="(similarity 100%)">ptr</a> = <a id='5034' tid='5033', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='5036' tid='5035', class="move" title="(similarity 100%)">int16_t</a><a id='5038' tid='5037', class="move" title="(similarity 100%)">*</a>&gt;(<a id='5040' tid='5039', class="move" title="(similarity 100%)">addr</a>);
  <span class="insertion" title="inserted">return *ptr;</span>
<span class="insertion" title="inserted">#else</span>
  <span class="insertion" title="inserted">if ((addr & 1) == 0) {
    int16_t* ptr = reinterpret_cast&lt;int16_t*&gt;(addr);
    return *ptr;
  }</span>
  <span class="insertion" title="inserted">PrintF(&quot;Unaligned signed halfword read at 0x%08x\n&quot;, addr);</span>
  <span class="insertion" title="inserted">UNIMPLEMENTED();</span>
  <span class="insertion" title="inserted">return 0;</span>
<span class="insertion" title="inserted">#endif</span>
}


<a id='4974' tid='4973', class="move" title="(similarity 100%)">void</a> <a id='4976' tid='4975', class="move" title="(similarity 100%)">Simulator</a><a id='4978' tid='4977', class="move" title="(similarity 100%)">::</a><a id='4980' tid='4979', class="move" title="(similarity 100%)">WriteH</a>(<a id='4982' tid='4981', class="move" title="(similarity 100%)">int32_t</a> <a id='4984' tid='4983', class="move" title="(similarity 100%)">addr</a>, <a id='4986' tid='4985', class="move" title="(similarity 100%)">uint16_t</a> <a id='4988' tid='4987', class="move" title="(similarity 100%)">value</a>, <a id='4990' tid='4989', class="move" title="(similarity 100%)">Instruction</a><a id='4992' tid='4991', class="move" title="(similarity 100%)">*</a> <a id='4994' tid='4993', class="move" title="(similarity 100%)">instr</a>) {
<span class="insertion" title="inserted">#if V8_TARGET_CAN_READ_UNALIGNED</span>
  <a id='4996' tid='4995', class="move" title="(similarity 100%)">uint16_t</a><a id='4998' tid='4997', class="move" title="(similarity 100%)">*</a> <a id='5000' tid='4999', class="move" title="(similarity 100%)">ptr</a> = <a id='5002' tid='5001', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='5004' tid='5003', class="move" title="(similarity 100%)">uint16_t</a><a id='5006' tid='5005', class="move" title="(similarity 100%)">*</a>&gt;(<a id='5008' tid='5007', class="move" title="(similarity 100%)">addr</a>);
  <span class="insertion" title="inserted">*ptr = value;</span>
  <span class="insertion" title="inserted">return;</span>
<span class="insertion" title="inserted">#else</span>
  <span class="insertion" title="inserted">if ((addr & 1) == 0) {
    uint16_t* ptr = reinterpret_cast&lt;uint16_t*&gt;(addr);
    *ptr = value;
    return;
  }</span>
  <a id='4958' tid='4957', class="move" title="(similarity 100%)">PrintF</a>(<a id='4960' tid='4959', class="move" title="(similarity 100%)">&quot;Unaligned unsigned halfword write at 0x%08x, pc=0x%08&quot;</a> <a id='4962' tid='4961', class="move" title="(similarity 100%)">V8PRIxPTR</a> <a id='4964' tid='4963', class="move" title="(similarity 100%)">&quot;\n&quot;</a>,
         <a id='4966' tid='4965', class="move" title="(similarity 100%)">addr</a>,
         <a id='4968' tid='4967', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='4970' tid='4969', class="move" title="(similarity 100%)">intptr_t</a>&gt;(<a id='4972' tid='4971', class="move" title="(similarity 100%)">instr</a>));
  <span class="insertion" title="inserted">UNIMPLEMENTED();</span>
<span class="insertion" title="inserted">#endif</span>
}


<a id='4922' tid='4921', class="move" title="(similarity 100%)">void</a> <a id='4924' tid='4923', class="move" title="(similarity 100%)">Simulator</a><a id='4926' tid='4925', class="move" title="(similarity 100%)">::</a><a id='4928' tid='4927', class="move" title="(similarity 100%)">WriteH</a>(<a id='4930' tid='4929', class="move" title="(similarity 100%)">int32_t</a> <a id='4932' tid='4931', class="move" title="(similarity 100%)">addr</a>, <a id='4934' tid='4933', class="move" title="(similarity 100%)">int16_t</a> <a id='4936' tid='4935', class="move" title="(similarity 100%)">value</a>, <a id='4938' tid='4937', class="move" title="(similarity 100%)">Instruction</a><a id='4940' tid='4939', class="move" title="(similarity 100%)">*</a> <a id='4942' tid='4941', class="move" title="(similarity 100%)">instr</a>) {
<span class="insertion" title="inserted">#if V8_TARGET_CAN_READ_UNALIGNED</span>
  <a id='4944' tid='4943', class="move" title="(similarity 100%)">int16_t</a><a id='4946' tid='4945', class="move" title="(similarity 100%)">*</a> <a id='4948' tid='4947', class="move" title="(similarity 100%)">ptr</a> = <a id='4950' tid='4949', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='4952' tid='4951', class="move" title="(similarity 100%)">int16_t</a><a id='4954' tid='4953', class="move" title="(similarity 100%)">*</a>&gt;(<a id='4956' tid='4955', class="move" title="(similarity 100%)">addr</a>);
  <span class="insertion" title="inserted">*ptr = value;</span>
  <span class="insertion" title="inserted">return;</span>
<span class="insertion" title="inserted">#else</span>
  <span class="insertion" title="inserted">if ((addr & 1) == 0) {
    int16_t* ptr = reinterpret_cast&lt;int16_t*&gt;(addr);
    *ptr = value;
    return;
  }</span>
  <a id='4906' tid='4905', class="move" title="(similarity 100%)">PrintF</a>(<a id='4908' tid='4907', class="move" title="(similarity 100%)">&quot;Unaligned halfword write at 0x%08x, pc=0x%08&quot;</a> <a id='4910' tid='4909', class="move" title="(similarity 100%)">V8PRIxPTR</a> <a id='4912' tid='4911', class="move" title="(similarity 100%)">&quot;\n&quot;</a>,
         <a id='4914' tid='4913', class="move" title="(similarity 100%)">addr</a>,
         <a id='4916' tid='4915', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='4918' tid='4917', class="move" title="(similarity 100%)">intptr_t</a>&gt;(<a id='4920' tid='4919', class="move" title="(similarity 100%)">instr</a>));
  <span class="insertion" title="inserted">UNIMPLEMENTED();</span>
<span class="insertion" title="inserted">#endif</span>
}


<span class="insertion" title="inserted">uint8_t Simulator::ReadBU(int32_t addr)</span> {
  <a id='4892' tid='4891', class="move" title="(similarity 100%)">uint8_t</a><a id='4894' tid='4893', class="move" title="(similarity 100%)">*</a> <a id='4896' tid='4895', class="move" title="(similarity 100%)">ptr</a> = <a id='4898' tid='4897', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='4900' tid='4899', class="move" title="(similarity 100%)">uint8_t</a><a id='4902' tid='4901', class="move" title="(similarity 100%)">*</a>&gt;(<a id='4904' tid='4903', class="move" title="(similarity 100%)">addr</a>);
  <span class="insertion" title="inserted">return *ptr;</span>
}


<span class="insertion" title="inserted">int8_t Simulator::ReadB(int32_t addr)</span> {
  <a id='4826' tid='4825', class="move" title="(similarity 100%)">int8_t</a><a id='4828' tid='4827', class="move" title="(similarity 100%)">*</a> <a id='4830' tid='4829', class="move" title="(similarity 100%)">ptr</a> = <a id='4832' tid='4831', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='4834' tid='4833', class="move" title="(similarity 100%)">int8_t</a><a id='4836' tid='4835', class="move" title="(similarity 100%)">*</a>&gt;(<a id='4838' tid='4837', class="move" title="(similarity 100%)">addr</a>);
  <span class="insertion" title="inserted">return *ptr;</span>
}


<a id='4854' tid='4853', class="move" title="(similarity 100%)">void</a> <a id='4856' tid='4855', class="move" title="(similarity 100%)">Simulator</a><a id='4858' tid='4857', class="move" title="(similarity 100%)">::</a><a id='4860' tid='4859', class="move" title="(similarity 100%)">WriteB</a>(<a id='4862' tid='4861', class="move" title="(similarity 100%)">int32_t</a> <a id='4864' tid='4863', class="move" title="(similarity 100%)">addr</a>, <a id='4866' tid='4865', class="move" title="(similarity 100%)">uint8_t</a> <a id='4868' tid='4867', class="move" title="(similarity 100%)">value</a>) {
  <a id='4870' tid='4869', class="move" title="(similarity 100%)">uint8_t</a><a id='4872' tid='4871', class="move" title="(similarity 100%)">*</a> <a id='4874' tid='4873', class="move" title="(similarity 100%)">ptr</a> = <a id='4876' tid='4875', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='4878' tid='4877', class="move" title="(similarity 100%)">uint8_t</a><a id='4880' tid='4879', class="move" title="(similarity 100%)">*</a>&gt;(<a id='4882' tid='4881', class="move" title="(similarity 100%)">addr</a>);
  <a id='4884' tid='4883', class="move" title="(similarity 100%)">*</a><a id='4886' tid='4885', class="move" title="(similarity 100%)">ptr</a> <a id='4888' tid='4887', class="move" title="(similarity 100%)">=</a> <a id='4890' tid='4889', class="move" title="(similarity 100%)">value</a>;
}


<a id='4810' tid='4809', class="move" title="(similarity 100%)">void</a> <a id='4812' tid='4811', class="move" title="(similarity 100%)">Simulator</a><a id='4814' tid='4813', class="move" title="(similarity 100%)">::</a><a id='4816' tid='4815', class="move" title="(similarity 100%)">WriteB</a>(<a id='4818' tid='4817', class="move" title="(similarity 100%)">int32_t</a> <a id='4820' tid='4819', class="move" title="(similarity 100%)">addr</a>, <a id='4822' tid='4821', class="move" title="(similarity 100%)">int8_t</a> <a id='4824' tid='4823', class="move" title="(similarity 100%)">value</a>) {
  <a id='4840' tid='4839', class="move" title="(similarity 100%)">int8_t</a><a id='4842' tid='4841', class="move" title="(similarity 100%)">*</a> <a id='4844' tid='4843', class="move" title="(similarity 100%)">ptr</a> = <a id='4846' tid='4845', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='4848' tid='4847', class="move" title="(similarity 100%)">int8_t</a><a id='4850' tid='4849', class="move" title="(similarity 100%)">*</a>&gt;(<a id='4852' tid='4851', class="move" title="(similarity 100%)">addr</a>);
  <span class="insertion" title="inserted">*ptr = value;</span>
}


<span class="insertion" title="inserted">int32_t* Simulator::ReadDW(int32_t addr) {
#if V8_TARGET_CAN_READ_UNALIGNED
  int32_t* ptr = reinterpret_cast&lt;int32_t*&gt;(addr);
  return ptr;
#else
  if ((addr & 3) == 0) {
    int32_t* ptr = reinterpret_cast&lt;int32_t*&gt;(addr);
    return ptr;
  }
  PrintF(&quot;Unaligned read at 0x%08x\n&quot;, addr);
  UNIMPLEMENTED();
  return 0;
#endif
}</span>


<span class="insertion" title="inserted">void Simulator::WriteDW(int32_t addr, int32_t value1, int32_t value2) {
#if V8_TARGET_CAN_READ_UNALIGNED
  int32_t* ptr = reinterpret_cast&lt;int32_t*&gt;(addr);
  *ptr++ = value1;
  *ptr = value2;
  return;
#else
  if ((addr & 3) == 0) {
    int32_t* ptr = reinterpret_cast&lt;int32_t*&gt;(addr);
    *ptr++ = value1;
    *ptr = value2;
    return;
  }
  PrintF(&quot;Unaligned write at 0x%08x\n&quot;, addr);
  UNIMPLEMENTED();
#endif
}</span>


// Returns the limit of the stack area to enable checking for stack overflows.
<span class="insertion" title="inserted">uintptr_t Simulator::StackLimit() const</span> <span class="insertion" title="inserted">{
  // Leave a safety margin of 256 bytes to prevent overrunning the stack when
  // pushing values.
  return reinterpret_cast&lt;uintptr_t&gt;(stack_) + 256;
}</span>


// Unsupported instructions use Format to print an error and stop execution.
<span class="insertion" title="inserted">void Simulator::Format(Instruction* instr, const char* format) {
  PrintF(&quot;Simulator found unsupported instruction:\n 0x%08x: %s\n&quot;,
         reinterpret_cast&lt;intptr_t&gt;(instr), format);
  UNIMPLEMENTED();
}</span>


// Checks if the current instruction should be executed based on its
// condition bits.
<span class="insertion" title="inserted">bool Simulator::ConditionallyExecute(Instruction* instr) {
  switch (instr-&gt;ConditionField()) {
    case eq: return z_flag_;
    case ne: return !z_flag_;
    case cs: return c_flag_;
    case cc: return !c_flag_;
    case mi: return n_flag_;
    case pl: return !n_flag_;
    case vs: return v_flag_;
    case vc: return !v_flag_;
    case hi: return c_flag_ && !z_flag_;
    case ls: return !c_flag_ || z_flag_;
    case ge: return n_flag_ == v_flag_;
    case lt: return n_flag_ != v_flag_;
    case gt: return !z_flag_ && (n_flag_ == v_flag_);
    case le: return z_flag_ || (n_flag_ != v_flag_);
    case al: return true;
    default: UNREACHABLE();
  }
  return false;
}</span>


// Calculate and set the Negative and Zero flags.
<span class="insertion" title="inserted">void Simulator::SetNZFlags(int32_t val) {
  n_flag_ = (val &lt; 0);
  z_flag_ = (val == 0);
}</span>


// Set the Carry flag.
<span class="insertion" title="inserted">void Simulator::SetCFlag(bool val) {
  c_flag_ = val;
}</span>


// Set the oVerflow flag.
<span class="insertion" title="inserted">void Simulator::SetVFlag(bool val) {
  v_flag_ = val;
}</span>


// Calculate C flag value for additions.
<span class="insertion" title="inserted">bool Simulator::CarryFrom(int32_t left, int32_t right, int32_t carry) {
  uint32_t uleft = static_cast&lt;uint32_t&gt;(left);
  uint32_t uright = static_cast&lt;uint32_t&gt;(right);
  uint32_t urest  = 0xffffffffU - uleft;

  return (uright &gt; urest) ||
         (carry && (((uright + 1) &gt; urest) || (uright &gt; (urest - 1))));
}</span>


// Calculate C flag value for subtractions.
<span class="insertion" title="inserted">bool Simulator::BorrowFrom(int32_t left, int32_t right) {
  uint32_t uleft = static_cast&lt;uint32_t&gt;(left);
  uint32_t uright = static_cast&lt;uint32_t&gt;(right);

  return (uright &gt; uleft);
}</span>


// Calculate V flag value for additions and subtractions.
<span class="insertion" title="inserted">bool Simulator::OverflowFrom(int32_t alu_out,
                             int32_t left, int32_t right, bool addition) {
  bool overflow;
  if (addition) {
               // operands have the same sign
    overflow = ((left &gt;= 0 && right &gt;= 0) || (left &lt; 0 && right &lt; 0))
               // and operands and result have different sign
               && ((left &lt; 0 && alu_out &gt;= 0) || (left &gt;= 0 && alu_out &lt; 0));
  } else {
               // operands have different signs
    overflow = ((left &lt; 0 && right &gt;= 0) || (left &gt;= 0 && right &lt; 0))
               // and first operand and result have different signs
               && ((left &lt; 0 && alu_out &gt;= 0) || (left &gt;= 0 && alu_out &lt; 0));
  }
  return overflow;
}</span>


// Support for VFP comparisons.
<span class="insertion" title="inserted">void Simulator::Compute_FPSCR_Flags(double val1, double val2) {
  if (isnan(val1) || isnan(val2)) {
    n_flag_FPSCR_ = false;
    z_flag_FPSCR_ = false;
    c_flag_FPSCR_ = true;
    v_flag_FPSCR_ = true;
  // All non-NaN cases.
  } else if (val1 == val2) {
    n_flag_FPSCR_ = false;
    z_flag_FPSCR_ = true;
    c_flag_FPSCR_ = true;
    v_flag_FPSCR_ = false;
  } else if (val1 &lt; val2) {
    n_flag_FPSCR_ = true;
    z_flag_FPSCR_ = false;
    c_flag_FPSCR_ = false;
    v_flag_FPSCR_ = false;
  } else {
    // Case when (val1 &gt; val2).
    n_flag_FPSCR_ = false;
    z_flag_FPSCR_ = false;
    c_flag_FPSCR_ = true;
    v_flag_FPSCR_ = false;
  }
}</span>


<span class="insertion" title="inserted">void Simulator::Copy_FPSCR_to_APSR() {
  n_flag_ = n_flag_FPSCR_;
  z_flag_ = z_flag_FPSCR_;
  c_flag_ = c_flag_FPSCR_;
  v_flag_ = v_flag_FPSCR_;
}</span>


// Addressing Mode 1 - Data-processing operands:
// Get the value based on the shifter_operand with register.
<span class="insertion" title="inserted">int32_t Simulator::GetShiftRm(Instruction* instr, bool* carry_out) {
  ShiftOp shift = instr-&gt;ShiftField();
  int shift_amount = instr-&gt;ShiftAmountValue();
  int32_t result = get_register(instr-&gt;RmValue());
  if (instr-&gt;Bit(4) == 0) {
    // by immediate
    if ((shift == ROR) && (shift_amount == 0)) {
      UNIMPLEMENTED();
      return result;
    } else if (((shift == LSR) || (shift == ASR)) && (shift_amount == 0)) {
      shift_amount = 32;
    }
    switch (shift) {
      case ASR: {
        if (shift_amount == 0) {
          if (result &lt; 0) {
            result = 0xffffffff;
            *carry_out = true;
          } else {
            result = 0;
            *carry_out = false;
          }
        } else {
          result &gt;&gt;= (shift_amount - 1);
          *carry_out = (result & 1) == 1;
          result &gt;&gt;= 1;
        }
        break;
      }

      case LSL: {
        if (shift_amount == 0) {
          *carry_out = c_flag_;
        } else {
          result &lt;&lt;= (shift_amount - 1);
          *carry_out = (result &lt; 0);
          result &lt;&lt;= 1;
        }
        break;
      }

      case LSR: {
        if (shift_amount == 0) {
          result = 0;
          *carry_out = c_flag_;
        } else {
          uint32_t uresult = static_cast&lt;uint32_t&gt;(result);
          uresult &gt;&gt;= (shift_amount - 1);
          *carry_out = (uresult & 1) == 1;
          uresult &gt;&gt;= 1;
          result = static_cast&lt;int32_t&gt;(uresult);
        }
        break;
      }

      case ROR: {
        UNIMPLEMENTED();
        break;
      }

      default: {
        UNREACHABLE();
        break;
      }
    }
  } else {
    // by register
    int rs = instr-&gt;RsValue();
    shift_amount = get_register(rs) &0xff;
    switch (shift) {
      case ASR: {
        if (shift_amount == 0) {
          *carry_out = c_flag_;
        } else if (shift_amount &lt; 32) {
          result &gt;&gt;= (shift_amount - 1);
          *carry_out = (result & 1) == 1;
          result &gt;&gt;= 1;
        } else {
          ASSERT(shift_amount &gt;= 32);
          if (result &lt; 0) {
            *carry_out = true;
            result = 0xffffffff;
          } else {
            *carry_out = false;
            result = 0;
          }
        }
        break;
      }

      case LSL: {
        if (shift_amount == 0) {
          *carry_out = c_flag_;
        } else if (shift_amount &lt; 32) {
          result &lt;&lt;= (shift_amount - 1);
          *carry_out = (result &lt; 0);
          result &lt;&lt;= 1;
        } else if (shift_amount == 32) {
          *carry_out = (result & 1) == 1;
          result = 0;
        } else {
          ASSERT(shift_amount &gt; 32);
          *carry_out = false;
          result = 0;
        }
        break;
      }

      case LSR: {
        if (shift_amount == 0) {
          *carry_out = c_flag_;
        } else if (shift_amount &lt; 32) {
          uint32_t uresult = static_cast&lt;uint32_t&gt;(result);
          uresult &gt;&gt;= (shift_amount - 1);
          *carry_out = (uresult & 1) == 1;
          uresult &gt;&gt;= 1;
          result = static_cast&lt;int32_t&gt;(uresult);
        } else if (shift_amount == 32) {
          *carry_out = (result &lt; 0);
          result = 0;
        } else {
          *carry_out = false;
          result = 0;
        }
        break;
      }

      case ROR: {
        UNIMPLEMENTED();
        break;
      }

      default: {
        UNREACHABLE();
        break;
      }
    }
  }
  return result;
}</span>


// Addressing Mode 1 - Data-processing operands:
// Get the value based on the shifter_operand with immediate.
<span class="insertion" title="inserted">int32_t Simulator::GetImm(Instruction* instr, bool* carry_out) {
  int rotate = instr-&gt;RotateValue() * 2;
  int immed8 = instr-&gt;Immed8Value();
  int imm = (immed8 &gt;&gt; rotate) | (immed8 &lt;&lt; (32 - rotate));
  *carry_out = (rotate == 0) ? c_flag_ : (imm &lt; 0);
  return imm;
}</span>


<span class="insertion" title="inserted">static int count_bits(int bit_vector) {
  int count = 0;
  while (bit_vector != 0) {
    if ((bit_vector & 1) != 0) {
      count++;
    }
    bit_vector &gt;&gt;= 1;
  }
  return count;
}</span>


<span class="insertion" title="inserted">void Simulator::ProcessPUW(Instruction* instr,
                           int num_regs,
                           int reg_size,
                           intptr_t* start_address,
                           intptr_t* end_address) {
  int rn = instr-&gt;RnValue();
  int32_t rn_val = get_register(rn);
  switch (instr-&gt;PUField()) {
    case da_x: {
      UNIMPLEMENTED();
      break;
    }
    case ia_x: {
      *start_address = rn_val;
      *end_address = rn_val + (num_regs * reg_size) - reg_size;
      rn_val = rn_val + (num_regs * reg_size);
      break;
    }
    case db_x: {
      *start_address = rn_val - (num_regs * reg_size);
      *end_address = rn_val - reg_size;
      rn_val = *start_address;
      break;
    }
    case ib_x: {
      *start_address = rn_val + reg_size;
      *end_address = rn_val + (num_regs * reg_size);
      rn_val = *end_address;
      break;
    }
    default: {
      UNREACHABLE();
      break;
    }
  }
  if (instr-&gt;HasW()) {
    set_register(rn, rn_val);
  }
}</span>

// Addressing Mode 4 - Load and Store Multiple
<span class="insertion" title="inserted">void Simulator::HandleRList(Instruction* instr, bool load) {
  int rlist = instr-&gt;RlistValue();
  int num_regs = count_bits(rlist);

  intptr_t start_address = 0;
  intptr_t end_address = 0;
  ProcessPUW(instr, num_regs, kPointerSize, &start_address, &end_address);

  intptr_t* address = reinterpret_cast&lt;intptr_t*&gt;(start_address);
  int reg = 0;
  while (rlist != 0) {
    if ((rlist & 1) != 0) {
      if (load) {
        set_register(reg, *address);
      } else {
        *address = get_register(reg);
      }
      address += 1;
    }
    reg++;
    rlist &gt;&gt;= 1;
  }
  ASSERT(end_address == ((intptr_t)address) - 4);
}</span>


// Addressing Mode 6 - Load and Store Multiple Coprocessor registers.
<span class="insertion" title="inserted">void Simulator::HandleVList(Instruction* instr) {
  VFPRegPrecision precision =
      (instr-&gt;SzValue() == 0) ? kSinglePrecision : kDoublePrecision;
  int operand_size = (precision == kSinglePrecision) ? 4 : 8;

  bool load = (instr-&gt;VLValue() == 0x1);

  int vd;
  int num_regs;
  vd = instr-&gt;VFPDRegValue(precision);
  if (precision == kSinglePrecision) {
    num_regs = instr-&gt;Immed8Value();
  } else {
    num_regs = instr-&gt;Immed8Value() / 2;
  }

  intptr_t start_address = 0;
  intptr_t end_address = 0;
  ProcessPUW(instr, num_regs, operand_size, &start_address, &end_address);

  intptr_t* address = reinterpret_cast&lt;intptr_t*&gt;(start_address);
  for (int reg = vd; reg &lt; vd + num_regs; reg++) {
    if (precision == kSinglePrecision) {
      if (load) {
        set_s_register_from_sinteger(
            reg, ReadW(reinterpret_cast&lt;int32_t&gt;(address), instr));
      } else {
        WriteW(reinterpret_cast&lt;int32_t&gt;(address),
               get_sinteger_from_s_register(reg), instr);
      }
      address += 1;
    } else {
      if (load) {
        set_s_register_from_sinteger(
            2 * reg, ReadW(reinterpret_cast&lt;int32_t&gt;(address), instr));
        set_s_register_from_sinteger(
            2 * reg + 1, ReadW(reinterpret_cast&lt;int32_t&gt;(address + 1), instr));
      } else {
        WriteW(reinterpret_cast&lt;int32_t&gt;(address),
               get_sinteger_from_s_register(2 * reg), instr);
        WriteW(reinterpret_cast&lt;int32_t&gt;(address + 1),
               get_sinteger_from_s_register(2 * reg + 1), instr);
      }
      address += 2;
    }
  }
  ASSERT(reinterpret_cast&lt;intptr_t&gt;(address) - operand_size == end_address);
}</span>


// Calls into the V8 runtime are based on this very simple interface.
// Note: To be able to return two values from some calls the code in runtime.cc
// uses the ObjectPair which is essentially two 32-bit values stuffed into a
// 64-bit value. With the code below we assume that all runtime calls return
// 64 bits of result. If they don&#39;t, the r1 result register contains a bogus
// value, which is fine because it is caller-saved.
<a id='4778' tid='4777', class="move" title="(similarity 100%)">typedef</a> <a id='4780' tid='4779', class="move" title="(similarity 100%)">int64_t</a> (<a id='4782' tid='4781', class="move" title="(similarity 100%)">*</a><a id='4784' tid='4783', class="move" title="(similarity 100%)">SimulatorRuntimeCall</a>)(<a id='4786' tid='4785', class="move" title="(similarity 100%)">int32_t</a> <a id='4788' tid='4787', class="move" title="(similarity 100%)">arg0</a>,
                                        <a id='4790' tid='4789', class="move" title="(similarity 100%)">int32_t</a> <a id='4792' tid='4791', class="move" title="(similarity 100%)">arg1</a>,
                                        <a id='4794' tid='4793', class="move" title="(similarity 100%)">int32_t</a> <a id='4796' tid='4795', class="move" title="(similarity 100%)">arg2</a>,
                                        <a id='4798' tid='4797', class="move" title="(similarity 100%)">int32_t</a> <a id='4800' tid='4799', class="move" title="(similarity 100%)">arg3</a>,
                                        <a id='4802' tid='4801', class="move" title="(similarity 100%)">int32_t</a> <a id='4804' tid='4803', class="move" title="(similarity 100%)">arg4</a>,
                                        <a id='4806' tid='4805', class="move" title="(similarity 100%)">int32_t</a> <a id='4808' tid='4807', class="move" title="(similarity 100%)">arg5</a>);
<a id='4754' tid='4753', class="move" title="(similarity 100%)">typedef</a> <a id='4756' tid='4755', class="move" title="(similarity 100%)">double</a> (<a id='4758' tid='4757', class="move" title="(similarity 100%)">*</a><a id='4760' tid='4759', class="move" title="(similarity 100%)">SimulatorRuntimeFPCall</a>)(<a id='4762' tid='4761', class="move" title="(similarity 100%)">int32_t</a> <a id='4764' tid='4763', class="move" title="(similarity 100%)">arg0</a>,
                                         <a id='4766' tid='4765', class="move" title="(similarity 100%)">int32_t</a> <a id='4768' tid='4767', class="move" title="(similarity 100%)">arg1</a>,
                                         <a id='4770' tid='4769', class="move" title="(similarity 100%)">int32_t</a> <a id='4772' tid='4771', class="move" title="(similarity 100%)">arg2</a>,
                                         <a id='4774' tid='4773', class="move" title="(similarity 100%)">int32_t</a> <a id='4776' tid='4775', class="move" title="(similarity 100%)">arg3</a>);

// This signature supports direct call in to API function native callback
// (refer to InvocationCallback in v8.h).
<a id='4732' tid='4731', class="move" title="(similarity 100%)">typedef</a> <a id='4734' tid='4733', class="move" title="(similarity 100%)">v8</a><a id='4736' tid='4735', class="move" title="(similarity 100%)">::</a><a id='4738' tid='4737', class="move" title="(similarity 100%)">Handle</a>&lt;<a id='4740' tid='4739', class="move" title="(similarity 100%)">v8</a><a id='4742' tid='4741', class="move" title="(similarity 100%)">::</a><a id='4744' tid='4743', class="move" title="(similarity 100%)">Value</a>&gt; (<a id='4746' tid='4745', class="move" title="(similarity 100%)">*</a><a id='4748' tid='4747', class="move" title="(similarity 100%)">SimulatorRuntimeDirectApiCall</a>)(<a id='4750' tid='4749', class="move" title="(similarity 100%)">int32_t</a> <a id='4752' tid='4751', class="move" title="(similarity 100%)">arg0</a>);

// This signature supports direct call to accessor getter callback.
<a id='4706' tid='4705', class="move" title="(similarity 100%)">typedef</a> <a id='4708' tid='4707', class="move" title="(similarity 100%)">v8</a><a id='4710' tid='4709', class="move" title="(similarity 100%)">::</a><a id='4712' tid='4711', class="move" title="(similarity 100%)">Handle</a>&lt;<a id='4714' tid='4713', class="move" title="(similarity 100%)">v8</a><a id='4716' tid='4715', class="move" title="(similarity 100%)">::</a><a id='4718' tid='4717', class="move" title="(similarity 100%)">Value</a>&gt; (<a id='4720' tid='4719', class="move" title="(similarity 100%)">*</a><a id='4722' tid='4721', class="move" title="(similarity 100%)">SimulatorRuntimeDirectGetterCall</a>)(<a id='4724' tid='4723', class="move" title="(similarity 100%)">int32_t</a> <a id='4726' tid='4725', class="move" title="(similarity 100%)">arg0</a>,
                                                                  <a id='4728' tid='4727', class="move" title="(similarity 100%)">int32_t</a> <a id='4730' tid='4729', class="move" title="(similarity 100%)">arg1</a>);

// Software interrupt instructions are used by the simulator to call into the
// C-based V8 runtime.
<a id='4678' tid='4677', class="move" title="(similarity 100%)">void</a> <a id='4680' tid='4679', class="move" title="(similarity 100%)">Simulator</a><a id='4682' tid='4681', class="move" title="(similarity 100%)">::</a><a id='4684' tid='4683', class="move" title="(similarity 100%)">SoftwareInterrupt</a>(<a id='4686' tid='4685', class="move" title="(similarity 100%)">Instruction</a><a id='4688' tid='4687', class="move" title="(similarity 100%)">*</a> <a id='4690' tid='4689', class="move" title="(similarity 100%)">instr</a>) {
  <span class="insertion" title="inserted">int svc = instr-&gt;SvcValue();</span>
  <span class="insertion" title="inserted">switch</span> (<span class="insertion" title="inserted">svc</span>) {
    <span class="insertion" title="inserted">case</span> <span class="insertion" title="inserted">kCallRtRedirected</span>: {
      // Check if stack is aligned. Error if not aligned is reported below to
      // include information on the function called.
      <span class="insertion" title="inserted">bool stack_aligned =
          (get_register(sp)
           & (::v8::internal::FLAG_sim_stack_alignment - 1)) == 0;</span>
      <a id='4692' tid='4691', class="move" title="(similarity 100%)">Redirection</a><a id='4694' tid='4693', class="move" title="(similarity 100%)">*</a> <a id='4696' tid='4695', class="move" title="(similarity 100%)">redirection</a> = <a id='4698' tid='4697', class="move" title="(similarity 100%)">Redirection</a><a id='4700' tid='4699', class="move" title="(similarity 100%)">::</a><a id='4702' tid='4701', class="move" title="(similarity 100%)">FromSwiInstruction</a>(<a id='4704' tid='4703', class="move" title="(similarity 100%)">instr</a>);
      <span class="insertion" title="inserted">int32_t arg0 = get_register(r0);</span>
      <span class="insertion" title="inserted">int32_t arg1 = get_register(r1);</span>
      <span class="insertion" title="inserted">int32_t arg2 = get_register(r2);</span>
      <span class="insertion" title="inserted">int32_t arg3 = get_register(r3);</span>
      <a id='4662' tid='4661', class="move" title="(similarity 100%)">int32_t</a><a id='4664' tid='4663', class="move" title="(similarity 100%)">*</a> <a id='4666' tid='4665', class="move" title="(similarity 100%)">stack_pointer</a> = <a id='4668' tid='4667', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='4670' tid='4669', class="move" title="(similarity 100%)">int32_t</a><a id='4672' tid='4671', class="move" title="(similarity 100%)">*</a>&gt;(<a id='4674' tid='4673', class="move" title="(similarity 100%)">get_register</a>(<a id='4676' tid='4675', class="move" title="(similarity 100%)">sp</a>));
      <span class="insertion" title="inserted">int32_t arg4 = stack_pointer[0];</span>
      <span class="insertion" title="inserted">int32_t arg5 = stack_pointer[1];</span>
      <a id='4538' tid='4537', class="move" title="(similarity 100%)">bool</a> <a id='4540' tid='4539', class="move" title="(similarity 100%)">fp_call</a> =
         (<a id='4542' tid='4541', class="move" title="(similarity 100%)">redirection</a>-&gt;<a id='4544' tid='4543', class="move" title="(similarity 100%)">type</a>() <a id='4546' tid='4545', class="move" title="(similarity 100%)">==</a> <a id='4548' tid='4547', class="move" title="(similarity 100%)">ExternalReference</a><a id='4550' tid='4549', class="move" title="(similarity 100%)">::</a><a id='4552' tid='4551', class="move" title="(similarity 100%)">BUILTIN_FP_FP_CALL</a>) <a id='4554' tid='4553', class="move" title="(similarity 100%)">||</a>
         (<a id='4556' tid='4555', class="move" title="(similarity 100%)">redirection</a>-&gt;<a id='4558' tid='4557', class="move" title="(similarity 100%)">type</a>() <a id='4560' tid='4559', class="move" title="(similarity 100%)">==</a> <a id='4562' tid='4561', class="move" title="(similarity 100%)">ExternalReference</a><a id='4564' tid='4563', class="move" title="(similarity 100%)">::</a><a id='4566' tid='4565', class="move" title="(similarity 100%)">BUILTIN_COMPARE_CALL</a>) <a id='4568' tid='4567', class="move" title="(similarity 100%)">||</a>
         (<a id='4570' tid='4569', class="move" title="(similarity 100%)">redirection</a>-&gt;<a id='4572' tid='4571', class="move" title="(similarity 100%)">type</a>() <a id='4574' tid='4573', class="move" title="(similarity 100%)">==</a> <a id='4576' tid='4575', class="move" title="(similarity 100%)">ExternalReference</a><a id='4578' tid='4577', class="move" title="(similarity 100%)">::</a><a id='4580' tid='4579', class="move" title="(similarity 100%)">BUILTIN_FP_CALL</a>) <a id='4582' tid='4581', class="move" title="(similarity 100%)">||</a>
         (<a id='4584' tid='4583', class="move" title="(similarity 100%)">redirection</a>-&gt;<a id='4586' tid='4585', class="move" title="(similarity 100%)">type</a>() <a id='4588' tid='4587', class="move" title="(similarity 100%)">==</a> <a id='4590' tid='4589', class="move" title="(similarity 100%)">ExternalReference</a><a id='4592' tid='4591', class="move" title="(similarity 100%)">::</a><a id='4594' tid='4593', class="move" title="(similarity 100%)">BUILTIN_FP_INT_CALL</a>);
      <span class="insertion" title="inserted">if (use_eabi_hardfloat()) {
        // With the hard floating point calling convention, double
        // arguments are passed in VFP registers. Fetch the arguments
        // from there and call the builtin using soft floating point
        // convention.
        switch (redirection-&gt;type()) {
        case ExternalReference::BUILTIN_FP_FP_CALL:
        case ExternalReference::BUILTIN_COMPARE_CALL:
          arg0 = vfp_register[0];
          arg1 = vfp_register[1];
          arg2 = vfp_register[2];
          arg3 = vfp_register[3];
          break;
        case ExternalReference::BUILTIN_FP_CALL:
          arg0 = vfp_register[0];
          arg1 = vfp_register[1];
          break;
        case ExternalReference::BUILTIN_FP_INT_CALL:
          arg0 = vfp_register[0];
          arg1 = vfp_register[1];
          arg2 = get_register(0);
          break;
        default:
          break;
        }
      }</span>
      // This is dodgy but it works because the C entry stubs are never moved.
      // See comment in codegen-arm.cc and bug 1242173.
      <span class="insertion" title="inserted">int32_t saved_lr = get_register(lr);</span>
      <span class="insertion" title="inserted">intptr_t external =
          reinterpret_cast&lt;intptr_t&gt;(redirection-&gt;external_function());</span>
      <a id='4326' tid='4325', class="move" title="(similarity 100%)">if</a> (<a id='4328' tid='4327', class="move" title="(similarity 100%)">fp_call</a>) {
        <span class="insertion" title="inserted">if</span> <span class="insertion" title="inserted">(::v8::internal::FLAG_trace_sim || !stack_aligned)</span> {
          <span class="insertion" title="inserted">SimulatorRuntimeFPCall target =
              reinterpret_cast&lt;SimulatorRuntimeFPCall&gt;(external);</span>
          <span class="insertion" title="inserted">double dval0, dval1;</span>
          <span class="insertion" title="inserted">int32_t ival;</span>
          <a id='4330' tid='4329', class="move" title="(similarity 100%)">switch</a> (<a id='4332' tid='4331', class="move" title="(similarity 100%)">redirection</a>-&gt;<a id='4334' tid='4333', class="move" title="(similarity 100%)">type</a>()) {
          <a id='4336' tid='4335', class="move" title="(similarity 100%)">case</a> <a id='4338' tid='4337', class="move" title="(similarity 100%)">ExternalReference</a><a id='4340' tid='4339', class="move" title="(similarity 100%)">::</a><a id='4342' tid='4341', class="move" title="(similarity 100%)">BUILTIN_FP_FP_CALL</a>:
          <a id='4344' tid='4343', class="move" title="(similarity 100%)">case</a> <a id='4346' tid='4345', class="move" title="(similarity 100%)">ExternalReference</a><a id='4348' tid='4347', class="move" title="(similarity 100%)">::</a><a id='4350' tid='4349', class="move" title="(similarity 100%)">BUILTIN_COMPARE_CALL</a>:
            <a id='4352' tid='4351', class="move" title="(similarity 100%)">GetFpArgs</a>(<a id='4354' tid='4353', class="move" title="(similarity 100%)">&</a><a id='4356' tid='4355', class="move" title="(similarity 100%)">dval0</a>, <a id='4358' tid='4357', class="move" title="(similarity 100%)">&</a><a id='4360' tid='4359', class="move" title="(similarity 100%)">dval1</a>);
            <a id='4362' tid='4361', class="move" title="(similarity 100%)">PrintF</a>(<a id='4364' tid='4363', class="move" title="(similarity 100%)">&quot;Call to host function at %p with args %f, %f&quot;</a>,
                <a id='4366' tid='4365', class="move" title="(similarity 100%)">FUNCTION_ADDR</a>(<a id='4368' tid='4367', class="move" title="(similarity 100%)">target</a>), <a id='4370' tid='4369', class="move" title="(similarity 100%)">dval0</a>, <a id='4372' tid='4371', class="move" title="(similarity 100%)">dval1</a>);
            <a id='4374' tid='4373', class="move" title="(similarity 100%)">break</a>;
          <a id='4376' tid='4375', class="move" title="(similarity 100%)">case</a> <a id='4378' tid='4377', class="move" title="(similarity 100%)">ExternalReference</a><a id='4380' tid='4379', class="move" title="(similarity 100%)">::</a><a id='4382' tid='4381', class="move" title="(similarity 100%)">BUILTIN_FP_CALL</a>:
            <a id='4384' tid='4383', class="move" title="(similarity 100%)">GetFpArgs</a>(<a id='4386' tid='4385', class="move" title="(similarity 100%)">&</a><a id='4388' tid='4387', class="move" title="(similarity 100%)">dval0</a>);
            <a id='4390' tid='4389', class="move" title="(similarity 100%)">PrintF</a>(<a id='4392' tid='4391', class="move" title="(similarity 100%)">&quot;Call to host function at %p with arg %f&quot;</a>,
                <a id='4394' tid='4393', class="move" title="(similarity 100%)">FUNCTION_ADDR</a>(<a id='4396' tid='4395', class="move" title="(similarity 100%)">target</a>), <a id='4398' tid='4397', class="move" title="(similarity 100%)">dval0</a>);
            <a id='4400' tid='4399', class="move" title="(similarity 100%)">break</a>;
          <a id='4402' tid='4401', class="move" title="(similarity 100%)">case</a> <a id='4404' tid='4403', class="move" title="(similarity 100%)">ExternalReference</a><a id='4406' tid='4405', class="move" title="(similarity 100%)">::</a><a id='4408' tid='4407', class="move" title="(similarity 100%)">BUILTIN_FP_INT_CALL</a>:
            <a id='4410' tid='4409', class="move" title="(similarity 100%)">GetFpArgs</a>(<a id='4412' tid='4411', class="move" title="(similarity 100%)">&</a><a id='4414' tid='4413', class="move" title="(similarity 100%)">dval0</a>, <a id='4416' tid='4415', class="move" title="(similarity 100%)">&</a><a id='4418' tid='4417', class="move" title="(similarity 100%)">ival</a>);
            <a id='4420' tid='4419', class="move" title="(similarity 100%)">PrintF</a>(<a id='4422' tid='4421', class="move" title="(similarity 100%)">&quot;Call to host function at %p with args %f, %d&quot;</a>,
                <a id='4424' tid='4423', class="move" title="(similarity 100%)">FUNCTION_ADDR</a>(<a id='4426' tid='4425', class="move" title="(similarity 100%)">target</a>), <a id='4428' tid='4427', class="move" title="(similarity 100%)">dval0</a>, <a id='4430' tid='4429', class="move" title="(similarity 100%)">ival</a>);
            <a id='4432' tid='4431', class="move" title="(similarity 100%)">break</a>;
          <a id='4434' tid='4433', class="move" title="(similarity 100%)">default</a>:
            <a id='4436' tid='4435', class="move" title="(similarity 100%)">UNREACHABLE</a>();
            <a id='4438' tid='4437', class="move" title="(similarity 100%)">break</a>;
          }
          <span class="insertion" title="inserted">if (!stack_aligned) {
            PrintF(&quot; with unaligned stack %08x\n&quot;, get_register(sp));
          }</span>
          <span class="insertion" title="inserted">PrintF(&quot;\n&quot;);</span>
        }
        <span class="insertion" title="inserted">CHECK(stack_aligned);</span>
        <span class="insertion" title="inserted">if</span> <span class="insertion" title="inserted">(redirection-&gt;type() != ExternalReference::BUILTIN_COMPARE_CALL)</span> {
          <span class="insertion" title="inserted">SimulatorRuntimeFPCall target =
              reinterpret_cast&lt;SimulatorRuntimeFPCall&gt;(external);</span>
          <a id='4206' tid='4205', class="move" title="(similarity 100%)">double</a> <a id='4208' tid='4207', class="move" title="(similarity 100%)">result</a> = <a id='4210' tid='4209', class="move" title="(similarity 100%)">target</a>(<a id='4212' tid='4211', class="move" title="(similarity 100%)">arg0</a>, <a id='4214' tid='4213', class="move" title="(similarity 100%)">arg1</a>, <a id='4216' tid='4215', class="move" title="(similarity 100%)">arg2</a>, <a id='4218' tid='4217', class="move" title="(similarity 100%)">arg3</a>);
          <span class="insertion" title="inserted">SetFpResult(result);</span>
        } <span class="insertion" title="inserted">else {
          SimulatorRuntimeCall target =
              reinterpret_cast&lt;SimulatorRuntimeCall&gt;(external);
          int64_t result = target(arg0, arg1, arg2, arg3, arg4, arg5);
          int32_t lo_res = static_cast&lt;int32_t&gt;(result);
          int32_t hi_res = static_cast&lt;int32_t&gt;(result &gt;&gt; 32);
          if (::v8::internal::FLAG_trace_sim) {
            PrintF(&quot;Returned %08x\n&quot;, lo_res);
          }
          set_register(r0, lo_res);
          set_register(r1, hi_res);
        }</span>
      } <a id='4440' tid='4439', class="move" title="(similarity 100%)">else</a> <span class="insertion" title="inserted">if</span> <span class="insertion" title="inserted">(redirection-&gt;type() == ExternalReference::DIRECT_API_CALL)</span> <span class="insertion" title="inserted">{
        SimulatorRuntimeDirectApiCall target =
            reinterpret_cast&lt;SimulatorRuntimeDirectApiCall&gt;(external);
        if (::v8::internal::FLAG_trace_sim || !stack_aligned) {
          PrintF(&quot;Call to host function at %p args %08x&quot;,
              FUNCTION_ADDR(target), arg0);
          if (!stack_aligned) {
            PrintF(&quot; with unaligned stack %08x\n&quot;, get_register(sp));
          }
          PrintF(&quot;\n&quot;);
        }
        CHECK(stack_aligned);
        v8::Handle&lt;v8::Value&gt; result = target(arg0);
        if (::v8::internal::FLAG_trace_sim) {
          PrintF(&quot;Returned %p\n&quot;, reinterpret_cast&lt;void *&gt;(*result));
        }
        set_register(r0, (int32_t) *result);
      }</span> <span class="insertion" title="inserted">else</span> <span class="insertion" title="inserted">if</span> <span class="insertion" title="inserted">(redirection-&gt;type() == ExternalReference::DIRECT_GETTER_CALL)</span> <span class="insertion" title="inserted">{
        SimulatorRuntimeDirectGetterCall target =
            reinterpret_cast&lt;SimulatorRuntimeDirectGetterCall&gt;(external);
        if (::v8::internal::FLAG_trace_sim || !stack_aligned) {
          PrintF(&quot;Call to host function at %p args %08x %08x&quot;,
              FUNCTION_ADDR(target), arg0, arg1);
          if (!stack_aligned) {
            PrintF(&quot; with unaligned stack %08x\n&quot;, get_register(sp));
          }
          PrintF(&quot;\n&quot;);
        }
        CHECK(stack_aligned);
        v8::Handle&lt;v8::Value&gt; result = target(arg0, arg1);
        if (::v8::internal::FLAG_trace_sim) {
          PrintF(&quot;Returned %p\n&quot;, reinterpret_cast&lt;void *&gt;(*result));
        }
        set_register(r0, (int32_t) *result);
      }</span> <a id='4442' tid='4441', class="move" title="(similarity 100%)">else</a> {
        // builtin call.
        <span class="insertion" title="inserted">ASSERT(redirection-&gt;type() == ExternalReference::BUILTIN_CALL);</span>
        <span class="insertion" title="inserted">SimulatorRuntimeCall target =
            reinterpret_cast&lt;SimulatorRuntimeCall&gt;(external);</span>
        <span class="insertion" title="inserted">if (::v8::internal::FLAG_trace_sim || !stack_aligned) {
          PrintF(
              &quot;Call to host function at %p&quot;
              &quot;args %08x, %08x, %08x, %08x, %08x, %08x&quot;,
              FUNCTION_ADDR(target),
              arg0,
              arg1,
              arg2,
              arg3,
              arg4,
              arg5);
          if (!stack_aligned) {
            PrintF(&quot; with unaligned stack %08x\n&quot;, get_register(sp));
          }
          PrintF(&quot;\n&quot;);
        }</span>
        <span class="insertion" title="inserted">CHECK(stack_aligned);</span>
        <a id='4444' tid='4443', class="move" title="(similarity 100%)">int64_t</a> <a id='4446' tid='4445', class="move" title="(similarity 100%)">result</a> = <a id='4448' tid='4447', class="move" title="(similarity 100%)">target</a>(<a id='4450' tid='4449', class="move" title="(similarity 100%)">arg0</a>, <a id='4452' tid='4451', class="move" title="(similarity 100%)">arg1</a>, <a id='4454' tid='4453', class="move" title="(similarity 100%)">arg2</a>, <a id='4456' tid='4455', class="move" title="(similarity 100%)">arg3</a>, <a id='4458' tid='4457', class="move" title="(similarity 100%)">arg4</a>, <a id='4460' tid='4459', class="move" title="(similarity 100%)">arg5</a>);
        <span class="insertion" title="inserted">int32_t lo_res = static_cast&lt;int32_t&gt;(result);</span>
        <span class="insertion" title="inserted">int32_t hi_res = static_cast&lt;int32_t&gt;(result &gt;&gt; 32);</span>
        <span class="insertion" title="inserted">if (::v8::internal::FLAG_trace_sim) {
          PrintF(&quot;Returned %08x\n&quot;, lo_res);
        }</span>
        <span class="insertion" title="inserted">set_register(r0, lo_res);</span>
        <span class="insertion" title="inserted">set_register(r1, hi_res);</span>
      }
      <span class="insertion" title="inserted">set_register(lr, saved_lr);</span>
      <span class="insertion" title="inserted">set_pc(get_register(lr));</span>
      <span class="insertion" title="inserted">break;</span>
    }
    <span class="insertion" title="inserted">case kBreakpoint: {
      ArmDebugger dbg(this);
      dbg.Debug();
      break;
    }
    // stop uses all codes greater than 1 &lt;&lt; 23.
    default: {
      if (svc &gt;= (1 &lt;&lt; 23)) {
        uint32_t code = svc & kStopCodeMask;
        if (isWatchedStop(code)) {
          IncreaseStopCounter(code);
        }
        // Stop if it is enabled, otherwise go on jumping over the stop
        // and the message address.
        if (isEnabledStop(code)) {
          ArmDebugger dbg(this);
          dbg.Stop(instr);
        } else {
          set_pc(get_pc() + 2 * Instruction::kInstrSize);
        }
      } else {
        // This is not a valid svc code.
        UNREACHABLE();
        break;
      }
    }</span>
  }
}


// Stop helper functions.
<span class="insertion" title="inserted">bool Simulator::isStopInstruction(Instruction* instr) {
  return (instr-&gt;Bits(27, 24) == 0xF) && (instr-&gt;SvcValue() &gt;= kStopCode);
}</span>


<span class="insertion" title="inserted">bool Simulator::isWatchedStop(uint32_t code) {
  ASSERT(code &lt;= kMaxStopCode);
  return code &lt; kNumOfWatchedStops;
}</span>


<span class="insertion" title="inserted">bool Simulator::isEnabledStop(uint32_t code) {
  ASSERT(code &lt;= kMaxStopCode);
  // Unwatched stops are always enabled.
  return !isWatchedStop(code) ||
    !(watched_stops[code].count & kStopDisabledBit);
}</span>


<span class="insertion" title="inserted">void Simulator::EnableStop(uint32_t code) {
  ASSERT(isWatchedStop(code));
  if (!isEnabledStop(code)) {
    watched_stops[code].count &= ~kStopDisabledBit;
  }
}</span>


<span class="insertion" title="inserted">void Simulator::DisableStop(uint32_t code) {
  ASSERT(isWatchedStop(code));
  if (isEnabledStop(code)) {
    watched_stops[code].count |= kStopDisabledBit;
  }
}</span>


<a id='4596' tid='4595', class="move" title="(similarity 100%)">void</a> <a id='4598' tid='4597', class="move" title="(similarity 100%)">Simulator</a><a id='4600' tid='4599', class="move" title="(similarity 100%)">::</a><a id='4602' tid='4601', class="move" title="(similarity 100%)">IncreaseStopCounter</a>(<a id='4604' tid='4603', class="move" title="(similarity 100%)">uint32_t</a> <a id='4606' tid='4605', class="move" title="(similarity 100%)">code</a>) {
  <span class="insertion" title="inserted">ASSERT(code &lt;= kMaxStopCode);</span>
  <span class="insertion" title="inserted">ASSERT(isWatchedStop(code));</span>
  <a id='4608' tid='4607', class="move" title="(similarity 100%)">if</a> ((<a id='4610' tid='4609', class="move" title="(similarity 100%)">watched_stops</a>[<a id='4612' tid='4611', class="move" title="(similarity 100%)">code</a>].<a id='4614' tid='4613', class="move" title="(similarity 100%)">count</a> <a id='4616' tid='4615', class="move" title="(similarity 100%)">&</a> <a id='4618' tid='4617', class="move" title="(similarity 100%)">~</a>(<a id='4620' tid='4619', class="move" title="(similarity 100%)">1</a> <a id='4622' tid='4621', class="move" title="(similarity 100%)">&lt;&lt;</a> <a id='4624' tid='4623', class="move" title="(similarity 100%)">31</a>)) <a id='4626' tid='4625', class="move" title="(similarity 100%)">==</a> <a id='4628' tid='4627', class="move" title="(similarity 100%)">0x7fffffff</a>) {
    <a id='4630' tid='4629', class="move" title="(similarity 100%)">PrintF</a>(<a id='4632' tid='4631', class="move" title="(similarity 100%)">&quot;Stop counter for code %i has overflowed.\n&quot;</a>
           <a id='4634' tid='4633', class="move" title="(similarity 100%)">&quot;Enabling this code and reseting the counter to 0.\n&quot;</a>, <a id='4636' tid='4635', class="move" title="(similarity 100%)">code</a>);
    <a id='4638' tid='4637', class="move" title="(similarity 100%)">watched_stops</a>[<a id='4640' tid='4639', class="move" title="(similarity 100%)">code</a>].<a id='4642' tid='4641', class="move" title="(similarity 100%)">count</a> <a id='4644' tid='4643', class="move" title="(similarity 100%)">=</a> <a id='4646' tid='4645', class="move" title="(similarity 100%)">0</a>;
    <a id='4648' tid='4647', class="move" title="(similarity 100%)">EnableStop</a>(<a id='4650' tid='4649', class="move" title="(similarity 100%)">code</a>);
  } <a id='4652' tid='4651', class="move" title="(similarity 100%)">else</a> {
    <a id='4654' tid='4653', class="move" title="(similarity 100%)">watched_stops</a>[<a id='4656' tid='4655', class="move" title="(similarity 100%)">code</a>].<a id='4658' tid='4657', class="move" title="(similarity 100%)">count</a><a id='4660' tid='4659', class="move" title="(similarity 100%)">++</a>;
  }
}


// Print a stop status.
<a id='4510' tid='4509', class="move" title="(similarity 100%)">void</a> <a id='4512' tid='4511', class="move" title="(similarity 100%)">Simulator</a><a id='4514' tid='4513', class="move" title="(similarity 100%)">::</a><a id='4516' tid='4515', class="move" title="(similarity 100%)">PrintStopInfo</a>(<a id='4518' tid='4517', class="move" title="(similarity 100%)">uint32_t</a> <a id='4520' tid='4519', class="move" title="(similarity 100%)">code</a>) {
  <span class="insertion" title="inserted">ASSERT(code &lt;= kMaxStopCode);</span>
  <span class="insertion" title="inserted">if</span> <span class="insertion" title="inserted">(!isWatchedStop(code))</span> <span class="insertion" title="inserted">{
    PrintF(&quot;Stop not watched.&quot;);
  }</span> <span class="insertion" title="inserted">else</span> {
    <span class="insertion" title="inserted">const char* state = isEnabledStop(code) ? &quot;Enabled&quot; : &quot;Disabled&quot;;</span>
    <a id='4522' tid='4521', class="move" title="(similarity 100%)">int32_t</a> <a id='4524' tid='4523', class="move" title="(similarity 100%)">count</a> = <a id='4526' tid='4525', class="move" title="(similarity 100%)">watched_stops</a>[<a id='4528' tid='4527', class="move" title="(similarity 100%)">code</a>].<a id='4530' tid='4529', class="move" title="(similarity 100%)">count</a> <a id='4532' tid='4531', class="move" title="(similarity 100%)">&</a> <a id='4534' tid='4533', class="move" title="(similarity 100%)">~</a><a id='4536' tid='4535', class="move" title="(similarity 100%)">kStopDisabledBit</a>;
    // Don&#39;t print the state of unused breakpoints.
    <a id='4462' tid='4461', class="move" title="(similarity 100%)">if</a> (<a id='4464' tid='4463', class="move" title="(similarity 100%)">count</a> <a id='4466' tid='4465', class="move" title="(similarity 100%)">!=</a> <a id='4468' tid='4467', class="move" title="(similarity 100%)">0</a>) {
      <a id='4470' tid='4469', class="move" title="(similarity 100%)">if</a> (<a id='4472' tid='4471', class="move" title="(similarity 100%)">watched_stops</a>[<a id='4474' tid='4473', class="move" title="(similarity 100%)">code</a>].<a id='4476' tid='4475', class="move" title="(similarity 100%)">desc</a>) {
        <a id='4478' tid='4477', class="move" title="(similarity 100%)">PrintF</a>(<a id='4480' tid='4479', class="move" title="(similarity 100%)">&quot;stop %i - 0x%x: \t%s, \tcounter = %i, \t%s\n&quot;</a>,
               <a id='4482' tid='4481', class="move" title="(similarity 100%)">code</a>, <a id='4484' tid='4483', class="move" title="(similarity 100%)">code</a>, <a id='4486' tid='4485', class="move" title="(similarity 100%)">state</a>, <a id='4488' tid='4487', class="move" title="(similarity 100%)">count</a>, <a id='4490' tid='4489', class="move" title="(similarity 100%)">watched_stops</a>[<a id='4492' tid='4491', class="move" title="(similarity 100%)">code</a>].<a id='4494' tid='4493', class="move" title="(similarity 100%)">desc</a>);
      } <a id='4496' tid='4495', class="move" title="(similarity 100%)">else</a> {
        <a id='4498' tid='4497', class="move" title="(similarity 100%)">PrintF</a>(<a id='4500' tid='4499', class="move" title="(similarity 100%)">&quot;stop %i - 0x%x: \t%s, \tcounter = %i\n&quot;</a>,
               <a id='4502' tid='4501', class="move" title="(similarity 100%)">code</a>, <a id='4504' tid='4503', class="move" title="(similarity 100%)">code</a>, <a id='4506' tid='4505', class="move" title="(similarity 100%)">state</a>, <a id='4508' tid='4507', class="move" title="(similarity 100%)">count</a>);
      }
    }
  }
}


// Handle execution based on instruction types.

// Instruction types 0 and 1 are both rolled into one function because they
// only differ in the handling of the shifter_operand.
<span class="insertion" title="inserted">void Simulator::DecodeType01(Instruction* instr) {
  int type = instr-&gt;TypeValue();
  if ((type == 0) && instr-&gt;IsSpecialType0()) {
    // multiply instruction or extra loads and stores
    if (instr-&gt;Bits(7, 4) == 9) {
      if (instr-&gt;Bit(24) == 0) {
        // Raw field decoding here. Multiply instructions have their Rd in
        // funny places.
        int rn = instr-&gt;RnValue();
        int rm = instr-&gt;RmValue();
        int rs = instr-&gt;RsValue();
        int32_t rs_val = get_register(rs);
        int32_t rm_val = get_register(rm);
        if (instr-&gt;Bit(23) == 0) {
          if (instr-&gt;Bit(21) == 0) {
            // The MUL instruction description (A 4.1.33) refers to Rd as being
            // the destination for the operation, but it confusingly uses the
            // Rn field to encode it.
            // Format(instr, &quot;mul&#39;cond&#39;s &#39;rn, &#39;rm, &#39;rs&quot;);
            int rd = rn;  // Remap the rn field to the Rd register.
            int32_t alu_out = rm_val * rs_val;
            set_register(rd, alu_out);
            if (instr-&gt;HasS()) {
              SetNZFlags(alu_out);
            }
          } else {
            // The MLA instruction description (A 4.1.28) refers to the order
            // of registers as &quot;Rd, Rm, Rs, Rn&quot;. But confusingly it uses the
            // Rn field to encode the Rd register and the Rd field to encode
            // the Rn register.
            Format(instr, &quot;mla&#39;cond&#39;s &#39;rn, &#39;rm, &#39;rs, &#39;rd&quot;);
          }
        } else {
          // The signed/long multiply instructions use the terms RdHi and RdLo
          // when referring to the target registers. They are mapped to the Rn
          // and Rd fields as follows:
          // RdLo == Rd
          // RdHi == Rn (This is confusingly stored in variable rd here
          //             because the mul instruction from above uses the
          //             Rn field to encode the Rd register. Good luck figuring
          //             this out without reading the ARM instruction manual
          //             at a very detailed level.)
          // Format(instr, &quot;&#39;um&#39;al&#39;cond&#39;s &#39;rd, &#39;rn, &#39;rs, &#39;rm&quot;);
          int rd_hi = rn;  // Remap the rn field to the RdHi register.
          int rd_lo = instr-&gt;RdValue();
          int32_t hi_res = 0;
          int32_t lo_res = 0;
          if (instr-&gt;Bit(22) == 1) {
            int64_t left_op  = static_cast&lt;int32_t&gt;(rm_val);
            int64_t right_op = static_cast&lt;int32_t&gt;(rs_val);
            uint64_t result = left_op * right_op;
            hi_res = static_cast&lt;int32_t&gt;(result &gt;&gt; 32);
            lo_res = static_cast&lt;int32_t&gt;(result & 0xffffffff);
          } else {
            // unsigned multiply
            uint64_t left_op  = static_cast&lt;uint32_t&gt;(rm_val);
            uint64_t right_op = static_cast&lt;uint32_t&gt;(rs_val);
            uint64_t result = left_op * right_op;
            hi_res = static_cast&lt;int32_t&gt;(result &gt;&gt; 32);
            lo_res = static_cast&lt;int32_t&gt;(result & 0xffffffff);
          }
          set_register(rd_lo, lo_res);
          set_register(rd_hi, hi_res);
          if (instr-&gt;HasS()) {
            UNIMPLEMENTED();
          }
        }
      } else {
        UNIMPLEMENTED();  // Not used by V8.
      }
    } else {
      // extra load/store instructions
      int rd = instr-&gt;RdValue();
      int rn = instr-&gt;RnValue();
      int32_t rn_val = get_register(rn);
      int32_t addr = 0;
      if (instr-&gt;Bit(22) == 0) {
        int rm = instr-&gt;RmValue();
        int32_t rm_val = get_register(rm);
        switch (instr-&gt;PUField()) {
          case da_x: {
            // Format(instr, &quot;&#39;memop&#39;cond&#39;sign&#39;h &#39;rd, [&#39;rn], -&#39;rm&quot;);
            ASSERT(!instr-&gt;HasW());
            addr = rn_val;
            rn_val -= rm_val;
            set_register(rn, rn_val);
            break;
          }
          case ia_x: {
            // Format(instr, &quot;&#39;memop&#39;cond&#39;sign&#39;h &#39;rd, [&#39;rn], +&#39;rm&quot;);
            ASSERT(!instr-&gt;HasW());
            addr = rn_val;
            rn_val += rm_val;
            set_register(rn, rn_val);
            break;
          }
          case db_x: {
            // Format(instr, &quot;&#39;memop&#39;cond&#39;sign&#39;h &#39;rd, [&#39;rn, -&#39;rm]&#39;w&quot;);
            rn_val -= rm_val;
            addr = rn_val;
            if (instr-&gt;HasW()) {
              set_register(rn, rn_val);
            }
            break;
          }
          case ib_x: {
            // Format(instr, &quot;&#39;memop&#39;cond&#39;sign&#39;h &#39;rd, [&#39;rn, +&#39;rm]&#39;w&quot;);
            rn_val += rm_val;
            addr = rn_val;
            if (instr-&gt;HasW()) {
              set_register(rn, rn_val);
            }
            break;
          }
          default: {
            // The PU field is a 2-bit field.
            UNREACHABLE();
            break;
          }
        }
      } else {
        int32_t imm_val = (instr-&gt;ImmedHValue() &lt;&lt; 4) | instr-&gt;ImmedLValue();
        switch (instr-&gt;PUField()) {
          case da_x: {
            // Format(instr, &quot;&#39;memop&#39;cond&#39;sign&#39;h &#39;rd, [&#39;rn], #-&#39;off8&quot;);
            ASSERT(!instr-&gt;HasW());
            addr = rn_val;
            rn_val -= imm_val;
            set_register(rn, rn_val);
            break;
          }
          case ia_x: {
            // Format(instr, &quot;&#39;memop&#39;cond&#39;sign&#39;h &#39;rd, [&#39;rn], #+&#39;off8&quot;);
            ASSERT(!instr-&gt;HasW());
            addr = rn_val;
            rn_val += imm_val;
            set_register(rn, rn_val);
            break;
          }
          case db_x: {
            // Format(instr, &quot;&#39;memop&#39;cond&#39;sign&#39;h &#39;rd, [&#39;rn, #-&#39;off8]&#39;w&quot;);
            rn_val -= imm_val;
            addr = rn_val;
            if (instr-&gt;HasW()) {
              set_register(rn, rn_val);
            }
            break;
          }
          case ib_x: {
            // Format(instr, &quot;&#39;memop&#39;cond&#39;sign&#39;h &#39;rd, [&#39;rn, #+&#39;off8]&#39;w&quot;);
            rn_val += imm_val;
            addr = rn_val;
            if (instr-&gt;HasW()) {
              set_register(rn, rn_val);
            }
            break;
          }
          default: {
            // The PU field is a 2-bit field.
            UNREACHABLE();
            break;
          }
        }
      }
      if (((instr-&gt;Bits(7, 4) & 0xd) == 0xd) && (instr-&gt;Bit(20) == 0)) {
        ASSERT((rd % 2) == 0);
        if (instr-&gt;HasH()) {
          // The strd instruction.
          int32_t value1 = get_register(rd);
          int32_t value2 = get_register(rd+1);
          WriteDW(addr, value1, value2);
        } else {
          // The ldrd instruction.
          int* rn_data = ReadDW(addr);
          set_dw_register(rd, rn_data);
        }
      } else if (instr-&gt;HasH()) {
        if (instr-&gt;HasSign()) {
          if (instr-&gt;HasL()) {
            int16_t val = ReadH(addr, instr);
            set_register(rd, val);
          } else {
            int16_t val = get_register(rd);
            WriteH(addr, val, instr);
          }
        } else {
          if (instr-&gt;HasL()) {
            uint16_t val = ReadHU(addr, instr);
            set_register(rd, val);
          } else {
            uint16_t val = get_register(rd);
            WriteH(addr, val, instr);
          }
        }
      } else {
        // signed byte loads
        ASSERT(instr-&gt;HasSign());
        ASSERT(instr-&gt;HasL());
        int8_t val = ReadB(addr);
        set_register(rd, val);
      }
      return;
    }
  } else if ((type == 0) && instr-&gt;IsMiscType0()) {
    if (instr-&gt;Bits(22, 21) == 1) {
      int rm = instr-&gt;RmValue();
      switch (instr-&gt;BitField(7, 4)) {
        case BX:
          set_pc(get_register(rm));
          break;
        case BLX: {
          uint32_t old_pc = get_pc();
          set_pc(get_register(rm));
          set_register(lr, old_pc + Instruction::kInstrSize);
          break;
        }
        case BKPT: {
          ArmDebugger dbg(this);
          PrintF(&quot;Simulator hit BKPT.\n&quot;);
          dbg.Debug();
          break;
        }
        default:
          UNIMPLEMENTED();
      }
    } else if (instr-&gt;Bits(22, 21) == 3) {
      int rm = instr-&gt;RmValue();
      int rd = instr-&gt;RdValue();
      switch (instr-&gt;BitField(7, 4)) {
        case CLZ: {
          uint32_t bits = get_register(rm);
          int leading_zeros = 0;
          if (bits == 0) {
            leading_zeros = 32;
          } else {
            while ((bits & 0x80000000u) == 0) {
              bits &lt;&lt;= 1;
              leading_zeros++;
            }
          }
          set_register(rd, leading_zeros);
          break;
        }
        default:
          UNIMPLEMENTED();
      }
    } else {
      PrintF(&quot;%08x\n&quot;, instr-&gt;InstructionBits());
      UNIMPLEMENTED();
    }
  } else {
    int rd = instr-&gt;RdValue();
    int rn = instr-&gt;RnValue();
    int32_t rn_val = get_register(rn);
    int32_t shifter_operand = 0;
    bool shifter_carry_out = 0;
    if (type == 0) {
      shifter_operand = GetShiftRm(instr, &shifter_carry_out);
    } else {
      ASSERT(instr-&gt;TypeValue() == 1);
      shifter_operand = GetImm(instr, &shifter_carry_out);
    }
    int32_t alu_out;

    switch (instr-&gt;OpcodeField()) {
      case AND: {
        // Format(instr, &quot;and&#39;cond&#39;s &#39;rd, &#39;rn, &#39;shift_rm&quot;);
        // Format(instr, &quot;and&#39;cond&#39;s &#39;rd, &#39;rn, &#39;imm&quot;);
        alu_out = rn_val & shifter_operand;
        set_register(rd, alu_out);
        if (instr-&gt;HasS()) {
          SetNZFlags(alu_out);
          SetCFlag(shifter_carry_out);
        }
        break;
      }

      case EOR: {
        // Format(instr, &quot;eor&#39;cond&#39;s &#39;rd, &#39;rn, &#39;shift_rm&quot;);
        // Format(instr, &quot;eor&#39;cond&#39;s &#39;rd, &#39;rn, &#39;imm&quot;);
        alu_out = rn_val ^ shifter_operand;
        set_register(rd, alu_out);
        if (instr-&gt;HasS()) {
          SetNZFlags(alu_out);
          SetCFlag(shifter_carry_out);
        }
        break;
      }

      case SUB: {
        // Format(instr, &quot;sub&#39;cond&#39;s &#39;rd, &#39;rn, &#39;shift_rm&quot;);
        // Format(instr, &quot;sub&#39;cond&#39;s &#39;rd, &#39;rn, &#39;imm&quot;);
        alu_out = rn_val - shifter_operand;
        set_register(rd, alu_out);
        if (instr-&gt;HasS()) {
          SetNZFlags(alu_out);
          SetCFlag(!BorrowFrom(rn_val, shifter_operand));
          SetVFlag(OverflowFrom(alu_out, rn_val, shifter_operand, false));
        }
        break;
      }

      case RSB: {
        // Format(instr, &quot;rsb&#39;cond&#39;s &#39;rd, &#39;rn, &#39;shift_rm&quot;);
        // Format(instr, &quot;rsb&#39;cond&#39;s &#39;rd, &#39;rn, &#39;imm&quot;);
        alu_out = shifter_operand - rn_val;
        set_register(rd, alu_out);
        if (instr-&gt;HasS()) {
          SetNZFlags(alu_out);
          SetCFlag(!BorrowFrom(shifter_operand, rn_val));
          SetVFlag(OverflowFrom(alu_out, shifter_operand, rn_val, false));
        }
        break;
      }

      case ADD: {
        // Format(instr, &quot;add&#39;cond&#39;s &#39;rd, &#39;rn, &#39;shift_rm&quot;);
        // Format(instr, &quot;add&#39;cond&#39;s &#39;rd, &#39;rn, &#39;imm&quot;);
        alu_out = rn_val + shifter_operand;
        set_register(rd, alu_out);
        if (instr-&gt;HasS()) {
          SetNZFlags(alu_out);
          SetCFlag(CarryFrom(rn_val, shifter_operand));
          SetVFlag(OverflowFrom(alu_out, rn_val, shifter_operand, true));
        }
        break;
      }

      case ADC: {
        // Format(instr, &quot;adc&#39;cond&#39;s &#39;rd, &#39;rn, &#39;shift_rm&quot;);
        // Format(instr, &quot;adc&#39;cond&#39;s &#39;rd, &#39;rn, &#39;imm&quot;);
        alu_out = rn_val + shifter_operand + GetCarry();
        set_register(rd, alu_out);
        if (instr-&gt;HasS()) {
          SetNZFlags(alu_out);
          SetCFlag(CarryFrom(rn_val, shifter_operand, GetCarry()));
          SetVFlag(OverflowFrom(alu_out, rn_val, shifter_operand, true));
        }
        break;
      }

      case SBC: {
        Format(instr, &quot;sbc&#39;cond&#39;s &#39;rd, &#39;rn, &#39;shift_rm&quot;);
        Format(instr, &quot;sbc&#39;cond&#39;s &#39;rd, &#39;rn, &#39;imm&quot;);
        break;
      }

      case RSC: {
        Format(instr, &quot;rsc&#39;cond&#39;s &#39;rd, &#39;rn, &#39;shift_rm&quot;);
        Format(instr, &quot;rsc&#39;cond&#39;s &#39;rd, &#39;rn, &#39;imm&quot;);
        break;
      }

      case TST: {
        if (instr-&gt;HasS()) {
          // Format(instr, &quot;tst&#39;cond &#39;rn, &#39;shift_rm&quot;);
          // Format(instr, &quot;tst&#39;cond &#39;rn, &#39;imm&quot;);
          alu_out = rn_val & shifter_operand;
          SetNZFlags(alu_out);
          SetCFlag(shifter_carry_out);
        } else {
          // Format(instr, &quot;movw&#39;cond &#39;rd, &#39;imm&quot;).
          alu_out = instr-&gt;ImmedMovwMovtValue();
          set_register(rd, alu_out);
        }
        break;
      }

      case TEQ: {
        if (instr-&gt;HasS()) {
          // Format(instr, &quot;teq&#39;cond &#39;rn, &#39;shift_rm&quot;);
          // Format(instr, &quot;teq&#39;cond &#39;rn, &#39;imm&quot;);
          alu_out = rn_val ^ shifter_operand;
          SetNZFlags(alu_out);
          SetCFlag(shifter_carry_out);
        } else {
          // Other instructions matching this pattern are handled in the
          // miscellaneous instructions part above.
          UNREACHABLE();
        }
        break;
      }

      case CMP: {
        if (instr-&gt;HasS()) {
          // Format(instr, &quot;cmp&#39;cond &#39;rn, &#39;shift_rm&quot;);
          // Format(instr, &quot;cmp&#39;cond &#39;rn, &#39;imm&quot;);
          alu_out = rn_val - shifter_operand;
          SetNZFlags(alu_out);
          SetCFlag(!BorrowFrom(rn_val, shifter_operand));
          SetVFlag(OverflowFrom(alu_out, rn_val, shifter_operand, false));
        } else {
          // Format(instr, &quot;movt&#39;cond &#39;rd, &#39;imm&quot;).
          alu_out = (get_register(rd) & 0xffff) |
              (instr-&gt;ImmedMovwMovtValue() &lt;&lt; 16);
          set_register(rd, alu_out);
        }
        break;
      }

      case CMN: {
        if (instr-&gt;HasS()) {
          // Format(instr, &quot;cmn&#39;cond &#39;rn, &#39;shift_rm&quot;);
          // Format(instr, &quot;cmn&#39;cond &#39;rn, &#39;imm&quot;);
          alu_out = rn_val + shifter_operand;
          SetNZFlags(alu_out);
          SetCFlag(!CarryFrom(rn_val, shifter_operand));
          SetVFlag(OverflowFrom(alu_out, rn_val, shifter_operand, true));
        } else {
          // Other instructions matching this pattern are handled in the
          // miscellaneous instructions part above.
          UNREACHABLE();
        }
        break;
      }

      case ORR: {
        // Format(instr, &quot;orr&#39;cond&#39;s &#39;rd, &#39;rn, &#39;shift_rm&quot;);
        // Format(instr, &quot;orr&#39;cond&#39;s &#39;rd, &#39;rn, &#39;imm&quot;);
        alu_out = rn_val | shifter_operand;
        set_register(rd, alu_out);
        if (instr-&gt;HasS()) {
          SetNZFlags(alu_out);
          SetCFlag(shifter_carry_out);
        }
        break;
      }

      case MOV: {
        // Format(instr, &quot;mov&#39;cond&#39;s &#39;rd, &#39;shift_rm&quot;);
        // Format(instr, &quot;mov&#39;cond&#39;s &#39;rd, &#39;imm&quot;);
        alu_out = shifter_operand;
        set_register(rd, alu_out);
        if (instr-&gt;HasS()) {
          SetNZFlags(alu_out);
          SetCFlag(shifter_carry_out);
        }
        break;
      }

      case BIC: {
        // Format(instr, &quot;bic&#39;cond&#39;s &#39;rd, &#39;rn, &#39;shift_rm&quot;);
        // Format(instr, &quot;bic&#39;cond&#39;s &#39;rd, &#39;rn, &#39;imm&quot;);
        alu_out = rn_val & ~shifter_operand;
        set_register(rd, alu_out);
        if (instr-&gt;HasS()) {
          SetNZFlags(alu_out);
          SetCFlag(shifter_carry_out);
        }
        break;
      }

      case MVN: {
        // Format(instr, &quot;mvn&#39;cond&#39;s &#39;rd, &#39;shift_rm&quot;);
        // Format(instr, &quot;mvn&#39;cond&#39;s &#39;rd, &#39;imm&quot;);
        alu_out = ~shifter_operand;
        set_register(rd, alu_out);
        if (instr-&gt;HasS()) {
          SetNZFlags(alu_out);
          SetCFlag(shifter_carry_out);
        }
        break;
      }

      default: {
        UNREACHABLE();
        break;
      }
    }
  }
}</span>


<span class="insertion" title="inserted">void Simulator::DecodeType2(Instruction* instr) {
  int rd = instr-&gt;RdValue();
  int rn = instr-&gt;RnValue();
  int32_t rn_val = get_register(rn);
  int32_t im_val = instr-&gt;Offset12Value();
  int32_t addr = 0;
  switch (instr-&gt;PUField()) {
    case da_x: {
      // Format(instr, &quot;&#39;memop&#39;cond&#39;b &#39;rd, [&#39;rn], #-&#39;off12&quot;);
      ASSERT(!instr-&gt;HasW());
      addr = rn_val;
      rn_val -= im_val;
      set_register(rn, rn_val);
      break;
    }
    case ia_x: {
      // Format(instr, &quot;&#39;memop&#39;cond&#39;b &#39;rd, [&#39;rn], #+&#39;off12&quot;);
      ASSERT(!instr-&gt;HasW());
      addr = rn_val;
      rn_val += im_val;
      set_register(rn, rn_val);
      break;
    }
    case db_x: {
      // Format(instr, &quot;&#39;memop&#39;cond&#39;b &#39;rd, [&#39;rn, #-&#39;off12]&#39;w&quot;);
      rn_val -= im_val;
      addr = rn_val;
      if (instr-&gt;HasW()) {
        set_register(rn, rn_val);
      }
      break;
    }
    case ib_x: {
      // Format(instr, &quot;&#39;memop&#39;cond&#39;b &#39;rd, [&#39;rn, #+&#39;off12]&#39;w&quot;);
      rn_val += im_val;
      addr = rn_val;
      if (instr-&gt;HasW()) {
        set_register(rn, rn_val);
      }
      break;
    }
    default: {
      UNREACHABLE();
      break;
    }
  }
  if (instr-&gt;HasB()) {
    if (instr-&gt;HasL()) {
      byte val = ReadBU(addr);
      set_register(rd, val);
    } else {
      byte val = get_register(rd);
      WriteB(addr, val);
    }
  } else {
    if (instr-&gt;HasL()) {
      set_register(rd, ReadW(addr, instr));
    } else {
      WriteW(addr, get_register(rd), instr);
    }
  }
}</span>


<span class="insertion" title="inserted">void Simulator::DecodeType3(Instruction* instr) {
  int rd = instr-&gt;RdValue();
  int rn = instr-&gt;RnValue();
  int32_t rn_val = get_register(rn);
  bool shifter_carry_out = 0;
  int32_t shifter_operand = GetShiftRm(instr, &shifter_carry_out);
  int32_t addr = 0;
  switch (instr-&gt;PUField()) {
    case da_x: {
      ASSERT(!instr-&gt;HasW());
      Format(instr, &quot;&#39;memop&#39;cond&#39;b &#39;rd, [&#39;rn], -&#39;shift_rm&quot;);
      UNIMPLEMENTED();
      break;
    }
    case ia_x: {
      if (instr-&gt;HasW()) {
        ASSERT(instr-&gt;Bits(5, 4) == 0x1);

        if (instr-&gt;Bit(22) == 0x1) {  // USAT.
          int32_t sat_pos = instr-&gt;Bits(20, 16);
          int32_t sat_val = (1 &lt;&lt; sat_pos) - 1;
          int32_t shift = instr-&gt;Bits(11, 7);
          int32_t shift_type = instr-&gt;Bit(6);
          int32_t rm_val = get_register(instr-&gt;RmValue());
          if (shift_type == 0) {  // LSL
            rm_val &lt;&lt;= shift;
          } else {  // ASR
            rm_val &gt;&gt;= shift;
          }
          // If saturation occurs, the Q flag should be set in the CPSR.
          // There is no Q flag yet, and no instruction (MRS) to read the
          // CPSR directly.
          if (rm_val &gt; sat_val) {
            rm_val = sat_val;
          } else if (rm_val &lt; 0) {
            rm_val = 0;
          }
          set_register(rd, rm_val);
        } else {  // SSAT.
          UNIMPLEMENTED();
        }
        return;
      } else {
        Format(instr, &quot;&#39;memop&#39;cond&#39;b &#39;rd, [&#39;rn], +&#39;shift_rm&quot;);
        UNIMPLEMENTED();
      }
      break;
    }
    case db_x: {
      // Format(instr, &quot;&#39;memop&#39;cond&#39;b &#39;rd, [&#39;rn, -&#39;shift_rm]&#39;w&quot;);
      addr = rn_val - shifter_operand;
      if (instr-&gt;HasW()) {
        set_register(rn, addr);
      }
      break;
    }
    case ib_x: {
      if (instr-&gt;HasW() && (instr-&gt;Bits(6, 4) == 0x5)) {
        uint32_t widthminus1 = static_cast&lt;uint32_t&gt;(instr-&gt;Bits(20, 16));
        uint32_t lsbit = static_cast&lt;uint32_t&gt;(instr-&gt;Bits(11, 7));
        uint32_t msbit = widthminus1 + lsbit;
        if (msbit &lt;= 31) {
          if (instr-&gt;Bit(22)) {
            // ubfx - unsigned bitfield extract.
            uint32_t rm_val =
                static_cast&lt;uint32_t&gt;(get_register(instr-&gt;RmValue()));
            uint32_t extr_val = rm_val &lt;&lt; (31 - msbit);
            extr_val = extr_val &gt;&gt; (31 - widthminus1);
            set_register(instr-&gt;RdValue(), extr_val);
          } else {
            // sbfx - signed bitfield extract.
            int32_t rm_val = get_register(instr-&gt;RmValue());
            int32_t extr_val = rm_val &lt;&lt; (31 - msbit);
            extr_val = extr_val &gt;&gt; (31 - widthminus1);
            set_register(instr-&gt;RdValue(), extr_val);
          }
        } else {
          UNREACHABLE();
        }
        return;
      } else if (!instr-&gt;HasW() && (instr-&gt;Bits(6, 4) == 0x1)) {
        uint32_t lsbit = static_cast&lt;uint32_t&gt;(instr-&gt;Bits(11, 7));
        uint32_t msbit = static_cast&lt;uint32_t&gt;(instr-&gt;Bits(20, 16));
        if (msbit &gt;= lsbit) {
          // bfc or bfi - bitfield clear/insert.
          uint32_t rd_val =
              static_cast&lt;uint32_t&gt;(get_register(instr-&gt;RdValue()));
          uint32_t bitcount = msbit - lsbit + 1;
          uint32_t mask = (1 &lt;&lt; bitcount) - 1;
          rd_val &= ~(mask &lt;&lt; lsbit);
          if (instr-&gt;RmValue() != 15) {
            // bfi - bitfield insert.
            uint32_t rm_val =
                static_cast&lt;uint32_t&gt;(get_register(instr-&gt;RmValue()));
            rm_val &= mask;
            rd_val |= rm_val &lt;&lt; lsbit;
          }
          set_register(instr-&gt;RdValue(), rd_val);
        } else {
          UNREACHABLE();
        }
        return;
      } else {
        // Format(instr, &quot;&#39;memop&#39;cond&#39;b &#39;rd, [&#39;rn, +&#39;shift_rm]&#39;w&quot;);
        addr = rn_val + shifter_operand;
        if (instr-&gt;HasW()) {
          set_register(rn, addr);
        }
      }
      break;
    }
    default: {
      UNREACHABLE();
      break;
    }
  }
  if (instr-&gt;HasB()) {
    if (instr-&gt;HasL()) {
      uint8_t byte = ReadB(addr);
      set_register(rd, byte);
    } else {
      uint8_t byte = get_register(rd);
      WriteB(addr, byte);
    }
  } else {
    if (instr-&gt;HasL()) {
      set_register(rd, ReadW(addr, instr));
    } else {
      WriteW(addr, get_register(rd), instr);
    }
  }
}</span>


<span class="insertion" title="inserted">void Simulator::DecodeType4(Instruction* instr) {
  ASSERT(instr-&gt;Bit(22) == 0);  // only allowed to be set in privileged mode
  if (instr-&gt;HasL()) {
    // Format(instr, &quot;ldm&#39;cond&#39;pu &#39;rn&#39;w, &#39;rlist&quot;);
    HandleRList(instr, true);
  } else {
    // Format(instr, &quot;stm&#39;cond&#39;pu &#39;rn&#39;w, &#39;rlist&quot;);
    HandleRList(instr, false);
  }
}</span>


<span class="insertion" title="inserted">void Simulator::DecodeType5(Instruction* instr) {
  // Format(instr, &quot;b&#39;l&#39;cond &#39;target&quot;);
  int off = (instr-&gt;SImmed24Value() &lt;&lt; 2);
  intptr_t pc_address = get_pc();
  if (instr-&gt;HasLink()) {
    set_register(lr, pc_address + Instruction::kInstrSize);
  }
  int pc_reg = get_register(pc);
  set_pc(pc_reg + off);
}</span>


<span class="insertion" title="inserted">void Simulator::DecodeType6(Instruction* instr) {
  DecodeType6CoprocessorIns(instr);
}</span>


<span class="insertion" title="inserted">void Simulator::DecodeType7(Instruction* instr) {
  if (instr-&gt;Bit(24) == 1) {
    SoftwareInterrupt(instr);
  } else {
    DecodeTypeVFP(instr);
  }
}</span>


// void Simulator::DecodeTypeVFP(Instruction* instr)
// The Following ARMv7 VFPv instructions are currently supported.
// vmov :Sn = Rt
// vmov :Rt = Sn
// vcvt: Dd = Sm
// vcvt: Sd = Dm
// Dd = vabs(Dm)
// Dd = vneg(Dm)
// Dd = vadd(Dn, Dm)
// Dd = vsub(Dn, Dm)
// Dd = vmul(Dn, Dm)
// Dd = vdiv(Dn, Dm)
// vcmp(Dd, Dm)
// vmrs
// Dd = vsqrt(Dm)
<span class="insertion" title="inserted">void Simulator::DecodeTypeVFP(Instruction* instr) {
  ASSERT((instr-&gt;TypeValue() == 7) && (instr-&gt;Bit(24) == 0x0) );
  ASSERT(instr-&gt;Bits(11, 9) == 0x5);

  // Obtain double precision register codes.
  int vm = instr-&gt;VFPMRegValue(kDoublePrecision);
  int vd = instr-&gt;VFPDRegValue(kDoublePrecision);
  int vn = instr-&gt;VFPNRegValue(kDoublePrecision);

  if (instr-&gt;Bit(4) == 0) {
    if (instr-&gt;Opc1Value() == 0x7) {
      // Other data processing instructions
      if ((instr-&gt;Opc2Value() == 0x0) && (instr-&gt;Opc3Value() == 0x1)) {
        // vmov register to register.
        if (instr-&gt;SzValue() == 0x1) {
          int m = instr-&gt;VFPMRegValue(kDoublePrecision);
          int d = instr-&gt;VFPDRegValue(kDoublePrecision);
          set_d_register_from_double(d, get_double_from_d_register(m));
        } else {
          int m = instr-&gt;VFPMRegValue(kSinglePrecision);
          int d = instr-&gt;VFPDRegValue(kSinglePrecision);
          set_s_register_from_float(d, get_float_from_s_register(m));
        }
      } else if ((instr-&gt;Opc2Value() == 0x0) && (instr-&gt;Opc3Value() == 0x3)) {
        // vabs
        double dm_value = get_double_from_d_register(vm);
        double dd_value = fabs(dm_value);
        set_d_register_from_double(vd, dd_value);
      } else if ((instr-&gt;Opc2Value() == 0x1) && (instr-&gt;Opc3Value() == 0x1)) {
        // vneg
        double dm_value = get_double_from_d_register(vm);
        double dd_value = -dm_value;
        set_d_register_from_double(vd, dd_value);
      } else if ((instr-&gt;Opc2Value() == 0x7) && (instr-&gt;Opc3Value() == 0x3)) {
        DecodeVCVTBetweenDoubleAndSingle(instr);
      } else if ((instr-&gt;Opc2Value() == 0x8) && (instr-&gt;Opc3Value() & 0x1)) {
        DecodeVCVTBetweenFloatingPointAndInteger(instr);
      } else if (((instr-&gt;Opc2Value() &gt;&gt; 1) == 0x6) &&
                 (instr-&gt;Opc3Value() & 0x1)) {
        DecodeVCVTBetweenFloatingPointAndInteger(instr);
      } else if (((instr-&gt;Opc2Value() == 0x4) || (instr-&gt;Opc2Value() == 0x5)) &&
                 (instr-&gt;Opc3Value() & 0x1)) {
        DecodeVCMP(instr);
      } else if (((instr-&gt;Opc2Value() == 0x1)) && (instr-&gt;Opc3Value() == 0x3)) {
        // vsqrt
        double dm_value = get_double_from_d_register(vm);
        double dd_value = sqrt(dm_value);
        set_d_register_from_double(vd, dd_value);
      } else if (instr-&gt;Opc3Value() == 0x0) {
        // vmov immediate.
        if (instr-&gt;SzValue() == 0x1) {
          set_d_register_from_double(vd, instr-&gt;DoubleImmedVmov());
        } else {
          UNREACHABLE();  // Not used by v8.
        }
      } else {
        UNREACHABLE();  // Not used by V8.
      }
    } else if (instr-&gt;Opc1Value() == 0x3) {
      if (instr-&gt;SzValue() != 0x1) {
        UNREACHABLE();  // Not used by V8.
      }

      if (instr-&gt;Opc3Value() & 0x1) {
        // vsub
        double dn_value = get_double_from_d_register(vn);
        double dm_value = get_double_from_d_register(vm);
        double dd_value = dn_value - dm_value;
        set_d_register_from_double(vd, dd_value);
      } else {
        // vadd
        double dn_value = get_double_from_d_register(vn);
        double dm_value = get_double_from_d_register(vm);
        double dd_value = dn_value + dm_value;
        set_d_register_from_double(vd, dd_value);
      }
    } else if ((instr-&gt;Opc1Value() == 0x2) && !(instr-&gt;Opc3Value() & 0x1)) {
      // vmul
      if (instr-&gt;SzValue() != 0x1) {
        UNREACHABLE();  // Not used by V8.
      }

      double dn_value = get_double_from_d_register(vn);
      double dm_value = get_double_from_d_register(vm);
      double dd_value = dn_value * dm_value;
      set_d_register_from_double(vd, dd_value);
    } else if ((instr-&gt;Opc1Value() == 0x4) && !(instr-&gt;Opc3Value() & 0x1)) {
      // vdiv
      if (instr-&gt;SzValue() != 0x1) {
        UNREACHABLE();  // Not used by V8.
      }

      double dn_value = get_double_from_d_register(vn);
      double dm_value = get_double_from_d_register(vm);
      double dd_value = dn_value / dm_value;
      div_zero_vfp_flag_ = (dm_value == 0);
      set_d_register_from_double(vd, dd_value);
    } else {
      UNIMPLEMENTED();  // Not used by V8.
    }
  } else {
    if ((instr-&gt;VCValue() == 0x0) &&
        (instr-&gt;VAValue() == 0x0)) {
      DecodeVMOVBetweenCoreAndSinglePrecisionRegisters(instr);
    } else if ((instr-&gt;VLValue() == 0x1) &&
               (instr-&gt;VCValue() == 0x0) &&
               (instr-&gt;VAValue() == 0x7) &&
               (instr-&gt;Bits(19, 16) == 0x1)) {
      // vmrs
      uint32_t rt = instr-&gt;RtValue();
      if (rt == 0xF) {
        Copy_FPSCR_to_APSR();
      } else {
        // Emulate FPSCR from the Simulator flags.
        uint32_t fpscr = (n_flag_FPSCR_ &lt;&lt; 31) |
                         (z_flag_FPSCR_ &lt;&lt; 30) |
                         (c_flag_FPSCR_ &lt;&lt; 29) |
                         (v_flag_FPSCR_ &lt;&lt; 28) |
                         (inexact_vfp_flag_ &lt;&lt; 4) |
                         (underflow_vfp_flag_ &lt;&lt; 3) |
                         (overflow_vfp_flag_ &lt;&lt; 2) |
                         (div_zero_vfp_flag_ &lt;&lt; 1) |
                         (inv_op_vfp_flag_ &lt;&lt; 0) |
                         (FPSCR_rounding_mode_);
        set_register(rt, fpscr);
      }
    } else if ((instr-&gt;VLValue() == 0x0) &&
               (instr-&gt;VCValue() == 0x0) &&
               (instr-&gt;VAValue() == 0x7) &&
               (instr-&gt;Bits(19, 16) == 0x1)) {
      // vmsr
      uint32_t rt = instr-&gt;RtValue();
      if (rt == pc) {
        UNREACHABLE();
      } else {
        uint32_t rt_value = get_register(rt);
        n_flag_FPSCR_ = (rt_value &gt;&gt; 31) & 1;
        z_flag_FPSCR_ = (rt_value &gt;&gt; 30) & 1;
        c_flag_FPSCR_ = (rt_value &gt;&gt; 29) & 1;
        v_flag_FPSCR_ = (rt_value &gt;&gt; 28) & 1;
        inexact_vfp_flag_ = (rt_value &gt;&gt; 4) & 1;
        underflow_vfp_flag_ = (rt_value &gt;&gt; 3) & 1;
        overflow_vfp_flag_ = (rt_value &gt;&gt; 2) & 1;
        div_zero_vfp_flag_ = (rt_value &gt;&gt; 1) & 1;
        inv_op_vfp_flag_ = (rt_value &gt;&gt; 0) & 1;
        FPSCR_rounding_mode_ =
            static_cast&lt;VFPRoundingMode&gt;((rt_value) & kVFPRoundingModeMask);
      }
    } else {
      UNIMPLEMENTED();  // Not used by V8.
    }
  }
}</span>


<span class="insertion" title="inserted">void Simulator::DecodeVMOVBetweenCoreAndSinglePrecisionRegisters(
    Instruction* instr) {
  ASSERT((instr-&gt;Bit(4) == 1) && (instr-&gt;VCValue() == 0x0) &&
         (instr-&gt;VAValue() == 0x0));

  int t = instr-&gt;RtValue();
  int n = instr-&gt;VFPNRegValue(kSinglePrecision);
  bool to_arm_register = (instr-&gt;VLValue() == 0x1);

  if (to_arm_register) {
    int32_t int_value = get_sinteger_from_s_register(n);
    set_register(t, int_value);
  } else {
    int32_t rs_val = get_register(t);
    set_s_register_from_sinteger(n, rs_val);
  }
}</span>


<span class="insertion" title="inserted">void Simulator::DecodeVCMP(Instruction* instr) {
  ASSERT((instr-&gt;Bit(4) == 0) && (instr-&gt;Opc1Value() == 0x7));
  ASSERT(((instr-&gt;Opc2Value() == 0x4) || (instr-&gt;Opc2Value() == 0x5)) &&
         (instr-&gt;Opc3Value() & 0x1));
  // Comparison.

  VFPRegPrecision precision = kSinglePrecision;
  if (instr-&gt;SzValue() == 1) {
    precision = kDoublePrecision;
  }

  int d = instr-&gt;VFPDRegValue(precision);
  int m = 0;
  if (instr-&gt;Opc2Value() == 0x4) {
    m = instr-&gt;VFPMRegValue(precision);
  }

  if (precision == kDoublePrecision) {
    double dd_value = get_double_from_d_register(d);
    double dm_value = 0.0;
    if (instr-&gt;Opc2Value() == 0x4) {
      dm_value = get_double_from_d_register(m);
    }

    // Raise exceptions for quiet NaNs if necessary.
    if (instr-&gt;Bit(7) == 1) {
      if (isnan(dd_value)) {
        inv_op_vfp_flag_ = true;
      }
    }

    Compute_FPSCR_Flags(dd_value, dm_value);
  } else {
    UNIMPLEMENTED();  // Not used by V8.
  }
}</span>


<span class="insertion" title="inserted">void Simulator::DecodeVCVTBetweenDoubleAndSingle(Instruction* instr) {
  ASSERT((instr-&gt;Bit(4) == 0) && (instr-&gt;Opc1Value() == 0x7));
  ASSERT((instr-&gt;Opc2Value() == 0x7) && (instr-&gt;Opc3Value() == 0x3));

  VFPRegPrecision dst_precision = kDoublePrecision;
  VFPRegPrecision src_precision = kSinglePrecision;
  if (instr-&gt;SzValue() == 1) {
    dst_precision = kSinglePrecision;
    src_precision = kDoublePrecision;
  }

  int dst = instr-&gt;VFPDRegValue(dst_precision);
  int src = instr-&gt;VFPMRegValue(src_precision);

  if (dst_precision == kSinglePrecision) {
    double val = get_double_from_d_register(src);
    set_s_register_from_float(dst, static_cast&lt;float&gt;(val));
  } else {
    float val = get_float_from_s_register(src);
    set_d_register_from_double(dst, static_cast&lt;double&gt;(val));
  }
}</span>

<span class="insertion" title="inserted">bool get_inv_op_vfp_flag(VFPRoundingMode mode,
                         double val,
                         bool unsigned_) {
  ASSERT((mode == RN) || (mode == RM) || (mode == RZ));
  double max_uint = static_cast&lt;double&gt;(0xffffffffu);
  double max_int = static_cast&lt;double&gt;(kMaxInt);
  double min_int = static_cast&lt;double&gt;(kMinInt);

  // Check for NaN.
  if (val != val) {
    return true;
  }

  // Check for overflow. This code works because 32bit integers can be
  // exactly represented by ieee-754 64bit floating-point values.
  switch (mode) {
    case RN:
      return  unsigned_ ? (val &gt;= (max_uint + 0.5)) ||
                          (val &lt; -0.5)
                        : (val &gt;= (max_int + 0.5)) ||
                          (val &lt; (min_int - 0.5));

    case RM:
      return  unsigned_ ? (val &gt;= (max_uint + 1.0)) ||
                          (val &lt; 0)
                        : (val &gt;= (max_int + 1.0)) ||
                          (val &lt; min_int);

    case RZ:
      return  unsigned_ ? (val &gt;= (max_uint + 1.0)) ||
                          (val &lt;= -1)
                        : (val &gt;= (max_int + 1.0)) ||
                          (val &lt;= (min_int - 1.0));
    default:
      UNREACHABLE();
      return true;
  }
}</span>


// We call this function only if we had a vfp invalid exception.
// It returns the correct saturated value.
<span class="insertion" title="inserted">int VFPConversionSaturate(double val, bool unsigned_res) {
  if (val != val) {
    return 0;
  } else {
    if (unsigned_res) {
      return (val &lt; 0) ? 0 : 0xffffffffu;
    } else {
      return (val &lt; 0) ? kMinInt : kMaxInt;
    }
  }
}</span>


<span class="insertion" title="inserted">void Simulator::DecodeVCVTBetweenFloatingPointAndInteger(Instruction* instr) {
  ASSERT((instr-&gt;Bit(4) == 0) && (instr-&gt;Opc1Value() == 0x7) &&
         (instr-&gt;Bits(27, 23) == 0x1D));
  ASSERT(((instr-&gt;Opc2Value() == 0x8) && (instr-&gt;Opc3Value() & 0x1)) ||
         (((instr-&gt;Opc2Value() &gt;&gt; 1) == 0x6) && (instr-&gt;Opc3Value() & 0x1)));

  // Conversion between floating-point and integer.
  bool to_integer = (instr-&gt;Bit(18) == 1);

  VFPRegPrecision src_precision = (instr-&gt;SzValue() == 1) ? kDoublePrecision
                                                          : kSinglePrecision;

  if (to_integer) {
    // We are playing with code close to the C++ standard&#39;s limits below,
    // hence the very simple code and heavy checks.
    //
    // Note:
    // C++ defines default type casting from floating point to integer as
    // (close to) rounding toward zero (&quot;fractional part discarded&quot;).

    int dst = instr-&gt;VFPDRegValue(kSinglePrecision);
    int src = instr-&gt;VFPMRegValue(src_precision);

    // Bit 7 in vcvt instructions indicates if we should use the FPSCR rounding
    // mode or the default Round to Zero mode.
    VFPRoundingMode mode = (instr-&gt;Bit(7) != 1) ? FPSCR_rounding_mode_
                                                : RZ;
    ASSERT((mode == RM) || (mode == RZ) || (mode == RN));

    bool unsigned_integer = (instr-&gt;Bit(16) == 0);
    bool double_precision = (src_precision == kDoublePrecision);

    double val = double_precision ? get_double_from_d_register(src)
                                  : get_float_from_s_register(src);

    int temp = unsigned_integer ? static_cast&lt;uint32_t&gt;(val)
                                : static_cast&lt;int32_t&gt;(val);

    inv_op_vfp_flag_ = get_inv_op_vfp_flag(mode, val, unsigned_integer);

    double abs_diff =
      unsigned_integer ? fabs(val - static_cast&lt;uint32_t&gt;(temp))
                       : fabs(val - temp);

    inexact_vfp_flag_ = (abs_diff != 0);

    if (inv_op_vfp_flag_) {
      temp = VFPConversionSaturate(val, unsigned_integer);
    } else {
      switch (mode) {
        case RN: {
          int val_sign = (val &gt; 0) ? 1 : -1;
          if (abs_diff &gt; 0.5) {
            temp += val_sign;
          } else if (abs_diff == 0.5) {
            // Round to even if exactly halfway.
            temp = ((temp % 2) == 0) ? temp : temp + val_sign;
          }
          break;
        }

        case RM:
          temp = temp &gt; val ? temp - 1 : temp;
          break;

        case RZ:
          // Nothing to do.
          break;

        default:
          UNREACHABLE();
      }
    }

    // Update the destination register.
    set_s_register_from_sinteger(dst, temp);

  } else {
    bool unsigned_integer = (instr-&gt;Bit(7) == 0);

    int dst = instr-&gt;VFPDRegValue(src_precision);
    int src = instr-&gt;VFPMRegValue(kSinglePrecision);

    int val = get_sinteger_from_s_register(src);

    if (src_precision == kDoublePrecision) {
      if (unsigned_integer) {
        set_d_register_from_double(dst,
                                   static_cast&lt;double&gt;((uint32_t)val));
      } else {
        set_d_register_from_double(dst, static_cast&lt;double&gt;(val));
      }
    } else {
      if (unsigned_integer) {
        set_s_register_from_float(dst,
                                  static_cast&lt;float&gt;((uint32_t)val));
      } else {
        set_s_register_from_float(dst, static_cast&lt;float&gt;(val));
      }
    }
  }
}</span>


// void Simulator::DecodeType6CoprocessorIns(Instruction* instr)
// Decode Type 6 coprocessor instructions.
// Dm = vmov(Rt, Rt2)
// &lt;Rt, Rt2&gt; = vmov(Dm)
// Ddst = MEM(Rbase + 4*offset).
// MEM(Rbase + 4*offset) = Dsrc.
<span class="insertion" title="inserted">void Simulator::DecodeType6CoprocessorIns(Instruction* instr) {
  ASSERT((instr-&gt;TypeValue() == 6));

  if (instr-&gt;CoprocessorValue() == 0xA) {
    switch (instr-&gt;OpcodeValue()) {
      case 0x8:
      case 0xA:
      case 0xC:
      case 0xE: {  // Load and store single precision float to memory.
        int rn = instr-&gt;RnValue();
        int vd = instr-&gt;VFPDRegValue(kSinglePrecision);
        int offset = instr-&gt;Immed8Value();
        if (!instr-&gt;HasU()) {
          offset = -offset;
        }

        int32_t address = get_register(rn) + 4 * offset;
        if (instr-&gt;HasL()) {
          // Load double from memory: vldr.
          set_s_register_from_sinteger(vd, ReadW(address, instr));
        } else {
          // Store double to memory: vstr.
          WriteW(address, get_sinteger_from_s_register(vd), instr);
        }
        break;
      }
      case 0x4:
      case 0x5:
      case 0x6:
      case 0x7:
      case 0x9:
      case 0xB:
        // Load/store multiple single from memory: vldm/vstm.
        HandleVList(instr);
        break;
      default:
        UNIMPLEMENTED();  // Not used by V8.
    }
  } else if (instr-&gt;CoprocessorValue() == 0xB) {
    switch (instr-&gt;OpcodeValue()) {
      case 0x2:
        // Load and store double to two GP registers
        if (instr-&gt;Bits(7, 4) != 0x1) {
          UNIMPLEMENTED();  // Not used by V8.
        } else {
          int rt = instr-&gt;RtValue();
          int rn = instr-&gt;RnValue();
          int vm = instr-&gt;VmValue();
          if (instr-&gt;HasL()) {
            int32_t rt_int_value = get_sinteger_from_s_register(2*vm);
            int32_t rn_int_value = get_sinteger_from_s_register(2*vm+1);

            set_register(rt, rt_int_value);
            set_register(rn, rn_int_value);
          } else {
            int32_t rs_val = get_register(rt);
            int32_t rn_val = get_register(rn);

            set_s_register_from_sinteger(2*vm, rs_val);
            set_s_register_from_sinteger((2*vm+1), rn_val);
          }
        }
        break;
      case 0x8:
      case 0xC: {  // Load and store double to memory.
        int rn = instr-&gt;RnValue();
        int vd = instr-&gt;VdValue();
        int offset = instr-&gt;Immed8Value();
        if (!instr-&gt;HasU()) {
          offset = -offset;
        }
        int32_t address = get_register(rn) + 4 * offset;
        if (instr-&gt;HasL()) {
          // Load double from memory: vldr.
          set_s_register_from_sinteger(2*vd, ReadW(address, instr));
          set_s_register_from_sinteger(2*vd + 1, ReadW(address + 4, instr));
        } else {
          // Store double to memory: vstr.
          WriteW(address, get_sinteger_from_s_register(2*vd), instr);
          WriteW(address + 4, get_sinteger_from_s_register(2*vd + 1), instr);
        }
        break;
      }
      case 0x4:
      case 0x5:
      case 0x9:
        // Load/store multiple double from memory: vldm/vstm.
        HandleVList(instr);
        break;
      default:
        UNIMPLEMENTED();  // Not used by V8.
    }
  } else {
    UNIMPLEMENTED();  // Not used by V8.
  }
}</span>


// Executes the current instruction.
<a id='3992' tid='3991', class="move" title="(similarity 100%)">void</a> <a id='3994' tid='3993', class="move" title="(similarity 100%)">Simulator</a><a id='3996' tid='3995', class="move" title="(similarity 100%)">::</a><a id='3998' tid='3997', class="move" title="(similarity 100%)">InstructionDecode</a>(<a id='4000' tid='3999', class="move" title="(similarity 100%)">Instruction</a><a id='4002' tid='4001', class="move" title="(similarity 100%)">*</a> <a id='4004' tid='4003', class="move" title="(similarity 100%)">instr</a>) {
  <a id='4030' tid='4029', class="move" title="(similarity 100%)">if</a> (<a id='4032' tid='4031', class="move" title="(similarity 100%)">v8</a><a id='4034' tid='4033', class="move" title="(similarity 100%)">::</a><a id='4036' tid='4035', class="move" title="(similarity 100%)">internal</a><a id='4038' tid='4037', class="move" title="(similarity 100%)">::</a><a id='4040' tid='4039', class="move" title="(similarity 100%)">FLAG_check_icache</a>) {
    <a id='4042' tid='4041', class="move" title="(similarity 100%)">CheckICache</a>(<a id='4044' tid='4043', class="move" title="(similarity 100%)">isolate_</a>-&gt;<a id='4046' tid='4045', class="move" title="(similarity 100%)">simulator_i_cache</a>(), <a id='4048' tid='4047', class="move" title="(similarity 100%)">instr</a>);
  }
  <span class="insertion" title="inserted">pc_modified_ = false;</span>
  <a id='4220' tid='4219', class="move" title="(similarity 100%)">if</a> (<a id='4222' tid='4221', class="move" title="(similarity 100%)">::</a><a id='4224' tid='4223', class="move" title="(similarity 100%)">v8</a><a id='4226' tid='4225', class="move" title="(similarity 100%)">::</a><a id='4228' tid='4227', class="move" title="(similarity 100%)">internal</a><a id='4230' tid='4229', class="move" title="(similarity 100%)">::</a><a id='4232' tid='4231', class="move" title="(similarity 100%)">FLAG_trace_sim</a>) {
    <span class="insertion" title="inserted">disasm::NameConverter converter;</span>
    <span class="insertion" title="inserted">disasm::Disassembler dasm(converter)</span>;
    // use a reasonably large buffer
    <a id='4292' tid='4291', class="move" title="(similarity 100%)">v8</a><a id='4294' tid='4293', class="move" title="(similarity 100%)">::</a><a id='4296' tid='4295', class="move" title="(similarity 100%)">internal</a><a id='4298' tid='4297', class="move" title="(similarity 100%)">::</a><a id='4300' tid='4299', class="move" title="(similarity 100%)">EmbeddedVector</a>&lt;<a id='4302' tid='4301', class="move" title="(similarity 100%)">char</a>, <a id='4304' tid='4303', class="move" title="(similarity 100%)">256</a>&gt; <a id='4306' tid='4305', class="move" title="(similarity 100%)">buffer</a>;
    <a id='3978' tid='3977', class="move" title="(similarity 100%)">dasm</a>.<a id='3980' tid='3979', class="move" title="(similarity 100%)">InstructionDecode</a>(<a id='3982' tid='3981', class="move" title="(similarity 100%)">buffer</a>,
                           <a id='3984' tid='3983', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='3986' tid='3985', class="move" title="(similarity 100%)">byte</a><a id='3988' tid='3987', class="move" title="(similarity 100%)">*</a>&gt;(<a id='3990' tid='3989', class="move" title="(similarity 100%)">instr</a>));
    <a id='3964' tid='3963', class="move" title="(similarity 100%)">PrintF</a>(<a id='3966' tid='3965', class="move" title="(similarity 100%)">&quot;  0x%08x  %s\n&quot;</a>, <a id='3968' tid='3967', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='3970' tid='3969', class="move" title="(similarity 100%)">intptr_t</a>&gt;(<a id='3972' tid='3971', class="move" title="(similarity 100%)">instr</a>), <a id='3974' tid='3973', class="move" title="(similarity 100%)">buffer</a>.<a id='3976' tid='3975', class="move" title="(similarity 100%)">start</a>());
  }
  <span class="insertion" title="inserted">if</span> <span class="insertion" title="inserted">(instr-&gt;ConditionField() == kSpecialCondition)</span> <span class="insertion" title="inserted">{
    UNIMPLEMENTED();
  }</span> <span class="insertion" title="inserted">else</span> <span class="insertion" title="inserted">if</span> <span class="insertion" title="inserted">(ConditionallyExecute(instr))</span> <span class="insertion" title="inserted">{
    switch (instr-&gt;TypeValue()) {
      case 0:
      case 1: {
        DecodeType01(instr);
        break;
      }
      case 2: {
        DecodeType2(instr);
        break;
      }
      case 3: {
        DecodeType3(instr);
        break;
      }
      case 4: {
        DecodeType4(instr);
        break;
      }
      case 5: {
        DecodeType5(instr);
        break;
      }
      case 6: {
        DecodeType6(instr);
        break;
      }
      case 7: {
        DecodeType7(instr);
        break;
      }
      default: {
        UNIMPLEMENTED();
        break;
      }
    }
  // If the instruction is a non taken conditional stop, we need to skip the
  // inlined message address.
  }</span> <a id='4308' tid='4307', class="move" title="(similarity 100%)">else</a> <span class="insertion" title="inserted">if</span> <span class="insertion" title="inserted">(instr-&gt;IsStop())</span> {
    <a id='4310' tid='4309', class="move" title="(similarity 100%)">set_pc</a>(<a id='4312' tid='4311', class="move" title="(similarity 100%)">get_pc</a>() <a id='4314' tid='4313', class="move" title="(similarity 100%)">+</a> <a id='4316' tid='4315', class="move" title="(similarity 100%)">2</a> <a id='4318' tid='4317', class="move" title="(similarity 100%)">*</a> <a id='4320' tid='4319', class="move" title="(similarity 100%)">Instruction</a><a id='4322' tid='4321', class="move" title="(similarity 100%)">::</a><a id='4324' tid='4323', class="move" title="(similarity 100%)">kInstrSize</a>);
  }
  <a id='4006' tid='4005', class="move" title="(similarity 100%)">if</a> (<a id='4008' tid='4007', class="move" title="(similarity 100%)">!</a><a id='4010' tid='4009', class="move" title="(similarity 100%)">pc_modified_</a>) {
    <a id='4012' tid='4011', class="move" title="(similarity 100%)">set_register</a>(<a id='4014' tid='4013', class="move" title="(similarity 100%)">pc</a>, <a id='4016' tid='4015', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='4018' tid='4017', class="move" title="(similarity 100%)">int32_t</a>&gt;(<a id='4020' tid='4019', class="move" title="(similarity 100%)">instr</a>)
                         <a id='4022' tid='4021', class="move" title="(similarity 100%)">+</a> <a id='4024' tid='4023', class="move" title="(similarity 100%)">Instruction</a><a id='4026' tid='4025', class="move" title="(similarity 100%)">::</a><a id='4028' tid='4027', class="move" title="(similarity 100%)">kInstrSize</a>);
  }
}


<span class="insertion" title="inserted">void Simulator::Execute() {
  // Get the PC to simulate. Cannot use the accessor here as we need the
  // raw PC value and not the one used as input to arithmetic instructions.
  int program_counter = get_pc();

  if (::v8::internal::FLAG_stop_sim_at == 0) {
    // Fast version of the dispatch loop without checking whether the simulator
    // should be stopping at a particular executed instruction.
    while (program_counter != end_sim_pc) {
      Instruction* instr = reinterpret_cast&lt;Instruction*&gt;(program_counter);
      icount_++;
      InstructionDecode(instr);
      program_counter = get_pc();
    }
  } else {
    // FLAG_stop_sim_at is at the non-default value. Stop in the debugger when
    // we reach the particular instuction count.
    while (program_counter != end_sim_pc) {
      Instruction* instr = reinterpret_cast&lt;Instruction*&gt;(program_counter);
      icount_++;
      if (icount_ == ::v8::internal::FLAG_stop_sim_at) {
        ArmDebugger dbg(this);
        dbg.Debug();
      } else {
        InstructionDecode(instr);
      }
      program_counter = get_pc();
    }
  }
}</span>


<a id='4248' tid='4247', class="move" title="(similarity 100%)">int32_t</a> <a id='4250' tid='4249', class="move" title="(similarity 100%)">Simulator</a><a id='4252' tid='4251', class="move" title="(similarity 100%)">::</a><a id='4254' tid='4253', class="move" title="(similarity 100%)">Call</a>(<a id='4256' tid='4255', class="move" title="(similarity 100%)">byte</a><a id='4258' tid='4257', class="move" title="(similarity 100%)">*</a> <a id='4260' tid='4259', class="move" title="(similarity 100%)">entry</a>, <a id='4262' tid='4261', class="move" title="(similarity 100%)">int</a> <a id='4264' tid='4263', class="move" title="(similarity 100%)">argument_count</a>, <a id='4266' tid='4265', class="move" title="(similarity 100%)">...</a>) {
  <span class="insertion" title="inserted">va_list parameters;</span>
  <span class="insertion" title="inserted">va_start(parameters, argument_count);</span>
  // Setup arguments

  // First four arguments passed in registers.
  <span class="insertion" title="inserted">ASSERT(argument_count &gt;= 4);</span>
  <span class="insertion" title="inserted">set_register(r0, va_arg(parameters, int32_t));</span>
  <span class="insertion" title="inserted">set_register(r1, va_arg(parameters, int32_t));</span>
  <span class="insertion" title="inserted">set_register(r2, va_arg(parameters, int32_t));</span>
  <span class="insertion" title="inserted">set_register(r3, va_arg(parameters, int32_t));</span>

  // Remaining arguments passed on stack.
  <span class="insertion" title="inserted">int original_stack = get_register(sp);</span>
  // Compute position of stack on entry to generated code.
  <span class="insertion" title="inserted">int entry_stack = (original_stack - (argument_count - 4) * sizeof(int32_t));</span>
  <a id='4268' tid='4267', class="move" title="(similarity 100%)">if</a> (<a id='4270' tid='4269', class="move" title="(similarity 100%)">OS</a><a id='4272' tid='4271', class="move" title="(similarity 100%)">::</a><a id='4274' tid='4273', class="move" title="(similarity 100%)">ActivationFrameAlignment</a>() <a id='4276' tid='4275', class="move" title="(similarity 100%)">!=</a> <a id='4278' tid='4277', class="move" title="(similarity 100%)">0</a>) {
    <a id='4280' tid='4279', class="move" title="(similarity 100%)">entry_stack</a> <a id='4282' tid='4281', class="move" title="(similarity 100%)">&=</a> <a id='4284' tid='4283', class="move" title="(similarity 100%)">-</a><a id='4286' tid='4285', class="move" title="(similarity 100%)">OS</a><a id='4288' tid='4287', class="move" title="(similarity 100%)">::</a><a id='4290' tid='4289', class="move" title="(similarity 100%)">ActivationFrameAlignment</a>();
  }
  // Store remaining arguments on stack, from low to high memory.
  <a id='4234' tid='4233', class="move" title="(similarity 100%)">intptr_t</a><a id='4236' tid='4235', class="move" title="(similarity 100%)">*</a> <a id='4238' tid='4237', class="move" title="(similarity 100%)">stack_argument</a> = <a id='4240' tid='4239', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='4242' tid='4241', class="move" title="(similarity 100%)">intptr_t</a><a id='4244' tid='4243', class="move" title="(similarity 100%)">*</a>&gt;(<a id='4246' tid='4245', class="move" title="(similarity 100%)">entry_stack</a>);
  <span class="insertion" title="inserted">for</span> (<a id='4132' tid='4131', class="move" title="(similarity 100%)">int</a> <a id='4134' tid='4133', class="move" title="(similarity 100%)">i</a> = <a id='4136' tid='4135', class="move" title="(similarity 100%)">4</a>; <a id='4138' tid='4137', class="move" title="(similarity 100%)">i</a> <a id='4140' tid='4139', class="move" title="(similarity 100%)">&lt;</a> <a id='4142' tid='4141', class="move" title="(similarity 100%)">argument_count</a>; <a id='4144' tid='4143', class="move" title="(similarity 100%)">i</a><a id='4146' tid='4145', class="move" title="(similarity 100%)">++</a>) <span class="insertion" title="inserted">{
    stack_argument[i - 4] = va_arg(parameters, int32_t);
  }</span>
  <span class="insertion" title="inserted">va_end(parameters);</span>
  <span class="insertion" title="inserted">set_register(sp, entry_stack);</span>

  // Prepare to execute the code at entry
  <span class="insertion" title="inserted">set_register(pc, reinterpret_cast&lt;int32_t&gt;(entry));</span>
  // Put down marker for end of simulation. The simulator will stop simulation
  // when the PC reaches this value. By saving the &quot;end simulation&quot; value into
  // the LR the simulation stops when returning to this call point.
  <span class="insertion" title="inserted">set_register(lr, end_sim_pc);</span>

  // Remember the values of callee-saved registers.
  // The code below assumes that r9 is not used as sb (static base) in
  // simulator code and therefore is regarded as a callee-saved register.
  <span class="insertion" title="inserted">int32_t r4_val = get_register(r4);</span>
  <span class="insertion" title="inserted">int32_t r5_val = get_register(r5);</span>
  <span class="insertion" title="inserted">int32_t r6_val = get_register(r6);</span>
  <span class="insertion" title="inserted">int32_t r7_val = get_register(r7);</span>
  <span class="insertion" title="inserted">int32_t r8_val = get_register(r8);</span>
  <span class="insertion" title="inserted">int32_t r9_val = get_register(r9);</span>
  <span class="insertion" title="inserted">int32_t r10_val = get_register(r10);</span>
  <span class="insertion" title="inserted">int32_t r11_val = get_register(r11);</span>

  // Setup the callee-saved registers with a known value. To be able to check
  // that they are preserved properly across JS execution.
  <span class="insertion" title="inserted">int32_t callee_saved_value = icount_;</span>
  <span class="insertion" title="inserted">set_register(r4, callee_saved_value);</span>
  <span class="insertion" title="inserted">set_register(r5, callee_saved_value);</span>
  <span class="insertion" title="inserted">set_register(r6, callee_saved_value);</span>
  <span class="insertion" title="inserted">set_register(r7, callee_saved_value);</span>
  <span class="insertion" title="inserted">set_register(r8, callee_saved_value);</span>
  <span class="insertion" title="inserted">set_register(r9, callee_saved_value);</span>
  <span class="insertion" title="inserted">set_register(r10, callee_saved_value);</span>
  <span class="insertion" title="inserted">set_register(r11, callee_saved_value);</span>

  // Start the simulation
  <span class="insertion" title="inserted">Execute();</span>

  // Check that the callee-saved registers have been preserved.
  <span class="insertion" title="inserted">CHECK_EQ(callee_saved_value, get_register(r4));</span>
  <span class="insertion" title="inserted">CHECK_EQ(callee_saved_value, get_register(r5));</span>
  <span class="insertion" title="inserted">CHECK_EQ(callee_saved_value, get_register(r6));</span>
  <span class="insertion" title="inserted">CHECK_EQ(callee_saved_value, get_register(r7));</span>
  <span class="insertion" title="inserted">CHECK_EQ(callee_saved_value, get_register(r8));</span>
  <span class="insertion" title="inserted">CHECK_EQ(callee_saved_value, get_register(r9));</span>
  <span class="insertion" title="inserted">CHECK_EQ(callee_saved_value, get_register(r10));</span>
  <span class="insertion" title="inserted">CHECK_EQ(callee_saved_value, get_register(r11));</span>

  // Restore callee-saved registers with the original value.
  <span class="insertion" title="inserted">set_register(r4, r4_val);</span>
  <span class="insertion" title="inserted">set_register(r5, r5_val);</span>
  <span class="insertion" title="inserted">set_register(r6, r6_val);</span>
  <span class="insertion" title="inserted">set_register(r7, r7_val);</span>
  <span class="insertion" title="inserted">set_register(r8, r8_val);</span>
  <span class="insertion" title="inserted">set_register(r9, r9_val);</span>
  <span class="insertion" title="inserted">set_register(r10, r10_val);</span>
  <span class="insertion" title="inserted">set_register(r11, r11_val);</span>

  // Pop stack passed arguments.
  <span class="insertion" title="inserted">CHECK_EQ(entry_stack, get_register(sp));</span>
  <span class="insertion" title="inserted">set_register(sp, original_stack);</span>

  <span class="insertion" title="inserted">int32_t result = get_register(r0);</span>
  <span class="insertion" title="inserted">return result;</span>
}


<a id='4148' tid='4147', class="move" title="(similarity 100%)">uintptr_t</a> <a id='4150' tid='4149', class="move" title="(similarity 100%)">Simulator</a><a id='4152' tid='4151', class="move" title="(similarity 100%)">::</a><a id='4154' tid='4153', class="move" title="(similarity 100%)">PushAddress</a>(<a id='4156' tid='4155', class="move" title="(similarity 100%)">uintptr_t</a> <a id='4158' tid='4157', class="move" title="(similarity 100%)">address</a>) {
  <a id='4160' tid='4159', class="move" title="(similarity 100%)">int</a> <a id='4162' tid='4161', class="move" title="(similarity 100%)">new_sp</a> = <a id='4164' tid='4163', class="move" title="(similarity 100%)">get_register</a>(<a id='4166' tid='4165', class="move" title="(similarity 100%)">sp</a>) <a id='4168' tid='4167', class="move" title="(similarity 100%)">-</a> <a id='4170' tid='4169', class="move" title="(similarity 100%)">sizeof</a>(<a id='4172' tid='4171', class="move" title="(similarity 100%)">uintptr_t</a>);
  <a id='4174' tid='4173', class="move" title="(similarity 100%)">uintptr_t</a><a id='4176' tid='4175', class="move" title="(similarity 100%)">*</a> <a id='4178' tid='4177', class="move" title="(similarity 100%)">stack_slot</a> = <a id='4180' tid='4179', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='4182' tid='4181', class="move" title="(similarity 100%)">uintptr_t</a><a id='4184' tid='4183', class="move" title="(similarity 100%)">*</a>&gt;(<a id='4186' tid='4185', class="move" title="(similarity 100%)">new_sp</a>);
  <a id='4188' tid='4187', class="move" title="(similarity 100%)">*</a><a id='4190' tid='4189', class="move" title="(similarity 100%)">stack_slot</a> <a id='4192' tid='4191', class="move" title="(similarity 100%)">=</a> <a id='4194' tid='4193', class="move" title="(similarity 100%)">address</a>;
  <a id='4196' tid='4195', class="move" title="(similarity 100%)">set_register</a>(<a id='4198' tid='4197', class="move" title="(similarity 100%)">sp</a>, <a id='4200' tid='4199', class="move" title="(similarity 100%)">new_sp</a>);
  <a id='4202' tid='4201', class="move" title="(similarity 100%)">return</a> <a id='4204' tid='4203', class="move" title="(similarity 100%)">new_sp</a>;
}


<a id='4078' tid='4077', class="move" title="(similarity 100%)">uintptr_t</a> <a id='4080' tid='4079', class="move" title="(similarity 100%)">Simulator</a><a id='4082' tid='4081', class="move" title="(similarity 100%)">::</a><a id='4084' tid='4083', class="move" title="(similarity 100%)">PopAddress</a>() {
  <a id='4086' tid='4085', class="move" title="(similarity 100%)">int</a> <a id='4088' tid='4087', class="move" title="(similarity 100%)">current_sp</a> = <a id='4090' tid='4089', class="move" title="(similarity 100%)">get_register</a>(<a id='4092' tid='4091', class="move" title="(similarity 100%)">sp</a>);
  <a id='4094' tid='4093', class="move" title="(similarity 100%)">uintptr_t</a><a id='4096' tid='4095', class="move" title="(similarity 100%)">*</a> <a id='4098' tid='4097', class="move" title="(similarity 100%)">stack_slot</a> = <a id='4100' tid='4099', class="move" title="(similarity 100%)">reinterpret_cast</a>&lt;<a id='4102' tid='4101', class="move" title="(similarity 100%)">uintptr_t</a><a id='4104' tid='4103', class="move" title="(similarity 100%)">*</a>&gt;(<a id='4106' tid='4105', class="move" title="(similarity 100%)">current_sp</a>);
  <a id='4108' tid='4107', class="move" title="(similarity 100%)">uintptr_t</a> <a id='4110' tid='4109', class="move" title="(similarity 100%)">address</a> = <a id='4112' tid='4111', class="move" title="(similarity 100%)">*</a><a id='4114' tid='4113', class="move" title="(similarity 100%)">stack_slot</a>;
  <a id='4116' tid='4115', class="move" title="(similarity 100%)">set_register</a>(<a id='4118' tid='4117', class="move" title="(similarity 100%)">sp</a>, <a id='4120' tid='4119', class="move" title="(similarity 100%)">current_sp</a> <a id='4122' tid='4121', class="move" title="(similarity 100%)">+</a> <a id='4124' tid='4123', class="move" title="(similarity 100%)">sizeof</a>(<a id='4126' tid='4125', class="move" title="(similarity 100%)">uintptr_t</a>));
  <a id='4128' tid='4127', class="move" title="(similarity 100%)">return</a> <a id='4130' tid='4129', class="move" title="(similarity 100%)">address</a>;
}

} }  // namespace v8::internal

<span class="insertion" title="inserted">#endif</span>  // USE_SIMULATOR

<span class="insertion" title="inserted">#endif</span>  // V8_TARGET_ARCH_ARM


</pre>
</div>
</body>
</html>
